[{"url_object_id": "e471e2a60cb82e666c724e013e14e93b", "title": "我曾误删了公司的数据库，但还是活下来了", "url": "http://blog.jobbole.com/113909/", "create_date": "2018/04/21", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2011/12/i-accidentally-deleted-all-our-data.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.freecodecamp.org/the-times-ive-messed-up-as-a-developer-3c0bcaa1afd6\">Zachary Kuhn</a>   译文出处：<a target=\"_blank\" href=\"http://36kr.com/p/5129182.html\">36氪</a>   </div><p>上周我与同事们进行了一次关于职业生涯中搞砸了一些事情的简短谈话。这确实会沦为他人笑柄，却更给我们带来了珍贵的教训。重要的是，我们应该分享那些曾经的错误，这样其他人就可以从其中学习。下文是最近在我身上发生的例子。</p>\n<h3>为什么有如此多误删生产数据库的事情发生？</h3>\n<p>几个月前，Reddit上有<a href=\"https://www.reddit.com/r/cscareerquestions/comments/6ez8ag/accidentally_destroyed_production_database_on/\">一篇文章</a>，讲了一名初级开发人员在上班的第一天就删除了生产数据库的事。我们都很憷于读到这类犯了这类无法让人忘却的大错误的文章。因为我们离这些也不远，而大多数人都是“死里逃生”。</p>\n<p>在我的第一份工作中，一位高级数据库管理员在上班第一天就误删了生产数据库。这类故事情节比比皆是。这个团队从一个星期的备份中恢复了他导致的错误，并让他继续工作。十年后，他们依然将其作为笑点。</p>\n<p>今年早些时候，我被派去检查一个客户的生产数据上的问题。他们进行了小范围的非公开测试，结果网站上没有显示任何内容。我想查查是否是存在漏洞或是易损性问题导致了这一结果。</p>\n<p>我通过了生产机器上的签名环节，然后打开了数据库。内容库（articles table）内空空如也。这证实了我们在网站上看到的情况是真实的。</p>\n<p>用户库（users table）内依然有用户数据存在。真让人奇怪。所以情况是我们丢失了所有内容，但是至少测试用户的信息依然存在。我们给出的解释是这是一个测试行为，所以这些事情有可能发生。</p>\n<p>接下来的几分钟一片混乱。我不记得自己做了什么。我不认为自己笨到在控制台上执行了删除用户库的操作。但是事实就是这么发生了，现在后台既没有了内容库，也没有了用户库。这真实下了我一大跳。</p>\n<p>然后我的大脑就开始转动起来思考如何解决这个问题。我真的把用户库给删掉了吗？是的。我们存备份了吗？没有。我们应该如何告诉客户这个事情？不知道。</p>\n<p>我犹记得自己走向项目经理那里，坐在她身边，向她解释了发生了什么事情时的场面。因为我们的内容库中没有内容，这就是为什么网站上空空如也的原因。同时，我还删除了用户库。他们现在需要重新邀请所有的用户，如果他们能够弄清楚谁是谁。</p>\n<p>我回到了自己的办公室，垂头丧气。</p>\n<p>不过，我还是没有接受这件事。我们一开始是如何失去这些东西的？</p>\n<p>我开始不停地往深处想。半是为了否认这件事，半是想要挽回面子。不久，我注意到了一些重要事情。</p>\n<p>在服务器上还存在着其他5个数据库。其中一个数据库的名字和我刚才看到的数据库名字很像。</p>\n<p>当我查看这个数据库的时候，发现所有的内容都在里面。用户库也安然无恙。结果证明，是一个配置变动无意中改变了生产设置，使站点指向了一个全新的数据库。我之前所看的用户信息是什么？种子数据。</p>\n<p>真是谢天谢地。早上的神经紧张和胃酸让我觉得很不舒服，但是我们“恢复”了数据，并在坏消息传开之前找到了真正的问题。</p>\n<p>从这件事中可以吸取很多教训。其中一点是关于最简单原则：我们总是在做的备份，也许是开发人员最有成效的挽救药。</p>\n<h3>继续前进但不要冲得过前</h3>\n<p>我最近犯的一个错误不太引人注目。事实上，这是一个经由小错误所引起的小错误最终导致了一场混乱的故事。</p>\n<p>我们面临的是一个时间紧迫的项目。</p>\n<p>在初次会议上，我们团队一致认为完成它会花费比预定时间多一倍的时间。这个最后期限一开始就对我们产生影响，让我宽松地通过了身份认证部分而留有更多时间去关注客户所实际关注的功能设计。</p>\n<p>我只是在一个单一页面测试了身份验证测试，但是当时还不了解它们将如何被组合在一起。</p>\n<p>把它单列出来是我做的一个错误决定。我忽略了一些重要事情：</p>\n<ol class=\" list-paddingleft-2\">\n<li>用户在登陆之后会从cookie中加载内容，但是这个页面却试图在没有任何等待的情况下进行加载。根据事件的发生顺序，用户会得到带来服务器的反映，说其是未经授权的。</li>\n<li>身份验证也未检查令牌是否过期。如果用户不经常访问这个网站。那么当其再一次访问时，网站需要用户登出再登入才会运行。</li>\n<li>令牌应该基于每个请求进行更新，但是我从未花费时间去理解其发生前后的规则。所以，这又产生了一个时间问题。如果我们同时发送了几个请求，根据它们返回的顺序，用户会得到那个在后来的请求中无法使用的令牌。</li>\n</ol>\n<p>我们匆匆忙忙地赶着项目，却仍花费了比规定多一倍的时间。区别之处在于有更多的漏洞，并需要花更多时间去跟踪并修复这些漏洞。</p>\n<p>这使我感到窘迫。之后因为整件事情变得比较糟糕哦而让我在公众场合感到羞愧。</p>\n<p>我想说的是：在此之后，我花费了时间去学习认证程序。我现在了解了OAuth、JWT、刷新令牌和到期行为。我仔细研究了其他人所编写的身份验证代码。我能够在不同的语言和框架中建构身份验证程序。</p>\n<h3>将失败转化为未来的成功</h3>\n<p>这是我从那些表现糟糕的事情中所获得的经验。如果你愿意，那么几乎所有好的结果都会由此而来。</p>\n<p>如果有人能从自己的错误中汲取教训，那么他就会比现在更优秀。我试着不去打击那些第一次犯错误的队友。他们通常都知道自己把事情搞的一团糟。</p>\n<p>我也正尝试不对那些不断犯同样错误的人施加压力。他们仍然值得同情。</p>\n<p>如果在错误中做到这4点，那么你就会不断成长：</p>\n<ol class=\" list-paddingleft-2\">\n<li>嘲笑自己。</li>\n<li>从中汲取经验教训。</li>\n<li>改正错误。</li>\n<li>分享自己的错误，让其他人也有所收获。</li>\n</ol>\n<p>最后，我想讲一个关于错误价值的轶事。20世纪初，IBM的首席执行官托马斯·J·沃森曾遇到过一名员工，这名员工的一系列糟糕决策让公司付出了巨大代价。当沃森被问到是否会解雇这名员工时，他回应道：</p>\n<blockquote><p>“不，我刚在他身上花了60万美元的培训费。为什么要让别人白白捡去这个便宜？”</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113909\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113909votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113909\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c8797b2eefd269f7cad89f821eb64889f001b563.jpg"},{"url_object_id": "e18020cb4a67969752b680d482555760", "title": "线上账务系统余额并发更新问题记录", "url": "http://blog.jobbole.com/113917/", "create_date": "2018/04/24", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/hebaodan/blog/917141\">hebaodan</a>   </div><p>某电商平台，某天线上用户报bug说账户余额信息与交易流水对不上。可以认为是数据库并发更新问题，由此定位出具体原因，并给出解决方案。</p>\n<h2>问题现象</h2>\n<h3>场景描述</h3>\n<p>线上账务系统，在定时结算给卖家钱时，且高并发量的情况下，出现提现x元（假设当前用户余额为x元）余额为0后，再转入该账户一笔钱（假设为y元），结果账户余额变为了<strong>x+y</strong> 元，导致用户余额错误。 ps：账户余额的变更都是在事务中update的</p>\n<p><strong>环境说明</strong></p>\n<p>mysql5.7 + innodb，事务隔离级别是<strong>REPEATABLE-READ</strong></p>\n<h3>场景模拟</h3>\n<p>我们简化下线上的数据结构，进行场景模拟。 数据表如下： ‘账户主表’</p>\n<p> </p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24eed3899d360483570\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE user (\r\nuid int(11) NOT NULL COMMENT '类型id+自增序列',\r\nname varchar(32) DEFAULT NULL,\r\nPRIMARY KEY (uid)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='账户主表'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24eed3899d360483570-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed3899d360483570-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed3899d360483570-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed3899d360483570-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed3899d360483570-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24eed3899d360483570-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed3899d360483570-2\"><span class=\"crayon-e\">uid </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'类型id+自增序列'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed3899d360483570-3\"><span class=\"crayon-e\">name </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed3899d360483570-4\"><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed3899d360483570-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">utf8 </span><span class=\"crayon-v\">COMMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'账户主表'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>‘账户余额明细表’</p>\n<p> </p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24eed389a6588260267\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE user_account (\r\nuid int(11) NOT NULL,\r\namount decimal(19,4) DEFAULT 0 COMMENT '账户余额',\r\nPRIMARY KEY (uid)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='账户余额明细表'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389a6588260267-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389a6588260267-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389a6588260267-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389a6588260267-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389a6588260267-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24eed389a6588260267-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">user_account</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389a6588260267-2\"><span class=\"crayon-e\">uid </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed389a6588260267-3\"><span class=\"crayon-e\">amount </span><span class=\"crayon-e\">decimal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">19</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'账户余额'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389a6588260267-4\"><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed389a6588260267-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">utf8 </span><span class=\"crayon-v\">COMMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'账户余额明细表'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>账户类型配置</p>\n<p> </p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24eed389aa088079631\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE user_conf (\r\ntype_id int(11) NOT NULL, description varchar(32) DEFAULT NULL COMMENT '类型描述', PRIMARY KEY (type_id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='账户类型配置'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389aa088079631-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389aa088079631-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24eed389aa088079631-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">user_conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389aa088079631-2\"><span class=\"crayon-e\">type_id </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">description </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'类型描述'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">utf8 </span><span class=\"crayon-v\">COMMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'账户类型配置'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>具体数据为：</p>\n<p> </p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24eed389ae770247255\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect * from user;\r\n+-------+------+ | uid | name | +-------+------+\r\n| 10001 | a |\r\n| 10002 | b |\r\nselect * from user_account;\r\n+-------+----------+ | uid | amount | +-------+----------+\r\n| 10001 | 10.0000 |\r\n| 10002 | 108.9900 |\r\nselect * from user_conf;\r\n+---------+--------------+ | type_id | description | +---------+--------------+\r\n| 100 | 外部账户 |\r\n| 200 | 内部账户 |</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389ae770247255-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389ae770247255-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389ae770247255-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389ae770247255-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389ae770247255-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389ae770247255-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389ae770247255-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389ae770247255-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389ae770247255-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389ae770247255-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae24eed389ae770247255-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24eed389ae770247255-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24eed389ae770247255-1\"><span class=\"crayon-e \">select *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389ae770247255-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed389ae770247255-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10001</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389ae770247255-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10002</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed389ae770247255-5\"><span class=\"crayon-e \">select *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">user_account</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389ae770247255-6\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">amount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed389ae770247255-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10001</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.0000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389ae770247255-8\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10002</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">108.9900</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed389ae770247255-9\"><span class=\"crayon-e \">select *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">user_conf</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389ae770247255-10\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">description</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5ae24eed389ae770247255-11\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span>外部账户<span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24eed389ae770247255-12\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span>内部账户<span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p><strong>模拟</strong>提现（即余额减）和入账（即余额加）<strong>并发操作的事务</strong>如下：</p>\n<table>\n<thead>\n<tr>\n<th>session1-提现10元</th>\n<th>session2-入账20元</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>begin；</td>\n<td></td>\n</tr>\n<tr>\n<td>select description from user_conf where type_id = 100;</td>\n<td></td>\n</tr>\n<tr>\n<td>select * from user where uid = 10001 for update; // user表用来做互斥</td>\n<td></td>\n</tr>\n<tr>\n<td>select amount from user_account where uid = 10001; // 10.00</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>begin;</td>\n</tr>\n<tr>\n<td></td>\n<td>select description from user_conf where type_id = 100;</td>\n</tr>\n<tr>\n<td></td>\n<td>select * from user where uid = 10001 for update; // <strong>wating</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>//wating</td>\n</tr>\n<tr>\n<td>update user_account set amount = 0.00 where uid = 10001;</td>\n<td></td>\n</tr>\n<tr>\n<td>commit;</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>拿到锁</td>\n</tr>\n<tr>\n<td></td>\n<td>select amount from user_account where uid = 10001; //<strong>10.00</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>入账20元，代码中计算后应该为30元</td>\n</tr>\n<tr>\n<td></td>\n<td>update user_account set amount = 30.00 where uid = 10001;</td>\n</tr>\n<tr>\n<td></td>\n<td>commit;</td>\n</tr>\n</tbody>\n</table>\n<p>问题出现了，后面再查询该用户余额为30元，即用户提现的10元未反映在余额中</p>\n<h2>原因定位</h2>\n<p>熟悉mysql的同学或许已经知道问题是<strong>由REPEATABLE-READ隔离级别下快照读导致</strong>。</p>\n<p><strong>具体解释：</strong></p>\n<p>RR级别下，第一次读操作会生成快照，对于可见性来说，只有当第一次读之前其他事务提交的修改和自己的修改可见，其他的均不可见。</p>\n<blockquote><p>官网文档：<a href=\"https://dev.mysql.com/doc/refman/5.7/en/glossary.html\">https://dev.mysql.com/doc/refman/5.7/en/glossary.html</a> snapshot A representation of data at a particular time, which remains the same even as changes are committed by other transactions.</p>\n<p>With REPEATABLE READ isolation level, the snapshot is based on the time when the first read operation is performed.</p></blockquote>\n<p><strong>可见性原理</strong></p>\n<p>可参考文章：<a href=\"http://hedengcheng.com/?p=148\">http://hedengcheng.com/?p=148</a></p>\n<p>回到上述模拟场景中，session2在sql语句<code>select description from user_conf where type_id = 100;</code> 时已生成快照，虽然session1提交了，但仍然不可见，导致并发更新问题。</p>\n<p>另外，开启事务后，<strong>SELECT … FOR UPDATE 是不会生成快照的</strong>，大家可自行实验</p>\n<h2>解决方案</h2>\n<h3>方案一</h3>\n<p>将REPEATABLE-READ隔离级别改为READ-COMMITTED，这样即能看到最新提交的数据。</p>\n<h3>方案二</h3>\n<p>在读’账户余额明细表’user_account 的时候加 for update，这样会 1.强制读该行记录的最新版本数据，2.且若其他事务未commit，本事务将阻塞，保证串行更新</p>\n<h3>方案三</h3>\n<p>延时生成快照。开启事务后，首先就通过user表做互斥，直接for update加锁，针对多个事务并发更新即变为串行。</p>\n<h2>附：定位过程</h2>\n<ol>\n<li>针对上报bug用户，查询其交易流水明细与余额变更明细，确认账务存在问题</li>\n<li>查询账务系统近几天是否有上线变更，检查无</li>\n<li>拉取账务数据库mysql general log，找到并发更新的两个事务session</li>\n<li>查询数据库设置的隔离级别为RR，查询应用数据库连接池配置即<strong>session的隔离级别未配置</strong>，采用数据库配置</li>\n<li>确认由RR级别导致（当然也可以认为是代码问题导致）</li>\n<li>确认是一个月前账务系统分库分表上线，改用其他<strong>连接池且未设置session隔离级别</strong>。而之前是有配置session的隔离级别为READ-COMMITTED。</li>\n</ol>\n<h2>延伸思考</h2>\n<p>mysql RR级别适用的业务场景是什么，应该怎么选择？ 有兴趣或有见解的同学可以留言回复或私信~~</p>\n<h2>参考</h2>\n<blockquote><p><a href=\"http://blog.csdn.net/chen77716/article/details/6742128#comments\">http://blog.csdn.net/chen77716/article/details/6742128#comments</a></p>\n<p><a href=\"http://hedengcheng.com/?p=148\">http://hedengcheng.com/?p=148</a></p>\n<p><a href=\"https://liuzhengyang.github.io/2017/04/18/innodb-mvcc/\">https://liuzhengyang.github.io/2017/04/18/innodb-mvcc/</a></p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113917\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113917votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113917\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"},{"url_object_id": "b51b2aa44b0b3a7401e270a76cf4f1bf", "title": "谁说国外的程序员过得好？法国政府搞的软件项目，坑出新境界", "url": "http://blog.jobbole.com/113920/", "create_date": "2018/04/25", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/04/5f2dbd34a324b10f8f29ed12482281ae.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "职场,项目", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://36kr.com/p/5130755.html\">Cado</a>   </div><p>编者按：很多软件项目开发时间大大超出了规划的时间，投入大量资金和人力，都没有实在的结果。如果你讨厌你的编程工作，请认真阅读这篇 2008 年的文章吧。法国科技公司为政府做的项目，预期两三年，做了十二年还在做；6 百万行 C++ 代码，经理比工程师多，人员素质极低。</p>\n<p>几年前，我在一家法国大型科技公司工作，为他们的一个软件项目做咨询师。在那段时间，我见识到了软件工程工作方面最匪夷所思的一切，完全超乎我的想象。项目人员工作极度不专业，而更严重的是，工作环境完全无视人的尊严。我一度觉得去那里上班就像坐牢。我只要举几个例子，读者自然就有分晓。</p>\n<p><strong>工作内容</strong></p>\n<p>为一个政府部门开发一款软件。</p>\n<p>政府先付了几百万欧元的订金，软件开发耗时初定 2 到 3 年。公司雇了几个工程师，开始了项目。每隔三个月，团队人数就翻一番，以便让资金不断流入。</p>\n<p>7 年后，项目还不成样子，连雏形都没有。每天公司都要交几千欧元的罚金。于是，管理层决定节流，把经验丰富的员工都辞退了，雇了些经验少，甚至完全没经验的新人。</p>\n<p>10 年后，项目进度实在太滞后，中层管理人员决定雇佣有软件工程经验的人，把项目拉回正轨。公司的员工每三个月换一批，也就是法国离职交接期的时长。</p>\n<p>12 年后，项目还没结束。公司每天给政府发的修改申请越来越多，以“补贴”每天缴纳的罚金。此时已经是 2008 年。</p>\n<p><strong>项目数据</strong></p>\n<ul>\n<li>600 万行代码</li>\n<li>基于 C ++</li>\n<li>50,000+ 类</li>\n<li>使用的 C ++ 已经过时，“锁死”在编译器版本中，编译器的版本只能一个操作系统上用。</li>\n<li>基于 CORBA</li>\n<li>项目使用的数据库软件背后的公司已经破产</li>\n<li>图层用户界面有好几个，但实际上每一层都没人维护。</li>\n<li>32 台计算机上构建，需要 48 小时</li>\n<li>运行一个用户界面需要 40 到 50 个并行进程</li>\n<li>没有动态库链接：可执行文件大小在数百兆字节范围内</li>\n<li>启动时间约为 15 分钟</li>\n<li>瘫痪频率：每 30 秒到 30 分钟一次</li>\n</ul>\n<p>没有那个软件工程师会说 C++ 很简单。就其复杂程度而言，这或许是最难掌握的编程语言，就连创造 C++ 的几个工程师都坦白说，他们自己也没有完全掌握。</p>\n<p>这种无底洞、大迷宫似的语言，还是有不少人扬言说自己已经掌握了，只要有机会，他们就敢用给你看。他们一猛子扎进这口深井，最后大多遍体鳞伤。看着一满篇天书，花不知多少小时，也找不到瘫痪原因。人都是很聪明的，人生短暂，投入一段时间没有回报，就会“弃暗投明”，改用其他语言，改做其他项目。</p>\n<p>软件一大，不管是什么语言写的，维护起来都很难。6 百万行代码，就一个小团队维护，只要想想就能发疯。6 百万可不是小数字，就算一秒钟读一行，也要 70 天不眠不休才能看完。</p>\n<p>我再举两个实例，读者就知道这个项目有多让人崩溃。</p>\n<p>有一个开发者被分配了这样一个任务：找出在界面上点击右键，界面冻结的原因。他花了几天时间，仔仔细细检查，耗掉大半耐心之后，他发现，在界面上右击后，其实没有错误，只是内容菜单要 45 分钟后才弹出。每次用户在主窗体点击后，菜单是动态生成的，但是背后是巨量的静态内容，因此耗时长。有些用户反馈说“加载 CD”的命令完全没反应。这个问题花了几个星期才弄明白，但是最后，错误报告却被标记为“已解决”，因为数据确实有加载，只不过是花了整整 7 天，才加载完 700 兆的数据。嗯，不然怎么说耐心是美德呢…</p>\n<p><strong>版本控制，犹如脱缰野马</strong></p>\n<p>好几年过去了，团队里终于来了个人才，提出要用版本控制工具。第一次尝试，效果不如人意，于是团队决定换一个系统。又过了纪念，每次更新的历史数据全没了。最后，他们选择使用一个瑞士的系统，图形用户界面简直不堪入目。有一个四人小组全职负责版本控制软件方面的维护问题，跟他们合作，我们常常面临以下的问题：</p>\n<ul>\n<li>第一次测试需要与版本控制团队先预约时间，通常在一周后才授权。</li>\n<li>未经中层管理人员授权，不允许编辑文件。必须事先告诉经理要编辑哪些文件，然后申请上级许可，再预约版本控制团队，在几天后才能编辑。</li>\n<li>每次修改代码都会产生分支文件，也就意味着必须合并所有修改。有了这么多的文件，你可能觉得，不会出现两个人弄同一个文件上的重复劳动。但事实证明，大家都在弄同样的 100 个文件。</li>\n<li>检入过程非常痛苦，这个过程中，你的代码经过自动化错误检测软件审查，最终由中间管理人员审查。不用说，bug 的出现速度永远比开发人员纠正速度快得多。如果你仔细看注册的错误数量，每次修正导致的新 bug 数量，是原来 bug 数量的两倍。</li>\n<li>版本控制很简单。旧软件是版本1，目前的软件是版本2，未来的软件是版本 3. 没有人知道哪个版本已经交付给客户了。</li>\n</ul>\n<p>从前的某一天，公司安排过正式交付。但是这个时间不是团队内的人定的。那天，客户受到了一张没有内容，只有安装指引的光盘。那时因为，没有人知道怎么把这个项目做出来。后来客户发现他们受到的光盘里，什么也没有，于是给公司发了封正式的投诉信。</p>\n<p>公司居然把旧版本的软件发给了客户。客户之所以能发现，是因为他们看了“说明”栏，里面的内容跟上一年的版本大同小异。</p>\n<p><strong>“人件”</strong></p>\n<p><strong>微薄薪水，只能雇庸碌之辈</strong></p>\n<p>团队里大部分人都是没有软件工程经验的人，软件里要不是大部分都是 bug，就奇了怪了。经理意识到，一个单纯的软件项目，支出的大头是薪水，真是天资聪颖。但是，这个大发现丝毫没有影响 TA 炒掉工程师，不论他们有没有经验，却把桌面上有“C++傻瓜入门”之类书的管理人员统统留下了。</p>\n<p><strong>我们的梦想团队</strong></p>\n<p>团队 55 人：20 个开发者，35 个管理人员</p>\n<p>没错，管理人员数量比工程师还多。</p>\n<p>管理人员最擅长的就是开会，讲的都是同一个 PPT，一遍又一遍，讲到吐为止。而开发者就在宽敞的共用办公空间里聊天解闷。</p>\n<p>很多管理人员在软件工程上毫无经验。当时 SCO-Linux 争议炒得沸沸扬扬，不管整件事算不算闹剧，很多人都意识到，以后要用自由软件都要付费了。）不用说，整个软件到处都是 GNU C 库里的代码，一个巨型 GNU 兼容的非共享软件。但是，就这个项目的水准，估计也没人敢把代码放出去。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/5f2dbd34a324b10f8f29ed12482281ae.jpg\" alt=\"谁说国外的程序员过得好？法国政府搞的软件项目，坑出新境界\"></p>\n<blockquote><p>自由软件（free software），根据自由软件基金会对其的定义，是一类可以不受限制地自由使用、复制、研究、修改和分发的，尊重用户自由的软件。这方面的不受限制正是自由软件最重要的本质，与自由软件相对的是专有软件（proprietary software），或被称为私有软件、封闭软件（其定义与是否收取费用无关──自由软件不一定是免费软件。</p></blockquote>\n<p>整个团队，技术水平不如人意，了解互联网的人屈指可数，其中自认为了解互联网的，以为互联网只是为爱情动作片而生的。他们之间，如果有人说自己在网上看了点东西，听者就会露出会心一笑。</p>\n<p><strong>地狱之旅</strong></p>\n<p>本来在这里的工作，虽然不算优越，至少不会无聊。但是顶层的管理人员非要采用纳粹管理集中营的办法来管理员工。我随便举几个例子：</p>\n<ul>\n<li>早九点后到岗是不允许的。有一天， 经理站在大门后，把 9 点整以后到的所有员工都当场炒鱿鱼，包括一些经理和销售人员。</li>\n<li>抽烟的员工，因为跑出去抽烟，工作的时间就打了折扣。所以管理层决定让所有员工都不许吸烟。当然，没有用。</li>\n<li>有时候，一连好几天咖啡机都被收起来。因为跑去喝咖啡的人自然没有坐在办公桌前的人、伏案写代码的人工作时间长。</li>\n<li>每次有上级来视察，咖啡机就要关掉，以便给上级留下大家都在桌前认真写代码的印象。</li>\n<li>那里的洗手间是我去过的洗手间里最恶心的。大概也是为了提高大家的效率：上厕所的时间少了，工作的时间自然就多了（工作质量自然也上去了）。</li>\n</ul>\n<p>这样的工作，这样的管理，为什么大家还要来上班？最主要的原因就是当时法国深陷经济危机（某种程度上，现在也是），有工作，有薪水几乎成了特权，工作环境、内容自然就没那么在意了。</p>\n<p>还有一个原因，对于在那里的大多数员工而言，这份合约算是他们与一家真实公司签下的一份实实在在的合约。没有对比，就没有伤害，他们可能都不知道这份工作的糟心程度。很多员工新入职场，觉得迟到就被炒鱿鱼，也没什么不合理的。但是，这样严苛的标准，晚一分钟都不行，只有变态的管理者才会付诸现实。</p>\n<p>话又说回来，政府怎么会让这样的事情发生呢？但我们都心知肚明，政府里管这个项目预算的官员和软件公司的顶层管理人员拜过把子，关系够铁。在法国，这种程度的腐败也没什么新鲜的。很多人根本不知道，更别说有什么惩罚或者后果了。当然，也不限于法国，放眼欧美，这样的故事也不少。</p>\n<p>所以，下次上班觉得难熬，要学会置身处地。想像一下自己在那里工作，会是什么光景。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113920\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113920votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113920\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/aab96c7405ff9c51c5ed53c3c56c2a4d05b37236.jpg"},{"url_object_id": "0d352bb0afad005f2b826e5ebae297ef", "title": "Linux 系统中 sudo 命令的 10 个技巧", "url": "http://blog.jobbole.com/113912/", "create_date": "2018/04/21", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/04/62b7a1070a67d4ff08c977612aa47ef3.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linuxtechi.com/quick-tips-sudo-command-linux-systems/\">Pradeep Kumar</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9559-1.html\">Linux中国/szcf-weiya</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/62b7a1070a67d4ff08c977612aa47ef3.jpg\"></p>\n<h3 id=\"toc_1\">概览</h3>\n<p><code>sudo</code> 表示 “<strong>s</strong>uper<strong>u</strong>ser <strong>do</strong>”。 它允许已验证的用户以其他用户的身份来运行命令。其他用户可以是普通用户或者超级用户。然而，大部分时候我们用它来以提升的权限来运行命令。</p>\n<p><code>sudo</code> 命令与安全策略配合使用，默认安全策略是 <code>sudoers</code>，可以通过文件 <code>/etc/sudoers</code> 来配置。其安全策略具有高度可拓展性。人们可以开发和分发他们自己的安全策略作为插件。</p>\n<h3 id=\"toc_2\">与 su 的区别</h3>\n<p>在 GNU/Linux 中，有两种方式可以用提升的权限来运行命令：</p>\n<ul>\n<li>使用 <code>su</code> 命令</li>\n<li>使用 <code>sudo</code> 命令</li>\n</ul>\n<p><code>su</code> 表示 “<strong>s</strong>witch <strong>u</strong>ser”。使用 <code>su</code>，我们可以切换到 root 用户并且执行命令。但是这种方式存在一些缺点：</p>\n<ul>\n<li>我们需要与他人共享 root 的密码。</li>\n<li>因为 root 用户为超级用户，我们不能授予受控的访问权限。</li>\n<li>我们无法审查用户在做什么。</li>\n</ul>\n<p><code>sudo</code> 以独特的方式解决了这些问题。</p>\n<ol>\n<li>首先，我们不需要妥协来分享 root 用户的密码。普通用户使用他们自己的密码就可以用提升的权限来执行命令。</li>\n<li>我们可以控制 <code>sudo</code> 用户的访问，这意味着我们可以限制用户只执行某些命令。</li>\n<li>除此之外，<code>sudo</code> 用户的所有活动都会被记录下来，因此我们可以随时审查进行了哪些操作。在基于 Debian 的 GNU/Linux 中，所有活动都记录在 <code>/var/log/auth.log</code> 文件中。</li>\n</ol>\n<p>本教程后面的部分阐述了这些要点。</p>\n<h3 id=\"toc_3\">实际动手操作 sudo</h3>\n<p>现在，我们对 sudo 有了大致的了解。让我们实际动手操作吧。为了演示，我使用 Ubuntu。但是，其它发行版本的操作应该是相同的。</p>\n<h4 id=\"toc_4\">允许 sudo 权限</h4>\n<p>让我们添加普通用户为 <code>sudo</code> 用户吧。在我的情形中，用户名为 <code>linuxtechi</code>。</p>\n<p>1) 按如下所示编辑 <code>/etc/sudoers</code> 文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c4516462729910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo visudo\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4516462729910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c4516462729910-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4516462729910-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-i\">visudo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c4516462729910-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>2) 添加以下行来允许用户 <code>linuxtechi</code> 有 sudo 权限：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c4521138533466\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlinuxtechi ALL=(ALL) ALL\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4521138533466-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c4521138533466-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4521138533466-1\"><span class=\"crayon-e\">linuxtechi </span><span class=\"crayon-v\">ALL</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ALL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ALL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c4521138533466-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>上述命令中：</p>\n<ul>\n<li><code>linuxtechi</code> 表示用户名</li>\n<li>第一个 <code>ALL</code> 指示允许从任何终端、机器访问 <code>sudo</code></li>\n<li>第二个 <code>(ALL)</code> 指示 <code>sudo</code> 命令被允许以任何用户身份执行</li>\n<li>第三个 <code>ALL</code> 表示所有命令都可以作为 root 执行</li>\n</ul>\n<h4 id=\"toc_5\">以提升的权限执行命令</h4>\n<p>要用提升的权限执行命令，只需要在命令前加上 <code>sudo</code>，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c4526103280818\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo cat /etc/passwd\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4526103280818-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c4526103280818-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4526103280818-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">passwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c4526103280818-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当你执行这个命令时，它会询问 <code>linuxtechi</code> 的密码，而不是 root 用户的密码。</p>\n<h4 id=\"toc_6\">以其他用户执行命令</h4>\n<p>除此之外，我们可以使用 <code>sudo</code> 以另一个用户身份执行命令。例如，在下面的命令中，用户 <code>linuxtechi</code> 以用户 <code>devesh</code> 的身份执行命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c452a093401576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo -u devesh whoami\r\n[sudo] password for linuxtechi:\r\ndevesh\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c452a093401576-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c452a093401576-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c452a093401576-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c452a093401576-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c452a093401576-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">devesh </span><span class=\"crayon-i\">whoami</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c452a093401576-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sudo</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">password </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">linuxtechi</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae27eb4c452a093401576-3\"><span class=\"crayon-i\">devesh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c452a093401576-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h4 id=\"toc_7\">内置命令行为</h4>\n<p><code>sudo</code> 的一个限制是 —— 它无法使用 Shell 的内置命令。例如， <code>history</code> 记录是内置命令，如果你试图用 <code>sudo</code> 执行这个命令，那么会提示如下的未找到命令的错误：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c452d325098408\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo history\r\n[sudo] password for linuxtechi:\r\nsudo: history: command not found\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c452d325098408-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c452d325098408-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c452d325098408-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c452d325098408-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c452d325098408-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c452d325098408-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-i\">history</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c452d325098408-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sudo</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">password </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">linuxtechi</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae27eb4c452d325098408-3\"><span class=\"crayon-v\">sudo</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">history</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">found</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c452d325098408-4\"> </div><div class=\"crayon-line\" id=\"crayon-5ae27eb4c452d325098408-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><strong>访问 root shell</strong></p>\n<p>为了克服上述问题，我们可以访问 root shell，并在那里执行任何命令，包括 Shell 的内置命令。</p>\n<p>要访问 root shell, 执行下面的命令:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c4531488006874\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo bash\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4531488006874-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c4531488006874-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4531488006874-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-i\">bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c4531488006874-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>执行完这个命令后——您将观察到提示符变为井号（<code>#</code>）。</p>\n<h3 id=\"toc_8\">技巧</h3>\n<p>这节我们将讨论一些有用的技巧，这将有助于提高生产力。大多数命令可用于完成日常任务。</p>\n<h4 id=\"toc_9\">以 sudo 用户执行之前的命令</h4>\n<p>让我们假设你想用提升的权限执行之前的命令，那么下面的技巧将会很有用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c4534853009587\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo !4\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4534853009587-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c4534853009587-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4534853009587-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c4534853009587-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>上面的命令将使用提升的权限执行历史记录中的第 4 条命令。</p>\n<h4 id=\"toc_10\">在 Vim 里面使用 sudo 命令</h4>\n<p>很多时候，我们编辑系统的配置文件时，在保存时才意识到我们需要 root 访问权限来执行此操作。因为这个可能让我们丢失我们对文件的改动。没有必要惊慌，我们可以在 Vim 中使用下面的命令来解决这种情况：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c4537407401918\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:w !sudo tee %\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4537407401918-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c4537407401918-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4537407401918-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">tee</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c4537407401918-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>上述命令中：</p>\n<ul>\n<li>冒号 (<code>:</code>) 表明我们处于 Vim 的退出模式</li>\n<li>感叹号 (<code>!</code>) 表明我们正在运行 shell 命令</li>\n<li><code>sudo</code> 和 <code>tee</code> 都是 shell 命令</li>\n<li>百分号 (<code>%</code>) 表明从当前行开始的所有行</li>\n</ul>\n<h4 id=\"toc_11\">使用 sudo 执行多个命令</h4>\n<p>至今我们用 <code>sudo</code> 只执行了单个命令，但我们可以用它执行多个命令。只需要用分号 (<code>;</code>) 隔开命令，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c453b004571745\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo -- bash -c 'pwd; hostname; whoami'\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c453b004571745-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c453b004571745-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c453b004571745-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c453b004571745-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'pwd; hostname; whoami'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c453b004571745-2\"> </div><div class=\"crayon-line\" id=\"crayon-5ae27eb4c453b004571745-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>上述命令中</p>\n<ul>\n<li>双连字符 (<code>--</code>) 停止命令行切换</li>\n<li><code>bash</code> 表示要用于执行命令的 shell 名称</li>\n<li><code>-c</code> 选项后面跟着要执行的命令</li>\n</ul>\n<h4 id=\"toc_12\">无密码运行 sudo 命令</h4>\n<p>当第一次执行 <code>sudo</code> 命令时，它会提示输入密码，默认情形下密码被缓存 15 分钟。但是，我们可以避免这个操作，并使用 <code>NOPASSWD</code> 关键字禁用密码认证，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c453e369875207\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlinuxtechi ALL=(ALL) NOPASSWD: ALL\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c453e369875207-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c453e369875207-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c453e369875207-1\"><span class=\"crayon-e\">linuxtechi </span><span class=\"crayon-v\">ALL</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ALL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NOPASSWD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ALL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c453e369875207-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h4 id=\"toc_13\">限制用户执行某些命令</h4>\n<p>为了提供受控访问，我们可以限制 <code>sudo</code> 用户只执行某些命令。例如，下面的行只允许执行 <code>echo</code> 和 <code>ls</code> 命令 。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c4543025892072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlinuxtechi ALL=(ALL) NOPASSWD: /bin/echo /bin/ls\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4543025892072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c4543025892072-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4543025892072-1\"><span class=\"crayon-e\">linuxtechi </span><span class=\"crayon-v\">ALL</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ALL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NOPASSWD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c4543025892072-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h4 id=\"toc_14\">深入了解 sudo</h4>\n<p>让我们进一步深入了解 <code>sudo</code> 命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c4547556137072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls -l /usr/bin/sudo\r\n-rwsr-xr-x 1 root root 145040 Jun 13  2017 /usr/bin/sudo\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4547556137072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c4547556137072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c4547556137072-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4547556137072-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sudo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c4547556137072-2\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rwsr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">145040</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">sudo</span></div><div class=\"crayon-line\" id=\"crayon-5ae27eb4c4547556137072-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>如果仔细观察文件权限，则发现 <code>sudo</code> 上启用了 setuid 位。当任何用户运行这个二进制文件时，它将以拥有该文件的用户权限运行。在所示情形下，它是 root 用户。</p>\n<p>为了演示这一点，我们可以使用 <code>id</code> 命令，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c454a662635011\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ id\r\nuid=1002(linuxtechi) gid=1002(linuxtechi) groups=1002(linuxtechi)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c454a662635011-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c454a662635011-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c454a662635011-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c454a662635011-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c454a662635011-2\"><span class=\"crayon-v\">uid</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1002</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">linuxtechi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gid</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1002</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">linuxtechi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">groups</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1002</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">linuxtechi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae27eb4c454a662635011-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>当我们不使用 <code>sudo</code> 执行 <code>id</code> 命令时，将显示用户 <code>linuxtechi</code> 的 id。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27eb4c454d872631684\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo id\r\nuid=0(root) gid=0(root) groups=0(root)\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c454d872631684-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c454d872631684-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae27eb4c454d872631684-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae27eb4c454d872631684-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27eb4c454d872631684-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c454d872631684-2\"><span class=\"crayon-v\">uid</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gid</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">groups</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae27eb4c454d872631684-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae27eb4c454d872631684-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>但是，如果我们使用 <code>sudo</code> 执行 <code>id</code> 命令时，则会显示 root 用户的 id。</p>\n<h3 id=\"toc_15\">结论</h3>\n<p>从这篇文章可以看出 —— <code>sudo</code> 为普通用户提供了更多受控访问。使用这些技术，多用户可以用安全的方式与 GNU/Linux 进行交互。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113912\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113912votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113912\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c99585e916a2233fec8fcbbf0dc4907e60e02254.jpg"},{"url_object_id": "a8bea411b8efb78652e2e1348eb0a11a", "title": "从 Linux 源码看 socket 的阻塞和非阻塞", "url": "http://blog.jobbole.com/113858/", "create_date": "2018/04/12", "front_image_url": ["http://wx2.sinaimg.cn/mw690/63918611gy1fq9n10wguaj20vi0katb1.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 4, "tags": "IT技术,socket,阻塞,非阻塞", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/alchemystar/blog/1791017\">无毁的湖光-Al</a>   </div><p>笔者一直觉得如果能知道从应用到框架再到操作系统的每一处代码，是一件Exciting的事情。</p>\n<p>大部分高性能网络框架采用的是非阻塞模式。笔者这次就从linux源码的角度来阐述socket阻塞(block)和非阻塞(non_block)的区别。 本文源码均来自采用Linux-2.6.24内核版本。</p>\n<h2 id=\"h2_1\">一个TCP非阻塞client端简单的例子</h2>\n<p>如果我们要产生一个非阻塞的socket,在C语言中如下代码所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d33140235798\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 创建socket\r\nint sock_fd = socket(AF_INET, SOCK_STREAM, 0);\r\n...\r\n// 更改socket为nonblock\r\nfcntl(sock_fd, F_SETFL, fdflags | O_NONBLOCK);\r\n// connect\r\n....\r\nwhile(1)  {  \r\n    int recvlen = recv(sock_fd, recvbuf, RECV_BUF_SIZE) ; \r\n    ......\r\n} \r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d33140235798-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d33140235798-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d33140235798-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d33140235798-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d33140235798-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d33140235798-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d33140235798-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d33140235798-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d33140235798-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d33140235798-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d33140235798-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d33140235798-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d33140235798-1\"><span class=\"crayon-c\">// 创建socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d33140235798-2\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock_fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d33140235798-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d33140235798-4\"><span class=\"crayon-c\">// 更改socket为nonblock</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d33140235798-5\"><span class=\"crayon-e\">fcntl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock_fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F_SETFL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fdflags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_NONBLOCK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d33140235798-6\"><span class=\"crayon-c\">// connect</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d33140235798-7\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d33140235798-8\"><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d33140235798-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recvlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock_fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recvbuf</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RECV_BUF_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d33140235798-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d33140235798-11\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d33140235798-12\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>由于网络协议非常复杂，内核里面用到了大量的面向对象的技巧，所以我们从创建连接开始，一步一步追述到最后代码的调用点。</p>\n<h3 id=\"h3_2\">socket的创建</h3>\n<p>很明显，内核的第一步应该是通过AF_INET、SOCK_STREAM以及最后一个参数0定位到需要创建一个TCP的socket,如下图绿线所示:</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fq9n10wguaj20vi0katb1.jpg\"></p>\n<p>我们跟踪源码调用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d3d210538293\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsocket(AF_INET, SOCK_STREAM, 0)\r\n\t|-&gt;sys_socket 进入系统调用\r\n\t\t|-&gt;sock_create\r\n\t\t\t|-&gt;__sock_create</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d3d210538293-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d3d210538293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d3d210538293-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d3d210538293-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d3d210538293-1\"><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d3d210538293-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">_</span>socket<span class=\"crayon-h\"> </span>进入系统调用</div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d3d210538293-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sock_create</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d3d210538293-4\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">__sock_create</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>进一步分析__sock_create的代码判断:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d41224889106\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconst struct net_proto_family *pf;\r\n// RCU(Read-Copy Update)是linux的一种内核同步方法，在此不阐述\r\n// family=INET\r\npf = rcu_dereference(net_families[family]);\r\nerr = pf-&gt;create(net, sock, protocol);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d41224889106-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d41224889106-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d41224889106-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d41224889106-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d41224889106-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d41224889106-1\"><span class=\"crayon-r\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net_proto_family</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">pf</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d41224889106-2\"><span class=\"crayon-c\">// RCU(Read-Copy Update)是linux的一种内核同步方法，在此不阐述</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d41224889106-3\"><span class=\"crayon-c\">// family=INET</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d41224889106-4\"><span class=\"crayon-v\">pf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rcu_dereference</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">net_families</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">family</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d41224889106-5\"><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pf</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">protocol</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p><span class=\"hljs-keyword\">const</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span></span></span> <span class=\"hljs-title\"><span class=\"hljs-class\"><span class=\"hljs-title\">net_proto_family</span></span></span></span> *pf; <span class=\"hljs-comment\"><span class=\"hljs-comment\">// RCU(Read-Copy Update)是linux的一种内核同步方法，在此不阐述</span></span> <span class=\"hljs-comment\"><span class=\"hljs-comment\">// family=INET</span></span> pf = rcu_dereference(net_families[family]); err = pf-&gt;create(net, sock, protocol);</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fq9n11nhljj20ui0eadi7.jpg\"></p>\n<p>则通过源码可知，由于是AF_INET(PF_INET),所以net_families[PF_INET].create=inet_create(以后我们都用PF_INET表示)，即<br>\npf-&gt;create = inet_create; 进一步追溯调用:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d45469096288\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninet_create(struct net *net, struct socket *sock, int protocol){\r\n\tSock* sock;\r\n\t......\r\n\t// 此处是寻找对应协议处理器的过程\r\nlookup_protocol:\r\n\t// 迭代寻找protocol==answer-&gt;protocol的情况\r\n\tlist_for_each_rcu(p, &amp;inetsw[sock-&gt;type]) answer = list_entry(p, struct inet_protosw, list);\r\n\r\n\t\t/* Check the non-wild match. */\r\n\t\tif (protocol == answer-&gt;protocol) {\r\n\t\t\tif (protocol != IPPROTO_IP)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t......\r\n\t// 这边answer指的是SOCK_STREAM\r\n\tsock-&gt;ops = answer-&gt;ops;\r\n\tanswer_no_check = answer-&gt;no_check;\r\n\t// 这边sk-&gt;prot就是answer_prot=&gt;tcp_prot\r\n\tsk = sk_alloc(net, PF_INET, GFP_KERNEL, answer_prot);\r\n\tsock_init_data(sock, sk);\r\n\t......\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d45469096288-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d45469096288-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-1\"><span class=\"crayon-e\">inet_create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">protocol</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">Sock</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 此处是寻找对应协议处理器的过程</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-5\"><span class=\"crayon-v\">lookup_protocol</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 迭代寻找protocol==answer-&gt;protocol的情况</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">list_for_each_rcu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">inetsw</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sock</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list_entry</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inet_protosw</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">/* Check the non-wild match. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-11\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IPPROTO_IP</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-12\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 这边answer指的是SOCK_STREAM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">sock</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">ops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">ops</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">answer_no_check</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">no_check</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 这边sk-&gt;prot就是answer_prot=&gt;tcp_prot</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-19\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">sk</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sk_alloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GFP_KERNEL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer_prot</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-20\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">sock_init_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d45469096288-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d45469096288-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>上面的代码就是在INET中寻找SOCK_STREAM的过程了 我们再看一下inetsw[SOCK_STREAM]的具体配置:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d49626733754\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic struct inet_protosw inetsw_array[] =\r\n{\r\n\t{\r\n\t\t.type =       SOCK_STREAM,\r\n\t\t.protocol =   IPPROTO_TCP,\r\n\t\t.prot =       &amp;tcp_prot,\r\n\t\t.ops =        &amp;inet_stream_ops,\r\n\t\t.capability = -1,\r\n\t\t.no_check =   0,\r\n\t\t.flags =      INET_PROTOSW_PERMANENT |\r\n\t\t\t      INET_PROTOSW_ICSK,\r\n\t},\r\n\t......\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d49626733754-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d49626733754-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d49626733754-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d49626733754-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d49626733754-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d49626733754-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d49626733754-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d49626733754-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d49626733754-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d49626733754-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d49626733754-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d49626733754-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d49626733754-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d49626733754-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d49626733754-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inet_protosw </span><span class=\"crayon-v\">inetsw_array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d49626733754-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d49626733754-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d49626733754-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">       </span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d49626733754-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">IPPROTO_TCP</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d49626733754-6\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">prot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">tcp_prot</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d49626733754-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">inet_stream_ops</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d49626733754-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">capability</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d49626733754-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">no_check</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d49626733754-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">INET_PROTOSW_PERMANENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d49626733754-11\"><span class=\"crayon-h\">\t\t\t      </span><span class=\"crayon-v\">INET_PROTOSW_ICSK</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d49626733754-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d49626733754-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d49626733754-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>这边也用了重载，AF_INET有TCP、UDP以及Raw三种:</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fq9n12m0pcj20wg0eetbd.jpg\"></p>\n<p>从上述代码，我们可以清楚的发现sock-&gt;ops=&amp;inet_stream_ops;</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d4d258357708\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconst struct proto_ops inet_stream_ops = {\r\n\t.family\t\t   = PF_INET,\r\n\t.owner\t\t   = THIS_MODULE,\r\n\t......\r\n\t.sendmsg\t   = tcp_sendmsg,\r\n\t.recvmsg\t   = sock_common_recvmsg,\r\n\t......\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d4d258357708-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d4d258357708-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d4d258357708-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d4d258357708-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d4d258357708-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d4d258357708-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d4d258357708-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d4d258357708-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d4d258357708-1\"><span class=\"crayon-r\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">proto_ops </span><span class=\"crayon-v\">inet_stream_ops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d4d258357708-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">family</span><span class=\"crayon-h\">\t\t   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PF_INET</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d4d258357708-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">owner</span><span class=\"crayon-h\">\t\t   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">THIS_MODULE</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d4d258357708-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d4d258357708-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sendmsg</span><span class=\"crayon-h\">\t   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp_sendmsg</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d4d258357708-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">recvmsg</span><span class=\"crayon-h\">\t   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock_common_recvmsg</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d4d258357708-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d4d258357708-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>即sock-&gt;ops-&gt;recvmsg = sock_common_recvmsg;<br>\n同时sock-&gt;sk-&gt;sk_prot = tcp_prot;</p>\n<p>我们再看下tcp_prot中的各个函数重载的定义:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d50539817446\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstruct proto tcp_prot = {\r\n\t.name\t\t\t= \"TCP\",\r\n\t.close\t\t\t= tcp_close,\r\n\t.connect\t\t= tcp_v4_connect,\r\n\t.disconnect\t\t= tcp_disconnect,\r\n\t.accept\t\t\t= inet_csk_accept,\r\n\t......\r\n\t// 我们重点考察tcp的读\r\n\t.recvmsg\t\t= tcp_recvmsg,\r\n\t......\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d50539817446-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d50539817446-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d50539817446-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d50539817446-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d50539817446-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d50539817446-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d50539817446-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d50539817446-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d50539817446-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d50539817446-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d50539817446-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d50539817446-1\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">proto </span><span class=\"crayon-v\">tcp_prot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d50539817446-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"TCP\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d50539817446-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">close</span><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp_close</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d50539817446-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">connect</span><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp_v4_connect</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d50539817446-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">disconnect</span><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp_disconnect</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d50539817446-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">accept</span><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inet_csk_accept</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d50539817446-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d50539817446-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 我们重点考察tcp的读</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d50539817446-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">recvmsg</span><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcp_recvmsg</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d50539817446-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d50539817446-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h2 id=\"h2_3\">fcntl控制socket的阻塞\\非阻塞状态</h2>\n<p>我们用fcntl修改socket的阻塞\\非阻塞状态。 事实上: fcntl的作用就是将O_NONBLOCK标志位存储在sock_fd对应的filp结构的f_lags里,如下图所示。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fq9n13is3fj20ws0j4go5.jpg\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d53292118266\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfcntl(sock_fd, F_SETFL, fdflags | O_NONBLOCK);\r\n\t|-&gt;setfl</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d53292118266-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d53292118266-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d53292118266-1\"><span class=\"crayon-e\">fcntl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock_fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F_SETFL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fdflags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_NONBLOCK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d53292118266-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">setfl</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>追踪setfl代码:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d56446563233\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic int setfl(int fd, struct file * filp, unsigned long arg) {\r\n\t......\r\n\tfilp-&gt;f_flags = (arg &amp; SETFL_MASK) | (filp-&gt;f_flags &amp; ~SETFL_MASK);\r\n\t......\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d56446563233-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d56446563233-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d56446563233-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d56446563233-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d56446563233-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d56446563233-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setfl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d56446563233-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d56446563233-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">filp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETFL_MASK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">SETFL_MASK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d56446563233-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d56446563233-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>上图中，由sock_fd在task_struct(进程结构体)-&gt;files_struct-&gt;fd_array中找到对应的socket的file描述符，再修改file-&gt;flags</p>\n<h2 id=\"h2_4\">在调用socket.recv的时候</h2>\n<p>我们跟踪源码调用:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d5a378293304\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsocket.recv\r\n\t|-&gt;sys_recv\r\n\t\t|-&gt;sys_recvfrom\r\n\t\t\t|-&gt;sock_recvmsg\r\n\t\t\t\t|-&gt;__sock_recvmsg\r\n\t\t\t\t\t|-&gt;sock-&gt;ops-&gt;recvmsg</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d5a378293304-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d5a378293304-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d5a378293304-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d5a378293304-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d5a378293304-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d5a378293304-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d5a378293304-1\"><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">recv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d5a378293304-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sys_recv</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d5a378293304-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sys_recvfrom</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d5a378293304-4\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sock_recvmsg</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d5a378293304-5\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">__sock_recvmsg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d5a378293304-6\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sock</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">ops</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">recvmsg</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>由上文可知: sock-&gt;ops-&gt;recvmsg = sock_common_recvmsg;</p>\n<h3 id=\"h3_5\">sock</h3>\n<p>值得注意的是,在sock_recmsg中,有对标识O_NONBLOCK的处理</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d5d515680585\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\tif (sock-&gt;file-&gt;f_flags &amp; O_NONBLOCK)\r\n\t\tflags |= MSG_DONTWAIT;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d5d515680585-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d5d515680585-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d5d515680585-1\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_NONBLOCK</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d5d515680585-2\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MSG_DONTWAIT</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>上述代码中sock关联的file中获取其f_flags,如果flags有O_NONBLOCK标识，那么就设置msg_flags为MSG_DONTWAIT(不等待)。<br>\nfcntl与socket就是通过其共同操作File结构关联起来的。</p>\n<h3 id=\"h3_6\">继续跟踪调用</h3>\n<p>sock_common_recvmsg</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d60300146324\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint sock_common_recvmsg(struct kiocb *iocb, struct socket *sock,\r\n\t\t\tstruct msghdr *msg, size_t size, int flags) {\r\n\t......\r\n\t// 如果flags的MSG_DONTWAIT标识置位，则传给recvmsg的第5个参数为正,否则为0\r\n\terr = sk-&gt;sk_prot-&gt;recvmsg(iocb, sk, msg, size, flags &amp; MSG_DONTWAIT,\r\n\t\t\t\t   flags &amp; ~MSG_DONTWAIT, &amp;addr_len);\r\n\t.....\t\t\t\t   \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d60300146324-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d60300146324-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d60300146324-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d60300146324-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d60300146324-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d60300146324-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d60300146324-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d60300146324-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d60300146324-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sock_common_recvmsg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">kiocb *</span><span class=\"crayon-v\">iocb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">socket *</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d60300146324-2\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">msghdr *</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d60300146324-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d60300146324-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 如果flags的MSG_DONTWAIT标识置位，则传给recvmsg的第5个参数为正,否则为0</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d60300146324-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_prot</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">recvmsg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">iocb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MSG_DONTWAIT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d60300146324-6\"><span class=\"crayon-h\">\t\t\t\t   </span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">MSG_DONTWAIT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">addr_len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d60300146324-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">\t\t\t\t   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d60300146324-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>由上文可知: sk-&gt;sk_prot-&gt;recvmsg 其中sk_prot=tcp_prot,即最终调用的是tcp_prot-&gt;tcp_recvmsg,<br>\n上面的代码可以看出，如果fcntl(O_NONBLOCK)=&gt;MSG_DONTWAIT置位=&gt;(flags &amp; MSG_DONTWAIT)&gt;0, 再结合tcp_recvmsg的函数签名,即如果设置了O_NONBLOCK的话，设置给tcp_recvmsg的nonblock参数&gt;0,关系如下图所示:</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fq9n14e3v5j212g09wdh9.jpg\"></p>\n<h3 id=\"h3_7\">最终的调用逻辑tcp_recvmsg</h3>\n<p>首先我们看下tcp_recvmsg的函数签名:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d64657832221\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint tcp_recvmsg(struct kiocb *iocb, struct sock *sk, struct msghdr *msg,\r\n\t\tsize_t len, int nonblock, int flags, int *addr_len)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d64657832221-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d64657832221-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d64657832221-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_recvmsg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kiocb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">iocb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msghdr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d64657832221-2\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nonblock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">addr_len</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>显然我们关注焦点在(int nonblock这个参数上):</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d67671734465\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint tcp_recvmsg(struct kiocb *iocb, struct sock *sk, struct msghdr *msg,\r\n\t\tsize_t len, int nonblock, int flags, int *addr_len){\r\n\t......\t\r\n\t// copied是指向用户空间拷贝了多少字节，即读了多少\r\n\tint copied;\r\n\t// target指的是期望多少字节\r\n\tint target;\r\n\t// 等效为timo = noblock ? 0 : sk-&gt;sk_rcvtimeo;\r\n\ttimeo = sock_rcvtimeo(sk, nonblock);\r\n\t......\t\r\n\t// 如果设置了MSG_WAITALL标识target=需要读的长度\r\n\t// 如果未设置，则为最低低水位值\r\n\ttarget = sock_rcvlowat(sk, flags &amp; MSG_WAITALL, len);\r\n\t......\r\n\r\n\tdo{\r\n\t\t// 表明读到数据\r\n\t\tif (copied) {\r\n\t\t\t// 注意，这边只要!timeo，即nonblock设置了就会跳出循环\r\n\t\t\tif (sk-&gt;sk_err ||\r\n\t\t\t    sk-&gt;sk_state == TCP_CLOSE ||\r\n\t\t\t    (sk-&gt;sk_shutdown &amp; RCV_SHUTDOWN) ||\r\n\t\t\t    !timeo ||\r\n\t\t\t    signal_pending(current) ||\r\n\t\t\t    (flags &amp; MSG_PEEK))\r\n\t\t\tbreak;\r\n\t\t}else{\r\n\t\t\t// 到这里，表明没有读到任何数据\r\n\t\t\t// 且nonblock设置了导致timeo=0，则返回-EAGAIN,符合我们的预期\r\n\t\t\tif (!timeo) {\r\n\t\t\t\tcopied = -EAGAIN;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t// 这边如果堵到了期望的数据，继续，否则当前进程阻塞在sk_wait_data上\r\n\t\tif (copied &gt;= target) {\r\n\t\t\t/* Do not sleep, just process backlog. */\r\n\t\t\trelease_sock(sk);\r\n\t\t\tlock_sock(sk);\r\n\t\t} else\r\n\t\t\tsk_wait_data(sk, &amp;timeo);\r\n\t} while (len &gt; 0);\t\t\r\n\t......\r\n\treturn copied\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d67671734465-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d67671734465-44\">44</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcp_recvmsg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kiocb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">iocb</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msghdr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-2\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nonblock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">addr_len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// copied是指向用户空间拷贝了多少字节，即读了多少</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">copied</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// target指的是期望多少字节</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 等效为timo = noblock ? 0 : sk-&gt;sk_rcvtimeo;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">timeo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sock_rcvtimeo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nonblock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 如果设置了MSG_WAITALL标识target=需要读的长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 如果未设置，则为最低低水位值</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">target</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sock_rcvlowat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MSG_WAITALL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">do</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-17\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 表明读到数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-18\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">copied</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-19\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 注意，这边只要!timeo，即nonblock设置了就会跳出循环</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-20\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-21\"><span class=\"crayon-h\">\t\t\t    </span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TCP_CLOSE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-22\"><span class=\"crayon-h\">\t\t\t    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_shutdown</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RCV_SHUTDOWN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-23\"><span class=\"crayon-h\">\t\t\t    </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">timeo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-24\"><span class=\"crayon-h\">\t\t\t    </span><span class=\"crayon-e\">signal_pending</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">current</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-25\"><span class=\"crayon-h\">\t\t\t    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MSG_PEEK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-26\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-27\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-28\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 到这里，表明没有读到任何数据</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-29\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">// 且nonblock设置了导致timeo=0，则返回-EAGAIN,符合我们的预期</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-30\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">timeo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-31\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-v\">copied</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">EAGAIN</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-32\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-33\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-34\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-c\">// 这边如果堵到了期望的数据，继续，否则当前进程阻塞在sk_wait_data上</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-35\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">copied</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-36\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-c\">/* Do not sleep, just process backlog. */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-37\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">release_sock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-38\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">lock_sock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-39\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-40\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">sk_wait_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">timeo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-41\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">\t\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-42\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d67671734465-43\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">copied</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d67671734465-44\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0061 seconds] -->\r\n<p>上面的逻辑归结起来就是：<br>\n(1)在设置了nonblock的时候，如果copied&gt;0,则返回读了多少字节,如果copied=0，则返回-EAGAIN,提示应用重复调用。<br>\n(2)如果没有设置nonblock，如果读取的数据&gt;=期望，则返回读取了多少字节。如果没有则用sk_wait_data将当前进程等待。<br>\n如下流程图所示:</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fq9n15gvtaj20z60k8acz.jpg\"></p>\n<h3 id=\"h3_8\">阻塞函数sk_wait_data</h3>\n<p>sk_wait_data代码-函数为:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d6b903197364\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\t// 将进程状态设置为可打断INTERRUPTIBLE\r\n\tprepare_to_wait(sk-&gt;sk_sleep, &amp;wait, TASK_INTERRUPTIBLE);\r\n\tset_bit(SOCK_ASYNC_WAITDATA, &amp;sk-&gt;sk_socket-&gt;flags);\r\n\t// 通过调用schedule_timeout让出CPU，然后进行睡眠\r\n\trc = sk_wait_event(sk, timeo, !skb_queue_empty(&amp;sk-&gt;sk_receive_queue));\r\n\t// 到这里的时候，有网络事件或超时事件唤醒了此进程，继续运行\r\n\tclear_bit(SOCK_ASYNC_WAITDATA, &amp;sk-&gt;sk_socket-&gt;flags);\r\n\tfinish_wait(sk-&gt;sk_sleep, &amp;wait);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d6b903197364-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d6b903197364-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d6b903197364-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d6b903197364-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d6b903197364-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d6b903197364-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d6b903197364-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d6b903197364-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d6b903197364-1\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 将进程状态设置为可打断INTERRUPTIBLE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d6b903197364-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">prepare_to_wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_sleep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">wait</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TASK_INTERRUPTIBLE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d6b903197364-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">set_bit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">SOCK_ASYNC_WAITDATA</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_socket</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d6b903197364-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 通过调用schedule_timeout让出CPU，然后进行睡眠</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d6b903197364-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">rc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sk_wait_event</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">skb_queue_empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_receive_queue</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d6b903197364-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 到这里的时候，有网络事件或超时事件唤醒了此进程，继续运行</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d6b903197364-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">clear_bit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">SOCK_ASYNC_WAITDATA</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_socket</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d6b903197364-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">finish_wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_sleep</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">wait</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>该函数调用schedule_timeout进入睡眠，其进一步调用了schedule函数，首先从运行队列删除，其次加入到等待队列，最后调用和体系结构相关的switch_to宏来完成进程间的切换。<br>\n如下图所示:</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fq9n16qg5xj21540rw43a.jpg\"></p>\n<h3 id=\"h3_9\">阻塞后什么时候恢复运行呢</h3>\n<h4 id=\"h4_10\">情况1:有对应的网络数据到来</h4>\n<p>首先我们看下网络分组到来的内核路径，网卡发起中断后调用netif_rx将事件挂入CPU的等待队列，并唤起软中断(soft_irq)，再通过linux的软中断机制调用net_rx_action，如下图所示:</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fq9n17pdxbj213s0oc0vh.jpg\"></p>\n<p>注:上图来自PLKA(&lt;&lt;深入Linux内核架构&gt;&gt;)<br>\n紧接着跟踪next_rx_action</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d6f165578268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnext_rx_action\r\n\t|-process_backlog\r\n\t\t......\r\n\t\t\t|-&gt;packet_type-&gt;func 在这里我们考虑ip_rcv\r\n\t\t\t\t\t|-&gt;ipprot-&gt;handler 在这里ipprot重载为tcp_protocol\r\n\t\t\t\t\t\t(handler 即为tcp_v4_rcv)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d6f165578268-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d6f165578268-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d6f165578268-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d6f165578268-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d6f165578268-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d6f165578268-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d6f165578268-1\"><span class=\"crayon-v\">next_rx_action</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d6f165578268-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">_</span>backlog</div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d6f165578268-3\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d6f165578268-4\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">packet_type</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-i\">func</span><span class=\"crayon-h\"> </span>在这里我们考虑<span class=\"crayon-v\">ip_rcv</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d6f165578268-5\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">ipprot</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-i\">handler</span><span class=\"crayon-h\"> </span>在这里<span class=\"crayon-i\">ipprot</span>重载为<span class=\"crayon-e\">tcp_protocol</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d6f165578268-6\"><span class=\"crayon-h\">\t\t\t\t\t\t</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">handler</span><span class=\"crayon-h\"> </span>即为<span class=\"crayon-v\">tcp_v4_rcv</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>紧接着tcp_v4_rcv:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d72758176770\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntcp_input.c\r\ntcp_v4_rcv\r\n\t|-tcp_v4_do_rcv\r\n\t\t|-tcp_rcv_state_process\r\n\t\t\t|-tcp_data_queue\r\n\t\t\t\t|-sk-&gt;sk_data_ready=sock_def_readable\r\n\t\t\t\t\t|-wake_up_interruptible\r\n\t\t\t\t\t\t|-__wake_up\r\n\t\t\t\t\t\t\t|-__wake_up_common</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d72758176770-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d72758176770-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d72758176770-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d72758176770-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d72758176770-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d72758176770-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d72758176770-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d72758176770-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d72758176770-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d72758176770-1\"><span class=\"crayon-v\">tcp_input</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d72758176770-2\"><span class=\"crayon-v\">tcp_v4_rcv</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d72758176770-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tcp_v4_do_rcv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d72758176770-4\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tcp_rcv_state_process</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d72758176770-5\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tcp_data_queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d72758176770-6\"><span class=\"crayon-h\">\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sk_data_ready</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">sock_def_readable</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d72758176770-7\"><span class=\"crayon-h\">\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">wake_up_interruptible</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d72758176770-8\"><span class=\"crayon-h\">\t\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">__wake_up</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d72758176770-9\"><span class=\"crayon-h\">\t\t\t\t\t\t\t</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">__wake_up_common</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>在这里__wake_up_common将停在当前wait_queue_head_t中的进程唤醒，即状态改为task_running，等待CFS调度以进行下一步的动作,如下图所示。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fq9n18hqx2j20zq0kigng.jpg\"></p>\n<h4 id=\"h4_11\">情况2:设定的超时时间到来</h4>\n<p>在前面调用sk_wait_event中调用了schedule_timeout</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d76679330659\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfastcall signed long __sched schedule_timeout(signed long timeout) {\r\n\t......\r\n\t// 设定超时的回掉函数为process_timeout\r\n\tsetup_timer(&amp;timer, process_timeout, (unsigned long)current);\r\n\t__mod_timer(&amp;timer, expire);\r\n\t// 这边让出CPU\r\n\tschedule();\r\n\tdel_singleshot_timer_sync(&amp;timer);\r\n\ttimeout = expire - jiffies;\r\n out:\r\n \t// 返回经过了多长事件\r\n\treturn timeout &lt; 0 ? 0 : timeout;\t\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d76679330659-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d76679330659-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d76679330659-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d76679330659-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d76679330659-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d76679330659-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d76679330659-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d76679330659-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d76679330659-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d76679330659-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d76679330659-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d76679330659-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d76679330659-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d76679330659-1\"><span class=\"crayon-e\">fastcall </span><span class=\"crayon-t\">signed</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__sched </span><span class=\"crayon-e\">schedule_timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">signed</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d76679330659-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d76679330659-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 设定超时的回掉函数为process_timeout</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d76679330659-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">setup_timer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">timer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process_timeout</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">current</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d76679330659-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">__mod_timer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">timer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expire</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d76679330659-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\">// 这边让出CPU</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d76679330659-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">schedule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d76679330659-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">del_singleshot_timer_sync</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">timer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d76679330659-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expire</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jiffies</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d76679330659-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d76679330659-11\"><span class=\"crayon-h\"> \t</span><span class=\"crayon-c\">// 返回经过了多长事件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d76679330659-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d76679330659-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>process_timeout函数即是将此进程重新唤醒</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26dd3b1d79198403607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic void process_timeout(unsigned long __data)\r\n{\r\n\twake_up_process((struct task_struct *)__data);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d79198403607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d79198403607-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26dd3b1d79198403607-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26dd3b1d79198403607-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d79198403607-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process_timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d79198403607-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26dd3b1d79198403607-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">wake_up_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">task_struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">__data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26dd3b1d79198403607-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h2 id=\"h2_12\">总结</h2>\n<p>linux内核源代码博大精深，阅读其代码很费周折。希望笔者这篇文章能帮助到阅读linux网络协议栈代码的人。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113858\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113858votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113858\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/83781eed2f7e726b14e5d4ca2e1a602b8b53d469.jpg"},{"url_object_id": "984d2095c68d0891012669fd1bb21e2d", "title": "彩票的数学知识", "url": "http://blog.jobbole.com/113901/", "create_date": "2018/04/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/04/f58960421a4971f3faf2694f8206948d.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,彩票", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://ruanyifeng.com/blog/2018/04/lottery-mathematics.html\">阮一峰的网络日志</a>   </div><div id=\"main-content\"><!-- div class=\"asset-body\" -->彩票怎样才能中奖？\n<p><!-- /div --> <!-- div id=\"more\" class=\"asset-more\" --></p>\n<p>理论上，只能靠运气。但是，如果规则设计得不好，就可以钻漏洞。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/ccb3d06456d33d07934f9f3d1c103f96.jpg\" alt=\"\"></p>\n<p>2005年2月，美国的一个彩票品种，就出现了漏洞，被麻省理工学院的学生发现了。随后的七年，这个学生反复购买这个品种，一共赚到了300万美元。</p>\n<p>本文介绍他怎么做的，以及其中的数学原理。我依据的材料，主要来自数学教授 Jordan Ellenberg 在斯坦福大学的一次演讲（<a href=\"https://www.youtube.com/watch?v=QtlmXoHpNyI\">Youtube</a>）。</p>\n<h1>一、期望值</h1>\n<p>彩票最重要的数学概念，叫做”期望值”（expected value），即同一种行为多次重复以后，所能得到的平均收益。</p>\n<p>举例来说，如果每次抽奖需要2元，假设200次抽奖可以中奖一次，奖金为300元。那么，你花了2000元，一共抽奖1000次，中奖了5次，奖金为1500元。</p>\n<p>也就是说，1000次抽奖的总收益是1500元，每次的平均收益是1.5元，这就是期望值。它的计算公式如下。</p>\n<blockquote><p>期望值 = 300 * (1 / 200) + 0 * (199 / 200) = 1.5</p></blockquote>\n<p>期望值是1.5元，但是每次抽奖成本2元，于是净亏损0.5元。</p>\n<p>一看就知道，这个事情是不划算的，做得越多，越不划算。偶尔买一次彩票，倒也算了；如果你一天到晚不断买彩票，就肯定会亏很多钱（上例是每200次亏100元）。</p>\n<p>总之，期望值是衡量彩票收益的一个关键指标。</p>\n<h1>二、马萨诸塞州的 WinFall 彩票</h1>\n<p>美国马萨诸塞州有一个彩票品种，叫做 WinFall。它的规则很简单：1到48里面，你猜6个数字，猜中就有奖。</p>\n<blockquote>\n<ul>\n<li>四等奖（6个猜中2个）：奖金2元</li>\n<li>三等奖（6个猜中3个）：奖金5元</li>\n<li>二等奖（6个猜中4个）：奖金150元</li>\n<li>一等奖（6个猜中5个）：奖金4000元</li>\n<li>特等奖（6个猜中6个）：奖金池剩余的全部奖金</li>\n</ul>\n</blockquote>\n<p>有一期，一共卖出了930万张彩票，其中特等奖一个，奖金100万美元，一等奖238个，二等奖11625个，三等奖19.8万个，四等奖136.8万个。</p>\n<p>计算可知，这种彩票的期望值是0.798元。</p>\n<blockquote><p>期望值 =<br>\n100万 * ( 1 / 930万) +<br>\n4000 * ( 238 / 930万) +<br>\n150 * (11625 / 930万) +<br>\n5 * (19.8万 / 930万) +<br>\n2 * (136.8万 / 930万 )<br>\n= 0.798</p></blockquote>\n<p>每张彩票的价格是2元，可是平均收益只有0.798元，连一半都不到，可见这种彩票是非常不划算的。因此没有吸引力，购买这种彩票的民众不断减少。</p>\n<p>州政府很着急，因为政府从彩票抽成20%（每张0.4元）。如果销售量减少，政府的收益也会减少。于是，政府为了增加这种彩票的吸引力，决定修改彩票规则。</p>\n<h1>三、新规则</h1>\n<p>新的规则是，如果当期没有特等奖（没人猜中６个数字），那么奖金会分配给一等奖、二等奖、三等奖的得主，各奖项新的中奖金额如下。</p>\n<blockquote>\n<ul>\n<li>一等奖（6中5）：50000元</li>\n<li>二等奖（6中4）：2385元</li>\n<li>三等奖（6中3）：60元</li>\n</ul>\n</blockquote>\n<p>还是使用前面的中奖率，计算期望值。</p>\n<blockquote><p>期望值 =<br>\n50000 * ( 238 / 930万) +<br>\n2385 * (11625 / 930万) +<br>\n60 * (19.8万 / 930万) +<br>\n= 5.53</p></blockquote>\n<p>每张彩票的价格还是2元，但是期望值变成了5.53元。购买这种彩票就变得非常划算，大量购买的话， 可以得到2.5倍的收益。之所以期望值大于彩票的成本，是因为奖金池还包含前期剩余的奖金。</p>\n<p>麻省理工学院的一个学生，发现了这一点。他凑了5000元购买彩票，结果中了将近15000元！</p>\n<h1>四、如何选择号码？</h1>\n<p>现在我们知道，新规则的彩票是有利可图的，可以大量购买。但是，还有一个问题，应该怎么选择号码，才能保证收益？也就是说，48个号码里面，你应该选择哪6个号码，才能收益最大化？</p>\n<p>毕竟你不能购买所有彩票，因为彩票的收益来自没中奖的那些人。你只能购买一部分彩票，设法使得自己购买的号码有最大的中奖可能。</p>\n<p>为了简化思考，让我们考虑一种简单的情况。1到7里面猜三个数字，奖金如下。</p>\n<blockquote>\n<ul>\n<li>猜中3个：奖金6元</li>\n<li>猜中2个：奖金2元</li>\n<li>猜中1个：无奖金</li>\n</ul>\n</blockquote>\n<p>你可以同时选择七种组合（即购买七张彩票），请问应该如何选择号码？</p>\n<h1>五、组合数公式</h1>\n<p>首先，让我们考虑一下，1到7这七个数字里面，三个数字的组合一共有多少种？这在数学里面，叫做<a href=\"https://baike.baidu.com/item/%E7%BB%84%E5%90%88%E6%95%B0%E5%85%AC%E5%BC%8F\">组合数公式</a>。</p>\n<blockquote><p>组合数公式是指从 m 个不同元素中，取出 n（n ≤ m）个元素的所有组合的个数，用符号 c(m, n) 表示。</p></blockquote>\n<p>它的计算公式如下。</p>\n<blockquote><p>c(m, n) = m! / n! * (m – n)!</p></blockquote>\n<p>上面公式中，感叹号表示阶乘，比如<code>4!</code> 等于<code>4 * 3 * 2 * 1</code> 。</p>\n<p>按照上面的定义，七个数字里面的三个号码的组合，共有<code>c(7, 3)</code>个。</p>\n<blockquote><p>c(7, 3) = 7! / 3! * (7 – 3)! = 35</p></blockquote>\n<p>这就是说，三个数字的组合共有 35 种。我们可以把它们全部列出来。</p>\n<blockquote><p>123 124 125 126 127<br>\n134 135 136 137<br>\n145 146 147<br>\n156 157<br>\n167<br>\n234 235 236 237<br>\n245 246 247<br>\n256 257<br>\n267<br>\n345 346 347<br>\n356 357<br>\n367<br>\n456 457<br>\n467<br>\n567</p></blockquote>\n<p>上面是所有35种可能的组合，你必须从中选出7种。请问应该选择哪七种？</p>\n<h1>六、最佳组合</h1>\n<p>答案是下面这七种组合。</p>\n<blockquote><p>123 145 167 247 256 346 357</p></blockquote>\n<p>这七张彩票能让你的收益最大化。因为，不管最后的中奖号码是什么，它们可以保证你总是获得6元奖金。如果中奖号码是123，那么你拿到头奖6元；如果中奖号码是367，那么167、346、357这三张彩票各自猜中两个号码，你中了三个小奖，奖金总额也是6元。</p>\n<p>仔细观察这七张彩票，你会发现它们是精心选择的：每个数字都正好出现三次。这导致你要么中一个大奖，要么中三个小奖。</p>\n<h1>七、几何选择法</h1>\n<p>这七张彩票是怎么选出的呢？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/4cad5b6d3d7a5f64bb1d7a55679c2f3d.gif\" alt=\"\"></p>\n<p>有一种几何方法，可以非常简单地做到这一点。七个号码就是七个点，把它们用直线连起来，每根线上只能有三个点，而每个点出现在三根线上。画成上面的形状，就得到了七根线（内部的圆也算一根线）。然后，记录一下每根线上的号码，很简单就选出了七张彩票。</p>\n<p>更严谨的证明是这样的：1到7这七个数字，共有21种两个数字的组合（<code>C(7, 2)</code>），这意味着只要把这21种组合都买全了，就可以保证中三个小奖。因为三个中奖号码里面，共有三种两个数字的组合（比如中奖号码是367，那么36、37、67都可以中小奖）。另一方面，由于每张彩票包含三个号码，即包含三种两个数字的组合，那么最少只要买7张彩票就能覆盖全部21种组合。</p>\n<h1>八、实际的策略</h1>\n<p>回到前面的问题，马萨诸塞州的彩票应该怎么买？</p>\n<p>6个号码只要猜中4个，就可以中二等奖，只要把所有四个号码的组合都买了，就可以确保中15个二等奖（6个中奖号码共有15个四个号码的组合<code>C(6, 4)</code>）。</p>\n<p>48个号码里面共有194580种四个号码的组合（<code>C(48, 4)</code>），既然一张彩票包含15种组合，那么最少购买12972张彩票就够了（<code>194580 / 15 = 12972</code>），就可以包含所有四个号码的组合。如果有兴趣的话，你可以写一个程序，算出包含这194580种组合的所有彩票。</p>\n<p>购买12972张彩票，需要25944元（<code>12972 * 2</code>）。根据前面的奖金额，二等奖的奖金是2385元，那么15个二等奖就是35775元（<code>2385 * 15</code>）。因此，投入25944元，可以无风险地获得35775元。当然，这样做的前提是，当期没人猜中特等奖，否则奖金就会被大大稀释。</p>\n<p><!-- /div --></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113901\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113901votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113901\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c065d43e6c84afd025fb0d411cb2511523d8ce50.jpg"},{"url_object_id": "617147c254639a1116c63b146f58b2e8", "title": "可怕的万圣节 Linux 命令", "url": "http://blog.jobbole.com/113905/", "create_date": "2018/04/18", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/04/11489667c4b61dbd7d1f86da23791294.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.networkworld.com/article/3235219/linux/scary-linux-commands-for-halloween.html\">Sandra Henry-stocker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9552-1.html\">Linux中国/geekpi</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/11489667c4b61dbd7d1f86da23791294.jpg\" alt=\"\"></p>\n<p>虽然现在不是万圣节，也可以关注一下 Linux 可怕的一面。什么命令可能会显示鬼、巫婆和僵尸的图像？哪个会鼓励“不给糖果就捣蛋”的精神？</p>\n<h3 id=\"toc_1\">crypt</h3>\n<p>好吧，我们一直看到 <code>crypt</code>。尽管名称不同，crypt 不是一个地窖，也不是垃圾文件的埋葬坑，而是一个加密文件内容的命令。现在，<code>crypt</code> 通常用一个脚本实现，通过调用一个名为 <code>mcrypt</code> 的二进制文件来模拟以前的 <code>crypt</code> 命令来完成它的工作。直接使用 <code>mycrypt</code> 命令是更好的选择。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a998779f127255987\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mcrypt x\r\nEnter the passphrase (maximum of 512 characters)\r\nPlease use a combination of upper and lower case letters and numbers.\r\nEnter passphrase:\r\nEnter passphrase:\r\n\r\nFile x was encrypted.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a998779f127255987-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a998779f127255987-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a998779f127255987-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a998779f127255987-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a998779f127255987-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a998779f127255987-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a998779f127255987-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a998779f127255987-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a998779f127255987-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mcrypt</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a998779f127255987-2\"><span class=\"crayon-e\">Enter </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">passphrase</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">maximum </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">characters</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a998779f127255987-3\"><span class=\"crayon-e\">Please </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">combination </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">upper </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lower </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">letters </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numbers</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a998779f127255987-4\"><span class=\"crayon-e\">Enter </span><span class=\"crayon-v\">passphrase</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a998779f127255987-5\"><span class=\"crayon-e\">Enter </span><span class=\"crayon-v\">passphrase</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a998779f127255987-6\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a998779f127255987-7\"><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">was </span><span class=\"crayon-v\">encrypted</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a998779f127255987-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>请注意，<code>mcrypt</code> 命令会创建第二个扩展名为 <code>.nc</code> 的文件。它不会覆盖你正在加密的文件。</p>\n<p><code>mcrypt</code> 命令有密钥大小和加密算法的选项。你也可以再选项中指定密钥，但 <code>mcrypt</code> 命令不鼓励这样做。</p>\n<h3 id=\"toc_2\">kill</h3>\n<p>还有 <code>kill</code> 命令 – 当然并不是指谋杀，而是用来强制和非强制地结束进程，这取决于正确终止它们的要求。当然，Linux 并不止于此。相反，它有各种 <code>kill</code> 命令来终止进程。我们有 <code>kill</code>、<code>pkill</code>、<code>killall</code>、<code>killpg</code>、<code>rfkill</code>、<code>skill</code>（）读作 es-kill）、<code>tgkill</code>、<code>tkill</code> 和 <code>xkill</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a99877a9781989485\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ killall runme\r\n[1] Terminated ./runme\r\n[2] Terminated ./runme\r\n[3]- Terminated ./runme\r\n[4]+ Terminated ./runme\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877a9781989485-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877a9781989485-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877a9781989485-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877a9781989485-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877a9781989485-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877a9781989485-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a99877a9781989485-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">killall </span><span class=\"crayon-i\">runme</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877a9781989485-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Terminated</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">runme</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877a9781989485-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Terminated</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">runme</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877a9781989485-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Terminated</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">runme</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877a9781989485-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Terminated</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">runme</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877a9781989485-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">shred</h3>\n<p>Linux 系统也支持一个名为 <code>shred</code> 的命令。<code>shred</code> 命令会覆盖文件以隐藏其以前的内容，并确保使用硬盘恢复工具无法恢复它们。请记住，<code>rm</code> 命令基本上只是删除文件在目录文件中的引用，但不一定会从磁盘上删除内容或覆盖它。<code>shred</code> 命令覆盖文件的内容。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a99877ad482123567\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ shred dupes.txt\r\n$ more dupes.txt\r\n▒oΛ▒▒9▒lm▒▒▒▒▒o▒1־▒▒f▒f▒▒▒i▒▒h^}&amp;▒▒▒{▒▒\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877ad482123567-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877ad482123567-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877ad482123567-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877ad482123567-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a99877ad482123567-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shred </span><span class=\"crayon-v\">dupes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877ad482123567-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">dupes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877ad482123567-3\">▒<span class=\"crayon-i\">o</span>Λ▒▒<span class=\"crayon-cn\">9</span>▒<span class=\"crayon-i\">lm</span>▒▒▒▒▒<span class=\"crayon-i\">o</span>▒<span class=\"crayon-cn\">1</span>־▒▒<span class=\"crayon-i\">f</span>▒<span class=\"crayon-i\">f</span>▒▒▒<span class=\"crayon-i\">i</span>▒▒<span class=\"crayon-v\">h</span><span class=\"crayon-o\">^</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&amp;</span>▒▒▒<span class=\"crayon-sy\">{</span>▒▒</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877ad482123567-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">僵尸</h3>\n<p>虽然不是命令，但僵尸在 Linux 系统上是很顽固的存在。僵尸基本上是没有完全清理掉的死亡进程的遗骸。进程<em>不应该</em>这样工作 —— 让死亡进程四处游荡，而不是简单地让它们死亡并进入数字天堂，所以僵尸的存在表明了让他们遗留于此的进程有一些缺陷。</p>\n<p>一个简单的方法来检查你的系统是否有僵尸进程遗留，看看 <code>top</code> 命令的标题行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a99877b1320608390\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ top\r\ntop - 18:50:38 up 6 days, 6:36, 2 users, load average: 0.00, 0.00, 0.00\r\nTasks: 171 total, 1 running, 167 sleeping, 0 stopped, 3 zombie  `&lt; ==`\r\n%Cpu(s): 0.0 us, 0.0 sy, 0.0 ni, 99.9 id, 0.1 wa, 0.0 hi, 0.0 si, 0.0 st\r\nKiB Mem : 2003388 total, 250840 free, 545832 used, 1206716 buff/cache\r\nKiB Swap: 9765884 total, 9765764 free, 120 used. 1156536 avail Mem</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b1320608390-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b1320608390-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b1320608390-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b1320608390-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b1320608390-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b1320608390-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b1320608390-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a99877b1320608390-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">top</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b1320608390-2\"><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">50</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">38</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">up</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">days</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">36</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">load </span><span class=\"crayon-v\">average</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.00</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877b1320608390-3\"><span class=\"crayon-v\">Tasks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">171</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">running</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">167</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sleeping</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stopped</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">zombie</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b1320608390-4\"><span class=\"crayon-ta\">%</span><span class=\"crayon-e\">Cpu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">us</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ni</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">99.9</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wa</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">si</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">st</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877b1320608390-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b1320608390-6\"><span class=\"crayon-e\">KiB </span><span class=\"crayon-v\">Mem</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2003388</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">250840</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">545832</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1206716</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buff</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">cache</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877b1320608390-7\"><span class=\"crayon-e\">KiB </span><span class=\"crayon-v\">Swap</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9765884</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">total</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9765764</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">120</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1156536</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">avail </span><span class=\"crayon-v\">Mem</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>可怕！上面显示有三个僵尸进程。</p>\n<h3 id=\"toc_5\">at midnight</h3>\n<p>有时会在万圣节这么说，死者的灵魂从日落开始游荡直到午夜。Linux 可以通过 <code>at midnight</code> 命令跟踪它们的离开。用于安排在下次到达指定时间时运行的作业，<code>at</code> 的作用类似于一次性的 cron。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a99877b4091301084\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ at midnight\r\nwarning: commands will be executed using /bin/sh\r\nat&gt; echo 'the spirits of the dead have left'\r\nat&gt; &lt;EOT&gt;\r\njob 3 at Thu Oct 31 00:00:00 2017\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b4091301084-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b4091301084-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b4091301084-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b4091301084-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b4091301084-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b4091301084-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a99877b4091301084-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">at </span><span class=\"crayon-e\">midnight</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b4091301084-2\"><span class=\"crayon-v\">warning</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">commands </span><span class=\"crayon-e\">will </span><span class=\"crayon-e\">be </span><span class=\"crayon-e\">executed </span><span class=\"crayon-v\">using</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sh</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877b4091301084-3\"><span class=\"crayon-v\">at</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'the spirits of the dead have left'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b4091301084-4\"><span class=\"crayon-v\">at</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">EOT</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877b4091301084-5\"><span class=\"crayon-i\">job</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">at </span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">Oct</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b4091301084-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">守护进程</h3>\n<p>Linux 系统也高度依赖守护进程 —— 在后台运行的进程，并提供系统的许多功能。许多守护进程的名称以 “d” 结尾。这个 “d” 代表守护进程daemon，表明这个进程一直运行并支持一些重要功能。有的会用单词 “daemon” 。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a99877b8455570571\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ps -ef | grep sshd\r\nroot 1142 1 0 Oct19 ? 00:00:00 /usr/sbin/sshd -D\r\nroot 25342 1142 0 18:34 ? 00:00:00 sshd: shs [priv]\r\n$ ps -ef | grep daemon | grep -v grep\r\nmessage+ 790 1 0 Oct19 ? 00:00:01 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation\r\nroot 836 1 0 Oct19 ? 00:00:02 /usr/lib/accountsservice/accounts-daemon\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b8455570571-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b8455570571-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b8455570571-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b8455570571-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b8455570571-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a99877b8455570571-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a99877b8455570571-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a99877b8455570571-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ef</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-e\">sshd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b8455570571-2\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1142</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Oct19</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sshd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">D</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877b8455570571-3\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25342</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1142</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sshd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">shs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">priv</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b8455570571-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ef</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-v\">daemon</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877b8455570571-5\"><span class=\"crayon-v\">message</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">790</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Oct19</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dbus</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">system</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">address</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">nofork</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">nopidfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">activation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a99877b8455570571-6\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">836</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Oct19</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">accountsservice</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">daemon</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a99877b8455570571-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113905\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113905votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113905\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/4a23101e18b9584644a1484a9f994cfdfe1aad85.jpg"},{"url_object_id": "627fba360f907b35e30cde7e75e233df", "title": "软件复杂性正在杀死我们", "url": "http://blog.jobbole.com/113820/", "create_date": "2018/04/14", "front_image_url": ["http://ww3.sinaimg.cn/mw690/7cc829d3gw1ezy0oepjyrj21hc0u0wk6.jpg"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 3, "tags": "业界", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx138099575\">风木</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.simplethread.com/software-complexity-killing-us/\">Justin Etheredge</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>代码量少了不代表软件的复杂度降低了，而是编程语言的表达力更强了。太多开发人员痴迷于框架，过度追求软件灵活性、可组合性等等，而忘记自己是不是真的需要这些。</p>\n<hr>\n<p><img class=\"alignnone\" src=\"http://ww3.sinaimg.cn/mw690/7cc829d3gw1ezy0oepjyrj21hc0u0wk6.jpg\" width=\"690\" height=\"388\"></p>\n<p>在有软件之前，只有黑暗。自从时代的黎明到来后，一直存在一个不变的事实：企业想要构建价格更低、运行更快的软件。</p>\n<p>当然，这是可以理解并且值得称赞的目标——尤其是你曾经花费时间跟软件开发人员打过交道。每个工程师都应该全心支持此目标，并且在当前环境的约束下，应该始终努力尽可能有效率地创造产品。</p>\n<p>然而，事实上，我们经常做不到这一点。并非故意为之，只是随着时间流逝，在构建软件时会因为意料之外的复杂性而陷入困境，因此自我训练以寻找边界案例、差距分析以及所有可能起源于同一个需求要点的隐藏故障。</p>\n<p>我们被大量的复杂度以及设计优雅解决方案的精神执念所迷惑：另一层抽象！干起来！分离相关量！继承构成！这也是可以理解的，但是在这个过程中，我们经常忽略正在被解决的业务问题，忘记管理复杂度是软件开发人员<strong>次重要</strong>的责任。</p>\n<p><strong>为什么会造成现在这样的局面？</strong></p>\n<h3>软件在某些方面上已经变得更加简单了</h3>\n<p>在过去的几十年里，软件产业非常成功地降低了编写大多数软件所需要的自定义代码量。</p>\n<p>这种减少大部分是通过使编程语言更有表现性来实现的。像 Python、Ruby 或 JavaScript 这些语言可以用<strong>不到 </strong>C 语言<strong>三分之一的代码</strong>来实现相似的功能。使用 C 语言取代汇编语言编写程序也同样带来了类似的优势。可以预见，在未来，语言设计不大可能带来如同过去几十年一样的改进。</p>\n<p>然而也有很多其他不需要让语言更具有表现力的方法，可以精简构建软件的代码总量。截止到现在，在过去的二十年里，我们最大的收获是开源软件（OSS）。如果没有个人和公司将资金投入到他们为社区免费赠予的软件中，没有这么多的代价和努力，那么我们今天所构建的大部分软件将不会实现。</p>\n<p>这些项目使我们能够站在巨人的肩膀上解决问题，利用工具让我们更专注于解决业务问题，而不是花时间建设基础设施。</p>\n<p>也就是说，业务是复杂的。可笑的复杂，而且只会更多，开源软件非常适合生成用以构建系统的框架和工具，但在很大程度上为了获得关注，又必须解决大量人员共享的问题。因此，大多数开源项目要么是相对通用的，要么是处于非常受欢迎的领域。因此，这些工具中的大部分都是建立系统的绝佳平台，但最终我们仍然需要在日益复杂且要求苛刻的系统中构建所有业务逻辑和接口。</p>\n<p>所以我们剩下的是一个看起来像这样的栈（对于 web 应用程序）…</p>\n<blockquote><p>&lt;Our Code/我们的代码&gt;<br>\n&lt;Libraries/库&gt;<br>\n&lt;Web Framework/Web 框架&gt;<br>\n&lt;Web Server/Web 服务器&gt;<br>\n&lt;Data Stores/数据存储&gt;<br>\n&lt;Operating System/操作系统&gt;</p></blockquote>\n<p>“Our Code”部分最终变得非常复杂，因为它反映了业务及其流程。如果我们有自定义的业务逻辑和自定义流程，那么我们只需编写组建应用程序的接口、工作流程和逻辑即可。当然，我们可以尝试用不同的方式来记录该逻辑（记住业务规则引擎？），但最终，没有其他人会为您的业务编写业务逻辑。实际上似乎没有办法解决这个问题……至少是在机器人到来并将我们从工作中解救出来之前。</p>\n<h3>不喜欢代码，那么低代码（Low-Code）如何？</h3>\n<p>如果我们必须开发应用程序的接口、工作流程和逻辑，这听起来像是难住我们了，对吗？ 在某种程度上，是的，但我们仍有几个选择。</p>\n<p>对于大多数开发者来说，软件等于代码，现实并非如此。 开发软件有许多方法，其中一种是使用可视化工具。 在网络普及之前，视觉开发和 RAD 工具在市场上占有更大的地位。 诸如 PowerBuilder、visual Foxpro、Delphi、VB 和 Access 等工具都具有可视化设计功能，允许开发人员在不输入任何代码的情况下创建界面。</p>\n<p>这些工具涵盖了需要编写的代码，但总的来说，你可以直观地设计应用程序，然后编写大量代码来实现应用程序的逻辑。 在很多情况下，你仍然用编程操作接口，因为使用这些工具构建的接口通常是静态的。 但是，对于大量应用程序，这些工具通过舍弃其他性能获得了巨大的生产力，主要是以灵活性为代价。</p>\n<p>自从网络兴起后，这些工具可能已经不再流行，但公司对它们的渴望并没有降低，尤其是因为势不可挡的软件需求仍然持续不断。 整个行业最新趋势是“低代码”系统。 低代码开发工具是最新一代拖放式软件开发工具的现代术语。 这些工具和其他工具之间最大的区别在于，它们主要基于 Web（和移动端），并且通常被托管于云平台。</p>\n<p>许多公司正活跃于这些平台上。Salesforce（App Cloud）、Outsystems、Mendix 以及 Kony 等厂商承诺能够比“传统”应用程序开发快许多倍。 虽然他们的很多说法可能很夸张，但也有一定的可信度。依赖类似上述平台的所有弊端，可能的确导致某些类型的程序比使用 .NET 或 Java 的传统程序开发更快。</p>\n<h3>那么，问题是什么呢？</h3>\n<p>的确有几个问题。 首先，有经验的开发人员经常讨厌这些工具。 大多数严肃的开发人员™ 喜欢使用真实代码™ 编写真正的软件™。 我知道这听起来像我正在迎合一群呜咽的婴儿（也许我有点儿），但如果你传递的核心价值是技术，那么采用顶尖开发人员不喜欢使用的工具并非是个好主意。</p>\n<p>其次，像我这样的人看着这些被封装的平台，说“不，不要在这里构建应用程序”。这是合情合理的忧虑，也是最让我困扰的事情。</p>\n<p>如果你 10 年前用 PHP 搭建了一个应用程序，那么这个应用程序可能会显老，但它现在仍然可以嗡嗡作响。 语言和生态系统都是开源的，并由社区维护的。 你需要保持应用程序持续更新，却不必担心供应商断定不再值得花时间支持。</p>\n<blockquote><p>像我这样的人看着这些被封装的平台，说“不，不要在这里构建应用程序”。这是合情合理的忧虑，也是最让我困扰的事情。</p></blockquote>\n<p>如果你 10 年前选择了有自己平台的供应商，那么如果他们关闭工具或频繁更改工具（<a href=\"https://techcrunch.com/2017/01/30/facebooks-parse-developer-platform-is-shutting-down-today/\">还记得 Parse 么？</a>），你可能会被迫重写程序。或者更糟，你的系统会停滞在一个停止更新、不再支持服务的平台上。</p>\n<p>有很多理由去警惕这类平台，但对许多企业来说，以更少的付出来搭建软件太具诱惑以至于不忍拒绝。 软件的复杂性仍在持续，不幸的是软件工程师帮不上任何忙。</p>\n<h3>什么需要改变？</h3>\n<p>有高效的平台，可以让我们用真实代码™ 构建真正的软件™，但不幸的是，软件行业太过担心于跟随科技巨头地领导，以至于没有意识到他们的工具并没有对项目添加任何价值。</p>\n<p>我无法告诉你有多少次，曾遇到开发人员跟我说，相比于仅仅渲染 HTML，构建单一页面应用程序（SPA）类似的东西并不会增加开销。我曾听开发人员说过，所有应用都应该基于 NoSQL 数据库来开发，而关系数据库逐渐没落了。也曾听开发人员质疑为什么应用程序不是用 CQRS 和事件溯源编写的。</p>\n<p>正是这种思维过程和常规的开销导致公司认为软件开发过于昂贵。 你可能会说，“但事件溯源如此优雅！在微服务之上搭建 SPA 如此整洁！”当然，它可能是，但对你这种正在写十个微服务的人来说不是这样的。这种额外的复杂性往往是<strong>不必要的</strong>。</p>\n<p>作为从业人员，我们需要找到各种方法来简化搭建软件的过程，并且不忽视业务的合理复杂性。 我们需要承认，并非每个应用程序都需要与 Gmail 相同层次的界面复杂性和运营扩展性。 有很多应用程序需要经过深思熟虑的界面、复杂的逻辑、坚实的体系结构、流畅的工作流程等。但不需要微服务、AI、chatbots、NoSQL、Redux、Kafka、Containers 或任何类似的工具。</p>\n<p>如今很多开发人员似乎对技术能力非常着迷，以至于他们不能退后一步，问问自己是否真的需要这些。</p>\n<p>就像 MasterChef 上的人一样，他们以分子美食家的身份入场兜售自己。 他们将原料分成不同的组成部分，使用科学配对口味的方法，然后用大量的二氧化碳和液氮来制作你见过的最有创意的食物。 然后他们会在一两集之后被踢开，因为他们忘记了大多数烹饪的核心原则，即食物需要口感好。 他们似乎真的很惊讶于没有人喜欢他们发酵的茴香和芒果精华珍珠加上抹了鳀鱼沫的鳕鱼肉。</p>\n<p>对灵活性、可组合性和机敏性的痴迷正在给我们带来巨大的痛苦，并迫使公司远离我们所喜爱的平台和工具。 并不是说我上面列出的那些工具不会增加价值，尽管大公司在大规模操作系统时会遇到典型问题，工具也仅是为了解决真正的痛点而产生的。</p>\n<p>我所说的是，我们需要回到简单化的方向，并开始以更简单的方式创造事物，而不是仅仅一直讨论简单性。 也许我们可以依靠更多的<strong>集成</strong>技术栈来提供开箱即用的模式和工具，以便软件开发人员能够更高效地创建软件。</p>\n<blockquote><p>我们将把越来越多的业务添加到“低代码”平台和其他通过简化、移除起初写过的代码来降低软件成本的工具中。</p></blockquote>\n<p>我们需要停止假装二十行的程序是一些需要认真手工缝制的独特挂毯。</p>\n<h3>聚焦简单性</h3>\n<p>写完之后，我仿佛听到一百万位开发人员磨刀的声音，但我相信如果我们继续坚持如下方向：想写所有东西、配置一切、编写所有内容、无论多大规模的问题都使用相同的堆栈，那么我们将把越来越多的业务添加到“低代码”平台和其他通过简化、移除起初写过的代码来降低软件成本的工具中。</p>\n<p>我们对业务日益复杂的回答不会增加开发过程的复杂性 – 无论它看起来多么优雅。</p>\n<p>我们必须设法通过简化开发流程来管理复杂性。 因为管理复杂性是次重要的责任，我们必须始终记住软件开发人员最重要的责任：通过使用软件来实现价值。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113820\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113820votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113820\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx138099575\">风木</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx138099575\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/e496dcafc16ff266b061f892352783db.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx138099575\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx138099575/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx138099575/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"微博主页\" target=\"_blank\" href=\"https://weibo.com/6426355449/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/1ee8b23b2be55de42dc12bc7e4b5d4a4385a1ff4.jpg"},{"url_object_id": "cc046f39bd58bd3436d2a6869083d93a", "title": "如何识别人的技术能力和水平？", "url": "http://blog.jobbole.com/113923/", "create_date": "2018/04/25", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/04/e268c18430b4378f4b65054379484b31.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "职场,技术,能力", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://acejoy.com/2018/03/14/%E5%A6%82%E4%BD%95%E8%AF%86%E5%88%AB%E4%BA%BA%E7%9A%84%E6%8A%80%E6%9C%AF%E8%83%BD%E5%8A%9B%E5%92%8C%E6%B0%B4%E5%B9%B3%EF%BC%9F/\">ACE开发者</a>   </div><div>\n<p>这个题目是比较复杂的，它包含的东西比较多，认真讨论估计能写几万字。如果是专业研究，我看能写一本书了。这里打算根据自己的学习过程和工作经验，谈一下要点问题，均属个人看法，欢迎讨论。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/e268c18430b4378f4b65054379484b31.png\" alt=\"skills tree\" width=\"600\" height=\"613\"></p>\n<p>写这篇文章的初衷，跟前段时间跟朋友们聊招聘有关。因为技术招聘除了考察人的协作精神和工作态度，一大目标便是判断人的技术能力和实际水平。在这件事情上多做观察、思考是很有意义的。</p>\n<p>对于考察人的技术等级，学界是有认真的研究的。参见：<em><strong><a href=\"https://acejoy.com/2018/03/14/%E5%BE%B7%E9%9B%B7%E7%A6%8F%E6%96%AF%E6%A8%A1%E5%9E%8B%EF%BC%88dreyfus-model-of-skill-acquisition%EF%BC%89/\" target=\"_blank\" rel=\"noopener\">德雷福斯模型解说</a></strong></em>。</p>\n<p>德雷福斯模型把人的技能水平，分成5级：<strong>新手、高级新手、胜任者、精通者、专家。</strong></p>\n<p>对不同技能等级的认定是这样的：</p>\n<hr>\n<p><strong>新手：依靠指令清单，必须按部就班。</strong>就是必须给出详细而具体的操作规则，才能工作。比如你做一道从未做过的菜，需要看菜谱的说明，第一步做什么，第二步做什么等等，直到最后烹饪结束。</p>\n<p><strong>高级新手：有限的情景洞察力，同等对待工作的各个方面。对全局性、体系性的东西没兴趣。</strong>这是小工的水平。比如他能跟着师傅干点活，打打下手。可以靠着反复检索搜索引擎、StackOverflow解决具体的小问题。</p>\n<p><strong>胜任者：能够独立解决各种各样的领域内问题。</strong>这是一般的企业招聘，比较希望招到的等级，招进来稍作适应就能干活了，省心省力。</p>\n<p><strong>精通者：经验丰富，可以自我纠正、自我改进。</strong>这类等级的人，思考可以指向内在，通过反省、反馈改善技能。这种在企业可以算上高手、大拿了，培养不易。</p>\n<p><strong>专家：依靠直觉工作，不需要解释和理由。</strong>实际你让他解释，他可能也说不出个所以然，就是直觉给出答案，然后还是对的。专家人数稀少，需要很长时间训练、实践。通常的说法是10年出专家，10000小时定律。</p>\n<hr>\n<p>这个是理论上的研究，实践中比较缺乏操作性，难以迅速的判定应聘者的实际情况。不信你打开收进来的大把简历，刚毕业的学生，每个技能名词上面都是一堆堆的“<strong>精通</strong>” – 你相信么？但它可以当成一个职业技能等级判定的参照标准。</p>\n<p>于是乎，各家企业开启了各种“笔试”、“机试”，多轮面试，并且严格要求学历以及出身院校，试图以此过滤掉不合意的应征者，留下合格的人选。<strong>它当然是可行的，但是效果一般，而且容易出错，错失有思想有水平的人。</strong>不然也不会催生出各类“推荐式”的招聘。看重学历、学校当然也有其优点：它是快速过滤的手段，毕竟能考上好学校的人智商不会太差吧。但在大数字公司的一朋友说，公司里面还有初中毕业，一直精研安全领域的人，技术能力也是十分出色。如果严苛对待背景，这些人就会错过了。因为人的生活多种多样，有各种历史的背景因素影响经历。而部分人的经历，就是跟一些人不同的，可是不妨碍他们同样可以变得优秀。招聘，实际上是建立信任关系。如果有充足的信息证明，应聘者足够优秀，这就够了。条条框框只是辅助手段，并不是目的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/6c5299bf43b31ce14b2b8c6245ca1c0f.jpg\" alt=\"\" width=\"600\" height=\"779\"></p>\n<p>任正非的洞察力一流</p>\n<p>推荐式的招聘实际要靠谱的多，因为人很容易了解熟悉的人的水平。<strong>这是靠推荐者的信用背书。</strong>人平时沟通时说什么话，日常看什么书，关注哪些领域，琢磨过啥问题，哪些东西很熟，这个经常聊的熟人往往都知道。可是，这类招聘局限性也很大：<strong>面窄、靠机缘</strong>。靠推荐能招几个好手啊？好手往往是各家争抢的对象，窗口期有限，基本不会缺工作的。</p>\n<p>说了一圈，还是要在技能水准判定上有更高效率的办法，招进合适的人来。</p>\n<p>回到开头的德雷福斯模型，既然人的技能是分级的，那么<strong>对待不同的职位要求，也应该侧重不同的考察角度。</strong>如果千篇一律的走招聘流程，就容易出问题了。比如你明明要找的是“<strong>精通者</strong>”，可上来就让人一堆笔试、机试，这是不合适的。对方会十分的厌烦。体现高水平技术能力的并不在默写什么“字符串算法”那里。这反倒是刚毕业的人占便宜，因为才学过不久，印象深。不信你让工作10年的人跟计算机专业应届生比比写排序算法，真未必能赢。但是这并不重要 – 你干活不看手册不查文档吗？聪明人从不死记硬背。<strong>重要的地方在于对问题域的准确、深刻的理解，对各类技术优劣点、各种条件平衡的评判和把握。</strong></p>\n<p>对待初阶新人，<strong>应着重考察的是基本功是否扎实，专业成绩是否优秀。更重要的，是他对职业的热情，学习能力和研究精神。</strong>某类人要说起技术来，滔滔不绝，两眼放光，充满热情，对未知的、新生的各类概念、技术非常好奇，这种人想差都难。因为他会自我驱动，不用督促，自己就钻研前进。反之，觉得这个职业待遇高，只是想混饭吃的人，很少走得长远。这类初阶新人以毕业生、工作年限少者为多。测试考核，可以笔试查看其对基础概念的理解是否准确，知识领域的大致范围。甚至，布置一个有点挑战性的小任务，让他尝试解决，说明思路。</p>\n<p><strong>考察胜任、精通者的策略不一样</strong>。笔试做题没啥用，原因前面说了。这类招聘是重头戏，企业都喜欢找这样的，能干活。所以考核评估的地方也较多。我觉得可以分成几个方面去看。<strong>意识是否先进，是否会反省思考；是否善于解决问题，富有创造性；是否有比较深的积累和广阔的知识面。</strong></p>\n<p>业界的开发思想也是在不断变化，工具链一直在革新。聪明的人不用蛮力，而爱用工具提升效率，喜欢自动化操作解放人力。<strong>要查看人用什么开发工具链，用什么开发环境，解释下为什么？</strong>好的开发者会及时注意新出现的工具，挖掘它能解决什么问题，并尝试吸收，解决自己的需求。如果没有这个思想意识，工作效率就会打折扣了。因为你会落后行业发展水平。人善于自我反省，则会催动自我纠正，这正是精通者的特征。参考：<a href=\"https://acejoy.com/2018/03/02/%E4%BC%98%E7%A7%80%E7%9A%84%E5%BC%80%E5%8F%91%E8%80%85%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0%E7%A0%94%E7%A9%B6%E6%96%B0%E7%9A%84%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%EF%BC%9F/\" target=\"_blank\" rel=\"noopener\"><em><strong>优秀的开发者为什么要学习研究新的编程语言？</strong></em></a></p>\n<p>解决问题的能力是重头戏，也是企业招聘人的主因。人要善于解决实际问题，而且，要学会聪明的解决问题。解决问题要看思路，看手段，看是否有创造性，这是真正考验人能力的地方。好的开发者，会考虑很多可能选项，预估各种优劣，给出一个较优的方案。 遇到难题，会用各种方法尝试。经验丰富的人，常常会使用技术的组合手段来处理难题，而不是一个语言一个工具到处用。所以，<strong>要查看下过往的项目经历遇到的问题、困难，是如何解决的，思路如何。</strong>一些公司据说不招聘不会用谷歌的工程师。谷歌打不开？嘿嘿，这就是你要克服的困难啊。这你都解决不了，还做什么研发。谷歌是人类最全、最新知识的总索引，充分利用事半功倍。</p>\n<p><strong>考察知识的深度、广度，对重要领域的概念是否有深刻的理解和掌握，以及从各类工作经验中得到的认知。</strong>问问他看过什么书，研究过什么东西。说白了，知道的东西是否多。一些公司很喜欢用CheckList模式来考核，列一堆领域的知识点、概念，问人懂不懂，知道就是水平好，不懂就是水平差。实际情况并非如此。人的工作过程是独立的，一些事情如果没有工作机会去接触并解决，那么一些冷僻的问题就永远都碰不上。当然也就不知道。但你能说没做过就一定做不好么？</p>\n<p>另外，人的技能树，其实也是“犬牙交错、参差不齐”的。什么意思？技术领域非常的广阔，你真的没办法每个领域都很精通，实际上是这个做的多，懂的多，那个用的少，知道的少。这个时候，应看具体知识领域，是哪一类。它是否需要复杂的、难度较高的背景。门槛高的技术，需要的配套技能多得多，比如<strong>AI、机器学习</strong>。而一般产品应用领域则不然，了解核心概念、设计意图，看着手册、最佳实践，也就能上手了。这个暂时不会，实际无关紧要的，工作一段学的认真点就会了。但是门槛高的领域，就需要很长时间的学习了。这是本质的差别。</p>\n<p>我曾看见某公司放出的职员技能树，包罗万象，几乎一切IT领域的知识技能都在里面了，还声称要求“全部精通”。我不知道它如何定义的“精通”，如果按德雷福斯模型的定义，能做到的那是神，不是人类。这个纯属吹牛皮，我压根就不信。如果真有这样的人，出来让我膜拜下。因为每个稍大点的领域，都足够让你钻研一辈子，因为它们也在迅速发展呀。业内流传“<strong>全栈工程师</strong>”的说法，鼓吹自己是全栈的人经常是前端工程师。而研究后端工作领域的技术高手经常鄙视这类人：真以为会点Node.js就能解决一堆后端的事务了么？我也懂一些前端，也能号称“全栈”，但在不同领域的专业性是什么水准，自己明白的很。前端要解决的事情也有很多复杂性。全栈实际是反专业化的，是人力资源稀缺时候的低成本选择。</p>\n<p>更高一层，则是考察人本身了。人的视野够广阔么？其它领域的知识有了解吗？一些问题的解答并不在问题域本身，而是在外面的领域。所谓“<strong>功夫在诗外</strong>”。公司讲求团队协作，总要面临不同的分工合作问题。比如产品、运营的人提需求，可以换位思考吗？合作意识强么？谁也不想招个刺头进来吧？把团队的气氛和人际关系搞的一团糟，大家做事都不痛快、不顺心，又如何安心做好工作？最终只能让团队工作效率下降，甚至瓦解。</p>\n<p>要说专家，实际上有研究者认为是需要刻意练习+充分实践才能功成。并不是每个人经过足够的工作年限，都自动成为专家。有的人工作10年，可能后面9年都在重复第一年的工作任务，毫无改进。而职业上的训练机会，又跟大环境乃至运气息息相关，并不是每个人都有机缘的。但是把个人的职业技能做到胜任乃至精通，则是完全可行的，这只需要认真和勤奋，工作态度问题。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113923\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113923votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113923\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/a6bd0b86424540078e7288d939384886be448281.jpg"},{"url_object_id": "c9d9c3009f6783bc6fdee771e14f8aa2", "title": "机器学习如何发现你喜欢的音乐", "url": "http://blog.jobbole.com/113821/", "create_date": "2018/04/13", "front_image_url": ["http://wx2.sinaimg.cn/large/7cc829d3gy1fq7l3ts6p3j20ps0ocq78.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 4, "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/1789912317\">XiaofengYue_DXY</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://hackernoon.com/spotifys-discover-weekly-how-machine-learning-finds-your-new-music-19a41ab76efe\">Sophia Ciocca</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><h2>机器学习如何发现你喜欢的音乐：音乐个性化推荐背后的科学原理</h2>\n<p>本周一，正如其它每个周一，一亿多 Spotify 用户每人都收到了一个崭新的歌单。这个叫做每周发现的歌单内混合了用户从未听过但是可能会喜欢的 30首歌曲。效果堪称神奇。</p>\n<p>我自己是 Spotify 的超级粉丝，对每周发现尤其喜爱。为什么呢？因为我觉得它懂我。它比我生命中的任何人都更清楚我的音乐品味。我很高兴每周它都能满足我的需求，一如既往地推荐一些我自己永远都不会找到或知道会喜欢的歌曲。</p>\n<p>对于那些两耳不闻窗外事的人们，请允许我介绍一下我的虚拟好友：</p>\n<p><img id=\"pic\" class=\"M_cur_zoom_out aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fq7l3ts6p3j20ps0ocq78.jpg\"></p>\n<p style=\"text-align: center;\">[图片说明: 我的 Spotify 每周发现歌单]</p>\n<p>没想到，在这方面我不是一个人，不光是我对每周发现如此着迷 – 整个用户群体都趋之若鹜。这股热潮使得 Spotify 重新调整了它的重心，并在基于算法的歌单上投入了更多的资源。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fq7l3uppwxj20dy0bwabh.jpg\" width=\"502\" height=\"428\"></p>\n<blockquote><p>Dave Howitz: @Spotfiy 每周发现的歌单对我的了解程度简直毛骨悚然，熟悉到就像一个曾经与我有过一起濒死体验的前女友一样。</p>\n<p>Amanda Whitbred: 现在 @Spotify 的每周发现对我已经了解到如果它现在求婚，我也会说同意的地步了。</p></blockquote>\n<p>自「每周发现」在 2015 年第一次上线以来，我就迫切想知道它是怎么运作的（而且由于我是 Spotify 公司的迷妹，我喜欢假装在那里工作并研究他们的产品）。 经过三周的疯狂Google，我终于满怀感恩地获取了一些幕后的知识。</p>\n<p>所以 Spotify 到底是如何成功做到给每人每周挑选 30 首歌曲的？我们先来仔细看下其它的音乐服务是如何做音乐推荐，以及 Spotify 是如何更胜一筹的。</p>\n<p> </p>\n<h3>在线音乐甄选服务简史</h3>\n<p><span style=\"font-weight: normal;\"><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fq7l3vdopfj20iu07n756.jpg\" width=\"678\" height=\"275\"></span></p>\n<p><span style=\"font-weight: normal;\">早在千禧年之初，Songza 就开始使用手动甄选为用户提供歌单。手动甄选的意思就是所谓的音乐专家或者其他编辑会手动挑选一些他们自己认为不错的音乐做成歌单，然后听众可以直接拿来听。（稍后，Beats 音乐也采取了同样的策略）。手动甄选效果尚可，但是由于这种方法只是纯手工挑选，方式方法也比较简单，它并不能照顾到每个听众音乐品味的微妙差异。</span></p>\n<p>跟 Songza 一样， Pandora 也是音乐甄选服务领域的早期玩家之一。它使用了一个略为更高级的方法来代替给歌曲属性手工打标签。即大众在听音乐的时候，对每首歌曲挑选一些描述性的词语来作为标签。进而，Pandora 的程序可以直接过滤特定的标签来生成包含相似歌曲的歌单。</p>\n<p>差不多同一时间，一个隶属于麻省理工学院媒体实验室的名叫 The Echo Nest 的音乐信息机构，采用了一个完全不同的高级策略来定制音乐。The Echo Nest 使用算法来分析音频和音乐的文本内容，以完成音乐识别，个性化推荐，歌单创建和分析等。</p>\n<p>最后，是 Last.fm 另辟蹊径，采取了另一个沿用至今的策略。那就是利用协同过滤来识别用户可能喜欢的音乐。稍后本文会展开讨论更多这方面的内容。</p>\n<p>所以说既然其他的音乐甄选服务都实现了推荐功能，Spotify 究竟是怎么操作自己的神奇引擎，来实现甩出竞争对手几条街的用户品味默契度的呢？</p>\n<p> </p>\n<h3>Spotify 的三种推荐模型</h3>\n<p>事实上 Spotify 并没有使用什么单一的革命性推荐模型，而是<strong>混合了一些其他公司使用的最好的策略来创建他们自己独一无二的强大发现引擎。</strong></p>\n<p>Spotify 使用三种主要的推荐模型来创建每周发现：</p>\n<ol>\n<li><strong>协同过滤模型</strong>（即 Last.fm 最早使用的那些模型）。工作原理为分析你和<strong>其他</strong>用户的行为。</li>\n<li><strong>自然语言处理（NLP）</strong>模型 。工作原理为分析文本。</li>\n<li><strong>音频</strong>模型。工作原理为分析<strong>原始音频声道本身</strong>。</li>\n</ol>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fq7l3vwrx4j20mv0dgjw0.jpg\" width=\"690\" height=\"406\"></p>\n<p>我们来具体看下这些推荐模型是怎么工作的！</p>\n<h3>推荐模型之一：协同过滤</h3>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fq7l3wmkvhj218g094tah.jpg\" width=\"445\" height=\"91\"></p>\n<p>首先介绍下背景：当很多人听到协同过滤这几个词的时候，他们会立刻联想到 <strong>Netflix</strong>，因为它是第一个利用协同过滤来实现推荐模型的公司之一。其做法主要是使用用户提交的电影星级来计算推荐那些电影给其他<strong>类似的</strong>用户。</p>\n<p>自 <strong>Netflix </strong>将其成功应用以来，协同过滤开始快速流传开来。现在无论是谁想实现一个推荐模型的话，一般都会拿它作为初次尝试。</p>\n<p>与<strong>Netflix</strong>不同的是，Spotify 并没有用户对他们音乐的星级评价数据。Spotify 所用的数据是<strong>隐形反馈</strong>的，具体来说就是我们在线听歌的<strong>歌曲次数</strong>，以及其他额外信息，诸如用户是否保存歌曲到个人歌单，或者听完歌曲后是否接着访问艺术家主页等。</p>\n<p>但什么是协同过滤，到底它是如何工作的呢？下面用一段简短对话来做一个大致的介绍。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fq7l3x7gfyj20go0cytht.jpg\"></p>\n<p>啥情况? 原来这俩人里面每人都有自己的一些歌曲偏好 – 左边的人喜欢歌曲 P, Q, R 和 S; 右边的人喜欢 Q, R, S 和 T。</p>\n<p>协同过滤系统进而利用这些数据得出结论，</p>\n<blockquote><p><em>“</em><em>嗯。既然你俩都喜欢相同的歌曲 – Q</em><em>，R </em><em>和 S – </em><em>那么你们可能是类似的用户。所以你们应该会喜欢另一个人听过但是你还没有听过的歌曲。”</em></p></blockquote>\n<p>系统然后建议右边的人去体验下歌曲 P，以及左边的人去体验下歌曲 T。听起来够简单吧？</p>\n<p>但是 Spotify 具体是怎么具体应用这个概念，来计算<strong>基于百万级</strong>的用户偏好从而得出<strong>数以百万计</strong>的用户歌曲推荐呢？</p>\n<p> </p>\n<h3>…矩阵运算，用 Python 库即可实现</h3>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fq7l3xy4boj20ay071t9u.jpg\" width=\"394\" height=\"253\"></p>\n<p>现实中，此处提及的矩阵是极其庞大的。<strong>每行都代表了</strong><strong> Spotify </strong><strong>的一亿四千万用户中的一员</strong>（如果你也用 Spotify，那么你也是这个矩阵中的一行），而每一列则代表了 Spotify 数据库中<strong>三亿首歌曲</strong>中的一首。</p>\n<p>然后，Python 库就开始跑这个漫长而复杂的矩阵分解公式：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fq7l3yp06ej20oy01v3zg.jpg\" width=\"690\" height=\"51\"></p>\n<p>计算完成后，系统会生成两种类型的向量，在此分别命名为 X 和 Y。X 为用户向量，代表单个用户的音乐品味。Y 则为歌曲向量，代表单支歌曲的特征。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fq7l3zb0mxj20mn0a8di9.jpg\" width=\"690\" height=\"312\"></p>\n<p>现在我们得到了一亿四千万个用户向量，每人一个，还有三亿歌曲向量。这些向量的具体内容只是一些单独拎出来自身并无意义的数字，但是在后面进行比较时会非常有用。</p>\n<p>为了找到那些跟我相似品味的用户，协同过滤系统会拿我的向量跟其他用户的向量作比较，最终会找到那些跟我最相似的用户。对于 Y 向量，也是同样的流程 – 你可以拿一首歌的向量与其他的歌曲向量做比较，进而找出哪些歌曲是跟你现在正在看的歌曲最相似。</p>\n<p>协同过滤确实效果不错，但是 Spotify 深知再添加另外一个引擎的话效果会更出色。这就到了自然语言处理出场的时候了。</p>\n<p> </p>\n<h3>推荐模型之二：自然语言处理</h3>\n<p>Spotify 采用的第二个推荐模型就是<strong>自然语言处理</strong>。这些模型的源数据，正如名字所示，就是一些普通的<strong>语言文字</strong> – 例如歌曲的元数据，新闻文章，博客，和互联网上的其它文本等。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fq7l40111lj20dr09h41u.jpg\" width=\"495\" height=\"341\"></p>\n<p> </p>\n<p>自然语言处理 – 计算机理解人类语言的能力 – 本身就是一个巨大的领域，通常通过情感分析应用编程接口（API）来进行操作处理。</p>\n<p>自然语言处理背后的具体原理超出了本文的讨论范畴，但是在此本文可以提供一些粗略的描述：Spotify 会在网上不断爬取博客帖子以及其它音乐相关的文本，并找出人们对特定的艺术家和歌曲的评论 – 比如说人们对这些歌曲经常使用哪些形容词和语言, 以及哪些其他艺术家和歌曲也会和它们放在一起讨论。</p>\n<p>虽然我不知道 Spotify 如何处理他们抓取的数据，但是我可以介绍下 The Echo Nest 是如何使用它们的。他们会把数据分类成“文化向量”和“最佳评语集”。每个艺术家和歌曲都有数以千计的每日更新的最佳评语集。每个评语都有一个相关的权重，来表示其描述的重要性（简单说就是某人可能会用该评语描述某个音乐的概率）。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fq7l40o7dnj20jm07qaej.jpg\" width=\"690\" height=\"272\"></p>\n<p style=\"text-align: center;\">[ “Cultural vectors”, or “top terms”, as used by the Echo Nest. Table from Brian Whitman]</p>\n<p>然后，与协同过滤类似，自然语言处理模型用这些评语和权重来创建一个歌曲的表达向量，可以用来确定两首音乐是否相似。很酷吧？</p>\n<p> </p>\n<h3>推荐模型之三：原始音频模型</h3>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fq7l41ibqgj20pn09btap.jpg\" width=\"690\" height=\"250\"></p>\n<p>首先，你可能会问这个问题：</p>\n<blockquote><p><em>但是，Sophia</em><em>，我们已经从前两种模型中获取了这么多数据！为什么还要继续分析音频本身呢？</em></p></blockquote>\n<p>额，首先要说的是，引入第三个模型会进一步提高这个已经很优秀的推荐服务的准确性。但实际上，采用这个模型还有另外一个次要目的：<strong>原始音频模型会把新歌考虑进来。</strong></p>\n<p>比如说，你的创作歌手朋友在 Spotify 上刚放上了一首新歌。可能它只有 50 次听歌记录，所以很少能有其他听众来一起协同过滤它。与此同时，它也在网上也没有留下多少痕迹，所以自然语言处理模型也不会注意到它。幸运的是，原始音频模型并不区分新歌曲和热门歌曲。所以有了它的帮忙，你朋友的歌曲也可以和流行歌曲一道出现在每周发现的歌单里面。</p>\n<p>好了，到了“如何”的部分了。我们如何才能分析这些看起来如此抽象的<strong>原始音频数据</strong>呢？</p>\n<p>…用<strong>卷积神经网络！</strong></p>\n<p>卷积神经网络同样也是支撑面部识别的技术。只不过在 Spotify 的案例中，他们被稍作修改以基于音频数据处理而不是像素点。下面是一个神经网络架构的例子：</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fq7l426503j20sg0gl423.jpg\" width=\"690\" height=\"402\"></p>\n<p style=\"text-align: center;\">[<em>Image credit: Sander Dieleman</em>]</p>\n<p>这个特定的神经网络有四个<strong>卷积层</strong>，具体为图中左侧的宽柱，和右边的稍微窄些的三根柱。输入是音频帧的时频表示，进而连接起来形成频谱图。</p>\n<p>音频帧会穿过这些卷积层，经过最后一个卷积层，你可以看到一个“全局临时池”层。该层在整个时间轴上汇集数据，并有效计算和统计歌曲时长内的学习特征。</p>\n<p>处理完之后，神经网络会得出其对歌曲的理解，包括估计的<strong>时间签名，音调，调式，拍子及音量</strong>等特征。下面就是 Draft Punk 的 “Around the World” 30 秒片段的数据图。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fq7l43abdwj20fq0hkdk4.jpg\" width=\"566\" height=\"632\"></p>\n<p style=\"text-align: center;\">[Image Credit: <a href=\"http://docs.echonest.com.s3-website-us-east-1.amazonaws.com/_static/AnalyzeDocumentation.pdf\">Tristan Jehan &amp; David DesRoches (The Echo Nest)</a>]</p>\n<p>最终，对这些对歌曲关键特征的理解可以让 Spotify 来决定歌曲之间的相似度，以及根据用户听歌历史来判断哪些用户可能会喜欢它们。</p>\n<p>这些基本涵盖了为每周发现提供支持的推荐作业流程所依赖的三种主要模型。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fq7l4426xrj20q70ec7ad.jpg\"></p>\n<p style=\"text-align: center;\">[ Cassandra instances]</p>\n<p>当然了，这些推荐模型也和 Spotify 其它更大的生态系统连接在一起，其中包括利用海量的数据存储以及<strong>非常多</strong>的 Hadoop 集群来做推荐服务的扩展，使得引擎得以计算巨型矩阵，无穷无尽的互联网音乐文章和大量的音频文件。</p>\n<p>我希望本文可以对你有所启发，并且像当时它对我一样能够激起你的好奇。怀着对幕后的机器学习技术的了解和感激之情，现在我将通过我自己的每周发现来寻找我喜欢的音乐。</p>\n<p>文章结束。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113821\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113821votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113821\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/1789912317\">XiaofengYue_DXY</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/1789912317\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/301e4d82055cbc30afc5d8e4ca14ea75.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Backend Dev.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/1789912317\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/1789912317/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/1789912317/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/1789912317\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/yuexiaofeng\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/3b7e7bed23407111b13cf9f458c1f31bf494ba05.jpg"},{"url_object_id": "ca9b7fe440dbafc569069b9a27e98bef", "title": "Reddit 如何面试工程师？", "url": "http://blog.jobbole.com/113744/", "create_date": "2018/04/20", "front_image_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fqeikwffd2j20xc0g4ju2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "职场,Reddit,工程师", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://redditblog.com/2017/08/02/acing-your-technical-interviews-at-reddit/\">Redditblog</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><blockquote><p>Reddit 给来应聘者写的官方指南，描述了整个面试的流程、该如何准备。</p></blockquote>\n<hr>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fqeikwffd2j20xc0g4ju2.jpg\" width=\"578\" height=\"280\"></p>\n<p><strong>在 Reddit，我们理解面试</strong>可能非常令人头疼，因此我们做了这份指南来帮你顺利通过面试。你不会不学习就去参加期末考试，对吧？同样，我们也不希望你不准备就来参加面试。请把这篇文章作为通过面试的学习指南。</p>\n<p><img class=\"aligncenter size-large wp-image-21663\" src=\"https://redditupvoted.files.wordpress.com/2017/08/recruiting-image-1.png?w=720&amp;h=61\"></p>\n<p>到目前为止，你大概已经与我们招聘团队的成员通过电话了，完成了初步的电话面试。那么恭喜你能继续下一步的面试！接下来要面对你的第一个技术面试了——这一次是与我们的工程师进行的电话面试。</p>\n<h3>电话技术面试</h3>\n<p>这部分面试更偏向于一般的能力倾向测试，旨在了解你对网络及其安全漏洞相关基本概念的技能。这部分面试基本上一半是问答形式的题目，一半是编程训练。你可能不知道所有问题的答案，这是可以接受的。重要的是，我们可以了解你的能力范围，并据此决定你的专长能否满足我们团队的需求。</p>\n<p>在回答这些问题时，一定要解释你是如何得到这个答案的，以及为什么采用这种方法。</p>\n<p><em>提示：打开你的笔记本并准备好面试。确保你接上了网线或者连上了可靠的 </em><em>WIFI</em><em>，并仔细检查你准备接电话的地方手机信号是否够强。</em></p>\n<h3>现场面试</h3>\n<p>如果你走到了这一步，那已经快成功啦。现场面试会分成三个技术面试和三个问答形式的面试。总之，面试应该会持续 5 个小时左右，所以来之前请休息好。</p>\n<p><img class=\"aligncenter size-large wp-image-21664\" src=\"https://redditupvoted.files.wordpress.com/2017/08/recruiting-image-2.png?w=720&amp;h=54\"></p>\n<h3>面试环境</h3>\n<p>你参加面试的房间里有一块白板，在技术面试中需要用到它。来参加面试时还要带上你的笔记本电脑，或者告诉我们你更希望我们提供一个笔记本电脑给你。你的技术面试要么是通过白板，要么是通过笔记本上的 coderpad（面试官会在你们见面时分享给你）。</p>\n<p>考虑到我们工作的性质，我们办公室的氛围比较休闲（当然是合理范围内！）。我们没有着装标准，建议你怎么舒服怎么穿。</p>\n<h3>技术面试</h3>\n<p>技术面试占你和我们在一起的大部分时间，总共大概是 3 个小时（每个技术面试占一个小时）。正是因为想看看你的实际编程水平，我们才要求你带笔记本来面试。尽管面试主要是看你的技术水平，但是面试官还要评估其他重要的因素，比如工作风格和团队配合。</p>\n<ul>\n<li><strong>编程</strong><strong>/</strong><strong>算法。</strong>在现场面试中你要完成两个编程面试，一个针对一般软件工程概念，另一个则更深入到你擅长的领域（无论是前端、后端还是机器学习等等）。对于一般的编程面试，我们鼓励你使用最习惯的语言来解决。在这部分会遇到的问题通常都可以利用递归和迭代技巧，用多种不同的方法来解决。</li>\n<li><strong>系统设计。</strong>与其他技术面试不同，这部分面试不是以编程为主的，但是你很可能会用到白板。你应该准备好碰到这种问题：“怎样构建一个这样的服务？”以及“如何扩大上述服务？”。此外，你还应该对互联网工作原理有扎实的理解。</li>\n</ul>\n<p><img class=\"aligncenter size-full wp-image-21665\" src=\"https://redditupvoted.files.wordpress.com/2017/08/recruiting-image-3.gif?w=720\"></p>\n<h3>应当牢记的几点</h3>\n<p><strong>别忽视面试的语言交流方面。</strong></p>\n<p>技术面试不是为了看你能否得出正确答案，而是为了检验你能够多好地与他人合作。把面试官当成一个帮助你解决问题的人，就像你的队友一样。我们明白一个人不可能完成所有事情，因此特意招募了不同背景和有不同技能的人来建立我们的团队。我们更想知道你有哪些领域的技能，而不是想找到完美的工程师。如果你忘了这篇指南里的其他内容，把下面这三点牢记于心就能让你在技术面试中遥遥领先：</p>\n<ul>\n<li><strong>倾听并认真考虑面试官的建议</strong>。他们很可能已经问过上百遍同样的问题，并见识了不同的解决方法。他们的工作就是帮你找到<em>最好</em>的方法。</li>\n<li><strong>把你的思考过程说出来，并能够解释你所用方法的优缺点</strong>。比起你能否想出解决方法，我们更在意你是怎样想出这个解决方法的。</li>\n<li><strong>在你没想好解决方法之前，别急着写代码</strong>。正如我们的一个工程师曾经告诉我的那样，在没有考虑木头的尺寸和如何把每个零件拼在一起之前是不会开始建工作台的；同样，在你开始写代码之前你也应该知道要怎样解决问题。</li>\n</ul>\n<h3>问答面试（Q&amp;A Interviews）</h3>\n<p>在 Reddit，我们给予人们自主权来让他们能做自己。尽管技术面试可能需要集中精神，但是问答面试要轻松得多。问答面试的面试官通常不在你申请的团队中，主要是为了让我们在技术能力层面之外更好地了解你。</p>\n<ul>\n<li><strong>申请者 </strong><strong>AMA</strong><strong>（</strong><strong>Ask Me Anything</strong><strong>）。</strong>这项面试是为了从个人的角度了解你，因为大部分面试更关注你在电脑上能做什么。这说明，应对这项面试最好的方法是准备好谈谈你自己。这是你要面对的所有面试中最随意的，但是它有希望让你更深入地了解我们如何工作，反之亦然。</li>\n</ul>\n<p><em>提示：准备好，会有关我们企业文化、方针和办公室的日常生活的问题。你的动力和<a href=\"https://about.reddit.com/\">我们公司的价值观</a>应该有相似之处。</em></p>\n<ul>\n<li><strong>跨部门面试。</strong>从名字大概就能看出来，这项面试是为了让你初步了解怎样与其他团队合作。除非你负责基础设施，否则你就要和我们的产品团队密切合作，所以我们需要确保你能很好地连接其他技能，而这些技能与你自己所掌握的技能不同；这就意味着你能够流畅地交流并有效解决冲突。在这项面试中，你会见到我们的产品经理之一，因此此时是询问 Reddit 如何运作以及今年的产品路线图（product roadmap）等相关问题的理想时机。</li>\n</ul>\n<p><em>提示：准备一些专业轶事来帮助你突出人际交往能力。提前想好你准备怎么讲故事，从而在面试中传达某些行为属性。</em></p>\n<ul>\n<li><strong>团队负责人面试。</strong>这项面试非常可能是一天中最后一项面试（耶！）。你未来的团队负责人会从高水平上审查你的工作，深入探究你完成过的具体项目，以便确定你能怎样融入团队。这是个很好的机会，可以问问在你未来要做的项目上还不清楚的问题，组织结构的问题，以及下半年团队的规划。</li>\n</ul>\n<h3>接下来呢？</h3>\n<p>你顺利完成了现场面试，好样的！我们知道这不容易。既然你已经完成了最难的部分，那么你可以准备好在面试后一周内接到招聘官的消息。还有问题吗？不要犹豫，联系我们吧！你在每一步都能得到我们的支持。</p>\n<p><img class=\"aligncenter size-full wp-image-21666\" src=\"https://redditupvoted.files.wordpress.com/2017/08/recruiting-image-4.gif?w=720\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113744\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113744votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113744\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 22</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/eb460a6c40dc597b739b2313a4c5c7ca08296694.jpg"},{"url_object_id": "f65acad5ef6af86c7aabdf707fd8d461", "title": "给初学者的 fc 示例教程", "url": "http://blog.jobbole.com/113926/", "create_date": "2018/04/25", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/04/9d9a2ae51099793ebcb0c2af97dc331b.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/the-fc-command-tutorial-with-examples-for-beginners/\">SK</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9572-1.html\">Linux中国/Dotcra</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/9d9a2ae51099793ebcb0c2af97dc331b.png\" alt=\"\"></p>\n<p><code>fc</code> （<strong>F</strong>ix <strong>C</strong>ommands 的缩写）是个 shell 内置命令，用于在交互式 shell 里列出、编辑和执行最近输入的命令。你可以用你喜欢的编辑器编辑最近的命令并再次执行，而不用把它们整个重新输入一遍。除了可以避免重复输入又长又复杂的命令，它对修正拼写错误来说也很有用。因为是 shell 内置命令，大多 shell 都包含它，比如 Bash 、 Zsh 、 Ksh 等。在这篇短文中，我们来学一学在 Linux 中使用 <code>fc</code> 命令。</p>\n<h3 id=\"toc_1\">fc 命令教程及示例</h3>\n<h4 id=\"toc_2\">列出最近执行的命令</h4>\n<p>执行不带其它参数的 <code>fc -l</code> 命令，它会列出最近 16 个命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7ac551093656\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -l\r\n507 fish\r\n508 fc -l\r\n509 sudo netctl restart wlp9s0sktab\r\n510 ls -l\r\n511 pwd\r\n512 uname -r\r\n513 uname -a\r\n514 touch ostechnix.txt\r\n515 vi ostechnix.txt\r\n516 echo \"Welcome to OSTechNix\"\r\n517 sudo apcman -Syu\r\n518 sudo pacman -Syu\r\n519 more ostechnix.txt\r\n520 wc -l ostechnix.txt\r\n521 cat ostechnix.txt\r\n522 clear\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ac551093656-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-2\"><span class=\"crayon-cn\">507</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">fish</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-3\"><span class=\"crayon-cn\">508</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-4\"><span class=\"crayon-cn\">509</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">netctl </span><span class=\"crayon-e\">restart </span><span class=\"crayon-i\">wlp9s0sktab</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-5\"><span class=\"crayon-cn\">510</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-6\"><span class=\"crayon-cn\">511</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pwd</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-7\"><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-8\"><span class=\"crayon-cn\">513</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-9\"><span class=\"crayon-cn\">514</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">touch </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-10\"><span class=\"crayon-cn\">515</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">vi </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-11\"><span class=\"crayon-cn\">516</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-12\"><span class=\"crayon-cn\">517</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apcman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Syu</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-13\"><span class=\"crayon-cn\">518</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Syu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-14\"><span class=\"crayon-cn\">519</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-15\"><span class=\"crayon-cn\">520</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-16\"><span class=\"crayon-cn\">521</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ac551093656-17\"><span class=\"crayon-cn\">522</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ac551093656-18\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p><code>-r</code> 选项用于将输出反向排序。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7b5894963330\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -lr\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b5894963330-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b5894963330-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b5894963330-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">lr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b5894963330-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><code>-n</code> 选项用于隐藏行号。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7b9005825803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -ln\r\n nano ~/.profile\r\n source ~/.profile\r\n source ~/.profile\r\n fc -ln\r\n fc -l\r\n sudo netctl restart wlp9s0sktab\r\n ls -l\r\n pwd\r\n uname -r\r\n uname -a\r\n echo \"Welcome to OSTechNix\"\r\n sudo apcman -Syu\r\n cat ostechnix.txt\r\n wc -l ostechnix.txt\r\n more ostechnix.txt\r\n clear\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7b9005825803-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">ln</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">nano</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">profile</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-3\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">profile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-4\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">profile</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-5\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">ln</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-6\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">netctl </span><span class=\"crayon-e\">restart </span><span class=\"crayon-e\">wlp9s0sktab</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-8\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-10\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apcman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Syu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-14\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-15\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-16\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7b9005825803-17\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7b9005825803-18\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>这样行号就不再显示了。</p>\n<p>如果想以某个命令开始，只需在 <code>-l</code> 选项后面加上行号即可。比如，要显示行号 520 至最近的命令，可以这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7bd290215447\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -l 520\r\n520 ls -l\r\n521 pwd\r\n522 uname -r\r\n523 uname -a\r\n524 echo \"Welcome to OSTechNix\"\r\n525 sudo apcman -Syu\r\n526 cat ostechnix.txt\r\n527 wc -l ostechnix.txt\r\n528 more ostechnix.txt\r\n529 clear\r\n530 fc -ln\r\n531 fc -l\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7bd290215447-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7bd290215447-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">520</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7bd290215447-2\"><span class=\"crayon-cn\">520</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7bd290215447-3\"><span class=\"crayon-cn\">521</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7bd290215447-4\"><span class=\"crayon-cn\">522</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7bd290215447-5\"><span class=\"crayon-cn\">523</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7bd290215447-6\"><span class=\"crayon-cn\">524</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7bd290215447-7\"><span class=\"crayon-cn\">525</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apcman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Syu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7bd290215447-8\"><span class=\"crayon-cn\">526</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7bd290215447-9\"><span class=\"crayon-cn\">527</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7bd290215447-10\"><span class=\"crayon-cn\">528</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7bd290215447-11\"><span class=\"crayon-cn\">529</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7bd290215447-12\"><span class=\"crayon-cn\">530</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ln</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7bd290215447-13\"><span class=\"crayon-cn\">531</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7bd290215447-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>要列出一段范围内的命令，将始、末行号作为 <code>fc -l</code> 的参数即可，比如 520 至 525：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7c0636791701\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -l 520 525\r\n520 ls -l\r\n521 pwd\r\n522 uname -r\r\n523 uname -a\r\n524 echo \"Welcome to OSTechNix\"\r\n525 sudo apcman -Syu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c0636791701-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c0636791701-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c0636791701-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c0636791701-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c0636791701-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c0636791701-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c0636791701-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c0636791701-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c0636791701-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">520</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">525</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c0636791701-2\"><span class=\"crayon-cn\">520</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c0636791701-3\"><span class=\"crayon-cn\">521</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c0636791701-4\"><span class=\"crayon-cn\">522</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c0636791701-5\"><span class=\"crayon-cn\">523</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c0636791701-6\"><span class=\"crayon-cn\">524</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c0636791701-7\"><span class=\"crayon-cn\">525</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apcman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Syu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c0636791701-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>除了使用行号，我们还可以使用字符。比如，要列出最近一个 <code>pwd</code> 至最近一个命令之间的所有命令，只需要像下面这样使用起始字母即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7c4272930806\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -l p\r\n521 pwd\r\n522 uname -r\r\n523 uname -a\r\n524 echo \"Welcome to OSTechNix\"\r\n525 sudo apcman -Syu\r\n526 cat ostechnix.txt\r\n527 wc -l ostechnix.txt\r\n528 more ostechnix.txt\r\n529 clear\r\n530 fc -ln\r\n531 fc -l\r\n532 fc -l 520\r\n533 fc -l 520 525\r\n534 fc -l 520\r\n535 fc -l 522\r\n536 fc -l l\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c4272930806-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-2\"><span class=\"crayon-cn\">521</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pwd</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-3\"><span class=\"crayon-cn\">522</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-4\"><span class=\"crayon-cn\">523</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-5\"><span class=\"crayon-cn\">524</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-6\"><span class=\"crayon-cn\">525</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apcman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Syu</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-7\"><span class=\"crayon-cn\">526</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-8\"><span class=\"crayon-cn\">527</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-9\"><span class=\"crayon-cn\">528</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-10\"><span class=\"crayon-cn\">529</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-11\"><span class=\"crayon-cn\">530</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ln</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-12\"><span class=\"crayon-cn\">531</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-13\"><span class=\"crayon-cn\">532</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">520</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-14\"><span class=\"crayon-cn\">533</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">520</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">525</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-15\"><span class=\"crayon-cn\">534</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">520</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-16\"><span class=\"crayon-cn\">535</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">522</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c4272930806-17\"><span class=\"crayon-cn\">536</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c4272930806-18\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>要列出所有 <code>pwd</code> 和 <code>more</code> 之间的命令，你可以都使用起始字母，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7c7409570761\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -l p m\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7c7409570761-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7c7409570761-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7c7409570761-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">m</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7c7409570761-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，使用开始命令的首字母以及结束命令的行号：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7ca499763383\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -l p 528\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ca499763383-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ca499763383-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ca499763383-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">528</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ca499763383-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者都使用行号：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7cf340604310\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -l 521 528\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7cf340604310-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7cf340604310-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7cf340604310-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">521</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">528</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7cf340604310-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这三个命令都显示一样的结果。</p>\n<h4 id=\"toc_3\">编辑并执行上一个命令</h4>\n<p>我们经常敲错命令，这时你可以用默认编辑器修正拼写错误并执行而不用将命令重新再敲一遍。</p>\n<p>编辑并执行上一个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7d3081419190\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7d3081419190-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7d3081419190-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7d3081419190-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">fc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7d3081419190-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这会在默认编辑器里载入上一个命令。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/ee5eae4873e4a4d9086aff61084b77b0.png\" alt=\"\"></p>\n<p>你可以看到，我上一个命令是 <code>fc -l</code>。你可以随意修改，它会在你保存退出编辑器时自动执行。这在命令或参数又长又复杂时很有用。需要注意的是，它同时也可能是<strong>毁灭性</strong>的。比如，如果你的上一个命令是危险的 <code>rm -fr &lt;some-path&gt;</code>，当它自动执行时你可能丢掉你的重要数据。所以，小心谨慎对待每一个命令。</p>\n<h4 id=\"toc_4\">更改默认编辑器</h4>\n<p>另一个有用的选项是 <code>-e</code> ，它可以用来为 <code>fc</code> 命令选择不同的编辑器。比如，如果我们想用 <code>nano</code> 来编辑上一个命令:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7d6646738183\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ fc -e nano\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7d6646738183-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7d6646738183-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7d6646738183-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nano</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7d6646738183-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这个命令会打开 <code>nano</code> 编辑器（而不是默认编辑器）编辑上一个命令。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/36c07793330d0f7269668ced5d0b30c8.png\" alt=\"\"></p>\n<p>如果你觉得用 <code>-e</code> 选项太麻烦，你可以修改你的默认编辑器，只需要将环境变量 <code>FCEDIT</code> 设为你想要让 <code>fc</code> 使用的编辑器名称即可。</p>\n<p>比如，要把 <code>nano</code> 设为默认编辑器，编辑你的 <code>~/.profile</code> 或其他初始化文件： （LCTT 译注：如果 <code>~/.profile</code> 不存在可自己创建；如果使用的是 bash ，可以编辑 <code>~/.bash_profile</code> ）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7da902683060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vi ~/.profile\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7da902683060-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7da902683060-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7da902683060-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">profile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7da902683060-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>添加下面一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7dd654685385\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFCEDIT=nano\r\n# LCTT译注：如果在子 shell 中会用到 fc ，最好在这里 export FCEDIT\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7dd654685385-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7dd654685385-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7dd654685385-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7dd654685385-1\"><span class=\"crayon-v\">FCEDIT</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">nano</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7dd654685385-2\"><span class=\"crayon-p\"># LCTT译注：如果在子 shell 中会用到 fc ，最好在这里 export FCEDIT</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7dd654685385-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>你也可以使用编辑器的完整路径：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7e0948500595\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFCEDIT=/usr/local/bin/emacs\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7e0948500595-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7e0948500595-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7e0948500595-1\"><span class=\"crayon-v\">FCEDIT</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">emacs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7e0948500595-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>输入 <code>:wq</code> 保存退出。要使改动立即生效，运行以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7e3378006191\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ source ~/.profile\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7e3378006191-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7e3378006191-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7e3378006191-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">profile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7e3378006191-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在再输入 <code>fc</code> 就可以使用 <code>nano</code> 编辑器来编辑上一个命令了。</p>\n<h4 id=\"toc_5\">不编辑而直接执行上一个命令</h4>\n<p>我们现在知道 <code>fc</code> 命令不带任何参数的话会将上一个命令载入编辑器。但有时你可能不想编辑，仅仅是想再次执行上一个命令。这很简单，在末尾加上连字符（<code>-</code>）就可以了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7e7550878279\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ echo \"Welcome to OSTechNix\"\r\nWelcome to OSTechNix\r\n\r\n$ fc -e -\r\necho \"Welcome to OSTechNix\"\r\nWelcome to OSTechNix\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7e7550878279-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7e7550878279-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7e7550878279-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7e7550878279-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7e7550878279-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7e7550878279-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7e7550878279-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7e7550878279-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7e7550878279-2\"><span class=\"crayon-e\">Welcome </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">OSTechNix</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7e7550878279-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7e7550878279-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7e7550878279-5\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7e7550878279-6\"><span class=\"crayon-e\">Welcome </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">OSTechNix</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7e7550878279-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>如你所见，<code>fc</code> 带了 <code>-e</code> 选项，但并没有编辑上一个命令（例中的 <code>echo \" Welcome to OSTechNix\"</code>）。</p>\n<p>需要注意的是，有些选项仅对指定 shell 有效。比如下面这些选项可以用在 zsh 中，但在 Bash 或 Ksh 中则不能用。</p>\n<h4 id=\"toc_6\">显示命令的执行时间</h4>\n<p>想要知道命令是在什么时候执行的，可以用 <code>-d</code> 选项：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7ea182600397\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfc -ld\r\n1 18:41 exit\r\n2 18:41 clear\r\n3 18:42 fc -l\r\n4 18:42 sudo netctl restart wlp9s0sktab\r\n5 18:42 ls -l\r\n6 18:42 pwd\r\n7 18:42 uname -r\r\n8 18:43 uname -a\r\n9 18:43 cat ostechnix.txt\r\n10 18:43 echo \"Welcome to OSTechNix\"\r\n11 18:43 more ostechnix.txt\r\n12 18:43 wc -l ostechnix.txt\r\n13 18:43 cat ostechnix.txt\r\n14 18:43 clear\r\n15 18:43 fc -l\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ea182600397-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-1\"><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ld</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ea182600397-2\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-3\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ea182600397-4\"><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-5\"><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">netctl </span><span class=\"crayon-e\">restart </span><span class=\"crayon-i\">wlp9s0sktab</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ea182600397-6\"><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-7\"><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ea182600397-8\"><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-9\"><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ea182600397-10\"><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-11\"><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ea182600397-12\"><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-13\"><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ea182600397-14\"><span class=\"crayon-cn\">13</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-15\"><span class=\"crayon-cn\">14</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ea182600397-16\"><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ea182600397-17\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>这样你就可以查看最近命令的具体执行时间了。</p>\n<p>使用选项 <code>-f</code> ，可以为每个命令显示完整的时间戳。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7ef538561750\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n fc -lf\r\n 1 4/5/2018 18:41 exit\r\n 2 4/5/2018 18:41 clear\r\n 3 4/5/2018 18:42 fc -l\r\n 4 4/5/2018 18:42 sudo netctl restart wlp9s0sktab\r\n 5 4/5/2018 18:42 ls -l\r\n 6 4/5/2018 18:42 pwd\r\n 7 4/5/2018 18:42 uname -r\r\n 8 4/5/2018 18:43 uname -a\r\n 9 4/5/2018 18:43 cat ostechnix.txt\r\n 10 4/5/2018 18:43 echo \"Welcome to OSTechNix\"\r\n 11 4/5/2018 18:43 more ostechnix.txt\r\n 12 4/5/2018 18:43 wc -l ostechnix.txt\r\n 13 4/5/2018 18:43 cat ostechnix.txt\r\n 14 4/5/2018 18:43 clear\r\n 15 4/5/2018 18:43 fc -l\r\n 16 4/5/2018 18:43 fc -ld\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7ef538561750-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">lf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">netctl </span><span class=\"crayon-e\">restart </span><span class=\"crayon-i\">wlp9s0sktab</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7ef538561750-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ld</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7ef538561750-18\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0056 seconds] -->\r\n<p>当然，欧洲的老乡们还可以使用 <code>-E</code> 选项来显示欧洲时间格式。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7f3038938286\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n fc -lE\r\n 2 5.4.2018 18:41 clear\r\n 3 5.4.2018 18:42 fc -l\r\n 4 5.4.2018 18:42 sudo netctl restart wlp9s0sktab\r\n 5 5.4.2018 18:42 ls -l\r\n 6 5.4.2018 18:42 pwd\r\n 7 5.4.2018 18:42 uname -r\r\n 8 5.4.2018 18:43 uname -a\r\n 9 5.4.2018 18:43 cat ostechnix.txt\r\n 10 5.4.2018 18:43 echo \"Welcome to OSTechNix\"\r\n 11 5.4.2018 18:43 more ostechnix.txt\r\n 12 5.4.2018 18:43 wc -l ostechnix.txt\r\n 13 5.4.2018 18:43 cat ostechnix.txt\r\n 14 5.4.2018 18:43 clear\r\n 15 5.4.2018 18:43 fc -l\r\n 16 5.4.2018 18:43 fc -ld\r\n 17 5.4.2018 18:49 fc -lf\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f3038938286-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">lE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">netctl </span><span class=\"crayon-e\">restart </span><span class=\"crayon-i\">wlp9s0sktab</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pwd</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to OSTechNix\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">clear</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ld</span></div><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f3038938286-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.4.2018</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">49</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">lf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f3038938286-18\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p></p>\n<h3 id=\"toc_7\">fc 用法总结</h3>\n<ul>\n<li>当不带任何参数时，<code>fc</code> 将上一个命令载入默认编辑器。</li>\n<li>当带一个数字作为参数时，<code>fc</code> 将数字指定的命令载入默认编辑器。</li>\n<li>当带一个字符作为参数时，<code>fc</code> 将最近一个以指定字符开头的命令载入默认编辑器。</li>\n<li>当有两个参数时，它们分别指定需要列出的命令范围的开始和结束。</li>\n</ul>\n<p>更多细节，请参考 man 手册。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae28d6a9e7f7543742514\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ man fc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae28d6a9e7f7543742514-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae28d6a9e7f7543742514-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae28d6a9e7f7543742514-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">man </span><span class=\"crayon-i\">fc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae28d6a9e7f7543742514-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>好了，今天就这些。希望这篇文章能帮助到你。更多精彩内容，敬请期待！</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113926\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113926votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113926\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e47f904ab6e911e10a86b4fb2039a9331071634d.jpg"},{"url_object_id": "6e3fcf5927147f4633e5566c0c847b94", "title": "精通 Linux 的 “kill” 命令", "url": "http://blog.jobbole.com/113894/", "create_date": "2018/04/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.maketecheasier.com/kill-command-in-linux/\">maketecheasier</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-2116-1-rel.html\">Linux中国/flsf</a>   </div><p>无论你使用哪种操作系统，你一定会遇到某个行为失常的应用，它把自己锁死并拒绝关闭。在Linux(还有Mac)，你可以用一个”kill”命令强制终结它。在这个教程中，我们将展示给你多种方式使用”kill”命令终结应用。</p>\n<h3><strong>Kill命令和信号</strong></h3>\n<p>当你执行一个”kill”命令，你实际上发送了一个信号给系统，让它去终结不正常的应用。总共有60个你可以使用的信号，但是基本上你只需要知道SIGTERM(15)和SIGKILL(9)。</p>\n<p>你可以用这个命令看到所有信号的列表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0c0248980589\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkill -l</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0c0248980589-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0c0248980589-1\"><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/48403246372fb16ffcd27eb6495b82a0.png\" alt=\"\" width=\"740\" height=\"341\"></p>\n<ul>\n<li>SIGTERM – 此信号请求一个进程停止运行。此信号是可以被忽略的。进程可以用一段时间来正常关闭，一个程序的正常关闭一般需要一段时间来保存进度并释放资源。换句话说，它不是强制停止。</li>\n<li>SIGKILL – 此信号强制进程立刻停止运行。程序不能忽略此信号，而未保存的进度将会丢失。</li>\n</ul>\n<p>使用”kill”的语法是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0ca174273891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkill [信号或选项] PID(s)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0ca174273891-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0ca174273891-1\"><span class=\"crayon-i\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span>信号或选项<span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PID</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>默认信号（当没有指定的时候）是SIGTERM。当它不起作用时，你可以使用下面的命令来强制kill掉一个进程:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0ce021415676\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkill SIGKILL PID</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0ce021415676-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0ce021415676-1\"><span class=\"crayon-e\">kill </span><span class=\"crayon-e\">SIGKILL </span><span class=\"crayon-v\">PID</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>或者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0d1115600874\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkill -9 PID</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0d1115600874-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0d1115600874-1\"><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这里”-9″代表着SIGKILL信号。</p>\n<p>如果你不知道应用的PID，仅需要运行这个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0d5756818269\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nps ux</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0d5756818269-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0d5756818269-1\"><span class=\"crayon-e\">ps </span><span class=\"crayon-v\">ux</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>它会显示所有正在运行的应用还有应用的PID。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/fdb483b1624e6e05fd5e2b6f84722403.png\" alt=\"\" width=\"700\" height=\"414\"></p>\n<p>例如，要kill掉Chrome，我会运行命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0d8072600608\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkill -9 3629</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0d8072600608-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0d8072600608-1\"><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3629</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>也可以在同一时间kill多个进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0db710605006\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkill -9 PID1 PID2 PID3</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0db710605006-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0db710605006-1\"><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PID1 </span><span class=\"crayon-e\">PID2 </span><span class=\"crayon-v\">PID3</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3><strong>PKill</strong></h3>\n<p>“pkill”命令允许使用扩展的正则表达式和其它匹配方式。你现在可以使用应用的进程名kill掉它们，而不是使用PID。例如，要kill掉Firefox浏览器，只需要运行命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0de211302209\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npkill firefox</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0de211302209-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0de211302209-1\"><span class=\"crayon-e\">pkill </span><span class=\"crayon-v\">firefox</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>使用正则表达式匹配的话，你可以输入进程名的部分字符，比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0e2898540872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npkill fire</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0e2898540872-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0e2898540872-1\"><span class=\"crayon-e\">pkill </span><span class=\"crayon-v\">fire</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>为了避免kill掉错误的进程，你应该用一下”pgrep -l [进程名]”列表来匹配进程名称。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/4bf646e70d32b860715b16e57e81ca38.png\" alt=\"\" width=\"396\" height=\"244\"></p>\n<h3><strong>Killall</strong></h3>\n<p>killall同样使用进程名替代PID，并且它会kill掉所有的同名进程。例如，如果你正在运行多个Firefox浏览器的实例，可以用命令把它们全部kill掉:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0e5467385247\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkillall firefox</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0e5467385247-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0e5467385247-1\"><span class=\"crayon-e\">killall </span><span class=\"crayon-v\">firefox</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在Gnome中，你可以使用这个命令重启Nautilus：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2631c5c0ec678240624\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkillall nautilus</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2631c5c0ec678240624-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2631c5c0ec678240624-1\"><span class=\"crayon-e\">killall </span><span class=\"crayon-v\">nautilus</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3><strong>xkill</strong></h3>\n<p>xkill 是图形方式kill一个应用。当你在终端键入”xkill”，你的光标将立刻变成一个”十字”。你只需要做的是在不正常的应用上点击一下，它就会立刻kill掉这个应用。如果你经常用的话，你也可以添加一个<a href=\"http://www.maketecheasier.com/quick-tips/kill-unresponsive-application-in-ubuntu/\" target=\"_blank\" rel=\"external nofollow\">键盘快捷键来激活xkill</a>。</p>\n<h3><strong>结论</strong></h3>\n<p>当应用不正常而导致系统挂起的时候，人们往往重启计算机并且再一次开启所有的任务。而有了这些”kill”命令，你将能够更好的处理不正常的应用，从而避免导致系统崩溃。当你不想因一个不正常的进程而导致服务器宕机时，它尤其的有用。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113894\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113894votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113894\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"},{"url_object_id": "072156c0f2153402aab100fbc555a4b8", "title": "最终一轮面试被 Google 刷掉，这是一种什么样的体验？", "url": "http://blog.jobbole.com/113568/", "create_date": "2018/04/16", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/ec8b7891ca44138c9a9a09ee180cf33b.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "职场,Google,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.com/swlh/this-is-what-its-like-to-fail-your-interviews-at-google-83c772e6e654\">Jacob Levi Peterson</a>   译文出处：<a target=\"_blank\" href=\"https://36kr.com/p/5127560.html\">36氪-郝鹏程</a>   </div><blockquote><p>编者按：入职谷歌向来是可遇不可求的，只有那最为顶尖的万分之一的人才，才有资格收到谷歌的橄榄枝。因此，就算应聘谷歌失败了，也很正常。重要的是，从失败经历中不断学习，砥砺前行。本文作者 Jacob Levi Peterson 分享了自己与谷歌offer失之交臂的求职经历。</p></blockquote>\n<p>我应聘的是位于美国密歇根安娜堡分公司的 Associate Account Strategist，实质上是谷歌前线业务的销售岗，归谷歌 AdWords 部门管辖。</p>\n<p>整个招聘流程持续了大约一个月。如果顺利，应聘这个岗位要经历五轮面试。谷歌是在今年一月份给我发出面试邀请的。</p>\n<p>以前的招聘流程通常会更长，一个求职者要经历许多轮面试，通常为六个月或更长时间。 所以我没有什么可抱怨的，毕竟我的经历只有一个月。这也是我最终被刷掉的一点安慰。</p>\n<p>另外，这不是我第一次申请谷歌。 这也是我第二次经过朋友的推荐找工作。</p>\n<p>下面，就让我来聊聊整个面试体验的所感所想吧。</p>\n<h3>三轮电话面试</h3>\n<p>谷歌的招聘流程总体是高效的。但是，我经历了一个月无数次准备、学习面试经验、参与各轮面试，最终还是背谷歌拒绝了，这种感觉还是很不好受的。如果你也有过类似经历，那么真的很难过。但是，事情无疑会好转起来的。</p>\n<p>提交了简历和求职信，有个HR就找我做了电话面试。我通过了。一个礼拜以后，安娜堡那边的团队成员又给我做了两轮电话面试。</p>\n<p>由于保密协议，我不能具体透露面试的问题。下面聊聊面试给我的感受。</p>\n<p>HR在电话里面还是挺热情的，我感觉聊天进行得很顺利。后来，HR在后续与我沟通的时候，老是喜欢发各种emoji表情包，让我一度不知道要怎么回复他。不过，下一轮的电话面试的时间还是很早的，不用等太久。</p>\n<p>第二轮电话面试的时候，是安娜堡团队的人给我面的。当时我就感觉对方的语气明显没有第一轮电面的时候那么亲切。整轮面试让我感觉像是咨询公司常用的“压力面试”，HR不断质疑我、否定我的答案，问我各种问题。当时我几乎确定自己要被刷掉了。</p>\n<p>当天又进行了第三轮电话面试，是安娜堡团队的一名经理给我面的。这一次我感觉谈话氛围要友善很多。我给HR聊了自己关于安娜堡地区的一些看法和体验，HR似乎对我的话很满意，甚至还谈到他自己对这个地方的感受。</p>\n<h3>两轮现场面试</h3>\n<p>几天之后，我接到电话，受邀到谷歌公司参加面试。我欣喜若狂。</p>\n<p>面试之前，我做了无数次准备。到达密歇根以后，我感觉自己准备好了。</p>\n<p>谷歌的面试是分批进行的，在同一时间段，同一个岗位的不同求职者会集中在一起于同一天进行面试。谷歌告诉求职者们，要对其他求职者友善，不能针锋相对。潜台词就是：如果我们对所有人都满意，就会全部招进来。我认为这句话也可以这样理解：如果我们不要你，那是因为你不够优秀。岗位就在那里。但我们就是不想要你。直到面试之前我都在纠结谷歌到底是不是这个意思。</p>\n<p>面试那天我到得非常早，早到了40分钟。签到以后，我在等接待我的人。我跟其他应聘者有礼貌地闲聊。我发现我不是最早到的，心里有了些宽慰。</p>\n<p>接待人员到了以后，给我们每人发了一个颜色鲜艳的袋子，上面印有谷歌的标记。</p>\n<p>我们组带着进去了，穿过了一个接待区的门。这是我第一次去谷歌。谷歌公司跟我之前见过的任何公司都不一样，它的空间设计充满未来感、给人高效的感觉，非常棒。有很多灯光。我感觉这里就是我的家。虽然我的合同期很短，但是在那个瞬间我依然觉得，“我属于这里”。</p>\n<p>我们组的人逐渐走散，被分配至各个面试室。轮到我的面试室里面已经有人在面试了，于是接待人员跟我就开始闲聊起来。我跟他说，这个地方让我着迷，这是我第一次来谷歌。</p>\n<p>既然我们都要等，接待人员就带我带了游戏室。在游戏室门口，他指了指里面各种新奇的娱乐设备。我看到里面有乒乓球台，居然还有大雄鹿猎人（Big Buck Hunter），那是一款电子游戏室里才有的游戏。我还聊了聊乒乓球桌的标志性质对Google空间的作用，以及这种图像学如何更广泛地塑造了初创企业文化。房间里充满了各种各样的东西，但似乎没有Google员工。</p>\n<p>然后我们就回到了面试室。那里依然有人在用。于是我的接待人员就大声敲门，里面的人跟他说了以后他就马上走开了，快步走到了一个走廊里。然后我就一个人尴尬地站在面试室房间，手里拿着我的谷歌袋子，里面装着一个文件件、一个笔记本。我看着房间里的员工走出来，然后说了声抱歉，然后看了看接待人员那边的走廊，仿佛在表明“门不是我敲的”。</p>\n<p>我的第一个面试官来找我的时候，我就是这副摸样。他问我接待人员回来了没有，还问我是不是可以开始面试了。接待人员还没回来，我有点心慌，支支吾吾地说可以开始了。</p>\n<p>后来面试很快就开始了。面试进行的似乎还算顺利，很快就聊到了一些行为和假设性问题。我谈到了我的弟弟（小企业主）和他对谷歌产品的一些积极看法。然后面试就结束了。</p>\n<p>第二轮面试是我的未来上司给我面的。这一轮面试，我感到自己的肢体语言在面试当中给我加分了。从他们的言谈当中，我也感到他们很满意我的答案。</p>\n<p>我问他是否认为我符合岗位的要求（我在Youtube上看了两个前谷歌HR的经验之谈）。他说，他觉得我挺合适的，但也说“要看看最终情况如何”。他好像对这个表达不太满意，但是现在回想起来，我觉得还是应符合我的面试结果的（我最后毕竟被刷）。</p>\n<p>我很开心地离开面试室，觉得offer快到手了。遇到一个应聘者，他问我面试感觉如何。我一时间不知道说什么，最后有点迟疑地说：“还不错。”</p>\n<p>我怀疑有谷歌员工听到我的话了，于是我感到一阵紧张，害怕“打脸”。</p>\n<p>在等其他面试者的过程中，我和接待员聊了起来。我问他为什么喜欢到谷歌工作。他说：“也许主要是因为福利和工作、生活之间的平衡关系吧。”</p>\n<p>“不过，这份工作也有难处，比如给应聘者打电话，通知他们被刷掉了。”他接着说。</p>\n<p>于是我又感到一直不安。后来是游览环节，接待员领着我们逛了一圈公司，我们就回去了。</p>\n<h3>两天后，我被刷了。</h3>\n<p>两天以后，HR打电话给我说，我被刷掉了。我顿时感觉晴空霹雳。</p>\n<p>我也没法告诉你我到底哪里做的不好。谷歌从来不给反馈。我的忠告只能是：不断准备、不断学习、并试着让自己别那么尴尬（参考我的经历）。</p>\n<p>入职谷歌一直都是可遇不可求的事。Inc的数据显示，谷歌每年接收200万份简历，最终只招0.02%，淘汰比例是5000：1。</p>\n<p>电话里，HR对我说：“走到了这一步，不管最终结果如何，你都应该为自己感到万分自豪。”我觉得自己也许是自豪的。但是，无论如何这都是一场旷日持久的求职经历，而且其中不乏尴尬与窘迫的境遇。</p>\n<p>如果你最近也被谷歌刷了，我希望你能继续向前看，永远别对未来失去激情！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113568\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113568votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113568\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/5630c3d4f4f3f685aa06d550f00a4cdef5d9a492.jpg"},{"url_object_id": "8e61db3f3bf1d94bc3a13d55899bc864", "title": "工程师如何在工作中提升自己?", "url": "http://blog.jobbole.com/113896/", "create_date": "2018/04/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/08/f969ef7109b8aec9d66834db8eac2ca5.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 2, "tags": "All,IT技术,互联网", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://tech.meituan.com/study_vs_work.html\">meituan</a>   </div><h1 id=\"-\">引言</h1>\n<p>古人云：“活到老，学到老。”互联网算是最辛苦的行业之一，“加班”对工程师来说已是“家常便饭”，同时互联网技术又日新月异，很多工程师都疲于应付，叫苦不堪。以至于长期以来流传一个很广的误解：35岁是程序员工作的终点。</p>\n<p>如何在繁忙的工作中做好技术积累，构建个人核心竞争力，相信是很多工程师同行都在思考的问题。本文是我自己的一些总结，试图从三个方面来解答：</p>\n<ul>\n<li>第一部分阐述了一些学习的原则。任何时候，遵循一些经过检验的原则，都是影响效率的重要因素，正确的方法是成功的秘诀。提升工作和学习效率的另一个重要因素是释惑和良好心态。</li>\n<li>第二部分分析了我在工作中碰到和看到的一些典型困惑。</li>\n<li>成为优秀的架构师是大部分初中级工程师的阶段性目标。第三部分剖析架构师的能力模型，让大家对目标所需能力有一个比较清晰的认知。</li>\n</ul>\n<h1 id=\"-\">如何学习</h1>\n<p>在繁忙的工作中，持之以恒、不断学习和进步是一件艰巨的任务，需要坚强的毅力和坚定的决心。如果方法不得当，更是事倍功半。幸好我们的古人和现在哲人已经总结了很多优秀的学习方法论，这里汇总了一些重要原则。遵循这些方法必会对大家的工作学习大有裨益。</p>\n<h2 id=\"-\">贵在坚持</h2>\n<p>有报道指出，过去几十年的知识量超过之前人类几千年的知识量总和。而计算机领域绝对是当代知识更新最快的领域之一，因此，工程师必须要接受这样一个现实，现在所掌握的深厚知识体系很快就会被淘汰。要想在计算机领域持续做优秀架构师，就必须不停的学习，掌握最新技术。总之，学不可以已。</p>\n<p>所谓“冰冻三尺，非一日之寒，水滴石穿，非一日之功”，通往架构师的道路漫长而又艰巨，轻易放弃，则所有付出瞬间付之东流。要想成为优秀的架构师，贵在坚持！</p>\n<p>虽然知识更新很快，但是基础理论的变化却非常缓慢。这就是“道”和“象”关系，纵是世间万象，道却万变不离其宗。对于那些非常基础的理论知识，我们需要经常复习，也就是“学而时习之”。</p>\n<h2 id=\"-\">重视实践</h2>\n<p>古人云：“纸上得来终觉浅，绝知此事要躬行。” 学习领域有所谓721模型：个人的成长70%来自于岗位实践，20%来自向他人学习，10%来自于培训。虽然这种理论存在争议，但对于工程师们来说，按照实践、学习和培训的方式进行重要性排序，大致是不错的。所以重视实践，在实践中成长是最重要的学习原则。</p>\n<p>人类的认知有两种：感性认知和理性认知。这两种认知互相不可替代性。实践很大程度来自于感性学习，看书更像是理性学习。以学开汽车做例子，很难想象什么人能够仅仅通过学习书本知识就会开汽车。</p>\n<p>书本知识主要是传道——讲述抽象原型，而对其具体应用场景的讲述往往含糊其辞，对抽象原型之间的关系也是浅尝辄止。采用同样精确的语言去描述应用场景和关联关系将会失去重点，让人摸不着头脑。所以，仅仅通过看书来获得成长就像是用一条腿走路。</p>\n<p>重视实践，充分运用感性认知潜能，在项目中磨炼自己，才是正确的学习之道。在实践中，在某些关键动作上刻意练习，也会取得事半功倍的效果。</p>\n<h2 id=\"-\">重视交流</h2>\n<p>牛顿说：“如果说我看得比别人远一些，那是因为我站在巨人的肩膀上。”我们需要从别人身上学习。从老师、领导、同事、下属甚至对手身上学习，是快速成长的重要手段。</p>\n<p>向老师和领导学习已经是人们生活习惯的一部分了。但是从同事甚至对手那里学习也很重要，因为这些人和我们自身更相似。所以要多多观察，取其所长，弃其所短。对于团队的小兄弟和下属，也要“不耻下问”。</p>\n<p>此外，在项目中积极参与具体方案讨论也非常重要。参与者先验感知了相关背景，并且讨论的观点和建议也是综合了发言者多种知识和技能。所以，讨论让参与者能够非常全面，立体地理解书本知识。同时，和高手讨论，他们的观点就会像修剪机剪树枝一样，快速的剪掉自己知识领域里面的疑惑点。</p>\n<h2 id=\"-\">重视总结和输出</h2>\n<p>工程师在实践中会掌握大量细节，但是，即使掌握了所有细节，却没有深刻的总结和思考，也会陷入到“学而不思则罔”的境地。成长的“量变”来自于对细节的逐渐深入地把控，而真正的“质变”来自于对“道”的更深层次的理解。</p>\n<p>将经验输出，接受别人的检验是高层次的总结。这种输出不仅帮助了别人，对自身更是大有裨益。总结的方式有很多，包括组织分享，撰写技术文章等等。当然“日三省吾身”也是不错的总结方式。总之，多多总结，多多分享，善莫大焉！</p>\n<p>解答别人的问题也是个人成长的重要手段。有时候，某个问题自己本来不太懂，但是在给别人讲解的时候却豁然开朗。所以，“诲人不倦”利人惠己。</p>\n<h2 id=\"-\">重视规划</h2>\n<p>凡事预则立，不预则废。对于漫长的学习生涯而言，好的计划是成功的一半。</p>\n<h3 id=\"-\">长期规划</h3>\n<p>长期规划的实施需要毅力和决心，但是做正确的长期规划还需要高瞻远瞩的眼界、超级敏感的神经和中大奖的运气。对于大部分人来说，长期规划定主要是“定方向”。但遵循如下原则能够减少犯方向性错误的概率：</p>\n<ul>\n<li>远离日暮西山的行业。</li>\n<li>做自己感兴趣的事情。</li>\n<li>做有积累的事情。</li>\n<li>一边走一边看，切勿一条道走到黑。</li>\n</ul>\n<h3 id=\"-\">短期规划</h3>\n<p>良好的短期规划应该在生活、成长、绩效和晋升之间取得平衡。大部分公司都会制定一个考核周期——少则一个月，多则一年。所以不妨以考核周期作为短期学习规划周期。本质上，规划是一个多目标优化问题，它有一系列的理论方案，这里不一一细说。基于相关理论，我给出一个简单易行的方案：</p>\n<ul>\n<li>确定目标优先级。比如：成长、生活、绩效。</li>\n<li>确定每个目标的下限。从优化理论的角度来看，这被称为约束。比如绩效必须在一般以上，之前已经规划好的旅行不能更改，必须读完《Effective Java》等等。</li>\n<li>优先为下限目标分配足够的资源。比如，事先规划好的旅行需要10天，这10天就必须预算出去。</li>\n<li>按照各主目标的顺序依次分配资源。比如，最终分配给学习的时间是10天。</li>\n<li>在给定的学习预算下，制定学习目标，要激进。然后给出执行方案。比如，学习目标是掌握基本的统计学知识，并成为Java专家。具体方案为：完成《Effective Java》、《Java Performance》、《Design Pattern》、《Head First Statistics》四本书的阅读。</li>\n<li>对规划中的各学习任务按目标优先级进行排序，并最先启动优先级最高的任务。比如，最高优先级是掌握统计理论，那么就要先看《Head First Statistics》。</li>\n</ul>\n<p>对于该方案，要注意以下几点：</p>\n<ul>\n<li>最低目标必须能够轻松达成的目标，否则，从优化理论的角度来讲，该命题无解。比如，类似“半年内完成晋级两次、绩效全部S、从菜鸟成为Java专家”就不太合适作为最低目标。总之，要区分理想和梦想。</li>\n<li>主要目标规划必须具备一定的挑战性，需要规划出不可能完成的目标。过度规划本质上是一种贪婪算法，目的是目标价值最大化。因为一切皆有变数，如果其他目标能够提前完成，就不妨利用这些时间去完成更多的学习目标。总之，前途必须光明，道路必须坎坷。</li>\n<li>各目标之间不一定共享资源，规划不一定互有冲突。</li>\n</ul>\n<p>此外，短期规划还可以从如下几个方面进行优化：</p>\n<ul>\n<li>学习计划最好能结合工作计划，理论联系实际结合，快速学以致用。比如，本季度规划去做一些数据分析工作，那么不妨把学习目标设置为学习统计知识。</li>\n<li>要灵活对待规划的目标和具体执行步骤，需要避免“郑人买履”式的笑话。面临新的挑战和变化，规划需要不断地调整。</li>\n</ul>\n<h1 id=\"-\">那些令人纠结的困惑</h1>\n<p>人生是一场马拉松，在漫长的征途中，难免有很多困惑。困惑就像枷锁，使我们步履蹒跚，困惑就像死锁，让我们停滞不前。</p>\n<p>接下来我将总结自己在工作中碰到和看到的一些典型困惑。这些困惑或者长期困扰作者本人，或者困扰我身边的同事和朋友。当这些困惑被释然之后，大家都感觉如重获释，为下一阶段的征程提供满满的正能量。人生就像一场旅途，不必在乎目的地，在乎的，应该是沿途的风景，以及看风景的心情。良好的心态是技术之旅最好的伴侣。期望通过这个解惑之旅，让大家拥有一个愉快的心情去感受漫长的学习旅途。</p>\n<h2 id=\"-\">学无止境吗</h2>\n<p>必须要承认一个残酷的现实：人的生命是有限的，知识却是无限的。用有限的生命去学习无限的知识是不可能完成的任务。一想到此，有些工程师不免产生一些悲观情绪。如果方法得当并且足够勤奋，悲伤大可不必。</p>\n<p>虽然，人类的整体知识体系一直在扩张。但是就很多重要的工程细分领域，基础理论并不高深。计算机的很多重要领域，工程师有能力在有限时间内抓住核心要害。</p>\n<p>比如，密码学被认为是门非常高深的学科，但是一大类密码技术的基础是数论中一个非常简单的理论——素因数分解：给出两个素数，很容易算出它们的积，然而反过来给定两个素数的积，分解的计算量却非常惊人。</p>\n<p>“一致性”算得上是计算机领域里面最经典的难题，它是所有分布式系统的基础，从多核多CPU到多线程，从跨机器到跨机房，无所不在，几乎所有的计算机从业人员都在解决这个问题，但是Paxos给出了一个很优雅的解决方案。</p>\n<p>权限管理是很多工程师的噩梦，但如果你能搞定“Attribute Based Access Control(ABAC)”和“Role-Based Access Control(RBAC)”，也能达到相当高度。</p>\n<p>另外，技术学习是一场对抗赛，虽然学无止境，超越大部分对手就是一种胜利。所以，以正确的学习方式，长时间投入就会形成核心竞争力。</p>\n<h2 id=\"-\">没有绝对高明的技术，只有真正的高手</h2>\n<p>致力于在技术上有所成就的工程师，都梦想有朝一日成为技术高手。但技术高手的标准却存在很大的争议。这是一个有着悠久历史的误解：以某种技术的掌握作为技术高手的评判标准。我经常碰到这样一些情景：因为掌握了某些技术，比如Spring、Kafka、Elasticsearch等，一些工程师就自封为高手。有些工程师非常仰慕别的团队，原因竟是那个团队使用了某种技术。</p>\n<p>这种误解的产生有几个原因：首先，技多不压身，技术自然是掌握的越多越好，掌握很多技术的人自然不是菜鸟。其次，在互联网时代来临之前，信息获取是非常昂贵的事情。这就导致一项技能的掌握可以给个人甚至整个公司带来优势地位。互联网时代，各种框架的出现以及开源的普及快速淘汰或者降低了很多技能的价值，同时降低了很多技术的学习门槛。所以，在当前，掌握某项技能知识只能是一个短期目标。怀揣某些技能就沾沾自喜的人需要记住：骄傲使人退步。</p>\n<p>所谓麻雀虽小，五脏俱全。如果让你来做造物主，设计麻雀和设计大象的复杂度并没有明显区别。一个看起来很小的业务需求，为了达到极致，所需要的技术和能力是非常综合和高深的。真正的高手不是拿着所掌握的技术去卡客户需求，而是倾听客户的需求，给出精益求精的方案。完成客户的需求是一场擂台赛，真正的高手，是会见招拆招的。</p>\n<h2 id=\"-\">不做项目就无法成长吗</h2>\n<p>在项目中学习是最快的成长方式之一，很多工程师非常享受这个过程。但是一年到头都做项目，你可能是在一家外包公司。对于一个做产品的公司，如果年头到年尾都在做项目，要不然就是在初步创业阶段，要不然就是做了大量失败的项目，总之不算是特别理想的状态。正常情况，在项目之间都会有一些非项目时间。在这段时间，有些同学会产生迷茫，成长很慢。</p>\n<p>项目真的是越多越好吗？答案显然是否定的。重复的项目不会给工程师们带来新的成长。不停的做项目，从而缺乏学习新知识的时间，会导致“做而不学则殆”。真正让工程师出类拔萃的是项目的深度，而不是不停地做项目。所以，在项目之间的空档期，工程师们应该珍惜难得的喘息之机，深入思考，把项目做深，做精。</p>\n<p>如何提高项目的深度呢？一般而言，任何项目都有一个目标，当项目完成后，目标就算基本达成了。但是，客户真的满意了吗？系统的可用性、可靠性、可扩展性、可维护性已经做到极致了吗？这几个问题的答案永远是否定的。所以，任何一个有价值的项目，都可以一直深挖。深挖项目，深度思考还可以锻炼工程师的创造力。期望不停地做项目的人，就像一个致力于训练更多千里马的人是发明不出汽车的。锻炼创造力也不是一蹴而就的事情，需要长时间地思考。总之，工程师们应该总是觉得时间不够用，毕竟时间是最宝贵的资源。</p>\n<h2 id=\"-\">职责真的很小吗</h2>\n<p>很多时候，一个工程师所负责系统的数量和团队规模与其“江湖地位”正相关。但是，江湖地位与技术成长没有必然关联。提升技术能力的关键是项目深度以及客户的挑剔程度。项目越多，在单个项目中投入的时间就越少，容易陷入肤浅。特别需要避免的是“ 在其位不谋其政”的情况。团队越大，在管理方面需要投入的精力就越多。在管理技巧不成熟，技术眼界不够高的前提强行负责大团队，可能会导致个人疲于应付，团队毫无建树。最终“ 一将无能，累死三军”，效果可能适得其反。</p>\n<p>从技术发展的角度来说，技术管理者应该关注自己所能把控的活跃项目的数量，并致力于提高活跃项目的影响力和技术深度。团队人数要与个人管理能力、规划能力和需求把控能力相适应。一份工作让多个人来干，每个人的成长都受限。每个人都做简单重复的工作，对技术成长没有任何好处。团队管理和项目管理需要循序渐进，忌“拔苗助长”。</p>\n<h2 id=\"-\">一定要当老大吗</h2>\n<p>有一些工程师的人生理想是做团队里的技术老大，这当然是一个值得称赞的理想。可是，如果整个团队技术能力一般，发展潜力一般，而你是技术最强者，这与其说是幸运，不如说是悲哀。这种场景被称之为“武大郎开店”。 团队里的技术顶尖高手不是不能做，但为了能够持续成长，需要满足如下几个条件：</p>\n<ul>\n<li>首先你得是行业里面的顶尖专家了——实在很难找到比你更强的人了！</li>\n<li>其次，你经常需要承担对你自己的能力有挑战的任务，但同时你拥有一批聪明能干的队友。虽然你的技术能力最高，但是在你不熟悉的领域，你的队友能够进行探索并扩展整个团队的知识。</li>\n<li>最后，你必须要敏而好学，不耻下问。</li>\n</ul>\n<p>否则，加入更强的技术团队或许是更好的选择，最少不是什么值得骄傲的事情。</p>\n<h2 id=\"-\">平台化的传说</h2>\n<p>平台化算得上是“高大上”的代名词了，很多工程师挤破头就为了和“平台化”沾点边。然而和其他业务需求相比，平台化需求并没有本质上的区别。无论是平台化需求还是普通业务需求，它的价值都来自于客户价值。不同点如下：</p>\n<ul>\n<li>很多平台化需求的客户来自于技术团队，普通需求的客户来自于业务方。</li>\n<li>产品经理不同。普通业务需求来自于产品经理，平台化需求的产品经理可能就是工程师自己。长期被产品经理“压迫”的工程师们，在平台化上终于找到“翻身农奴把歌唱”的感觉。</li>\n<li>很多平台化的关注点是接入能力和可扩展性，而普通业务的关注点更多。</li>\n</ul>\n<p>归根结底，平台化就是一种普通需求。在实施平台化之前，一定要避免下面两个误区：</p>\n<ul>\n<li>平台化绝对不是诸如“统一”、“全面”之类形容词的堆砌。是否需要平台化，应该综合考虑：客户数量，为客户解决的问题，以及客户价值是否值得平台化的投入。</li>\n<li>平台化不是你做平台，让客户来服务你。一些平台化设计者的规划设计里面，把大量的平台接入工作、脏活累活交给了客户，然后自己专注于所谓“最高大上”的功能。恰恰相反，平台化应该是客户什么都不做，所有的脏活累活都由平台方来做。本质上讲，平台化的价值来自于技术深度。真正体现技术深度的恰恰是设计者能够很轻松的把所有的脏活累活搞定。</li>\n</ul>\n<p>所以平台化的最佳实践是：投入最少的资源，解决最多的问题。平台解决一切，客户坐享其成。</p>\n<h2 id=\"-\">搞基础技术就一定很牛吗</h2>\n<p>经常听到同学们表达对基础技术部同学的敬仰之情，而对搞业务技术的同学表现出很轻视，认为存储、消息队列、服务治理框架（比如美团点评内部使用的OCTO）、Hadoop等才能被称为真正的技术。事实并非如此，更基础的并不一定更高深。</p>\n<p>比如下面这个流传很久的段子：越高级的语言就越没有技术含量。但真是这样吗，就拿Java和C来说，这是完全不同的两种语言，所需要的技能完全不同。C或许跟操作系统更加接近一点，和CPU、内存打交道的机会更多一点。但是为了用好Java，程序员在面向对象、设计模式、框架技术方面必须要非常精通。Java工程师转到C方向确实不容易，但作者也见过很多转到Java语言的C工程师水土不服。</p>\n<p>基础技术和业务应用技术必然会有不同的关注点，没有高低之分。之所以产生这种误解，有两个原因：</p>\n<ul>\n<li>基础技术相对成熟，有比较完整的体系，这给人一个高大上的感觉。业务应用技术相对来说，由于每个团队使用的不一样，所以成熟度参差不齐，影响力没有那么大。</li>\n<li>基础技术的门槛相对来说高一点，考虑到影响面，对可靠性、可用性等有比较高的最低要求。但是门槛高不代表技术含量高，另外成熟技术相对来说在创新方面会受到很大的约束。但是最先进的技术都来自活跃的创新。</li>\n</ul>\n<p>对比下来，业务技术和基础技术各有千秋。但真正的高手关注的是解决问题，所有的技术都是技能而已。</p>\n<h2 id=\"-\">可行性调研的那些坑</h2>\n<p>工作中开展可行性调研时有发生。做可行性调研要避免如下情况：</p>\n<ul>\n<li>把可行性调研做成不可行性调研。这真的非常糟糕。不可行性的结论往往是：因为这样或者那样的原因，所以不可行。</li>\n<li>避免“老鼠给猫挂铃铛”式的高风险可行性方案。“天下大事必作于细”，可行性调研一定要细致入微，避免粗枝大叶。</li>\n<li>避免调研时间过长。如果发现调研进展进入到指数级复杂度，也就是每前进一步需要之前两倍的时间投入，就应该果断的停止调研。</li>\n</ul>\n<p>可行性调研的结论应该是收益与成本的折衷，格式一般如下：</p>\n<ul>\n<li>首先明确预期的结果，并按照高中低收益进行分级。</li>\n<li>阐述达成每种预期结果需要采取的措施和方案。</li>\n<li>给出实施各方案需要付出的成本。</li>\n</ul>\n<h2 id=\"-\">工程师天生不善沟通吗</h2>\n<p>实际工作中，沟通所导致的问题层出不穷。工程师有不少是比较内向的，总是被贴上“不善沟通”的标签。实际上，沟通能力是工程师最重要的能力之一，良好的沟通是高效工作学习的基础，也是通过学习可以掌握的。下面我按工程师的语言说说沟通方面的经验。</p>\n<p>第一类常见的问题是沟通的可靠性。从可靠性的角度来讲，沟通分为TCP模式和UDP模式。TCP模式的形象表述是：我知道你知道。UDP模式的形象表述是：希望你知道。TCP模式当然比较可靠，不过成本比较高，UDP模式成本低，但是不可靠。在沟通可靠性方面，常见错误有如下两种：</p>\n<ul>\n<li>经常听到的这样的争论。一方说：“我已经告诉他了”，另一方说：“我不知道这个事情呀”。把UDP模式被当作TCP模式来使用容易产生扯皮。</li>\n<li>过度沟通。有些同学对沟通的可靠性产生了过度焦虑，不断的重复讨论已有结论问题。把TCP模式当成UDP来使用，效率会比较低。</li>\n</ul>\n<p>第二类沟通问题是时效性问题。从时效性讲，沟通分为：同步模式和异步模式。同步沟通形象地说就是：你现在给我听好了。异步沟通的形象表述是：记得给我做好了。在沟通时效性方面，有如下两种常见错误：</p>\n<ul>\n<li>已经出现线上事故，紧急万分。大家你一言，我一语，感觉事故可能和某几个人有关，但是也不能完全确定，所以没有通知相关人员。最终，一个普通的事故变成了严重事故。对于紧急的事情，必须要同步沟通。</li>\n<li>半夜三点你正在熟睡，或者周末正在逛街，接到一个电话：“现在有个需求，能否立刻帮忙做完。”这会非常令人郁闷，因为那并不是紧急的事情。不是所有的需求都需要立刻解决。</li>\n</ul>\n<p>有效沟通的一个重要原则是提前沟通。沟通本质是信息交流和处理，可以把被沟通对象形象地比喻成串行信息处理的CPU。提前沟通，意味着将处理请求尽早放入处理队列里面。下面的例子让很多工程师深恶痛绝：一个需求策划了1个月，产品设计了2周。当开发工程是第一次听说该需求的时候，发现开发的时间是2天。工程师据理力争，加班加点1周搞定。最后的结论是工程师非常不给力，不配合。就像工程师讨厌类似需求一样。要协调一个大项目，希望获得别人的配合，也需要尽早沟通。</p>\n<p>有效沟通的另外一个重点是“不要跑题”。很多看起来很接近的问题，本质上是完全不同的问题。比如：一个会议的主题是“如何实施一个方案”，有人却可能提出“是否应该实施该方案”。 “如何实施”和“是否应该实施”是完全不同的两个问题，很多看起来相关的问题实际上跑题很远。“跑题”是导致无效沟通的重要原因。</p>\n<p>良好沟通的奥秘在于能掌握TCP模式和UDP模式精髓，正确判断问题的紧急性，尽量提前沟通，避免跑题。</p>\n<h2 id=\"-\">带人之道</h2>\n<p>有些初为导师的工程师由于担心毕业生的能力太弱，安排任务时候谆谆教诲，最后感觉还是有所顾虑，干脆自己写代码。同样的事情发生在很多刚刚管理小团队的工程师身上。最终的结果他们：写完所有的代码，让下属无代码可写。“ 事必躬亲”当然非常糟糕，最终的往往是团队的整体绩效不高，团队成员的成长很慢，而自己却很累。</p>\n<p>古人说：“用人不疑，疑人不用。”这句话并非“放之四海而皆准”。在古代，受限于通信技术，反馈延迟显著，而且信息在传递过程中有大量噪音，变形严重。在这种情况下，如果根据短期内收集的少量变形的信息做快速决断，容易陷于草率。在公司里，这句话用于选人环节更为恰当，应该改为：录用不疑，疑人不录。</p>\n<p>考虑到招聘成本，就算是在录用层面，有时候也无法做到。作为一个小团队的管理者，能够快速准确的获取团队成员的各种反馈信息，完全不需要“用人不疑，疑人不用”。用人的真正理论基础来自于“探索和利用”(Exploration and Exploitation )。不能因为下属能做什么就只让他做什么，更不能因为下属一次失败就不给机会。</p>\n<p>根据经典的“探索和利用”(Exploration and Exploitation )理论，良好的用人方式应该如下：</p>\n<ul>\n<li>首选选择相信，在面临失败后，收缩信任度。</li>\n<li>查找失败的原因，提供改进意见，提升下属的能力。</li>\n<li>总是给下属机会，在恰当地时机给下属更高的挑战。 总之，苍天大树来自一颗小种子，要相信成长的力量。</li>\n</ul>\n<h2 id=\"-\">效率、效率、效率</h2>\n<p>经常看到有些同学给自己的绩效评分是100分——满分，原因是在过去一段时间太辛苦了，但最终的绩效却一般般。天道酬勤不错，但是天道更酬巧。工程师们都学过数据结构，不同算法的时间复杂度的差距，仅仅通过更长的工作时间是难以弥补的。为了提升工作学习效率，我们需要注意以下几点：</p>\n<ul>\n<li>主要关注效率提升。很多时候，与效率提升所带来的收益相比，延长时间所带来的成果往往不值得一提。</li>\n<li>要有清晰的结果导向思维。功劳和苦劳不是一回事。</li>\n<li>做正确的事情，而不仅仅正确地做事情。这是一个被不断提起的话题，但是错误每天都上演。为了在规定的时间内完成一个大项目，总是要有所取舍。如果没有重点，均匀发力，容易事倍功半。如果“南辕北辙”，更是可悲可叹。</li>\n</ul>\n<h1 id=\"-\">架构师能力模型</h1>\n<p>前面我们已经讲完了原则和一些困惑，那么工程师到底应该怎么提升自己呢？</p>\n<p>成为优秀的架构师是大部分初中级工程师的阶段性目标。优秀的架构师往往具备七种核心能力：编程能力、调试能力、编译部署能力、性能优化能力、业务架构能力、在线运维能力、项目管理能力和规划能力。</p>\n<p>这几种能力之间的关系大概如下图。编程能力、调试能力和编译部署能力属于最基础的能力。不能精通掌握这三种能力，很难在性能优化能力和业务架构能力方面有所成就。具备了一定的性能优化能力和业务架构能力之后，才能在线运维能力和项目管理能力方面表现优越。团队管理能力是最高能力，它对项目管理能力的依赖度更大。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/525d40d185c5f8b8d9b2f4274fba5c8d.png\"><img class=\"aligncenter size-full wp-image-113899\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/525d40d185c5f8b8d9b2f4274fba5c8d.png\" alt=\"architect_abilities\"></a></p>\n<h2 id=\"-\">编程能力</h2>\n<p>对工程师而言，编程是最基础的能力，必备技能。其本质是一个翻译能力，将业务需求翻译成机器能懂的语言。</p>\n<p>提升编程能力的书籍有很多。精通面向对象和设计模式是高效编程的基础。初级工程师应该多写代码、多看代码。找高手做Code Review，也是提升编程水平的捷径。</p>\n<h2 id=\"-\">调试能力</h2>\n<p>程序代码是系统的静态形式，调试的目的是通过查看程序的运行时状态来验证和优化系统。本质上讲，工程师们通过不断调试可以持续强化其通过静态代码去预测运行状态的能力。所以调试能力也是工程师编程能力提升的关键手段。很早之前有个传说：“调试能力有多强，编程能力就有多强。”不过现在很多编辑器的功能很强大，调试能力的门槛已经大大降低。</p>\n<p>调试能力是项目能否按时、高质量提交的关键。即使一个稍具复杂度的项目，大部分工程师也无法一次性准确无误的完成。大项目都是通过不断地调试进行优化和纠错的。所以调试能力是不可或缺的能力。</p>\n<p>多写程序，解决Bug，多请教高手是提升调试能力的重要手段。</p>\n<h2 id=\"-\">编译部署能力</h2>\n<p>编译并在线上部署运行程序是系统上线的最后一个环节。随着SOA架构的普及以及业务复杂度的增加，大部分系统只是一个完整业务的一个环节，因此，本地编译和运行并不能完全模拟系统在线运行。为了快速验证所编写程序的正确性，编译并在线上部署就成了必要环节。所以编译部署能力是一个必备技能。</p>\n<p>让盘根错节的众多子系统运行起来是个不小的挑战。得益于SOA架构的普及以及大量编译、部署工具的发展，编译部署的门槛已经大大降低。基于应用层进行开发的公司，已经很少有“编译工程师”的角色了。但是对于初级工程师而言，编译部署仍然不是一个轻松的事情。</p>\n<h2 id=\"-\">性能优化能力</h2>\n<p>衡量一个系统成功的一个重要指标是使用量。随着使用量的增加和业务复杂度的增加，大部分系统最终都会碰到性能问题。 性能优化能力是一个综合能力。因为：</p>\n<ul>\n<li>影响系统性能的因素众多，包括：数据结构、操作系统、虚拟机、CPU、存储、网络等。为了对系统性能进行调优，架构师需要掌握所有相关的技术。</li>\n<li>精通性能优化意味着深刻理解可用性、可靠性、一致性、可维护性、可扩展性等的本质。</li>\n<li>性能优化与业务强耦合，最终所采取的手段是往往折衷的结果。所以，性能优化要深谙妥协的艺术。</li>\n</ul>\n<p>可以说，性能优化能力是工程师们成长过程中各种技能开始融会贯通的一个标志。这方面可以参考之前的博客文章“常见性能优化策略的总结”。市场上还有很多与性能优化相关的书籍，大家可以参考。多多阅读开源框架中关于性能优化方面的文档和代码也不失为好的提升手段。动手解决线上性能问题也是提升性能优化能力的关键。如果有机会，跟着高手学习，分析性能优化解决方案案例（我们技术博客之前也发表了很多这方面的文章），也是快速提升性能优化能力的手段。</p>\n<h2 id=\"-\">在线运维能力</h2>\n<p>如果说性能优化能力体现的是架构师的静态思考能力，在线运维能力考验的就是动态反应能力。残酷的现实是，无论程序多么完美，Bug永远存在。与此同时，职位越高、责任越大，很多架构师需要负责非常重要的在线系统。对于线上故障，如果不能提前预防以及快速解决，损失可能不堪设想，所以在线运维能力是优秀架构师的必备技能。</p>\n<p>为了对线上故障进行快速处理，标准化的监控、上报、升级，以及基本应对机制当然很重要。通过所观察到的现象，快速定位、缓解以及解决相关症状也相当关键。这要求架构师对故障系统的业务、技术具备通盘解读能力。解决线上故障的架构师就好比一个在参加比赛F1的车手。赛车手必须要了解自身、赛车、对手、同伴、天气、场地等所有因素，快速决策，不断调整。架构师必须要了解所有技术细节、业务细节、处理规范、同伴等众多因素，快速决断，迅速调整。</p>\n<p>在线运维本质上是一个强化学习的过程。很多能力都可以通过看书、查资料来完成，但在线运维能力往往需要大量的实践来提升。</p>\n<h2 id=\"-\">业务架构能力</h2>\n<p>工程师抱怨产品经理的故事屡见不鲜，抱怨最多的主要原因来自于需求的频繁变更。需求变更主要有两个来源：第一个原因是市场改变或战略调整，第二个原因是伪需求。对于第一个原因，无论是工程师还是产品经理，都只能无奈的接受。优秀的架构师应该具备减少第二种原因所导致的需求变更的概率。</p>\n<p>伪需求的产生有两个原因：</p>\n<p>第一个原因是需求传递变形。从信息论的角度来讲，任何沟通都是一个编码和解码的过程。典型的需求从需求方到产品经理，最终到开发工程师，最少需要经历三次编码和解码过程。而信息的每一次传递都存在一些损失并带来一些噪音，这导致有些时候开发出来的产品完全对不上需求。此外，需求方和产品经理在需求可行性、系统可靠性，开发成本控制方面的把控比较弱，也会导致需求变形。</p>\n<p>第二个原因就是需求方完全没有想好自己的需求。</p>\n<p>优秀的架构师应该具备辨别真伪需求的能力。应该花时间去了解客户的真实业务场景，具备较强的业务抽象能力，洞悉客户的真实需求。系统的真正实施方是工程师，在明确客户真实需求后，高明的架构师应该具备准确判断项目对可行性、可靠性、可用性等方面的要求，并能具备成本意识。最后，由于需求与在线系统的紧耦合关系，掌握在线系统的各种细节也是成功的业务架构的关键。随着级别的提升，工程师所面对的需求会越来越抽象。承接抽象需求，提供抽象架构是架构师走向卓越的必经之途。</p>\n<p>市场上有一些关于如何成为架构师的书，大家可以参考。但是架构能力的提升，实践可能是更重要的方式。业务架构师应该关注客户的痛点而不是PRD文档，应该深入关注真实业务。掌握现存系统的大量技术和业务细节也是业务架构师的必备知识。</p>\n<h2 id=\"-\">项目管理能力</h2>\n<p>作为工业时代的产物，分工合作融入在互联网项目基因里面。架构师也需要负责几个重大项目才能给自己正名。以架构师角色去管理项目，业务架构能力当然是必备技能。此外，人员管理和成本控制意识也非常重要。</p>\n<p>项目管理还意味着要有一个大心脏。重大项目涉及技术攻关、人员变动、需求更改等众多可变因素。面临各种变化，还要在确保目标顺利达成，需要较强的抗压能力。</p>\n<p>人员管理需要注意的方面包括：知人善用，优化关系，简化沟通，坚持真理。</p>\n<ul>\n<li>知人善用意味着架构师需要了解每个参与者的硬技能和软素质。同时，关注团队成员在项目过程中的表现，按能分配。</li>\n<li>优化关系意味着管理团队的情绪，毕竟项目的核心是团队，有士气的团队才能高效达成目标。</li>\n<li>简化沟通意味着快速决策，该妥协的时候妥协，权责分明。</li>\n<li>坚持真理意味着顶住压力，在原则性问题上绝不退步。</li>\n</ul>\n<p>成本控制意味着对项目进行精细化管理，需要遵循如下几个原则：</p>\n<ul>\n<li>以终为始、确定里程碑。为了达成目标，所有的计划必须以终为始来制定。将大项目分解成几个小阶段，控制每个阶段的里程碑可以大大降低项目失败的风险。</li>\n<li>把控关键路径和关键项目。按照关键路径管理理论（CPM）的要求，架构师需要确定每个子项目的关键路径，确定其最早和最晚启动时间。同时，架构师需要关注那些可能会导致项目整体延期的关键节点，并集中力量攻破。</li>\n<li>掌控团队成员的张弛度。大项目持续时间会比较长，也包含不同工种。项目实施是一个不断变化的动态过程，在这个过程中不是整个周期都很紧张，不是所有的工种都一样忙。优秀的架构师必须要具备精细阅读整体项目以及快速反应和实时调整的能力。这不仅仅可以大大降低项目成本，还可以提高产出质量和团队满意度。总体来说，“前紧后松”是项目管理的一个重要原则。</li>\n</ul>\n<p>项目管理方面的书籍很多。但是，提高业务架构能力同样重要。积极参与大项目并观察别人管理项目的方式也是非常重要的提升手段。</p>\n<h2 id=\"-\">团队管理能力</h2>\n<p>不想做CTO的工程师不是一个好的架构师。走向技术管理应该是工程师的一个主流职业规划。团队管理的一个核心能力就是规划能力，这包括项目规划和人员规划。良好的规划需要遵循如下原则：</p>\n<ul>\n<li>规划是利益的博弈。良好的规划上面对得起老板，中间对得起自己，下面对得起团队。在三者利益者寻找平衡点，实现多方共赢考验着管理者的智慧和精细拿捏的能力。</li>\n<li>任何规划都比没有规划好。没有规划的团队就是没头的苍蝇，不符合所有人的利益。</li>\n<li>规划不是本本主义。市场在变，团队在变，规划也不应该一成不变。</li>\n<li>客户至上的是项目规划的出发点。</li>\n<li>就人员规划而言，规划需要考量团队成员的能力、绩效、成长等多方面的因素。</li>\n</ul>\n<p>市场上有很多规划管理方面的书籍，值得阅读。最优化理论虽然是技术书籍，但它是规划的理论基础，所以不妨多看看翻阅一下。从自我规划开始，多多学习别人的规划也是规划能力提升的重要手段。</p>\n<h1 id=\"-\">总结</h1>\n<p>因为受邀去做一个关于“一边工作，一边学习”的分享，作者花了一段时间去思考和汇总学习方法论，接着每天不断地采集谣言并尝试解惑，再根据个人经验绘制出优秀架构师的能力模型，最后汇集成文。</p>\n<p>文章系统性地阐述了学习原则、分析了常见困惑，并制定明确学习目标，期望对工程师们的工作学习有所帮助。需要申明的是，文章内容挂一漏万，所谓的架构师能力模型也是作者的个人观点。欢迎大家在评论中分享自己在学习成长方面的心得。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113896\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113896votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113896\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/5ea5d5577cf5ecf062f451ebfecfee5acbc4bab8.jpg"},{"url_object_id": "0b814620d5a98d544ddba1dfe2b6faf2", "title": "创建订单实现幂等的一点思考", "url": "http://blog.jobbole.com/113709/", "create_date": "2018/04/10", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/07/8266f93c2d45d97e0d52e71428ca372e.png"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 0, "tags": "IT技术,分布式,架构设计", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">Sam哥哥</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h3 id=\"幂等的概念\">幂等的概念</h3>\n<p>大部分文章都会说，同一个操作，进行多次操作后，结果是一样的，就可以说这个操作是支持幂等的。感觉不太准确，比如一个http get操作，可能每次的结果都不一样，但是其实是幂等的。看了很多文章，感觉下面的定义比较准确：</p>\n<blockquote><p>一个操作如果多次任意执行所产生的影响（或者叫副作用），都是相同的。</p></blockquote>\n<h3 id=\"创建订单的幂等\">创建订单的幂等</h3>\n<p>如果一个用户分两次下单，购买的商品都是一样的。</p>\n<p>第一次请求：user1：购买一个商品product1；<br>\n第二次请求：user1：还是购买一个商品product1；</p>\n<p>这种场景也很常见，是需要生成两个订单的。这样子看起来貌似创建订单的接口做不了幂等，因为业务数据一样的情况下，还是需要生成多个订单。但是这样子设计还是有个坑，万一创建订单的接口超时了呢？并且调用方进行了重试的话，那就可能变成用户其实想下一个单，但是订单系统其实生成了多个订单。比如说：</p>\n<blockquote><p>调用方发起创建订单的请求，订单系统收到了，并成功创建订单了。但是由于系统原因或者网络原因等，没有及时告知调用方订单已经创建成功，调用方一直等待回复，直到超时了。调用方再次发起了创建订单的请求，这个时候就可能会生成多个订单。</p></blockquote>\n<p>如果订单接口不支持幂等的情况下，如何应付这种情况呢？有两种方法</p>\n<p>第一种:</p>\n<blockquote><p>当调用方调用订单接口超时了，是会收到异常的，这个时候调用方捕获到这个异常后，<code>不要进行重试操作了，调用订单的一个回滚接口，将订单取消掉。</code>虽然看起来很low，但是还是有人这么做的。</p></blockquote>\n<p>第二种：</p>\n<blockquote><p>让订单系统提供一个订单是否创建成功的查询接口，根据一些关键业务字段去查询，如果查询到已经创建成功了，则调用方不要重试了。</p></blockquote>\n<p>上面两种方案都有人用过，但是都没实现幂等。其实针对上面的场景，用幂等来设计也不是很难。可以使用一个唯一的流水号ID，用来标识是不是同一个请求或者交易。这种ID通常都需要具备<code>全局唯一性</code>。假设让客户端来生成这个ID，每个创建订单的请求生成一个唯一的ID。那么订单系统如何根据来实现幂等呢？通常有两种。</p>\n<p>第一种：</p>\n<blockquote><p>先将这个ID保存到一个流水表里面，并且流水表中将这个ID设置为<code>UNIQUE KEY</code>,如果插入出现冲突了，则说明这个创建订单的请求已经处理过了，直接返回之前的操作结果。</p></blockquote>\n<p>第二种：</p>\n<blockquote><p>根据ID读取流水表，如果没有读取到，则创建订单和插入流水表。如果读取到了，则返回之前的操作结果。</p></blockquote>\n<p>不建议使用第二种方式，因为大部分情况下的请求都不是重试来的，让100%的请求都要去读取流水表，实在是不应该。另外，读取流水表的操作也是有潜在风险的，因为用数据库的读检查来确保数据存在性可能因为竞争而不生效，存在竞态条件。</p>\n<p>建议用第一种方案，因为本来流水表就是要插入，顺便利用<code>UNIQUE KEY</code>的冲突特性来判断。</p>\n<p>现在我们用第一种方案完整描述一下整个处理过程。</p>\n<blockquote><p>当调用方携带流水号ID调用创建订单的接口，如果出现超时了，调用方不知道订单到底创建成功还是失败，这个时候，用<code>同一个</code>流水号进行重试，订单系统虽然收到了两个请求，但是由于流水号ID是同一个，可以根据流水表来做幂等操作。并告知对方订单创建成功与否。</p></blockquote>\n<p>这里又有一个坑，万一调用方进行重试的时候，重新生成一个流水号，那就没得救了，会生成多个订单了。这个只能让客户端来保证了。</p>\n<h3 id=\"关于多重幂等\">关于多重幂等</h3>\n<p>假设创建订单的接口在创建订单的时候，还需要依赖一些外部系统，如果订单创建接口实现了幂等，但是外部接口没有实现幂等的话，还是可能出现<code>幂等漏洞</code>。属于整个链路幂等的问题了。好复杂。目前还没想好如何处理这种情况呢。</p>\n<h3 id=\"思考题\">思考题</h3>\n<p>调用方创建唯一ID，服务端用流水表这种方式实现幂等，非常依赖这个唯一ID。万一这个ID丢失了呢？咋破？目前我也在思考这个问题。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/54f7206fd1f1907bec78ddf32f50d66d.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113709\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113709votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113709\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">Sam哥哥</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/3660a090181b2b6ae3bd8c07d393aa36.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网技术爱好者，目前就职于广州唯品会担任JAVA高级开发。个人的csdn技术博客如下：http://blog.csdn.net/linsongbin1本人伯乐在线的文章，都出自这个csdn博客        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/sam-2/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/cd53a2302bc0852583e1e611cf280b011948f392.jpg"},{"url_object_id": "c4047562c0b4ecb3f07bd8265ef26273", "title": "命令行乐趣：嘲讽输错 Bash 命令的用户", "url": "http://blog.jobbole.com/113854/", "create_date": "2018/04/13", "front_image_url": ["https://dn-linuxcn.qbox.me/data/attachment/album/201803/30/102653o0g177wl8dug2kw2.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.cyberciti.biz/howto/insult-linux-unix-bash-user-when-typing-wrong-command/\">Vivek Gite</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9497-1.html\">Linux中国/ChenYi</a>   </div><p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201803/30/102653o0g177wl8dug2kw2.jpg\"></p>\n<p>你可以通过配置 <code>sudo</code> 命令去嘲讽输入错误密码的用户。但是现在，当用户在 shell 输错命令时，也能嘲讽他了（滥用？）。</p>\n<h3 id=\"toc_1\">你好 bash-insulter</h3>\n<p>来自 Github 页面：</p>\n<blockquote><p>当用户键入错误命令，随机嘲讽。它使用了一个 bash4.x. 版本的全新内置错误处理函数，叫 <code>command_not_found_handle</code>。</p></blockquote>\n<h3 id=\"toc_2\">安装</h3>\n<p>键入下列 git 命令克隆一个仓库：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec636ec112192057\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit clone https://github.com/hkbakke/bash-insulter.git bash-insulter</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec636ec112192057-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec636ec112192057-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/hkbakke/bash-insulter.git bash-insulter</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>示例输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec636fa122130454\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCloning into 'bash-insulter'...\r\nremote: Counting objects: 52, done.\r\nremote: Compressing objects: 100% (49/49), done.\r\nremote: Total 52 (delta 12), reused 12 (delta 2), pack-reused 0\r\nUnpacking objects: 100% (52/52), done.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec636fa122130454-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec636fa122130454-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec636fa122130454-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec636fa122130454-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec636fa122130454-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec636fa122130454-1\"><span class=\"crayon-e\">Cloning </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'bash-insulter'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec636fa122130454-2\"><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Counting </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec636fa122130454-3\"><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Compressing </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">49</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">49</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec636fa122130454-4\"><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">delta</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">reused</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">delta</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pack</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">reused</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec636fa122130454-5\"><span class=\"crayon-e\">Unpacking </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">52</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">52</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>用文本编辑器，比如说使用 <code>vi</code>，编辑你的 <code>~/.bashrc</code> 或者 <code>/etc/bash.bashrc</code> 文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63702604308247\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vi ~/.bashrc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63702604308247-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63702604308247-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bashrc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在其后追加这一行（具体了解请查看 <a class=\"ext\" href=\"https://bash.cyberciti.biz/guide/If..else..fi\" target=\"_blank\" rel=\"external nofollow\">if..else..fi 声明</a><span class=\"sup\">[1]</span> 和 <a class=\"ext\" href=\"https://bash.cyberciti.biz/guide/Source_command\" target=\"_blank\" rel=\"external nofollow\">source 命令</a><span class=\"sup\">[2]</span>）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63709778298025\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif [ -f $HOME/bash-insulter/src/bash.command-not-found ]; then\r\n    source $HOME/bash-insulter/src/bash.command-not-found\r\nfi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63709778298025-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63709778298025-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63709778298025-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63709778298025-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">HOME</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">insulter</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">not</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63709778298025-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">HOME</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">insulter</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">not</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">found</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63709778298025-3\"><span class=\"crayon-v\">fi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>保存并关闭文件。重新登录，如果不想退出账号也可以手动运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63712943611719\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ . $HOME/bash-insulter/src/bash.command-not-found</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63712943611719-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63712943611719-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">HOME</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">insulter</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">not</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">found</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">如何使用它？</h3>\n<p>尝试键入一些无效命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63718483253593\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ifconfigs\r\n$ dates</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63718483253593-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63718483253593-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63718483253593-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ifconfigs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63718483253593-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dates</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>示例输出:</p>\n<p style=\"text-align: center\"><a class=\"ext\" href=\"https://www.cyberciti.biz/media/new/cms/2017/11/bash-insulter-Insults-the-user-when-typing-wrong-command.jpg\" target=\"_blank\" rel=\"external nofollow\"><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201803/30/102702uazyc5tf7qmhcccy.jpg\" alt=\"一个有趣的 bash 钩子功能，嘲讽输入了错误命令的你。\"></a><span class=\"sup\"><em>一个有趣的 bash 钩子功能，嘲讽输入了错误命令的你。</em>[3]</span></p>\n<h3 id=\"toc_4\">自定义</h3>\n<p>你需要编辑 <code>$HOME/bash-insulter/src/bash.command-not-found</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec6371f837283607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vi $HOME/bash-insulter/src/bash.command-not-found</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec6371f837283607-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec6371f837283607-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vi</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">HOME</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">insulter</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">not</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">found</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>示例代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63725466784323\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncommand_not_found_handle () {\r\n    local INSULTS=(\r\n        \"Boooo!\"\r\n        \"Don't you know anything?\"\r\n        \"RTFM!\"\r\n        \"Hahaha, n00b!\"\r\n        \"Wow! That was impressively wrong!\"\r\n        \"What are you doing??\"\r\n        \"Pathetic\"\r\n        \"...and this is the best you can do??\"\r\n        \"The worst one today!\"\r\n        \"n00b alert!\"\r\n        \"Your application for reduced salary has been sent!\"\r\n        \"lol\"\r\n        \"u suk\"\r\n        \"lol... plz\"\r\n        \"plz uninstall\"\r\n        \"And the Darwin Award goes to.... ${USER}!\"\r\n        \"ERROR_INCOMPETENT_USER\"\r\n        \"Incompetence is also competence\"\r\n        \"Bad.\"\r\n        \"Fake it till you make it!\"\r\n        \"What is this...? Amateur hour!?\"\r\n        \"Come on! You can do it!\"\r\n        \"Nice try.\"\r\n        \"What if... you type an actual command the next time!\"\r\n        \"What if I told you... it is possible to type valid commands.\"\r\n        \"Y u no speak computer???\"\r\n        \"This is not Windows\"\r\n        \"Perhaps you should leave the command line alone...\"\r\n        \"Please step away from the keyboard!\"\r\n        \"error code: 1D10T\"\r\n        \"ACHTUNG! ALLES TURISTEN UND NONTEKNISCHEN LOOKENPEEPERS! DAS KOMPUTERMASCHINE IST NICHT FÜR DER GEFINGERPOKEN UND MITTENGRABEN! ODERWISE IST EASY TO SCHNAPPEN DER SPRINGENWERK, BLOWENFUSEN UND POPPENCORKEN MIT SPITZENSPARKEN. IST NICHT FÜR GEWERKEN BEI DUMMKOPFEN. DER RUBBERNECKEN SIGHTSEEREN KEEPEN DAS COTTONPICKEN HÄNDER IN DAS POCKETS MUSS. ZO RELAXEN UND WATSCHEN DER BLINKENLICHTEN.\"\r\n        \"Pro tip: type a valid command!\"\r\n    )\r\n\r\n    # 设置“随机”种子发生器 \r\n    RANDOM=$(date +%s%N)\r\n    VALUE=$((${RANDOM}%2))\r\n\r\n    if [[ ${VALUE} -lt 1 ]]; then\r\n        printf \"\\n  $(tput bold)$(tput setaf 1)$(shuf -n 1 -e \"${INSULTS[@]}\")$(tput sgr0)\\n\\n\"\r\n    fi\r\n\r\n    echo \"-bash: $1: command not found\"\r\n\r\n    # 无效命令，常规返回已存在的代码\r\n    return 127\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63725466784323-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63725466784323-49\">49</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-1\"><span class=\"crayon-e\">command_not_found_handle</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">INSULTS</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Boooo!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Don't you know anything?\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"RTFM!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Hahaha, n00b!\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Wow! That was impressively wrong!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"What are you doing??\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Pathetic\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"...and this is the best you can do??\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"The worst one today!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"n00b alert!\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Your application for reduced salary has been sent!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"lol\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"u suk\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"lol... plz\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"plz uninstall\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"And the Darwin Award goes to.... ${USER}!\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"ERROR_INCOMPETENT_USER\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Incompetence is also competence\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Bad.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Fake it till you make it!\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"What is this...? Amateur hour!?\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Come on! You can do it!\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Nice try.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"What if... you type an actual command the next time!\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"What if I told you... it is possible to type valid commands.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Y u no speak computer???\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"This is not Windows\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Perhaps you should leave the command line alone...\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Please step away from the keyboard!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"error code: 1D10T\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"ACHTUNG! ALLES TURISTEN UND NONTEKNISCHEN LOOKENPEEPERS! DAS KOMPUTERMASCHINE IST NICHT FÜR DER GEFINGERPOKEN UND MITTENGRABEN! ODERWISE IST EASY TO SCHNAPPEN DER SPRINGENWERK, BLOWENFUSEN UND POPPENCORKEN MIT SPITZENSPARKEN. IST NICHT FÜR GEWERKEN BEI DUMMKOPFEN. DER RUBBERNECKEN SIGHTSEEREN KEEPEN DAS COTTONPICKEN HÄNDER IN DAS POCKETS MUSS. ZO RELAXEN UND WATSCHEN DER BLINKENLICHTEN.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Pro tip: type a valid command!\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-36\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 设置“随机”种子发生器 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">RANDOM</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">VALUE</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">RANDOM</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-40\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">VALUE</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">lt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">printf</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\n  $(tput bold)$(tput setaf 1)$(shuf -n 1 -e \"</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">INSULTS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-s\">\")$(tput sgr0)\\n\\n\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-44\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-45\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-bash: $1: command not found\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-46\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 无效命令，常规返回已存在的代码</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63725466784323-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63725466784323-49\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p></p>\n<h3 id=\"toc_5\">赠品：sudo 嘲讽</h3>\n<p>编辑 <code>sudoers</code> 文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec6372e551292914\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo visudo</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec6372e551292914-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec6372e551292914-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">visudo</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>追加下面这一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63734899137094\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDefaults insults</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63734899137094-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63734899137094-1\"><span class=\"crayon-e\">Defaults </span><span class=\"crayon-v\">insults</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>或者像下面尾行增加一句嘲讽语：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63739282920267\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDefaults !lecture,tty_tickets,!fqdn,insults</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63739282920267-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63739282920267-1\"><span class=\"crayon-v\">Defaults</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">lecture</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">tty_tickets</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">fqdn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">insults</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这是我的文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63744058315684\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDefaults    env_reset\r\nDefaults    mail_badpass\r\nDefaults    secure_path = \"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin\"\r\n## If set, sudo will insult users when they enter an incorrect password. ##\r\nDefaults    insults\r\n\r\n# Host alias specification\r\n\r\n# User alias specification\r\n\r\n# Cmnd alias specification\r\n\r\n# User privilege specification\r\nroot ALL = (ALL:ALL) ALL\r\n\r\n# Members of the admin group may gain root privileges\r\n% admin ALL = (ALL) ALL   \r\n\r\n# Allow members of group sudo to execute any command\r\n% sudo ALL = (ALL:ALL) ALL   \r\n\r\n# See sudoers(5) for more information on \"#include\" directives:\r\n\r\n#includedir /etc/sudoers.d</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63744058315684-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec63744058315684-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-1\"><span class=\"crayon-e\">Defaults    </span><span class=\"crayon-e\">env_reset</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-2\"><span class=\"crayon-e\">Defaults    </span><span class=\"crayon-e\">mail_badpass</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-3\"><span class=\"crayon-e\">Defaults    </span><span class=\"crayon-v\">secure_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-4\"><span class=\"crayon-p\">## If set, sudo will insult users when they enter an incorrect password. ##</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-5\"><span class=\"crayon-e\">Defaults    </span><span class=\"crayon-v\">insults</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-6\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-7\"><span class=\"crayon-p\"># Host alias specification</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-9\"><span class=\"crayon-p\"># User alias specification</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-10\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-11\"><span class=\"crayon-p\"># Cmnd alias specification</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-12\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-13\"><span class=\"crayon-p\"># User privilege specification</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-14\"><span class=\"crayon-e\">root </span><span class=\"crayon-v\">ALL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ALL</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">ALL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ALL</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-16\"><span class=\"crayon-p\"># Members of the admin group may gain root privileges</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-17\"><span class=\"crayon-ta\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">admin</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ALL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ALL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ALL</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-18\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-20\"><span class=\"crayon-p\"># Allow members of group sudo to execute any command</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-21\"><span class=\"crayon-ta\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ALL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ALL</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">ALL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ALL</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-22\"> </div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-24\"><span class=\"crayon-p\"># See sudoers(5) for more information on \"#include\" directives:</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec63744058315684-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec63744058315684-26\"><span class=\"crayon-p\">#includedir /etc/sudoers.d</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>试一试：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec6374c650886273\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo -k # 清除缓存，从头开始\r\n$ sudo ls /root/\r\n$ sudo -i</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec6374c650886273-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae277ec6374c650886273-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae277ec6374c650886273-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec6374c650886273-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 清除缓存，从头开始</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae277ec6374c650886273-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-5ae277ec6374c650886273-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>样例对话：</p>\n<p style=\"text-align: center\"><a class=\"ext\" href=\"https://www.cyberciti.biz/media/new/cms/2017/11/sudo-insults.jpg\" target=\"_blank\" rel=\"external nofollow\"><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201803/30/102702kp19pqb2egl8hlw2.jpg\" alt=\"当输入错误密码时，你会被一个有趣的的 sudo 嘲讽语戏弄。\"></a><span class=\"sup\"><em>当输入错误密码时，你会被一个有趣的的 sudo 嘲讽语戏弄。</em>[4]</span></p>\n<h3 id=\"toc_6\">赠品：你好 sl</h3>\n<p><a class=\"ext\" href=\"https://www.cyberciti.biz/tips/displays-animations-when-accidentally-you-type-sl-instead-of-ls.html\" target=\"_blank\" rel=\"external nofollow\">sl 或是 UNIX 经典捣蛋软件</a><span class=\"sup\">[5]</span> 游戏。当你错误的把 <code>ls</code> 输入成 <code>sl</code>，将会有一辆蒸汽机车穿过你的屏幕。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae277ec63753183329241\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sl</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae277ec63753183329241-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae277ec63753183329241-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sl</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p style=\"text-align: center\"><a class=\"ext\" href=\"https://www.cyberciti.biz/tips/displays-animations-when-accidentally-you-type-sl-instead-of-ls.html\" target=\"_blank\" rel=\"external nofollow\"><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201803/30/102703s739gw183ll5454a.png\" alt=\"Linux / UNIX 桌面乐趣: 蒸汽机车\"></a><span class=\"sup\"><em>Linux / UNIX 桌面乐趣: 蒸汽机车</em>[6]</span></p>\n<p style=\"text-align: left\">[1]: https://bash.cyberciti.biz/guide/If..else..fi<br>\n[2]: https://bash.cyberciti.biz/guide/Source_command<br>\n[3]: https://www.cyberciti.biz/media/new/cms/2017/11/bash-insulter-Insults-the-user-when-typing-wrong-command.jpg<br>\n[4]: https://www.cyberciti.biz/media/new/cms/2017/11/sudo-insults.jpg<br>\n[5]: https://www.cyberciti.biz/tips/displays-animations-when-accidentally-you-type-sl-instead-of-ls.html<br>\n[6]: https://www.cyberciti.biz/tips/displays-animations-when-accidentally-you-type-sl-instead-of-ls.html<br>\n[7]: https://www.cyberciti.biz<br>\n[8]: https://github.com/CYLeft<br>\n[9]: https://github.com/wxy<br>\n[10]: https://github.com/LCTT/TranslateProject<br>\n[11]: https://linux.cn/article-9497-1.html?pr</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113854\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113854votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113854\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/521831f2ac1c9590fa6ac824e27690afeb69956d.jpg"},{"url_object_id": "3de2dfc429d04bf285e94ece0ab02d8d", "title": "15 分钟参透比特币和区块链", "url": "http://blog.jobbole.com/111954/", "create_date": "2018/04/10", "front_image_url": ["http://wx3.sinaimg.cn/mw690/7cc829d3gy1fq7lkjvcdmj20sd0g445z.jpg"], "praise_nums": "4", "comment_nums": 2, "fav_nums": 3, "tags": "IT技术,区块链,比特币", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://mp.weixin.qq.com/s/JEkjYdvRw2x3PzxKDR7FQQ\">来自 ChenJunXuan 的投稿</a>   </div><div>\n<blockquote><p>区块链就是比特币世界这个村子的账本，谁挖到矿，谁就有权在这个账本翻开新的一页，并在新的一页记下“X年X日，本村某某挖矿得到比特币一枚，并得到奖励的手续费若干”。</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fq7lkjvcdmj20sd0g445z.jpg\" width=\"690\" height=\"392\"></p>\n<p>比特币又火了。为什么要说又呢？因为比特币在 2013 年已经火过一次了。这次与 2013 年相同的是，比特币的价格一路飙升，让人咂舌。与 2013 年不同的是，这次人们不仅仅关注比特币的价格，也开始关注比特币背后的技术——<strong>区块链</strong>。</p>\n<p>一夜之间，区块链从舞台背后站到了聚光灯下，成为了人们追捧的热点。物流、医药、版权…好像哪都可以凭借区块链脱胎换骨。那么，这么神奇的技术，到底是怎么回事？</p>\n<p>本文就以最通俗的语言，不涉及任何高等数学和计算机知识，来介绍一下比特币和区块链系统。</p>\n<p>说到区块链就不得不说比特币，比特币是区块链技术最好的载体，所以本文就以比特币为例来介绍区块链。</p>\n<p>比特币很牛，牛在两个特点：<strong>去中心化、</strong><strong>电子货币</strong>。</p>\n<p>别小瞧这两点，这两点同时存在可不是一件容易事儿。</p>\n<p>首先来说说去中心化，通常去中心化的货币一般都要追溯到很久以前了，远古时代人们自发地使用贝壳、石子做为雏形货币进行交易，这时候的货币可以看作是去中心化的货币——无需中央银行来组织发行、确认交易合法性。</p>\n<p>但是使用这类货币的弊端也不必我多说，货币供给不稳定，取决于每年的贝类产量；货币质量不一，有的大有的小，有的是花蛤有的是文蛤；交易很繁琐，大宗交易动不动就要好几车的贝壳，这么多货币运来运去还容易被抢劫。</p>\n<p>于是货币进化，信用货币时代到来，货币成了银行账户里的数字，上面的问题都解决了，但是我们必须需要银行来控制货币的发行、防伪，来进行交易结算，我们的财产权全掌握在了银行的手中。银行喜欢动不动搞点QE放点水，我们银行卡里的钱越来越贬值。</p>\n<p><strong>这时候，我们就希望能有一种货币，既能像使用贝壳一样无需银行插手，又能符合当前信息时代对货币功能的需求。于是，集这两种特点于一身的比特币诞生了。</strong></p>\n<h2>比特币的基本原理</h2>\n<p>做为一种货币，通常就要满足几个特点：得有人<strong>发行</strong>它，得能<strong>持有</strong>它，人与人之间可以互相<strong>交换</strong>它。</p>\n<h3>持有</h3>\n<p>持有比特币非常简单，只要有一个<strong>收款地址</strong>，就可以持有比特币并接受比特币。所持有的比特币数量只是这个地址下的一个数字。</p>\n<p>有人会问，这不跟银行账户一样么，确实很像，但实质又很不一样。银行系统是一个中心化的系统，账户的余额是由银行说了算的，哪天银行系统出错余额变成0，那你就真的从ATM机里取不出钱。</p>\n<p>比特币不使用这种权威的中心机构，又需要一个稳定的记账系统，所以解决办法是每一个“矿工”都把比特币世界发生过的所有交易记录存在自己的硬盘上。有了全部的交易记录，推算每个人有多少余额也就很容易了。这个被保存在所有人电脑里的交易记录，学名就是<strong>区块链</strong>。黑客可以黑掉一些人保存的区块链，但是他做不到黑掉全世界大部分人，只要有大部分仍保存着正确的区块链，那么整个系统就可以通过纠错重新恢复正常。</p>\n<blockquote><p>就像打麻将时，我们有时候用记账方式来记录每回合的应收应付，比特币世界也通过记账来交易，每发生一笔交易都会公之于众，然后大家把这笔交易记录在自己的小账本上，这样每家有多少钱，大家在自己的小账本上都能查清楚。只不过当记账由4个人变成全比特币世界的村民时，这就需要一个稍微复杂点的系统了。</p></blockquote>\n<h3>发行</h3>\n<p>再来看看发行。我们先看纸币是怎么发行的，很简单，央行开动印刷机，一瞬间出现大把“毛爷爷”。而做为一种去中心化的电子货币，比特币是没有央行的，那怎么发行呢？</p>\n<p>比特币规定，人们可以去解答一个困难的问题，谁最先答出来，谁就可以发行一块比特币，也就是我们所谓的“挖矿”。</p>\n<p>这个困难的问题是什么呢？是哈希(hashing)的问题。哈希是一个函数<strong>F</strong>，对输入<strong>X</strong>进行一些运算来得到<strong>哈希值</strong><strong>Y</strong>。就是咱们高中学过的<strong>Y = F(X)</strong>。比特币让你解答的问题就是，告诉你哈希值<strong>Y</strong>和<strong>F</strong>，求<strong>X</strong>。</p>\n<p>这时候你会说了，这不就是个反函数的事么。抱歉，哈希函数这个函数比较特殊，找不到合适的反函数，要想求出<strong>X</strong>，唯一的方法就是一个一个数来试，把每一个数都代入到<strong>F</strong>里，看看结果是不是<strong>Y</strong>，如果恰好蒙对了，那也就把这个问题解答出来了。</p>\n<p>所以说所谓的货币发行、挖矿，实际上就是一帮人在用最好的计算机来撞大运蒙这个数。当一名矿工蒙对<strong>X</strong>后，也就是挖到矿后，他就获得了在原有的区块链末端创造一个新的<strong>交易区块</strong>的权利，在这个新创建的交易区块上，这位矿工可以附带一个由<strong>比特币世界</strong>作为付款人，收款人是任何人交易，这样，他就通过这个交易，创造并发行了一枚比特币。</p>\n<p>区块链就是由一串交易区块组成的。我们来看看交易区块上包含什么。</p>\n<p>一个交易区块会显示谁是它的父区块，包含本区块上的交易记录，以及本区块的哈希值。</p>\n<p> </p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fq7ljddkbdj20ht06ydil.jpg\" width=\"641\" height=\"250\"></p>\n<p>这样，随着矿工们不断挖矿创建新的交易区块，一个接一个的区块就串成了一串，成为了名副其实的区块链！在比特币世界中，由于某些原因，区块链会发生分叉（为什么会分叉下文会提到），因而比特币世界规定：唯一合法的区块链是当前最长的区块链。</p>\n<blockquote><p>区块链就是比特币世界这个村子的账本，谁挖到矿，谁就有权在这个账本翻开新的一页，并在新的一页记下“X年X日，本村某某挖矿得到比特币一枚，并得到奖励的手续费若干”。这个账本很特殊，并不是由村支书管理，而是所有的村民人手一本，谁挖到矿以后，都可以自己翻页记账，并让全村人按照同样的方式做，以保证全村所有人的账本一致。当全村人的账本出现不一致时，规定谁家的账本最长就听谁的。</p></blockquote>\n<h3>发行</h3>\n<p>比特币的关键点在于交易。对于一个去中心化的电子货币系统，交易是很有风险的。想象一下，你和另一个人的电子货币交易就类似于打欠条，而且这个欠条没有第三方公证人。如果其中一方突然翻脸，欠条的有效性是很难保障的。</p>\n<p>由于不能使用类似银行结算中心的第三方公证人（使用了就是中心化系统了），所以比特币干脆就让全世界人做为公证人。</p>\n<p>所有比特币的交易都不能偷偷摸摸进行，都需要将这笔交易通过互联网广播到全世界。如果C想给B 0.5个比特币，会向全世界广播“C给了B 0.5个比特币！”，这时所有挖矿的矿工们，会把这条交易记录加到他们正在挖的这个交易区块中。</p>\n<p>他们为什么要加呢？因为当矿工挖出矿时，除了规定奖励的一枚比特币外，每加多一条交易记录，还会额外再多给一点点手续费。蚊子肉也是肉，辛勤的矿工们没有不喜欢的。</p>\n<p>在把交易记录加到区块的过程中，矿工们首先会验证一下这笔交易合不合法，也就是查查村里的账本，当C名下货币不足0.5个时，这条交易记录就会被拒绝加入到区块中。</p>\n<p>加入到区块中并不代表交易已经成功，只有当包含这个交易记录的区块的随机数X被某位矿工发现，并创造了新的交易区块链接在当前区块后，才能被认为是合法交易，这条交易记录也就成为被验证的交易。</p>\n<p>B可能会问了，那也就是说C发了给我钱的广播后，我还不能马上确定我是不是收到钱了啊？</p>\n<blockquote><p>没错，C发广播，只相当于C站在村口朝全村人喊了一句 “我给B 五毛钱！”，只有当全村的人都听见，把这件事都记在了个自账本上，并且记下这件事的那页被矿工翻过去以后，B的户头上多了五毛钱这件事才真正得到了全村村民的认可。由于参与比特币挖矿的矿工众多，通常每笔交易所需的验证时间是非常短的，不会给交易带来延迟感。</p></blockquote>\n<p>由此比特币的发行和交易首尾相连扣在了一起。交易通过发布广播的形式进行，矿工们听到广播后把交易写在交易区块中；矿工们通过挖矿来确认历史交易的完成，并由此创建新的区块，延长区块链，发行新的比特币。</p>\n<section>\n<section class=\"\">\n<h2>区块链的分叉</h2>\n</section>\n</section>\n<p>之前提到了<strong>区块链的分叉</strong>。为什么区块链会发生分叉呢？原因就在于<strong>去中心化</strong>。</p>\n<p>没有中心，大家都各自维护账本，因此受困于网络的延时、交流的不充分，难免有出现分歧的时候。</p>\n<p>举两个例子，一个是在挖矿时容易出现的问题：矿工B蒙对了随机数，挖矿成功，延长了区块链，注意，此时矿工B延长的区块链仅仅是自己的，其他人还都不知道这件事。当然，矿工B马上向全世界发布挖矿成功的消息，让大家按照他的方式延长区块链。</p>\n<p>但是这时，另一位矿工C也蒙对了随机数，他或者因为网速延迟还没听到B的广播，或者听到广播但不甘心，存心想破坏规则，于是他也把自己的区块链延长了，并开始向全世界发广播。</p>\n<p>因为网速的延迟，并不是所有人都先听到B的广播，此时就会出现一部分人按照B的指示更新区块链，一部分人按照C的指示更新区块链，而且因为网速的延迟，大家没办法确定到底是B还是C先发布的广播，从而引起区块链分叉。</p>\n<blockquote><p>就好比村里两位矿工B和C分别住在村东和村西，B和C差不多在同一时间挖矿成功，把自家账本翻页，在新的一页写下属于自己的宣言“X年X月，本村B(C)挖矿得到比特币一枚”，并开始向全村大喊让全村人翻页并写下这句话。由于他们分别住在村子的两头，结果村东头的人先听到B大喊于是按找B的话记账，村西头的人先听到C大喊于是按照C的话记账，导致全村的账本此时出现了两个版本。</p></blockquote>\n<p>第二种情况是<strong>双重交易</strong>，B与C进行交易，发布广播宣布付给C一枚比特币，但是B同时还跟D勾搭，几乎同时又发布广播宣布付给D一枚比特币，更糟糕的是，B宣布付出的是同一枚。</p>\n<p>跟第一种情况一样，由于网速问题，一部分矿工先听到B与C交易的广播，并将这条交易记录计入到当前交易区块中，后听到B与D的交易，并判定不合法，拒不添加到交易区块。而另一部分矿工正相反，只把B与D的交易添加到交易区块中。</p>\n<p>这两种情况并不是罕见的，由于比特币世界由全世界各地的人参与，有的地区用的是100M光宽带，有的地方用的是56K拨号上网，网速千差万别，而且又有很多人心怀不轨，存心作恶，因此区块链分叉几乎时时刻刻都在发生。此时，比特币世界的最高原则就起作用了：<strong>唯一合法的区块链是当前最长的区块链。</strong></p>\n<p>可是就上面两种分叉的情况来看，此时分叉的两个区块链一样长啊？没关系，这两条都合法，也都不合法，咱们搁置争议，继续开挖，看谁挖得快，谁先再蒙对新的X，让自己的区块链再进一步，谁的区块链就变成最长，也就成了唯一合法的了。这么一听，怎么感觉这个区块链系统这么随意，有些不靠谱的样子啊，如果大家都不守规则，随意分叉，世界岂不乱套。</p>\n<p>别急，接下来咱们通过分析会发现，最终区块链肯定会恢复成稳定的一条。</p>\n<p>让我们回到第一个情况矿工B和矿工C分歧问题中，假设B的链条再进一步，成为了最长链条，这条链条也就成为比特币世界认定的合法链条。此时C有两个选择，一是放弃努力，乖乖的扔掉自己的区块链，使用B的。另一种选择是不甘心失败，扔坚持自己的区块链，希望自己能很快继续追平B并反超。</p>\n<p>选择前者是大家都开心的，比特币世界的区块链从此统一，选择后者实际上继续让区块链保持分叉状态。那么从理性角度，C应该如何做呢？实际上C此时应该果断放弃自己的链条。</p>\n<p>我们可以分析一下，当B和C的链条分叉时，此时比特币世界存在4种矿工、两种势力，B和拥护B的吃瓜矿工，C和拥护C的吃瓜矿工。此时B势力与C势力大体相当，所以大家各挖各的。</p>\n<p>当B势力先一步延长了B的链条后，此时C势力就会发生分化，绝大部分拥护C的吃瓜群众只要听到B链条延长的消息，马上会转投到B链条上，因为此时B链条更长，在更长的链条上继续挖矿显然更有前途。势力马上发生逆转，C会尴尬地发现，全世界都在与他为敌（哭）。所以C不得不放弃。</p>\n<p>当然，假设是C的势力先延长了区块链，那么情形正好相反，全世界的矿工都会马上投入C的怀抱。尽管可能确实是B先挖到的矿，但此时B也不得不选择放弃自己的那条已经无人问津的区块链。按照这种理性的假设，全世界大部分矿工都会安分守己的选择在最长的链条上工作，所以偶尔的分叉也不是什么大不了的事。</p>\n<p>当然仍存在一种极端情况，即B或C一个人的算力超过全世界算力的50%，这时候他们凭借一己之力就有可能反超。但是事实上，由于全世界都在参与，很难有人或组织有这么强的算力，其次即使C有这么强的算力，他老老实实地在最长链条上挖矿就好了，也没必要硬刚全世界，非要显示霸权只会让全世界都不陪他玩了，最后比特币失去价值，C损失更大。</p>\n<p>上面所说的第二种分叉情况的解决办法与第一种情况同理，坚持“唯一合法的区块链是当前最长的区块链”原则不动摇，最终合法的一条区块链只会记录B与C交易或B与D交易的其中一个，具体原因读者可以自己想一想。</p>\n<p> </p>\n<p>讲了这么多，大家可以发现，比特币凭借区块链的巧妙设计，使得交易与发行以一种非常稳定的状态进行，而保持稳定的核心力量是什么呢？就是无数矿工提供的算力。</p>\n<p>只要矿工够多，算力够大，验证速度够快，比特币的交易就可以快速地被验证，不小心出现的区块链分叉状态可以很快结束，保证整个系统稳定运行。所以挖矿可不光只是费电，这些电能实际上转化成为维持整个系统稳定的能量！</p>\n<p>这也告诉我们为什么比特币可以一个币价值数万，而有些新发行的各种币一文不值，因为比特币做为历史最长、受众最广的电子货币，也拥有数量最多、分布最广泛的矿工和算力，是最稳定的电子货币。</p>\n<p>而新发行的货币矿工数量很少，参与的算力低，根本起不到稳定整个系统的作用，算力低也意味着每笔交易的验证时间会变长，从而降低货币的可用性，所以这样的新兴货币一文不值。</p>\n<p>好了，关于比特币以及比特币系统所用到的区块链技术就介绍到这里，如有大牛对文中内容有异议，欢迎拍砖探讨！</p>\n<p> </p>\n<p><strong>参考文献：</strong></p>\n<p>Satoshi《Bitcoin: A Peer-to-Peer Electronic Cash System》</p>\n</div>\n<p> </p>\n<p><strong>关于作者：</strong></p>\n<p>ChenJunXuan / CC，17 年硕士毕业于上海交大，目前在阿里达摩院做计算机视觉方向/智能医学影像相关的算法开发，喜欢 Python。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111954\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111954votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111954\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/6ee5b64dfb633d1d06e3478d949e5f0b666c3d17.jpg"},{"url_object_id": "a0e861fe08356d9eabe96fbd21c0753d", "title": "使用 Graylog 和 Prometheus 监视 Kubernetes 集群", "url": "http://blog.jobbole.com/113875/", "create_date": "2018/04/13", "front_image_url": ["https://dn-linuxcn.qbox.me/data/attachment/album/201804/10/182842hu1toaq9hhh9uiou.png"], "praise_nums": "1", "comment_nums": 2, "fav_nums": 2, "tags": "IT技术,集群", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://insights.ubuntu.com/2018/01/16/monitor-your-kubernetes-cluster/\">Kevin Monroe</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9534-1.html\">Linux中国/qhwdw</a>   </div><p>这篇文章最初发表在 <a href=\"https://medium.com/@kwmonroe/monitor-your-kubernetes-cluster-a856d2603ec3\">Kevin Monroe 的博客</a> 上。</p>\n<p>监视日志和指标状态是集群管理员的重点工作。它的好处很明显：指标能帮你设置一个合理的性能目标，而日志分析可以发现影响你工作负载的问题。然而，困难的是如何找到一个与大量运行的应用程序一起工作的监视解决方案。</p>\n<p>在本文中，我将使用 <a href=\"https://www.graylog.org/\">Graylog</a> （用于日志）和 <a href=\"https://prometheus.io/\">Prometheus</a> （用于指标）去打造一个 Kubernetes 集群的监视解决方案。当然了，这不仅是将三个东西连接起来那么简单，实现上，最终结果看起来应该如题图所示：</p>\n<p><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201804/10/182842hu1toaq9hhh9uiou.png\" alt=\"\"></p>\n<p>正如你所了解的，Kubernetes 不是一件东西 —— 它由主控节点、工作节点、网络连接、配置管理等等组成。同样，Graylog 是一个配角（apache2、mongodb、等等），Prometheus 也一样（telegraf、grafana 等等）。在部署中连接这些点看起来似乎有些让人恐惧，但是使用合适的工具将不会那么困难。</p>\n<p>我将使用 <a href=\"https://conjure-up.io/\">conjure-up</a> 和 <a href=\"https://jujucharms.com/canonical-kubernetes\">Canonical 版本的 Kubernetes</a> (CDK) 去探索 Kubernetes。我发现 <code>conjure-up</code> 接口对部署大型软件很有帮助，但是我知道一些人可能不喜欢 GUI、TUI 以及其它用户界面。对于这些人，我将用命令行再去部署一遍。</p>\n<p>在开始之前需要注意的一点是，Graylog 和 Prometheus 是部署在 Kubernetes 外侧而不是集群上。像 Kubernetes 仪表盘和 Heapster 是运行的集群的非常好的信息来源，但是我的目标是为日志/指标提供一个分析机制，而不管集群运行与否。</p>\n<h3 id=\"toc_1\">开始探索</h3>\n<p>如果你的系统上没有 <code>conjure-up</code>，首先要做的第一件事情是，请先安装它，在 Linux 上，这很简单：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119a8f776611856\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo snap install conjure-up --classic\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119a8f776611856-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119a8f776611856-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119a8f776611856-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">snap </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">conjure</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">up</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">classic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119a8f776611856-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>对于 macOS 用户也提供了 brew 包：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119a99192160266\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbrew install conjure-up\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119a99192160266-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119a99192160266-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119a99192160266-1\"><span class=\"crayon-e\">brew </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">conjure</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">up</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119a99192160266-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>你需要最新的 2.5.2 版，它的好处是添加了 CDK spell，因此，如果你的系统上已经安装了旧的版本，请使用 <code>sudo snap refresh conjure-up</code> 或者 <code>brew update &amp;&amp; brew upgrade conjure-up</code> 去更新它。</p>\n<p>安装完成后，运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119a9d996791682\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconjure-up\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119a9d996791682-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119a9d996791682-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119a9d996791682-1\"><span class=\"crayon-v\">conjure</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">up</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119a9d996791682-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/0a84a2dc6e19e9e92a195dbe6c5eb6b1.png\" alt=\"\"></p>\n<p>你将发现有一个 spell 列表。选择 CDK 然后按下回车。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/5c2e2762a0bb2a81dd5939d4a657c69d.png\" alt=\"\"></p>\n<p>这个时候，你将看到 CDK spell 可用的附加组件。我们感兴趣的是 Graylog 和 Prometheus，因此选择这两个，然后点击 “Continue”。</p>\n<p>它将引导你选择各种云，以决定你的集群部署的地方。之后，你将看到一些部署的后续步骤，接下来是回顾屏幕，让你再次确认部署内容：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/e8a7154940f22e1ee5c1035698a2fab3.png\" alt=\"\"></p>\n<p>除了典型的 K8s 相关的应用程序（etcd、flannel、load-balancer、master 以及 workers）之外，你将看到我们选择的日志和指标相关的额外应用程序。</p>\n<p>Graylog 栈包含如下：</p>\n<ul>\n<li>apache2：graylog web 界面的反向代理</li>\n<li>elasticsearch：日志使用的文档数据库</li>\n<li>filebeat：从 K8s master/workers 转发日志到 graylog</li>\n<li>graylog：为日志收集器提供一个 api，以及提供一个日志分析界面</li>\n<li>mongodb：保存 graylog 元数据的数据库</li>\n</ul>\n<p>Prometheus 栈包含如下：</p>\n<ul>\n<li>grafana：指标相关的仪表板的 web 界面</li>\n<li>prometheus：指标收集器以及时序数据库</li>\n<li>telegraf：发送主机的指标到 prometheus 中</li>\n</ul>\n<p>你可以在回顾屏幕上微调部署，但是默认组件是必选 的。点击 “Deploy all Remaining Applications” 继续。</p>\n<p>部署工作将花费一些时间，它将部署你的机器和配置你的云。完成后，<code>conjure-up</code> 将展示一个摘要屏幕，它包含一些链接，你可以用你的终端去浏览各种感兴趣的内容：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/77927d348a0c12ef4855bd1116947ef5.png\" alt=\"\"></p>\n<h4 id=\"toc_2\">浏览日志</h4>\n<p>现在，Graylog 已经部署和配置完成，我们可以看一下采集到的一些数据。默认情况下，filebeat 应用程序将从 Kubernetes 的 master 和 worker 中转发系统日志（ <code>/var/log/*.log</code> ）和容器日志（<code>/var/log/containers/*.log</code>）到 graylog 中。</p>\n<p>记住如下的 apache2 的地址和 graylog 的 admin 密码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119aa2572420473\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\njuju status --format yaml apache2/0 | grep public-address\r\n public-address: &lt;your-apache2-ip&gt;\r\njuju run-action --wait graylog/0 show-admin-password\r\n admin-password: &lt;your-graylog-password&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aa2572420473-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119aa2572420473-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aa2572420473-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119aa2572420473-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119aa2572420473-1\"><span class=\"crayon-e\">juju </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">format </span><span class=\"crayon-e\">yaml </span><span class=\"crayon-v\">apache2</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-m\">public</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">address</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119aa2572420473-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">address</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">apache2</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ip</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119aa2572420473-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">wait </span><span class=\"crayon-v\">graylog</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">admin</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">password</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119aa2572420473-4\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">password</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">graylog</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">password</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>在浏览器中输入 <code>http://&lt;your-apache2-ip&gt;</code> ，然后以管理员用户名（admin）和密码（&lt;your-graylog-password&gt;）登入。</p>\n<p><strong>注意：</strong> 如果这个界面不可用，请等待大约 5 分钟时间，以便于配置的反向代理生效。</p>\n<p>登入后，顶部的 “Sources” 选项卡可以看到从 K8s 的 master 和 workers 中收集日志的概述：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/8e0dc56257a324ee2f0f33426b3c105e.png\" alt=\"\"></p>\n<p>通过点击 “System / Inputs” 选项卡深入这些日志，选择 “Show received messages” 查看 filebeat 的输入：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/6b187118ff50bc41d040ef954b607ffe.png\" alt=\"\"></p>\n<p>在这里，你可以应用各种过滤或者设置 Graylog 仪表板去帮助识别大多数比较重要的事件。查看 <a href=\"http://docs.graylog.org/en/2.3/pages/dashboards.html\">Graylog Dashboard</a> 文档，可以了解如何定制你的视图的详细资料。</p>\n<h4 id=\"toc_3\">浏览指标</h4>\n<p>我们的部署通过 grafana 仪表板提供了两种类型的指标：系统指标，包括像 K8s master 和 worker 的 CPU /内存/磁盘使用情况，以及集群指标，包括像从 K8s cAdvisor 端点上收集的容器级指标。</p>\n<p>记住如下的 grafana 的地址和 admin 密码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119aa6785543811\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\njuju status --format yaml grafana/0 | grep public-address\r\n public-address: &lt;your-grafana-ip&gt;\r\njuju run-action --wait grafana/0 get-admin-password\r\n password: &lt;your-grafana-password&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aa6785543811-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119aa6785543811-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aa6785543811-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119aa6785543811-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119aa6785543811-1\"><span class=\"crayon-e\">juju </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">format </span><span class=\"crayon-e\">yaml </span><span class=\"crayon-v\">grafana</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-m\">public</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">address</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119aa6785543811-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">address</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">grafana</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ip</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119aa6785543811-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">wait </span><span class=\"crayon-v\">grafana</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">admin</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">password</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119aa6785543811-4\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">grafana</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">password</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>在浏览器中输入 <code>http://&lt;your-grafana-ip&gt;:3000</code>，输入管理员用户（admin）和密码（&lt;your-grafana-password&gt;）登入。成功登入后，点击 “Home” 下拉框，选取 “Kubernetes Metrics (via Prometheus)” 去查看集群指标仪表板：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/76a0a9d93a75c76c8033b51957615741.png\" alt=\"\"></p>\n<p>我们也可以通过下拉框切换到 “Node Metrics (via Telegraf) ” 去查看 K8s 主机的系统指标。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/a708ae229aeffef775184db190b97c95.png\" alt=\"\"></p>\n<h3 id=\"toc_4\">另一种方法</h3>\n<p>正如在文章开始的介绍中提到的，我喜欢用 <code>conjure-up</code> 的向导去完成像 Kubernetes 这种复杂软件的部署。现在，我们来看一下 <code>conjure-up</code> 的另一种方法，你可能希望去看到实现相同结果的一些命令行的方法。还有其它的可能已经部署了前面的 CDK，并想去扩展使用上述的 Graylog/Prometheus 组件。不管什么原因你既然看到这了，既来之则安之，继续向下看吧。</p>\n<p>支持 <code>conjure-up</code> 的工具是 <a href=\"https://jujucharms.com/\">Juju</a>。CDK spell 所做的一切，都可以使用 <code>juju</code> 命令行来完成。我们来看一下，如何一步步完成这些工作。</p>\n<h4 id=\"toc_5\">从 Scratch 中启动</h4>\n<p>如果你使用的是 Linux，安装 Juju 很简单，命令如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119aaa564862096\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo snap install juju --classic\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aaa564862096-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119aaa564862096-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119aaa564862096-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">snap </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">juju</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">classic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119aaa564862096-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>对于 macOS，Juju 也可以从 brew 中安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119aad298724290\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbrew install juju\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aad298724290-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119aad298724290-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119aad298724290-1\"><span class=\"crayon-e\">brew </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">juju</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119aad298724290-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>现在为你选择的云配置一个控制器。你或许会被提示请求一个凭据（用户名密码）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119ab1937767584\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\njuju bootstrap\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ab1937767584-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ab1937767584-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119ab1937767584-1\"><span class=\"crayon-e\">juju </span><span class=\"crayon-i\">bootstrap</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ab1937767584-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>我们接下来需要基于 CDK 捆绑部署：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119ab4027629011\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\njuju deploy canonical-kubernetes\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ab4027629011-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ab4027629011-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119ab4027629011-1\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">canonical</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">kubernetes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ab4027629011-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h4 id=\"toc_6\">从 CDK 开始</h4>\n<p>使用我们部署的 Kubernetes 集群，我们需要去添加 Graylog 和 Prometheus 所需要的全部应用程序：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119ab7443047481\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n## deploy graylog-related applications\r\njuju deploy xenial/apache2\r\njuju deploy xenial/elasticsearch\r\njuju deploy xenial/filebeat\r\njuju deploy xenial/graylog\r\njuju deploy xenial/mongodb\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ab7443047481-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ab7443047481-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ab7443047481-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ab7443047481-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ab7443047481-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ab7443047481-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ab7443047481-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119ab7443047481-1\"><span class=\"crayon-p\">## deploy graylog-related applications</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ab7443047481-2\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">xenial</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">apache2</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ab7443047481-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">xenial</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">elasticsearch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ab7443047481-4\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">xenial</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">filebeat</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ab7443047481-5\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">xenial</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">graylog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ab7443047481-6\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">xenial</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">mongodb</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ab7443047481-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119aba850234271\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n## deploy prometheus-related applications\r\njuju deploy xenial/grafana\r\njuju deploy xenial/prometheus\r\njuju deploy xenial/telegraf\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aba850234271-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119aba850234271-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aba850234271-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119aba850234271-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119aba850234271-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119aba850234271-1\"><span class=\"crayon-p\">## deploy prometheus-related applications</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119aba850234271-2\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">xenial</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">grafana</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119aba850234271-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">xenial</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">prometheus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119aba850234271-4\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">deploy </span><span class=\"crayon-v\">xenial</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">telegraf</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119aba850234271-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在软件已经部署完毕，将它们连接到一起，以便于它们之间可以相互通讯：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119abd037355986\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n## relate graylog applications\r\njuju relate apache2:reverseproxy graylog:website\r\njuju relate graylog:elasticsearch elasticsearch:client\r\njuju relate graylog:mongodb mongodb:database\r\njuju relate filebeat:beats-host kubernetes-master:juju-info\r\njuju relate filebeat:beats-host kubernetes-worker:jujuu-info\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119abd037355986-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119abd037355986-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119abd037355986-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119abd037355986-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119abd037355986-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119abd037355986-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119abd037355986-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119abd037355986-1\"><span class=\"crayon-p\">## relate graylog applications</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119abd037355986-2\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">apache2</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">reverseproxy </span><span class=\"crayon-v\">graylog</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">website</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119abd037355986-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">graylog</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">elasticsearch </span><span class=\"crayon-v\">elasticsearch</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119abd037355986-4\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">graylog</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">mongodb </span><span class=\"crayon-v\">mongodb</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">database</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119abd037355986-5\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">filebeat</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">beats</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">host </span><span class=\"crayon-v\">kubernetes</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">master</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">juju</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119abd037355986-6\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">filebeat</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">beats</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">host </span><span class=\"crayon-v\">kubernetes</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">worker</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">jujuu</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">info</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119abd037355986-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119ac1156566788\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n## relate prometheus applications\r\njuju relate prometheus:grafana-source grafana:grafana-source\r\njuju relate telegraf:prometheus-client prometheus:target\r\njuju relate kubernetes-master:juju-info telegraf:juju-info\r\njuju relate kubernetes-worker:juju-info telegraf:juju-info\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac1156566788-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac1156566788-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac1156566788-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac1156566788-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac1156566788-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac1156566788-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac1156566788-1\"><span class=\"crayon-p\">## relate prometheus applications</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac1156566788-2\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">prometheus</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">grafana</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">source </span><span class=\"crayon-v\">grafana</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">grafana</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">source</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac1156566788-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">telegraf</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">prometheus</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">client </span><span class=\"crayon-v\">prometheus</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">target</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac1156566788-4\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">kubernetes</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">master</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">juju</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">info </span><span class=\"crayon-v\">telegraf</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">juju</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">info</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac1156566788-5\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">relate </span><span class=\"crayon-v\">kubernetes</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">worker</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">juju</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">info </span><span class=\"crayon-v\">telegraf</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">juju</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac1156566788-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>这个时候，所有的应用程序已经可以相互之间进行通讯了，但是我们还需要多做一点配置（比如，配置 apache2 反向代理、告诉 prometheus 如何从 K8s 中取数、导入到 grafana 仪表板等等）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119ac4289611352\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n## configure graylog applications\r\njuju config apache2 enable_modules=\"headers proxy_html proxy_http\"\r\njuju config apache2 vhost_http_template=\"$(base64 &lt;vhost-tmpl&gt;)\"\r\njuju config elasticsearch firewall_enabled=\"false\"\r\njuju config filebeat \\\r\n logpath=\"/var/log/*.log /var/log/containers/*.log\"\r\njuju config filebeat logstash_hosts=&lt;graylog-ip&gt;\":5044\"\r\njuju config graylog elasticsearch_cluster_name=\"&lt;es-cluster&gt;\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac4289611352-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac4289611352-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac4289611352-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac4289611352-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac4289611352-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac4289611352-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac4289611352-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac4289611352-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac4289611352-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac4289611352-1\"><span class=\"crayon-p\">## configure graylog applications</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac4289611352-2\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">apache2 </span><span class=\"crayon-v\">enable_modules</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"headers proxy_html proxy_http\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac4289611352-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">apache2 </span><span class=\"crayon-v\">vhost_http_template</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"$(base64 &lt;vhost-tmpl&gt;)\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac4289611352-4\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">elasticsearch </span><span class=\"crayon-v\">firewall_enabled</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"false\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac4289611352-5\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">config </span><span class=\"crayon-i\">filebeat</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac4289611352-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logpath</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/var/log/*.log /var/log/containers/*.log\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac4289611352-7\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">filebeat </span><span class=\"crayon-v\">logstash_hosts</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">graylog</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ip</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\":5044\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac4289611352-8\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">graylog </span><span class=\"crayon-v\">elasticsearch_cluster_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"&lt;es-cluster&gt;\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac4289611352-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119ac7188241871\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n## configure prometheus applications\r\njuju config prometheus scrape-jobs=\"&lt;scraper-yaml&gt;\"\r\njuju run-action --wait grafana/0 import-dashboard \\\r\n dashboard=\"$(base64 &lt;dashboard-json&gt;)\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac7188241871-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac7188241871-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac7188241871-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119ac7188241871-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119ac7188241871-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac7188241871-1\"><span class=\"crayon-p\">## configure prometheus applications</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac7188241871-2\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">prometheus </span><span class=\"crayon-v\">scrape</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">jobs</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"&lt;scraper-yaml&gt;\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac7188241871-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">wait </span><span class=\"crayon-v\">grafana</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">import</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">dashboard</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119ac7188241871-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dashboard</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"$(base64 &lt;dashboard-json&gt;)\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119ac7188241871-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>以上的步骤需要根据你的部署来指定一些值。你可以用与 <code>conjure-up</code> 相同的方法得到这些：</p>\n<ul>\n<li><code>&lt;vhost-tmpl&gt;</code>： 从 github 获取我们的示例 <a href=\"https://raw.githubusercontent.com/conjure-up/spells/master/canonical-kubernetes/addons/graylog/steps/01_install-graylog/graylog-vhost.tmpl\">模板</a></li>\n<li><code>&lt;graylog-ip&gt;</code>： <code>juju run --unit graylog/0 'unit-get private-address'</code></li>\n<li><code>&lt;es-cluster&gt;</code>： <code>juju config elasticsearch cluster-name</code></li>\n<li><code>&lt;scraper-yaml&gt;</code>： 从 github 获取我们的示例 <a href=\"https://raw.githubusercontent.com/conjure-up/spells/master/canonical-kubernetes/addons/prometheus/steps/01_install-prometheus/prometheus-scrape-k8s.yaml\">scraper</a> ；<code>[K8S_PASSWORD][20]</code> 和 <code>[K8S_API_ENDPOINT][21]</code> <a href=\"https://github.com/conjure-up/spells/blob/master/canonical-kubernetes/addons/prometheus/steps/01_install-prometheus/after-deploy#L25\">substitute</a> 的正确值</li>\n<li><code>&lt;dashboard-json&gt;</code>： 从 github 获取我们的 <a href=\"https://raw.githubusercontent.com/conjure-up/spells/master/canonical-kubernetes/addons/prometheus/steps/01_install-prometheus/grafana-telegraf.json\">主机</a> 和 <a href=\"https://raw.githubusercontent.com/conjure-up/spells/master/canonical-kubernetes/addons/prometheus/steps/01_install-prometheus/grafana-k8s.json\">k8s</a> 仪表板</li>\n</ul>\n<p>最后，发布 apache2 和 grafana 应用程序，以便于可以通过它们的 web 界面访问：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae24ec119acc173857607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n## expose relevant endpoints\r\njuju expose apache2\r\njuju expose grafana\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119acc173857607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119acc173857607-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae24ec119acc173857607-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae24ec119acc173857607-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae24ec119acc173857607-1\"><span class=\"crayon-p\">## expose relevant endpoints</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119acc173857607-2\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">expose </span><span class=\"crayon-e\">apache2</span></div><div class=\"crayon-line\" id=\"crayon-5ae24ec119acc173857607-3\"><span class=\"crayon-e\">juju </span><span class=\"crayon-e\">expose </span><span class=\"crayon-i\">grafana</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae24ec119acc173857607-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在我们已经完成了所有的部署、配置、和发布工作，你可以使用与上面的<strong>浏览日志</strong>和<strong>浏览指标</strong>部分相同的方法去查看它们。</p>\n<h3 id=\"toc_7\">总结</h3>\n<p>我的目标是向你展示如何去部署一个 Kubernetes 集群，很方便地去监视它的日志和指标。无论你是喜欢向导的方式还是命令行的方式，我希望你清楚地看到部署一个监视系统并不复杂。关键是要搞清楚所有部分是如何工作的，并将它们连接到一起工作，通过断开/修复/重复的方式，直到它们每一个都能正常工作。</p>\n<p>这里有一些像 conjure-up 和 Juju 一样非常好的工具。充分发挥这个生态系统贡献者的专长让管理大型软件变得更容易。从一套可靠的应用程序开始，按需定制，然后投入到工作中！</p>\n<p>大胆去尝试吧，然后告诉我你用的如何。你可以在 Freenode IRC 的 <strong>#conjure-up</strong> 和 <strong>#juju</strong> 中找到像我这样的爱好者。感谢阅读！</p>\n<h3 id=\"toc_8\">关于作者</h3>\n<p>Kevin 在 2014 年加入 Canonical 公司，他专注于复杂软件建模。他在 Juju 大型软件团队中找到了自己的位置，他的任务是将大数据和机器学习应用程序转化成可重复的（可靠的）解决方案。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113875\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113875votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113875\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8163b569212cff9b9756ab2724d7a551f380e188.jpg"},{"url_object_id": "fcc6df41d82a46e2ff4b2aa2b977da7e", "title": "SQL 入门", "url": "http://blog.jobbole.com/113879/", "create_date": "2018/04/14", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/01/970c5be7812066919173f6ec5ab052ce.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/2/getting-started-sql\">Aaron Cocker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9537-1.html\">Linux中国/MjSeven</a>   </div><blockquote><p>使用 SQL 构建一个关系数据库比你想的更容易。</p></blockquote>\n<p>使用 SQL 构建数据库比大多数人想象得要简单。实际上，你甚至不需要成为一个有经验的程序员就可以使用 SQL 创建数据库。在本文中，我将解释如何使用 MySQL 5.6 来创建简单的关系型数据库管理系统（RDMS）。在开始之前，我想顺便感谢一下 <a href=\"http://sqlfiddle.com\">SQL Fiddle</a>，这是我用来运行脚本的工具。它提供了一个用于测试简单脚本的有用的沙箱。</p>\n<p>在本教程中，我将构建一个使用如下实体关系图（ERD）中显示的简单架构的数据库。数据库列出了学生和正在学习的课程。为了保持简单，我使用了两个实体（即表），只有一种关系和依赖。这两个实体称为 <code>dbo_students</code> 和 <code>dbo_courses</code>。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/1281ca5e31c38cb7a7c9a46ad9a1ce04.png\" alt=\"\"></p>\n<p>数据库的多样性是一对多的，因为每门课程可以包含很多学生，但每个学生只能学习一门课程。</p>\n<p>关于术语的快速说明：</p>\n<ol>\n<li>一张表称为一个实体。</li>\n<li>一个字段称为一个属性。</li>\n<li>一条记录称为一个元组。</li>\n<li>用于构建数据库的脚本称为架构。</li>\n</ol>\n<h3 id=\"toc_1\">构建架构</h3>\n<p>要构建数据库，使用 <code>CREATE TABLE &lt;表名&gt; </code> 命令，然后定义每个字段的名称和数据类型。数据库使用 <code>VARCHAR(n)</code> （字符串）和 <code>INT(n)</code> （整数），其中 <code>n</code> 表示可以存储的值的长度。例如 <code>INT(2)</code> 可以是 <code>01</code>。</p>\n<p>这是用于创建两个表的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2909bbf8da356677118\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE dbo_students\r\n(\r\n  student_id INT(2) AUTO_INCREMENT NOT NULL,\r\n  student_name VARCHAR(50),\r\n  course_studied INT(2),\r\n  PRIMARY KEY (student_id)\r\n);\r\n\r\nCREATE TABLE dbo_courses\r\n(\r\n  course_id INT(2) AUTO_INCREMENT NOT NULL,\r\n  course_name VARCHAR(30),\r\n  PRIMARY KEY (course_id)\r\n);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8da356677118-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8da356677118-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8da356677118-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8da356677118-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8da356677118-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8da356677118-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8da356677118-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8da356677118-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8da356677118-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8da356677118-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8da356677118-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8da356677118-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8da356677118-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8da356677118-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8da356677118-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8da356677118-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">dbo_students</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8da356677118-2\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8da356677118-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">student_id </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AUTO_INCREMENT </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8da356677118-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">student_name </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8da356677118-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">course_studied </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8da356677118-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8da356677118-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8da356677118-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8da356677118-9\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">dbo_courses</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8da356677118-10\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8da356677118-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">course_id </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AUTO_INCREMENT </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8da356677118-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">course_name </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8da356677118-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8da356677118-14\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8da356677118-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p><code>NOT NULL</code> 意味着字段不能为空，<code>AUTO_INCREMENT</code> 意味着当一个新的元组被添加时，ID 号将自动生成，是对先前存储的 ID 号加 1，以强化各实体之间的完整参照性。 <code>PRIMARY KEY</code> 是每个表的惟一标识符属性。这意味着每个元组都有自己的不同的标识。</p>\n<h3 id=\"toc_2\">关系作为一种约束</h3>\n<p>就目前来看，这两张表格是独立存在的，没有任何联系或关系。要连接它们，必须标识一个外键。在 <code>dbo_students</code> 中，外键是 <code>course_studied</code>，其来源在 <code>dbo_courses</code> 中，意味着该字段被引用。SQL 中的特定命令为 <code>CONSTRAINT</code>，并且将使用另一个名为 <code>ALTER TABLE</code> 的命令添加这种关系，这样即使在架构构建完毕后，也可以编辑表。</p>\n<p>以下代码将关系添加到数据库构造脚本中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2909bbf8e4690877679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nALTER TABLE dbo_students\r\nADD CONSTRAINT FK_course_studied\r\nFOREIGN KEY (course_studied) REFERENCES dbo_courses(course_id);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e4690877679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e4690877679-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e4690877679-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e4690877679-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e4690877679-1\"><span class=\"crayon-e\">ALTER </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">dbo_students</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e4690877679-2\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-e\">CONSTRAINT </span><span class=\"crayon-e\">FK_course_studied</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e4690877679-3\"><span class=\"crayon-e\">FOREIGN </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">REFERENCES </span><span class=\"crayon-e\">dbo_courses</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e4690877679-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>使用 <code>CONSTRAINT</code> 命令实际上并不是必要的，但这是一个好习惯，因为它意味着约束可以被命名并且使维护更容易。现在数据库已经完成了，是时候添加一些数据了。</p>\n<h3 id=\"toc_3\">将数据添加到数据库</h3>\n<p><code>INSERT INTO &lt;表名&gt; </code> 是用于直接选择要添加哪些属性（即字段）数据的命令。首先声明实体名称，然后声明属性，下边是添加到实体的数据，从而创建一个元组。如果指定了 <code>NOT NULL</code>，这表示该属性不能留空。以下代码将展示如何向表中添加记录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2909bbf8e8183673674\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nINSERT INTO dbo_courses(course_id,course_name)\r\nVALUES(001,'Software Engineering');\r\nINSERT INTO dbo_courses(course_id,course_name)\r\nVALUES(002,'Computer Science');\r\nINSERT INTO dbo_courses(course_id,course_name)\r\nVALUES(003,'Computing');\r\n\r\nINSERT INTO dbo_students(student_id,student_name,course_studied)\r\nVALUES(001,'student1',001);\r\nINSERT INTO dbo_students(student_id,student_name,course_studied)\r\nVALUES(002,'student2',002);\r\nINSERT INTO dbo_students(student_id,student_name,course_studied)\r\nVALUES(003,'student3',002);\r\nINSERT INTO dbo_students(student_id,student_name,course_studied)\r\nVALUES(004,'student4',003);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e8183673674-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e8183673674-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e8183673674-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e8183673674-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e8183673674-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e8183673674-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e8183673674-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e8183673674-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e8183673674-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e8183673674-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e8183673674-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e8183673674-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e8183673674-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e8183673674-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8e8183673674-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8e8183673674-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e8183673674-1\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_courses</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e8183673674-2\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'Software Engineering'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e8183673674-3\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_courses</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e8183673674-4\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">002</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'Computer Science'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e8183673674-5\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_courses</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e8183673674-6\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">003</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'Computing'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e8183673674-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e8183673674-8\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_students</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">student_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e8183673674-9\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'student1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">001</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e8183673674-10\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_students</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">student_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e8183673674-11\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">002</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'student2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">002</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e8183673674-12\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_students</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">student_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e8183673674-13\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">003</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'student3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">002</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e8183673674-14\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_students</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">student_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8e8183673674-15\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">004</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'student4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">003</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8e8183673674-16\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>现在数据库架构已经完成并添加了数据，现在是时候在数据库上运行查询了。</p>\n<h3 id=\"toc_4\">查询</h3>\n<p>查询遵循使用以下命令的集合结构：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2909bbf8ec440426540\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT &lt;attributes&gt;\r\nFROM &lt;entity&gt;\r\nWHERE &lt;condition&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8ec440426540-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8ec440426540-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8ec440426540-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8ec440426540-1\"><span class=\"crayon-v\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">attributes</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8ec440426540-2\"><span class=\"crayon-v\">FROM</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">entity</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8ec440426540-3\"><span class=\"crayon-v\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">condition</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>要显示 <code>dbo_courses</code> 实体内的所有记录并显示课程代码和课程名称，请使用 <code>*</code> 。 这是一个通配符，它消除了键入所有属性名称的需要。（在生产数据库中不建议使用它。）此处查询的代码是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2909bbf8f0529983562\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT *\r\nFROM dbo_courses\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f0529983562-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f0529983562-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f0529983562-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f0529983562-1\"><span class=\"crayon-e \">SELECT *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f0529983562-2\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">dbo</span><span class=\"crayon-sy\">_</span>courses</div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f0529983562-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>此处查询的输出显示表中的所有元组，因此可显示所有可用课程：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2909bbf8f3986868662\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n| course_id |          course_name |\r\n|-----------|----------------------|\r\n|         1 | Software Engineering |\r\n|         2 |     Computer Science |\r\n|         3 |            Computing |\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f3986868662-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f3986868662-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f3986868662-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f3986868662-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f3986868662-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f3986868662-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f3986868662-1\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">course_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">course_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f3986868662-2\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f3986868662-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Software </span><span class=\"crayon-v\">Engineering</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f3986868662-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Computer </span><span class=\"crayon-v\">Science</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f3986868662-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">Computing</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f3986868662-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>在后面的文章中，我将使用三种类型的连接之一来解释更复杂的查询：内连接、外连接和交叉连接。</p>\n<p>这是完整的脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2909bbf8f6925899166\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE dbo_students\r\n(\r\n  student_id INT(2) AUTO_INCREMENT NOT NULL,\r\n  student_name VARCHAR(50),\r\n  course_studied INT(2),\r\n  PRIMARY KEY (student_id)\r\n);\r\n\r\nCREATE TABLE dbo_courses\r\n(\r\n  course_id INT(2) AUTO_INCREMENT NOT NULL,\r\n  course_name VARCHAR(30),\r\n  PRIMARY KEY (course_id)\r\n);\r\n\r\nALTER TABLE dbo_students\r\nADD CONSTRAINT FK_course_studied\r\nFOREIGN KEY (course_studied) REFERENCES dbo_courses(course_id);\r\n\r\nINSERT INTO dbo_courses(course_id,course_name)\r\nVALUES(001,'Software Engineering');\r\nINSERT INTO dbo_courses(course_id,course_name)\r\nVALUES(002,'Computer Science');\r\nINSERT INTO dbo_courses(course_id,course_name)\r\nVALUES(003,'Computing');\r\n\r\nINSERT INTO dbo_students(student_id,student_name,course_studied)\r\nVALUES(001,'student1',001);\r\nINSERT INTO dbo_students(student_id,student_name,course_studied)\r\nVALUES(002,'student2',002);\r\nINSERT INTO dbo_students(student_id,student_name,course_studied)\r\nVALUES(003,'student3',002);\r\nINSERT INTO dbo_students(student_id,student_name,course_studied)\r\nVALUES(004,'student4',003);\r\n\r\nSELECT *\r\nFROM dbo_courses\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5ae2909bbf8f6925899166-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2909bbf8f6925899166-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">dbo_students</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-2\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">student_id </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AUTO_INCREMENT </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">student_name </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">course_studied </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-9\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">dbo_courses</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-10\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">course_id </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AUTO_INCREMENT </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">course_name </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-14\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-16\"><span class=\"crayon-e\">ALTER </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">dbo_students</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-17\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-e\">CONSTRAINT </span><span class=\"crayon-e\">FK_course_studied</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-18\"><span class=\"crayon-e\">FOREIGN </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">REFERENCES </span><span class=\"crayon-e\">dbo_courses</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-20\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_courses</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-21\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'Software Engineering'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-22\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_courses</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-23\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">002</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'Computer Science'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-24\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_courses</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">course_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-25\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">003</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'Computing'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-26\"> </div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-27\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_students</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">student_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-28\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'student1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">001</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-29\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_students</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">student_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-30\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">002</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'student2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">002</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-31\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_students</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">student_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-32\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">003</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'student3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">002</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-33\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">dbo_students</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">student_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">student_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">course_studied</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-34\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">004</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'student4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">003</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-36\"><span class=\"crayon-e \">SELECT *</span></div><div class=\"crayon-line\" id=\"crayon-5ae2909bbf8f6925899166-37\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">dbo</span><span class=\"crayon-sy\">_</span>courses</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2909bbf8f6925899166-38\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p></p>\n<h3 id=\"toc_5\">学习更多</h3>\n<p>SQL 并不困难；我认为它比编程简单，并且该语言对于不同的数据库系统是通用的。 请注意，实体关系图中 <code>dbo.&lt;实体&gt;</code> （LCTT 译注：文章中使用的是 <code>dbo_&lt;实体&gt;</code>）不是必需的实体命名约定；我之所以使用，仅仅是因为它是 Microsoft SQL Server 中的标准。</p>\n<p>如果你想了解更多，在网络上这方面的最佳指南是 <a href=\"https://www.w3schools.com/sql/default.asp\">W3Schools.com</a> 中对所有数据库平台的 SQL 综合指南。</p>\n<p>请随意使用我的数据库。另外，如果你有任何建议或疑问，请在评论中回复。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113879\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113879votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113879\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/0e89c4879b2842f9c58098e98ad64d0a9d218103.jpg"},{"url_object_id": "9f16c4dc5a6cd2f4b07fef3690f49f8b", "title": "du 及 df 命令的使用（附带示例）", "url": "http://blog.jobbole.com/113780/", "create_date": "2018/03/23", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://linuxtechlab.com/du-df-commands-examples/\">shusain</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9457-1.html\">Linux中国/geekpi</a>   </div><p>在本文中，我将讨论 <code>du</code> 和 <code>df</code> 命令。<code>du</code> 和 <code>df</code> 命令都是 Linux 系统的重要工具，来显示 Linux 文件系统的磁盘使用情况。这里我们将通过一些例子来分享这两个命令的用法。</p>\n<ul>\n<li><strong>（推荐阅读：<a href=\"http://linuxtechlab.com/files-transfer-scp-rsync-commands/\">使用 scp 和 rsync 命令传输文件</a>）</strong></li>\n<li><strong>（另请阅读：<a href=\"http://linuxtechlab.com/linux-cloning-disks-using-dd-cat-commands/\">使用 dd 和 cat 命令为 Linux 系统克隆磁盘</a>）</strong></li>\n</ul>\n<h3 id=\"toc_1\">du 命令</h3>\n<p><code>du</code>（disk usage 的简称）是用于查找文件和目录的磁盘使用情况的命令。<code>du</code> 命令在与各种选项一起使用时能以多种格式提供结果。</p>\n<p>下面是一些例子：</p>\n<h4 id=\"toc_2\">1、 得到一个目录下所有子目录的磁盘使用概况</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693eb9443947347964\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ du /home\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693eb9443947347964-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693eb9443947347964-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693eb9443947347964-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">du</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">home</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693eb9443947347964-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/a7080196ba5d69aefcecf7bbf44c9556.jpg\" alt=\"du command\"></p>\n<p>该命令的输出将显示 <code>/home</code> 中的所有文件和目录以及显示块大小。</p>\n<h4 id=\"toc_3\">2、 以人类可读格式也就是 kb、mb 等显示文件/目录大小</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693eb944e353502896\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ du -h /home\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693eb944e353502896-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693eb944e353502896-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693eb944e353502896-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">du</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">home</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693eb944e353502896-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/1b9dd42d7efa627e663eeb719c31051b.jpg\" alt=\"du command\"></p>\n<h4 id=\"toc_4\">3、 目录的总磁盘大小</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693eb9452414265184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ du -s /home\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693eb9452414265184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693eb9452414265184-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693eb9452414265184-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">du</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">home</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693eb9452414265184-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/3d49dd172fc018cabd4747f4db263811.jpg\" alt=\"du command\"></p>\n<p>它是 <code>/home</code> 目录的总大小</p>\n<h3 id=\"toc_5\">df 命令</h3>\n<p>df（disk filesystem 的简称）用于显示 Linux 系统的磁盘利用率。（LCTT 译注：<code>df</code> 可能应该是 disk free 的简称。）</p>\n<p>下面是一些例子。</p>\n<h4 id=\"toc_6\">1、 显示设备名称、总块数、总磁盘空间、已用磁盘空间、可用磁盘空间和文件系统上的挂载点。</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693eb9455761373309\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ df\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693eb9455761373309-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693eb9455761373309-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693eb9455761373309-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">df</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693eb9455761373309-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/ab5724c46d3e98a63c869827c65cd227.jpg\" alt=\"df command\"></p>\n<h4 id=\"toc_7\">2、 人类可读格式的信息</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693eb9459675897737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ df -h\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693eb9459675897737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693eb9459675897737-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693eb9459675897737-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">df</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693eb9459675897737-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/5e54bd24a629aad15d72114b57687e18.jpg\" alt=\"df command\"></p>\n<p>上面的命令以人类可读格式显示信息。</p>\n<h4 id=\"toc_8\">3、 显示特定分区的信息</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693eb945c550358610\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ df -hT /etc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693eb945c550358610-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693eb945c550358610-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693eb945c550358610-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">df</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">hT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">etc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693eb945c550358610-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/5b29e87fdba47b650c6958d569d553c2.jpg\" alt=\"df command\"></p>\n<p><code>-hT</code> 加上目标目录将以可读格式显示 <code>/etc</code> 的信息。</p>\n<p>虽然 <code>du</code> 和 <code>df</code> 命令有更多选项，但是这些例子可以让你初步了解。如果在这里找不到你要找的东西，那么你可以参考有关命令的 man 页面。</p>\n<p>另外，<a href=\"http://linuxtechlab.com/tips-tricks/\"><strong>在这</strong></a>阅读我的其他帖子，在那里我分享了一些其他重要和经常使用的 Linux 命令。</p>\n<p>如往常一样，欢迎你留下评论和疑问，因此在下面留下你的评论和疑问，我会回复你。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113780\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113780votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113780\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"},{"url_object_id": "ab0322e9007276c76fe370fbf4a95a33", "title": "Linux 中的“大内存页”（hugepage）是个什么？", "url": "http://blog.jobbole.com/113782/", "create_date": "2018/03/24", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://kerneltalks.com/services/what-is-huge-pages-in-linux/\">Shrikant Lavhate</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9450-1.html\">Linux中国/DarkSun</a>   </div><blockquote><p>学习 Linux 中的大内存页hugepage。理解什么是“大内存页”，如何进行配置，如何查看当前状态以及如何禁用它。</p></blockquote>\n<p>本文中我们会详细介绍大内存页huge page，让你能够回答：Linux 中的“大内存页”是什么？在 RHEL6、RHEL7、Ubuntu 等 Linux 中，如何启用/禁用“大内存页”？如何查看“大内存页”的当前值？</p>\n<p>首先让我们从“大内存页”的基础知识开始讲起。</p>\n<h3 id=\"toc_1\">Linux 中的“大内存页”是个什么玩意？</h3>\n<p>“大内存页”有助于 Linux 系统进行虚拟内存管理。顾名思义，除了标准的 4KB 大小的页面外，它们还能帮助管理内存中的巨大的页面。使用“大内存页”，你最大可以定义 1GB 的页面大小。</p>\n<p>在系统启动期间，你能用“大内存页”为应用程序预留一部分内存。这部分内存，即被“大内存页”占用的这些存储器永远不会被交换出内存。它会一直保留其中，除非你修改了配置。这会极大地提高像 Oracle 数据库这样的需要海量内存的应用程序的性能。</p>\n<h3 id=\"toc_2\">为什么使用“大内存页”？</h3>\n<p>在虚拟内存管理中，内核维护一个将虚拟内存地址映射到物理地址的表，对于每个页面操作，内核都需要加载相关的映射。如果你的内存页很小，那么你需要加载的页就会很多，导致内核会加载更多的映射表。而这会降低性能。</p>\n<p>使用“大内存页”，意味着所需要的页变少了。从而大大减少由内核加载的映射表的数量。这提高了内核级别的性能最终有利于应用程序的性能。</p>\n<p>简而言之，通过启用“大内存页”，系统具只需要处理较少的页面映射表，从而减少访问/维护它们的开销！</p>\n<h3 id=\"toc_3\">如何配置“大内存页”？</h3>\n<p>运行下面命令来查看当前“大内存页”的详细内容。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebedad207329654\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # grep Huge /proc/meminfo\r\nAnonHugePages:         0 kB\r\nHugePages_Total:       0\r\nHugePages_Free:        0\r\nHugePages_Rsvd:        0\r\nHugePages_Surp:        0\r\nHugepagesize:       2048 kB\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedad207329654-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedad207329654-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedad207329654-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedad207329654-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedad207329654-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedad207329654-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedad207329654-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedad207329654-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebedad207329654-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># grep Huge /proc/meminfo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedad207329654-2\"><span class=\"crayon-v\">AnonHugePages</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kB</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedad207329654-3\"><span class=\"crayon-v\">HugePages_Total</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedad207329654-4\"><span class=\"crayon-v\">HugePages_Free</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedad207329654-5\"><span class=\"crayon-v\">HugePages_Rsvd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedad207329654-6\"><span class=\"crayon-v\">HugePages_Surp</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedad207329654-7\"><span class=\"crayon-v\">Hugepagesize</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">2048</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">kB</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedad207329654-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>从上面输出可以看到，每个页的大小为 2MB（<code>Hugepagesize</code>），并且系统中目前有 <code>0</code> 个“大内存页”（<code>HugePages_Total</code>）。这里“大内存页”的大小可以从 <code>2MB</code> 增加到 <code>1GB</code>。</p>\n<p>运行下面的脚本可以知道系统当前需要多少个巨大页。该脚本取之于 Oracle。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebedb6214062556\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\n#\r\n# hugepages_settings.sh\r\n#\r\n# Linux bash script to compute values for the\r\n# recommended HugePages/HugeTLB configuration\r\n#\r\n# Note: This script does calculation for all shared memory\r\n# segments available when the script is run, no matter it\r\n# is an Oracle RDBMS shared memory segment or not.\r\n# Check for the kernel version\r\nKERN=`uname -r | awk -F. '{ printf(\"%d.%d\\n\",$1,$2); }'`\r\n# Find out the HugePage size\r\nHPG_SZ=`grep Hugepagesize /proc/meminfo | awk {'print $2'}`\r\n# Start from 1 pages to be on the safe side and guarantee 1 free HugePage\r\nNUM_PG=1\r\n# Cumulative number of pages required to handle the running shared memory segments\r\nfor SEG_BYTES in `ipcs -m | awk {'print $5'} | grep \"[0-9][0-9]*\"`\r\ndo\r\n   MIN_PG=`echo \"$SEG_BYTES/($HPG_SZ*1024)\" | bc -q`\r\n   if [ $MIN_PG -gt 0 ]; then\r\n      NUM_PG=`echo \"$NUM_PG+$MIN_PG+1\" | bc -q`\r\n   fi\r\ndone\r\n# Finish with results\r\ncase $KERN in\r\n   '2.4') HUGETLB_POOL=`echo \"$NUM_PG*$HPG_SZ/1024\" | bc -q`;\r\n          echo \"Recommended setting: vm.hugetlb_pool = $HUGETLB_POOL\" ;;\r\n   '2.6' | '3.8' | '3.10' | '4.1' ) echo \"Recommended setting: vm.nr_hugepages = $NUM_PG\" ;;\r\n    *) echo \"Unrecognized kernel version $KERN. Exiting.\" ;;\r\nesac\r\n# End\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedb6214062556-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedb6214062556-33\">33</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-2\"><span class=\"crayon-p\">#</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-3\"><span class=\"crayon-p\"># hugepages_settings.sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-4\"><span class=\"crayon-p\">#</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-5\"><span class=\"crayon-p\"># Linux bash script to compute values for the</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-6\"><span class=\"crayon-p\"># recommended HugePages/HugeTLB configuration</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-7\"><span class=\"crayon-p\">#</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-8\"><span class=\"crayon-p\"># Note: This script does calculation for all shared memory</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-9\"><span class=\"crayon-p\"># segments available when the script is run, no matter it</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-10\"><span class=\"crayon-p\"># is an Oracle RDBMS shared memory segment or not.</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-11\"><span class=\"crayon-p\"># Check for the kernel version</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-12\"><span class=\"crayon-v\">KERN</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">F</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{ printf(\"%d.%d\\n\",$1,$2); }'</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-13\"><span class=\"crayon-p\"># Find out the HugePage size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-14\"><span class=\"crayon-v\">HPG_SZ</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-e\">grep </span><span class=\"crayon-v\">Hugepagesize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">meminfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'print $2'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-15\"><span class=\"crayon-p\"># Start from 1 pages to be on the safe side and guarantee 1 free HugePage</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-16\"><span class=\"crayon-v\">NUM_PG</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-17\"><span class=\"crayon-p\"># Cumulative number of pages required to handle the running shared memory segments</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-18\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SEG_BYTES </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ipcs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'print $5'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"[0-9][0-9]*\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-19\"><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-20\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">MIN_PG</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$SEG_BYTES/($HPG_SZ*1024)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-21\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">MIN_PG</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">gt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">NUM_PG</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$NUM_PG+$MIN_PG+1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-23\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-24\"><span class=\"crayon-v\">done</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-25\"><span class=\"crayon-p\"># Finish with results</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-26\"><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">KERN </span><span class=\"crayon-st\">in</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-27\"><span class=\"crayon-h\">   </span><span class=\"crayon-s\">'2.4'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HUGETLB_POOL</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$NUM_PG*$HPG_SZ/1024\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-28\"><span class=\"crayon-h\">          </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Recommended setting: vm.hugetlb_pool = $HUGETLB_POOL\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-29\"><span class=\"crayon-h\">   </span><span class=\"crayon-s\">'2.6'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3.8'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3.10'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4.1'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Recommended setting: vm.nr_hugepages = $NUM_PG\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Unrecognized kernel version $KERN. Exiting.\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-31\"><span class=\"crayon-v\">esac</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedb6214062556-32\"><span class=\"crayon-p\"># End</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedb6214062556-33\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p>将它以 <code>hugepages_settings.sh</code> 为名保存到 <code>/tmp</code> 中，然后运行之：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebedbb075055117\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # sh /tmp/hugepages_settings.sh\r\nRecommended setting: vm.nr_hugepages = 124\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedbb075055117-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedbb075055117-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedbb075055117-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebedbb075055117-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># sh /tmp/hugepages_settings.sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedbb075055117-2\"><span class=\"crayon-e\">Recommended </span><span class=\"crayon-v\">setting</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nr_hugepages</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">124</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedbb075055117-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>你的输出类似如上结果，只是数字会有一些出入。</p>\n<p>这意味着，你系统需要 124 个每个 2MB 的“大内存页”！若你设置页面大小为 4MB，则结果就变成了 62。你明白了吧？</p>\n<h3 id=\"toc_4\">配置内核中的“大内存页”</h3>\n<p>本文最后一部分内容是配置上面提到的 <a href=\"https://kerneltalks.com/linux/how-to-tune-kernel-parameters-in-linux/\">内核参数 </a> ，然后重新加载。将下面内容添加到 <code>/etc/sysctl.conf</code> 中，然后输入 <code>sysctl -p</code> 命令重新加载配置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebedbf326143284\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvm.nr_hugepages=126\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedbf326143284-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedbf326143284-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebedbf326143284-1\"><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nr_hugepages</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">126</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedbf326143284-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>注意我们这里多加了两个额外的页，因为我们希望在实际需要的页面数量之外多一些额外的空闲页。</p>\n<p>现在，内核已经配置好了，但是要让应用能够使用这些“大内存页”还需要提高内存的使用阀值。新的内存阀值应该为 126 个页 x 每个页 2 MB = 252 MB，也就是 258048 KB。</p>\n<p>你需要编辑 <code>/etc/security/limits.conf</code> 中的如下配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebedc2300650565\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsoft memlock 258048\r\nhard memlock 258048\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedc2300650565-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebedc2300650565-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebedc2300650565-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebedc2300650565-1\"><span class=\"crayon-e\">soft </span><span class=\"crayon-i\">memlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">258048</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebedc2300650565-2\"><span class=\"crayon-e\">hard </span><span class=\"crayon-i\">memlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">258048</span></div><div class=\"crayon-line\" id=\"crayon-5ae2693ebedc2300650565-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>某些情况下，这些设置是在指定应用的文件中配置的，比如 Oracle DB 就是在 <code>/etc/security/limits.d/99-grid-oracle-limits.conf</code> 中配置的。</p>\n<p>这就完成了！你可能还需要重启应用来让应用来使用这些新的巨大页。</p>\n<p>（LCTT 译注：此外原文有误，“透明大内存页”和“大内存页”不同，而且，在 Redhat 系统中，“大内存页” 不是默认启用的，而“透明大内存页”是启用的。因此这个段落删除了。）</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113782\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113782votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113782\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "d7679705b6786b2bb8061b616470a651", "title": "深入学习 Redis（1）：Redis 内存模型", "url": "http://blog.jobbole.com/113789/", "create_date": "2018/03/27", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "3", "comment_nums": 5, "fav_nums": 8, "tags": "IT技术,Redis,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/kismetv/p/8654978.html\">编程迷思</a>   </div><h2>前言</h2>\n<p>Redis是目前最火爆的内存数据库之一，通过在内存中读写数据，大大提高了读写速度，可以说Redis是实现网站高并发不可或缺的一部分。</p>\n<p>我们使用Redis时，会接触Redis的5种对象类型（字符串、哈希、列表、集合、有序集合），丰富的类型是Redis相对于Memcached等的一大优势。在了解Redis的5种对象类型的用法和特点的基础上，进一步了解Redis的内存模型，对Redis的使用有很大帮助，例如：</p>\n<p>1、估算Redis内存使用量。目前为止，内存的使用成本仍然相对较高，使用内存不能无所顾忌；根据需求合理的评估Redis的内存使用量，选择合适的机器配置，可以在满足需求的情况下节约成本。</p>\n<p>2、优化内存占用。了解Redis内存模型可以选择更合适的数据类型和编码，更好的利用Redis内存。</p>\n<p>3、分析解决问题。当Redis出现阻塞、内存占用等问题时，尽快发现导致问题的原因，便于分析解决问题。</p>\n<p>这篇文章主要介绍Redis的内存模型（以3.0为例），包括Redis占用内存的情况及如何查询、不同的对象类型在内存中的编码方式、内存分配器(jemalloc)、简单动态字符串(SDS)、RedisObject等；然后在此基础上介绍几个Redis内存模型的应用。</p>\n<p>在后面的文章中，会陆续介绍关于Redis高可用的内容，包括主从复制、哨兵、集群等等，欢迎关注。</p>\n<p> </p>\n<h2>目录</h2>\n<p><a href=\"#t1\">一、Redis内存统计</a></p>\n<p><a href=\"#t2\">二、Redis内存划分</a></p>\n<p><a href=\"#t21\">1、数据（或者称为对象）</a></p>\n<p><a href=\"#t22\">2、进程本身运行需要的内存</a></p>\n<p><a href=\"#t23\">3、缓冲内存</a></p>\n<p><a href=\"#t24\">4、内存碎片</a></p>\n<p><a href=\"#t3\">三、Redis数据存储的细节</a></p>\n<p><a href=\"#t31\">1、概述</a></p>\n<p><a href=\"#t32\">2、jemalloc</a></p>\n<p><a href=\"#t33\">3、redisObject</a></p>\n<p><a href=\"#t34\">4、SDS</a></p>\n<p><a href=\"#t4\">四、Redis的对象类型与内部编码</a></p>\n<p><a href=\"#t41\">1、字符串</a></p>\n<p><a href=\"#t42\">2、列表</a></p>\n<p><a href=\"#t43\">3、哈希</a></p>\n<p><a href=\"#t44\">4、集合</a></p>\n<p><a href=\"#t45\">5、有序集合</a></p>\n<p><a href=\"#t5\">五、应用举例</a></p>\n<p><a href=\"#t51\">1、估算Redis内存使用量</a></p>\n<p><a href=\"#t52\">2、优化内存占用</a></p>\n<p><a href=\"#t53\">3、关注内存碎片率</a></p>\n<p><a href=\"#t6\">六、参考文献</a></p>\n<h1><a name=\"t1\"></a>一、Redis内存统计</h1>\n<p>工欲善其事必先利其器，在说明Redis内存之前首先说明如何统计Redis使用内存的情况。</p>\n<p>在客户端通过redis-cli连接服务器后（后面如无特殊说明，客户端一律使用redis-cli），通过info命令可以查看内存使用情况：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b38b5770301829\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninfo memory</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38b5770301829-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b38b5770301829-1\"><span class=\"crayon-e\">info </span><span class=\"crayon-v\">memory</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n\n</div>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/8c3d1b1af4dea80d14b73aad3232d6c2.png\" alt=\"\"></p>\n<p>其中，info命令可以显示redis服务器的许多信息，包括服务器基本信息、CPU、内存、持久化、客户端连接信息等等；memory是参数，表示只显示内存相关的信息。</p>\n<p>返回结果中比较重要的几个说明如下：</p>\n<p>（1）<strong>used_memory</strong><strong>：</strong>Redis分配器分配的内存总量（单位是字节），包括使用的虚拟内存（即swap）；Redis分配器后面会介绍。used_memory_human只是显示更友好。</p>\n<p>（2）<strong>used_memory_rss</strong><strong>：</strong>Redis进程占据操作系统的内存（单位是字节），与top及ps命令看到的值是一致的；除了分配器分配的内存之外，used_memory_rss还包括进程运行本身需要的内存、内存碎片等，但是不包括虚拟内存。</p>\n<p>因此，used_memory和used_memory_rss，前者是从Redis角度得到的量，后者是从操作系统角度得到的量。二者之所以有所不同，一方面是因为内存碎片和Redis进程运行需要占用内存，使得前者可能比后者小，另一方面虚拟内存的存在，使得前者可能比后者大。</p>\n<p>由于在实际应用中，Redis的数据量会比较大，此时进程运行占用的内存与Redis数据量和内存碎片相比，都会小得多；因此used_memory_rss和used_memory的比例，便成了衡量Redis内存碎片率的参数；这个参数就是mem_fragmentation_ratio。</p>\n<p>（3）<strong>mem_fragmentation_ratio</strong><strong>：</strong>内存碎片比率，该值是used_memory_rss / used_memory的比值。</p>\n<p>mem_fragmentation_ratio一般大于1，且该值越大，内存碎片比例越大。mem_fragmentation_ratio&lt;1，说明Redis使用了虚拟内存，由于虚拟内存的媒介是磁盘，比内存速度要慢很多，当这种情况出现时，应该及时排查，如果内存不足应该及时处理，如增加Redis节点、增加Redis服务器的内存、优化应用等。</p>\n<p>一般来说，mem_fragmentation_ratio在1.03左右是比较健康的状态（对于jemalloc来说）；上面截图中的mem_fragmentation_ratio值很大，是因为还没有向Redis中存入数据，Redis进程本身运行的内存使得used_memory_rss 比used_memory大得多。</p>\n<p>（4）<strong>mem_allocator</strong><strong>：</strong>Redis使用的内存分配器，在编译时指定；可以是 libc 、jemalloc或者tcmalloc，默认是jemalloc；截图中使用的便是默认的jemalloc。</p>\n<h1><a name=\"t2\"></a>二、Redis内存划分</h1>\n<p>Redis作为内存数据库，在内存中存储的内容主要是数据（键值对）；通过前面的叙述可以知道，除了数据以外，Redis的其他部分也会占用内存。</p>\n<p>Redis的内存占用主要可以划分为以下几个部分：</p>\n<h2><a name=\"t21\"></a>1、数据</h2>\n<p>作为数据库，数据是最主要的部分；这部分占用的内存会统计在used_memory中。</p>\n<p>Redis使用键值对存储数据，其中的值（对象）包括5种类型，即字符串、哈希、列表、集合、有序集合。这5种类型是Redis对外提供的，实际上，在Redis内部，每种类型可能有2种或更多的内部编码实现；此外，Redis在存储对象时，并不是直接将数据扔进内存，而是会对对象进行各种包装：如redisObject、SDS等；这篇文章后面将重点介绍Redis中数据存储的细节。</p>\n<h2><a name=\"t22\"></a>2、进程本身运行需要的内存</h2>\n<p>Redis主进程本身运行肯定需要占用内存，如代码、常量池等等；这部分内存大约几兆，在大多数生产环境中与Redis数据占用的内存相比可以忽略。这部分内存不是由jemalloc分配，因此不会统计在used_memory中。</p>\n<p>补充说明：除了主进程外，Redis创建的子进程运行也会占用内存，如Redis执行AOF、RDB重写时创建的子进程。当然，这部分内存不属于Redis进程，也不会统计在used_memory和used_memory_rss中。</p>\n<h2><a name=\"t23\"></a>3、缓冲内存</h2>\n<p>缓冲内存包括客户端缓冲区、复制积压缓冲区、AOF缓冲区等；其中，客户端缓冲存储客户端连接的输入输出缓冲；复制积压缓冲用于部分复制功能；AOF缓冲区用于在进行AOF重写时，保存最近的写入命令。在了解相应功能之前，不需要知道这些缓冲的细节；这部分内存由jemalloc分配，因此会统计在used_memory中。</p>\n<h2><a name=\"t24\"></a>4、内存碎片</h2>\n<p>内存碎片是Redis在分配、回收物理内存过程中产生的。例如，如果对数据的更改频繁，而且数据之间的大小相差很大，可能导致redis释放的空间在物理内存中并没有释放，但redis又无法有效利用，这就形成了内存碎片。内存碎片不会统计在used_memory中。</p>\n<p>内存碎片的产生与对数据进行的操作、数据的特点等都有关；此外，与使用的内存分配器也有关系：如果内存分配器设计合理，可以尽可能的减少内存碎片的产生。后面将要说到的jemalloc便在控制内存碎片方面做的很好。</p>\n<p>如果Redis服务器中的内存碎片已经很大，可以通过安全重启的方式减小内存碎片：因为重启之后，Redis重新从备份文件中读取数据，在内存中进行重排，为每个数据重新选择合适的内存单元，减小内存碎片。</p>\n<h1><a name=\"t3\"></a>三、Redis数据存储的细节</h1>\n<h2><a name=\"t31\"></a>1、概述</h2>\n<p>关于Redis数据存储的细节，涉及到内存分配器（如jemalloc）、简单动态字符串（SDS）、5种对象类型及内部编码、redisObject。在讲述具体内容之前，先说明一下这几个概念之间的关系。</p>\n<p>下图是执行set hello world时，所涉及到的数据模型。</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/e68530a523ccf27f161597f21994f842.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：https://searchdatabase.techtarget.com.cn/7-20218/</p>\n<p>（1）dictEntry：Redis是Key-Value数据库，因此对每个键值对都会有一个dictEntry，里面存储了指向Key和Value的指针；next指向下一个dictEntry，与本Key-Value无关。</p>\n<p>（2）Key：图中右上角可见，Key（”hello”）并不是直接以字符串存储，而是存储在SDS结构中。</p>\n<p>（3）redisObject：Value(“world”)既不是直接以字符串存储，也不是像Key一样直接存储在SDS中，而是存储在redisObject中。实际上，不论Value是5种类型的哪一种，都是通过redisObject来存储的；而redisObject中的type字段指明了Value对象的类型，ptr字段则指向对象所在的地址。不过可以看出，字符串对象虽然经过了redisObject的包装，但仍然需要通过SDS存储。</p>\n<p>实际上，redisObject除了type和ptr字段以外，还有其他字段图中没有给出，如用于指定对象内部编码的字段；后面会详细介绍。</p>\n<p>（4）jemalloc：无论是DictEntry对象，还是redisObject、SDS对象，都需要内存分配器（如jemalloc）分配内存进行存储。以DictEntry对象为例，有3个指针组成，在64位机器下占24个字节，jemalloc会为它分配32字节大小的内存单元。</p>\n<p>下面来分别介绍jemalloc、redisObject、SDS、对象类型及内部编码。</p>\n<h2><a name=\"t32\"></a>2、jemalloc</h2>\n<p>Redis在编译时便会指定内存分配器；内存分配器可以是 libc 、jemalloc或者tcmalloc，默认是jemalloc。</p>\n<p>jemalloc作为Redis的默认内存分配器，在减小内存碎片方面做的相对比较好。jemalloc在64位系统中，将内存空间划分为小、大、巨大三个范围；每个范围内又划分了许多小的内存块单位；当Redis存储数据时，会选择大小最合适的内存块进行存储。</p>\n<p>jemalloc划分的内存单元如下图所示：</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/34ac5c647e31f0ab02036d78ee63f248.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：http://blog.csdn.net/zhengpeitao/article/details/76573053</p>\n<p>例如，如果需要存储大小为130字节的对象，jemalloc会将其放入160字节的内存单元中。</p>\n<h2><a name=\"t33\"></a>3、redisObject</h2>\n<p>前面说到，Redis对象有5种类型；无论是哪种类型，Redis都不会直接存储，而是通过redisObject对象进行存储。</p>\n<p>redisObject对象非常重要，Redis对象的类型、内部编码、内存回收、共享对象等功能，都需要redisObject支持，下面将通过redisObject的结构来说明它是如何起作用的。</p>\n<p>redisObject的定义如下（不同版本的Redis可能稍稍有所不同）：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b38c6483433479\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct redisObject {\r\n　　unsigned type:4;\r\n　　unsigned encoding:4;\r\n　　unsigned lru:REDIS_LRU_BITS; /* lru time (relative to server.lruclock) */\r\n　　int refcount;\r\n　　void *ptr;\r\n} robj;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38c6483433479-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38c6483433479-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38c6483433479-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38c6483433479-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38c6483433479-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38c6483433479-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38c6483433479-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b38c6483433479-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redisObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38c6483433479-2\">　　<span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38c6483433479-3\">　　<span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38c6483433479-4\">　　<span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lru</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">REDIS_LRU_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* lru time (relative to server.lruclock) */</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38c6483433479-5\">　　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">refcount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38c6483433479-6\">　　<span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">ptr</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38c6483433479-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">robj</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>redisObject的每个字段的含义和作用如下：</p>\n<h3>（1）type</h3>\n<p>type字段表示对象的类型，占4个比特；目前包括REDIS_STRING(字符串)、REDIS_LIST (列表)、REDIS_HASH(哈希)、REDIS_SET(集合)、REDIS_ZSET(有序集合)。</p>\n<p>当我们执行type命令时，便是通过读取RedisObject的type字段获得对象的类型；如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/43d3539f6d0124bd1581566616b64f97.png\" alt=\"\"></p>\n<h3>（2）encoding</h3>\n<p>encoding表示对象的内部编码，占4个比特。</p>\n<p>对于Redis支持的每种类型，都有至少两种内部编码，例如对于字符串，有int、embstr、raw三种编码。通过encoding属性，Redis可以根据不同的使用场景来为对象设置不同的编码，大大提高了Redis的灵活性和效率。以列表对象为例，有压缩列表和双端链表两种编码方式；如果列表中的元素较少，Redis倾向于使用压缩列表进行存储，因为压缩列表占用内存更少，而且比双端链表可以更快载入；当列表对象元素较多时，压缩列表就会转化为更适合存储大量元素的双端链表。</p>\n<p>通过object encoding命令，可以查看对象采用的编码方式，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/f6339c50fe0f4a46f0059b2f35231e23.png\" alt=\"\"></p>\n<p>5种对象类型对应的编码方式以及使用条件，将在后面介绍。</p>\n<h3>（3）lru</h3>\n<p>lru记录的是对象最后一次被命令程序访问的时间，占据的比特数不同的版本有所不同（如4.0版本占24比特，2.6版本占22比特）。</p>\n<p>通过对比lru时间与当前时间，可以计算某个对象的空转时间；object idletime命令可以显示该空转时间（单位是秒）。object idletime命令的一个特殊之处在于它不改变对象的lru值。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/12d2cec6e14b158f69fda46c75601482.png\" alt=\"\"></p>\n<p>lru值除了通过object idletime命令打印之外，还与Redis的内存回收有关系：如果Redis打开了maxmemory选项，且内存回收算法选择的是volatile-lru或allkeys—lru，那么当Redis内存占用超过maxmemory指定的值时，Redis会优先选择空转时间最长的对象进行释放。</p>\n<h3>（4）refcount</h3>\n<p><strong>refcount</strong><strong>与共享对象</strong></p>\n<p>refcount记录的是该对象被引用的次数，类型为整型。refcount的作用，主要在于对象的引用计数和内存回收。当创建新对象时，refcount初始化为1；当有新程序使用该对象时，refcount加1；当对象不再被一个新程序使用时，refcount减1；当refcount变为0时，对象占用的内存会被释放。</p>\n<p>Redis中被多次使用的对象(refcount&gt;1)，称为共享对象。Redis为了节省内存，当有一些对象重复出现时，新的程序不会创建新的对象，而是仍然使用原来的对象。这个被重复使用的对象，就是共享对象。目前共享对象仅支持整数值的字符串对象。</p>\n<p><strong>共享对象的具体实现</strong></p>\n<p>Redis的共享对象目前只支持整数值的字符串对象。之所以如此，实际上是对内存和CPU（时间）的平衡：共享对象虽然会降低内存消耗，但是判断两个对象是否相等却需要消耗额外的时间。对于整数值，判断操作复杂度为O(1)；对于普通字符串，判断复杂度为O(n)；而对于哈希、列表、集合和有序集合，判断的复杂度为O(n^2)。</p>\n<p>虽然共享对象只能是整数值的字符串对象，但是5种类型都可能使用共享对象（如哈希、列表等的元素可以使用）。</p>\n<p>就目前的实现来说，Redis服务器在初始化时，会创建10000个字符串对象，值分别是0~9999的整数值；当Redis需要使用值为0~9999的字符串对象时，可以直接使用这些共享对象。10000这个数字可以通过调整参数REDIS_SHARED_INTEGERS（4.0中是OBJ_SHARED_INTEGERS）的值进行改变。</p>\n<p>共享对象的引用次数可以通过object refcount命令查看，如下图所示。命令执行的结果页佐证了只有0~9999之间的整数会作为共享对象。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/da89cea4d30533c989b73b07efd27317.png\" alt=\"\"></p>\n<h3>（5）ptr</h3>\n<p>ptr指针指向具体的数据，如前面的例子中，set hello world，ptr指向包含字符串world的SDS。</p>\n<h3>（6）总结</h3>\n<p>综上所述，redisObject的结构与对象类型、编码、内存回收、共享对象都有关系；一个redisObject对象的大小为16字节：</p>\n<p>4bit+4bit+24bit+4Byte+8Byte=16Byte。</p>\n<h2><a name=\"t34\"></a>4、SDS</h2>\n<p>Redis没有直接使用C字符串(即以空字符’\\0’结尾的字符数组)作为默认的字符串表示，而是使用了SDS。SDS是简单动态字符串(Simple Dynamic String)的缩写。</p>\n<h3>（1）SDS结构</h3>\n<p>sds的结构如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b38d2871898709\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstruct sdshdr { \r\n    int len;\r\n    int free;\r\n    char buf[];\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38d2871898709-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38d2871898709-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38d2871898709-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38d2871898709-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38d2871898709-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b38d2871898709-1\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdshdr</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38d2871898709-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38d2871898709-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38d2871898709-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38d2871898709-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>其中，buf表示字节数组，用来存储字符串；len表示buf已使用的长度，free表示buf未使用的长度。下面是两个例子。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/2116fb2f5ea2170e8e9df0032c1fad4d.png\" alt=\"\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/951c87cee3bcd2599fcdddac9167d232.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：《Redis设计与实现》</p>\n<p>通过SDS的结构可以看出，buf数组的长度=free+len+1（其中1表示字符串结尾的空字符）；所以，一个SDS结构占据的空间为：free所占长度+len所占长度+ buf数组的长度=4+4+free+len+1=free+len+9。</p>\n<h3>（2）SDS与C字符串的比较</h3>\n<p>SDS在C字符串的基础上加入了free和len字段，带来了很多好处：</p>\n<ul>\n<li>获取字符串长度：SDS是O(1)，C字符串是O(n)</li>\n<li>缓冲区溢出：使用C字符串的API时，如果字符串长度增加（如strcat操作）而忘记重新分配内存，很容易造成缓冲区的溢出；而SDS由于记录了长度，相应的API在可能造成缓冲区溢出时会自动重新分配内存，杜绝了缓冲区溢出。</li>\n<li>修改字符串时内存的重分配：对于C字符串，如果要修改字符串，必须要重新分配内存（先释放再申请），因为如果没有重新分配，字符串长度增大时会造成内存缓冲区溢出，字符串长度减小时会造成内存泄露。而对于SDS，由于可以记录len和free，因此解除了字符串长度和空间数组长度之间的关联，可以在此基础上进行优化：空间预分配策略（即分配内存时比实际需要的多）使得字符串长度增大时重新分配内存的概率大大减小；惰性空间释放策略使得字符串长度减小时重新分配内存的概率大大减小。</li>\n<li>存取二进制数据：SDS可以，C字符串不可以。因为C字符串以空字符作为字符串结束的标识，而对于一些二进制文件（如图片等），内容可能包括空字符串，因此C字符串无法正确存取；而SDS以字符串长度len来作为字符串结束标识，因此没有这个问题。</li>\n</ul>\n<p>此外，由于SDS中的buf仍然使用了C字符串（即以’\\0’结尾），因此SDS可以使用C字符串库中的部分函数；但是需要注意的是，只有当SDS用来存储文本数据时才可以这样使用，在存储二进制数据时则不行（’\\0’不一定是结尾）。</p>\n<h3>（3）SDS与C字符串的应用</h3>\n<p>Redis在存储对象时，一律使用SDS代替C字符串。例如set hello world命令，hello和world都是以SDS的形式存储的。而sadd myset member1 member2 member3命令，不论是键（”myset”），还是集合中的元素（”member1”、 ”member2”和”member3”），都是以SDS的形式存储。除了存储对象，SDS还用于存储各种缓冲区。</p>\n<p>只有在字符串不会改变的情况下，如打印日志时，才会使用C字符串。</p>\n<h1><a name=\"t4\"></a>四、Redis的对象类型与内部编码</h1>\n<p>前面已经说过，Redis支持5种对象类型，而每种结构都有至少两种编码；这样做的好处在于：一方面接口与实现分离，当需要增加或改变内部编码时，用户使用不受影响，另一方面可以根据不同的应用场景切换内部编码，提高效率。</p>\n<p>Redis各种对象类型支持的内部编码如下图所示(图中版本是Redis3.0，Redis后面版本中又增加了内部编码，略过不提；本章所介绍的内部编码都是基于3.0的)：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/28593c0d23953ad296b17967fa129871.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：《Redis设计与实现》</p>\n<p>关于Redis内部编码的转换，都符合以下规律：<strong>编码转换在</strong><strong>Redis</strong><strong>写入数据时完成，且转换过程不可逆，只能从小内存编码向大内存编码转换。</strong></p>\n<h2><a name=\"t41\"></a>1、字符串</h2>\n<h3>（1）概况</h3>\n<p>字符串是最基础的类型，因为所有的键都是字符串类型，且字符串之外的其他几种复杂类型的元素也是字符串。</p>\n<p>字符串长度不能超过512MB。</p>\n<h3>（2）内部编码</h3>\n<p>字符串类型的内部编码有3种，它们的应用场景如下：</p>\n<ul>\n<li>int：8个字节的长整型。字符串值是整型时，这个值使用long整型表示。</li>\n<li>embstr：&lt;=39字节的字符串。embstr与raw都使用redisObject和sds保存数据，区别在于，embstr的使用只分配一次内存空间（因此redisObject和sds是连续的），而raw需要分配两次内存空间（分别为redisObject和sds分配空间）。因此与raw相比，embstr的好处在于创建时少分配一次空间，删除时少释放一次空间，以及对象的所有数据连在一起，寻找方便。而embstr的坏处也很明显，如果字符串的长度增加需要重新分配内存时，整个redisObject和sds都需要重新分配空间，因此redis中的embstr实现为只读。</li>\n<li>raw：大于39个字节的字符串</li>\n</ul>\n<p>示例如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/671a709f884a9584f067c2dc7d588b59.png\" alt=\"\"></p>\n<p>embstr和raw进行区分的长度，是39；是因为redisObject的长度是16字节，sds的长度是9+字符串长度；因此当字符串长度是39时，embstr的长度正好是16+9+39=64，jemalloc正好可以分配64字节的内存单元。</p>\n<h3>（3）编码转换</h3>\n<p>当int数据不再是整数，或大小超过了long的范围时，自动转化为raw。</p>\n<p>而对于embstr，由于其实现是只读的，因此在对embstr对象进行修改时，都会先转化为raw再进行修改，因此，只要是修改embstr对象，修改后的对象一定是raw的，无论是否达到了39个字节。示例如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/46b394cc882ed056fdee8caf1237e4da.png\" alt=\"\"></p>\n<h2><a name=\"t42\"></a>2、列表</h2>\n<h3>（1）概况</h3>\n<p>列表（list）用来存储多个有序的字符串，每个字符串称为元素；一个列表可以存储2^32-1个元素。Redis中的列表支持两端插入和弹出，并可以获得指定位置（或范围）的元素，可以充当数组、队列、栈等。</p>\n<h3>（2）内部编码</h3>\n<p>列表的内部编码可以是压缩列表（ziplist）或双端链表（linkedlist）。</p>\n<p>双端链表：由一个list结构和多个listNode结构组成；典型结构如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/dc15e787d4b13a9944b821568afae17c.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：《Redis设计与实现》</p>\n<p>通过图中可以看出，双端链表同时保存了表头指针和表尾指针，并且每个节点都有指向前和指向后的指针；链表中保存了列表的长度；dup、free和match为节点值设置类型特定函数，所以链表可以用于保存各种不同类型的值。而链表中每个节点指向的是type为字符串的redisObject。</p>\n<p>压缩列表：压缩列表是Redis为了节约内存而开发的，是由一系列特殊编码的<strong>连续内存块</strong>(而不是像双端链表一样每个节点是指针)组成的顺序型数据结构；具体结构相对比较复杂，略。与双端链表相比，压缩列表可以节省内存空间，但是进行修改或增删操作时，复杂度较高；因此当节点数量较少时，可以使用压缩列表；但是节点数量多时，还是使用双端链表划算。</p>\n<p>压缩列表不仅用于实现列表，也用于实现哈希、有序列表；使用非常广泛。</p>\n<h3>（3）编码转换</h3>\n<p>只有同时满足下面两个条件时，才会使用压缩列表：列表中元素数量小于512个；列表中所有字符串对象都不足64字节。如果有一个条件不满足，则使用双端列表；且编码只可能由压缩列表转化为双端链表，反方向则不可能。</p>\n<p>下图展示了列表编码转换的特点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/aeea9b05c5e09cae19d2ee9ed2875285.png\" alt=\"\"></p>\n<p>其中，单个字符串不能超过64字节，是为了便于统一分配每个节点的长度；这里的64字节是指字符串的长度，不包括SDS结构，因为压缩列表使用连续、定长内存块存储字符串，不需要SDS结构指明长度。后面提到压缩列表，也会强调长度不超过64字节，原理与这里类似。</p>\n<h2><a name=\"t43\"></a>3、哈希</h2>\n<h3>（1）概况</h3>\n<p>哈希（作为一种数据结构），不仅是redis对外提供的5种对象类型的一种（与字符串、列表、集合、有序结合并列），也是Redis作为Key-Value数据库所使用的数据结构。为了说明的方便，在本文后面当使用“内层的哈希”时，代表的是redis对外提供的5种对象类型的一种；使用“外层的哈希”代指Redis作为Key-Value数据库所使用的数据结构。</p>\n<h3>（2）内部编码</h3>\n<p>内层的哈希使用的内部编码可以是压缩列表（ziplist）和哈希表（hashtable）两种；Redis的外层的哈希则只使用了hashtable。</p>\n<p>压缩列表前面已介绍。与哈希表相比，压缩列表用于元素个数少、元素长度小的场景；其优势在于集中存储，节省空间；同时，虽然对于元素的操作复杂度也由O(n)变为了O(1)，但由于哈希中元素数量较少，因此操作的时间并没有明显劣势。</p>\n<p>hashtable：一个hashtable由1个dict结构、2个dictht结构、1个dictEntry指针数组（称为bucket）和多个dictEntry结构组成。</p>\n<p>正常情况下（即hashtable没有进行rehash时）各部分关系如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/bade6592c75a4d693f8269dd3a9c5d85.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片改编自：《Redis设计与实现》</p>\n<p>下面从底层向上依次介绍各个部分：</p>\n<p><strong>dictEntry</strong></p>\n<p>dictEntry结构用于保存键值对，结构定义如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b38e1810011933\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct dictEntry{\r\n    void *key;\r\n    union{\r\n        void *val;\r\n        uint64_tu64;\r\n        int64_ts64;\r\n    }v;\r\n    struct dictEntry *next;\r\n}dictEntry;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38e1810011933-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38e1810011933-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38e1810011933-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38e1810011933-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38e1810011933-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38e1810011933-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38e1810011933-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38e1810011933-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38e1810011933-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b38e1810011933-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dictEntry</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38e1810011933-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38e1810011933-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">union</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38e1810011933-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38e1810011933-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">uint64_tu64</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38e1810011933-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">int64_ts64</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38e1810011933-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38e1810011933-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">dictEntry *</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38e1810011933-9\"><span class=\"crayon-sy\">}</span><span class=\"crayon-v\">dictEntry</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>其中，各个属性的功能如下：</p>\n<ul>\n<li>key：键值对中的键；</li>\n<li>val：键值对中的值，使用union(即共用体)实现，存储的内容既可能是一个指向值的指针，也可能是64位整型，或无符号64位整型；</li>\n<li>next：指向下一个dictEntry，用于解决哈希冲突问题</li>\n</ul>\n<p>在64位系统中，一个dictEntry对象占24字节（key/val/next各占8字节）。</p>\n<p><strong>bucket</strong></p>\n<p>bucket是一个数组，数组的每个元素都是指向dictEntry结构的指针。redis中bucket数组的大小计算规则如下：大于dictEntry的、最小的2^n；例如，如果有1000个dictEntry，那么bucket大小为1024；如果有1500个dictEntry，则bucket大小为2048。</p>\n<p><strong>dictht</strong></p>\n<p>dictht结构如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b38ed581353157\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct dictht{\r\n    dictEntry **table;\r\n    unsigned long size;\r\n    unsigned long sizemask;\r\n    unsigned long used;\r\n}dictht;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38ed581353157-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38ed581353157-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38ed581353157-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38ed581353157-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38ed581353157-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38ed581353157-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b38ed581353157-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dictht</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38ed581353157-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">dictEntry *</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38ed581353157-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38ed581353157-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sizemask</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38ed581353157-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38ed581353157-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-v\">dictht</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>其中，各个属性的功能说明如下：</p>\n<ul>\n<li>table属性是一个指针，指向bucket；</li>\n<li>size属性记录了哈希表的大小，即bucket的大小；</li>\n<li>used记录了已使用的dictEntry的数量；</li>\n<li>sizemask属性的值总是为size-1，这个属性和哈希值一起决定一个键在table中存储的位置。</li>\n</ul>\n<p><strong>dict</strong></p>\n<p>一般来说，通过使用dictht和dictEntry结构，便可以实现普通哈希表的功能；但是Redis的实现中，在dictht结构的上层，还有一个dict结构。下面说明dict结构的定义及作用。</p>\n<p>dict结构如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b38f1238179543\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct dict{\r\n    dictType *type;\r\n    void *privdata;\r\n    dictht ht[2];\r\n    int trehashidx;\r\n} dict;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38f1238179543-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38f1238179543-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38f1238179543-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38f1238179543-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38f1238179543-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38f1238179543-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b38f1238179543-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dict</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38f1238179543-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">dictType *</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38f1238179543-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">privdata</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38f1238179543-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">dictht </span><span class=\"crayon-v\">ht</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38f1238179543-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trehashidx</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38f1238179543-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dict</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>其中，type属性和privdata属性是为了适应不同类型的键值对，用于创建多态字典。</p>\n<p>ht属性和trehashidx属性则用于rehash，即当哈希表需要扩展或收缩时使用。ht是一个包含两个项的数组，每项都指向一个dictht结构，这也是Redis的哈希会有1个dict、2个dictht结构的原因。通常情况下，所有的数据都是存在放dict的ht[0]中，ht[1]只在rehash的时候使用。dict进行rehash操作的时候，将ht[0]中的所有数据rehash到ht[1]中。然后将ht[1]赋值给ht[0]，并清空ht[1]。</p>\n<p>因此，Redis中的哈希之所以在dictht和dictEntry结构之外还有一个dict结构，一方面是为了适应不同类型的键值对，另一方面是为了rehash。</p>\n<h3>（3）编码转换</h3>\n<p>如前所述，Redis中内层的哈希既可能使用哈希表，也可能使用压缩列表。</p>\n<p>只有同时满足下面两个条件时，才会使用压缩列表：哈希中元素数量小于512个；哈希中所有键值对的键和值字符串长度都小于64字节。如果有一个条件不满足，则使用哈希表；且编码只可能由压缩列表转化为哈希表，反方向则不可能。</p>\n<p>下图展示了Redis内层的哈希编码转换的特点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/0a98910371a2157072c25fcf2b7f6784.png\" alt=\"\"></p>\n<h2><a name=\"t44\"></a>4、集合</h2>\n<h3>（1）概况</h3>\n<p>集合（set）与列表类似，都是用来保存多个字符串，但集合与列表有两点不同：集合中的元素是无序的，因此不能通过索引来操作元素；集合中的元素不能有重复。</p>\n<p>一个集合中最多可以存储2^32-1个元素；除了支持常规的增删改查，Redis还支持多个集合取交集、并集、差集。</p>\n<h3>（2）内部编码</h3>\n<p>集合的内部编码可以是整数集合（intset）或哈希表（hashtable）。</p>\n<p>哈希表前面已经讲过，这里略过不提；需要注意的是，集合在使用哈希表时，值全部被置为null。</p>\n<p>整数集合的结构定义如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b38f8187429983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct intset{\r\n    uint32_t encoding;\r\n    uint32_t length;\r\n    int8_t contents[];\r\n} intset;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38f8187429983-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38f8187429983-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38f8187429983-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38f8187429983-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38f8187429983-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b38f8187429983-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">intset</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38f8187429983-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint32_t </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38f8187429983-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint32_t </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38f8187429983-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">int8_t </span><span class=\"crayon-v\">contents</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38f8187429983-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">intset</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>其中，encoding代表contents中存储内容的类型，虽然contents（存储集合中的元素）是int8_t类型，但实际上其存储的值是int16_t、int32_t或int64_t，具体的类型便是由encoding决定的；length表示元素个数。</p>\n<p>整数集合适用于集合所有元素都是整数且集合元素数量较小的时候，与哈希表相比，整数集合的优势在于集中存储，节省空间；同时，虽然对于元素的操作复杂度也由O(n)变为了O(1)，但由于集合数量较少，因此操作的时间并没有明显劣势。</p>\n<h3>（3）编码转换</h3>\n<p>只有同时满足下面两个条件时，集合才会使用整数集合：集合中元素数量小于512个；集合中所有元素都是整数值。如果有一个条件不满足，则使用哈希表；且编码只可能由整数集合转化为哈希表，反方向则不可能。</p>\n<p>下图展示了集合编码转换的特点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/c5dcfed49dff9c771a6929455d548f81.png\" alt=\"\"></p>\n<h2><a name=\"t45\"></a>5、有序集合</h2>\n<h3>（1）概况</h3>\n<p>有序集合与集合一样，元素都不能重复；但与集合不同的是，有序集合中的元素是有顺序的。与列表使用索引下标作为排序依据不同，有序集合为每个元素设置一个分数（score）作为排序依据。</p>\n<h3>（2）内部编码</h3>\n<p>有序集合的内部编码可以是压缩列表（ziplist）或跳跃表（skiplist）。ziplist在列表和哈希中都有使用，前面已经讲过，这里略过不提。</p>\n<p>跳跃表是一种有序数据结构，通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的。除了跳跃表，实现有序数据结构的另一种典型实现是平衡树；大多数情况下，跳跃表的效率可以和平衡树媲美，且跳跃表实现比平衡树简单很多，因此redis中选用跳跃表代替平衡树。跳跃表支持平均O(logN)、最坏O(N)的复杂点进行节点查找，并支持顺序操作。Redis的跳跃表实现由zskiplist和zskiplistNode两个结构组成：前者用于保存跳跃表信息（如头结点、尾节点、长度等），后者用于表示跳跃表节点。具体结构相对比较复杂，略。</p>\n<h3>（3）编码转换</h3>\n<p>只有同时满足下面两个条件时，才会使用压缩列表：有序集合中元素数量小于128个；有序集合中所有成员长度都不足64字节。如果有一个条件不满足，则使用跳跃表；且编码只可能由压缩列表转化为跳跃表，反方向则不可能。</p>\n<p>下图展示了有序集合编码转换的特点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/ec94bc8c186973c1318a5c439729eacb.png\" alt=\"\"></p>\n<h1><a name=\"t5\"></a>五、应用举例</h1>\n<p>了解Redis的内存模型之后，下面通过几个例子说明其应用。</p>\n<h2><a name=\"t51\"></a>1、估算Redis内存使用量</h2>\n<p>要估算redis中的数据占据的内存大小，需要对redis的内存模型有比较全面的了解，包括前面介绍的hashtable、sds、redisobject、各种对象类型的编码方式等。</p>\n<p>下面以最简单的字符串类型来进行说明。</p>\n<p>假设有90000个键值对，每个key的长度是7个字节，每个value的长度也是7个字节（且key和value都不是整数）；下面来估算这90000个键值对所占用的空间。在估算占据空间之前，首先可以判定字符串类型使用的编码方式：embstr。</p>\n<p>90000个键值对占据的内存空间主要可以分为两部分：一部分是90000个dictEntry占据的空间；一部分是键值对所需要的bucket空间。</p>\n<p>每个dictEntry占据的空间包括：</p>\n<p>1)       一个dictEntry，24字节，jemalloc会分配32字节的内存块</p>\n<p>2)       一个key，7字节，所以SDS(key)需要7+9=16个字节，jemalloc会分配16字节的内存块</p>\n<p>3)       一个redisObject，16字节，jemalloc会分配16字节的内存块</p>\n<p>4)       一个value，7字节，所以SDS(value)需要7+9=16个字节，jemalloc会分配16字节的内存块</p>\n<p>5)       综上，一个dictEntry需要32+16+16+16=80个字节。</p>\n<p>bucket空间：bucket数组的大小为大于90000的最小的2^n，是131072；每个bucket元素为8字节（因为64位系统中指针大小为8字节）。</p>\n<p>因此，可以估算出这90000个键值对占据的内存大小为：90000*80 + 131072*8 = 8248576。</p>\n<p>下面写个程序在redis中验证一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b38fe176185514\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class RedisTest {\r\n \r\n　　public static Jedis jedis = new Jedis(\"localhost\", 6379);\r\n \r\n　　public static void main(String[] args) throws Exception{\r\n　　　　Long m1 = Long.valueOf(getMemory());\r\n　　　　insertData();\r\n　　　　Long m2 = Long.valueOf(getMemory());\r\n　　　　System.out.println(m2 - m1);\r\n　　}\r\n \r\n　　public static void insertData(){\r\n　　　　for(int i = 10000; i &lt; 100000; i++){\r\n　　　　　　jedis.set(\"aa\" + i, \"aa\" + i); //key和value长度都是7字节，且不是整数\r\n　　　　}\r\n　　}\r\n \r\n　　public static String getMemory(){\r\n　　　　String memoryAllLine = jedis.info(\"memory\");\r\n　　　　String usedMemoryLine = memoryAllLine.split(\"\\r\\n\")[1];\r\n　　　　String memory = usedMemoryLine.substring(usedMemoryLine.indexOf(':') + 1);\r\n　　　　return memory;\r\n　　}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b38fe176185514-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b38fe176185514-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-2\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-3\">　　<span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jedis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"localhost\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-4\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-5\">　　<span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-6\">　　　　<span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getMemory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-7\">　　　　<span class=\"crayon-e\">insertData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-8\">　　　　<span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getMemory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-9\">　　　　<span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-10\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-11\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-12\">　　<span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insertData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-13\">　　　　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-14\">　　　　　　<span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"aa\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"aa\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//key和value长度都是7字节，且不是整数</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-15\">　　　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-16\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-17\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-18\">　　<span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getMemory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-19\">　　　　<span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memoryAllLine</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"memory\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-20\">　　　　<span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">usedMemoryLine</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memoryAllLine</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-21\">　　　　<span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">usedMemoryLine</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">usedMemoryLine</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">':'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-22\">　　　　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b38fe176185514-23\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b38fe176185514-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p>运行结果：8247552</p>\n<p>理论值与结果值误差在万分之1.2，对于计算需要多少内存来说，这个精度已经足够了。之所以会存在误差，是因为在我们插入90000条数据之前redis已分配了一定的bucket空间，而这些bucket空间尚未使用。</p>\n<p>作为对比将key和value的长度由7字节增加到8字节，则对应的SDS变为17个字节，jemalloc会分配32个字节，因此每个dictEntry占用的字节数也由80字节变为112字节。此时估算这90000个键值对占据内存大小为：90000*112 + 131072*8 = 11128576。</p>\n<p>在redis中验证代码如下（只修改插入数据的代码）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae280c0b3905915440441\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic static void insertData(){\r\n　　for(int i = 10000; i &lt; 100000; i++){\r\n　　　　jedis.set(\"aaa\" + i, \"aaa\" + i); //key和value长度都是8字节，且不是整数\r\n　　}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b3905915440441-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b3905915440441-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b3905915440441-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae280c0b3905915440441-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae280c0b3905915440441-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae280c0b3905915440441-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insertData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b3905915440441-2\">　　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b3905915440441-3\">　　　　<span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"aaa\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"aaa\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//key和value长度都是8字节，且不是整数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae280c0b3905915440441-4\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae280c0b3905915440441-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>运行结果：11128576；估算准确。</p>\n<p>对于字符串类型之外的其他类型，对内存占用的估算方法是类似的，需要结合具体类型的编码方式来确定。</p>\n<h2><a name=\"t52\"></a>2、优化内存占用</h2>\n<p>了解redis的内存模型，对优化redis内存占用有很大帮助。下面介绍几种优化场景。</p>\n<p>（1）利用jemalloc特性进行优化</p>\n<p>上一小节所讲述的90000个键值便是一个例子。由于jemalloc分配内存时数值是不连续的，因此key/value字符串变化一个字节，可能会引起占用内存很大的变动；在设计时可以利用这一点。</p>\n<p>例如，如果key的长度如果是8个字节，则SDS为17字节，jemalloc分配32字节；此时将key长度缩减为7个字节，则SDS为16字节，jemalloc分配16字节；则每个key所占用的空间都可以缩小一半。</p>\n<p>（2）使用整型/长整型</p>\n<p>如果是整型/长整型，Redis会使用int类型（8字节）存储来代替字符串，可以节省更多空间。因此在可以使用长整型/整型代替字符串的场景下，尽量使用长整型/整型。</p>\n<p>（3）共享对象</p>\n<p>利用共享对象，可以减少对象的创建（同时减少了redisObject的创建），节省内存空间。目前redis中的共享对象只包括10000个整数（0-9999）；可以通过调整REDIS_SHARED_INTEGERS参数提高共享对象的个数；例如将REDIS_SHARED_INTEGERS调整到20000，则0-19999之间的对象都可以共享。</p>\n<p>考虑这样一种场景：论坛网站在redis中存储了每个帖子的浏览数，而这些浏览数绝大多数分布在0-20000之间，这时候通过适当增大REDIS_SHARED_INTEGERS参数，便可以利用共享对象节省内存空间。</p>\n<p>（4）避免过度设计</p>\n<p>然而需要注意的是，不论是哪种优化场景，都要考虑内存空间与设计复杂度的权衡；而设计复杂度会影响到代码的复杂度、可维护性。</p>\n<p>如果数据量较小，那么为了节省内存而使得代码的开发、维护变得更加困难并不划算；还是以前面讲到的90000个键值对为例，实际上节省的内存空间只有几MB。但是如果数据量有几千万甚至上亿，考虑内存的优化就比较必要了。</p>\n<h2><a name=\"t53\"></a>3、关注内存碎片率</h2>\n<p>内存碎片率是一个重要的参数，对redis 内存的优化有重要意义。</p>\n<p>如果内存碎片率过高（jemalloc在1.03左右比较正常），说明内存碎片多，内存浪费严重；这时便可以考虑重启redis服务，在内存中对数据进行重排，减少内存碎片。</p>\n<p>如果内存碎片率小于1，说明redis内存不足，部分数据使用了虚拟内存（即swap）；由于虚拟内存的存取速度比物理内存差很多（2-3个数量级），此时redis的访问速度可能会变得很慢。因此必须设法增大物理内存（可以增加服务器节点数量，或提高单机内存），或减少redis中的数据。</p>\n<p>要减少redis中的数据，除了选用合适的数据类型、利用共享对象等，还有一点是要设置合理的数据回收策略（maxmemory-policy），当内存达到一定量后，根据不同的优先级对内存进行回收。</p>\n<h1><a name=\"t6\"></a>六、参考文献</h1>\n<p>《Redis开发与运维》</p>\n<p>《Redis设计与实现》</p>\n<p>https://redis.io/documentation</p>\n<p>http://redisdoc.com/server/info.html</p>\n<p>https://www.cnblogs.com/lhcpig/p/4769397.html</p>\n<p>https://searchdatabase.techtarget.com.cn/7-20218/</p>\n<p>http://www.cnblogs.com/mushroom/p/4738170.html</p>\n<p>http://www.imooc.com/article/3645</p>\n<p>http://blog.csdn.net/zhengpeitao/article/details/76573053</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113789\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113789votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113789\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"},{"url_object_id": "4982221dc7233a7fb52e97b15b7f65e8", "title": "IT 职场新人碰到的几个常见误区", "url": "http://blog.jobbole.com/112038/", "create_date": "2018/03/29", "front_image_url": ["http://wx2.sinaimg.cn/large/7cc829d3gy1fptsk9tvx8j20go0b441z.jpg"], "praise_nums": "2", "comment_nums": 3, "fav_nums": 3, "tags": "职场,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/sankt/p/8658028.html\">沐榕休</a>   </div><p>自己工作 10+ 年了，大概 5 年前从技术转管理后，多少还是发现一些职场新人职业发展的问题。</p>\n<p>表现惊艳的新人肯定有，这种人往往在学校里面或者进入职场后就养成了一些非常良好的做事方式和工作习惯，工作效率高，产出多，甚至很短时间内就可以带新人，年度最佳新人当之无愧。</p>\n<p>然而表现不到位的似乎更多一些，这些员工工作时间短（比如说应届毕业生或者不到两年）尤其性格内向的往往容易掉入错误泥潭，无法自拔，而这些错误的行为会对未来的发展造成非常负面的影响，从而导致职场发展往失败的道路上越走越远。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fptsk9tvx8j20go0b441z.jpg\"></p>\n<p>我分别从以下角度来阐述一下，</p>\n<h3>1. 不愿意和同事沟通，不愿意向同事多学习</h3>\n<p>这种员工大多比较内向或者性情有点高冷，须不知三人行，必有我师。多向同事学习，互通有无，对自己以后的发展有百利而无一害。有导师制或者老员工带，情况或许会有所改善，但如果内因没有改变，最终效果依旧不容乐观。</p>\n<p>技术开发工作中遇到一些技术难题非常正常，当然独立思考固然可贵，但是公司项目往往有一定的时间限制，优先解决问题永远放在第一位，而不是一个人在那里苦苦挣扎和搜索解决方案。如果时间压力不大，多思考一下也未尝不可。考虑到交付压力，这个时候就需要积极和同事，技术经理沟通，寻找解决思路，通常情况下，积极的沟通好过自己的单打独斗。也许同事或者老板的一句话，就应了那据古诗，山重水复疑无路，柳暗花明又一村。与此同时也和同事建立了更好的友谊，在老板心里也留下了做事有方法的好印象。</p>\n<h3>2.视野狭窄，只关注自己的一亩三分地，囿于角色</h3>\n<p>这种情况其实在职场中多见不仅是初级程序员，甚至工作五年以上的程序员也有类似的问题，不是自己的事情不闻不问，而且危害更大。</p>\n<p>公司项目往往大而全，如果仅仅专注自己的那个角落，那么永远都是只见树木，不见森林。</p>\n<p>我相信没有老板会介意下面的程序员多承担一些责任，多做一些事情，最后给项目组多一些产出。</p>\n<p>既然老板不介意，那么就应该大胆的跳出自己的职责范围，多看看公司的其他项目，丰富自己的行业知识。</p>\n<p>职责外的事情，帮的上的不要躲避,，努力承担更多的东西。帮助别人就是提高自己，教学相长就是这个意思。况且你这次帮了别人，下次你的项目紧或者遇到技术难题了，受助之人肯定投桃报李，这样就形成了良性互助氛围，整个项目组的产出也同步提升了。</p>\n<p>一般来说，公司要提升一个人，最好的策略就是先让候选人做一些将来职位才需要做的事情。做的好，理所当然就要提拔。做的不好，则可以提前发现该员工的问题，暂缓提拔，需要多考察一段时间。这样的试错成本毫无疑问是最低的。</p>\n<h3>3.格局太小，对项目以外的技术视而不见，知识面陈旧，匮乏，技能极其单一</h3>\n<p>这里其实谈到了整个IT行业的问题，技术发展太快了。主要还是一个持续提升竞争力的一个话题。</p>\n<p>今天还是桌面开发，明天web开发就成为主流。</p>\n<p>好不容易掌握了关系型数据库，No-SQL成为主流。</p>\n<p>费了九牛二虎之力，熟练掌握Java, C#等静态语言，发现动态语言GO, Python成为云计算，机器学习的标配。</p>\n<p>移动开发昨天还是Object-C, Java, 今天就变成Swift, Kotlin。</p>\n<p> </p>\n<p>当然这里不是说让大家紧跟潮流，扼住时尚。那样做除了疲于奔命，累死在工作台，没有其他的结果。</p>\n<p>其实只要选择一个方向，纵深学习和积累，必有所成。</p>\n<p>比如说，你熟悉 Java, 那么学习 Kotlin 绝对驾轻就熟。</p>\n<p>你有扎实的关系型数据库基础，那么掌握 MangoDB 肯定是件轻而易举的事情。</p>\n<p>编成思想和解决问题的思路都是相通的，平时的学习和工作中要善于思考，举一反三。并且做到与时俱进，及时更新自己的知识库和技能属性，保持良好的市场竞争力。</p>\n<p>做完事情后多思考，怎样做得更好，站在更好的要求上看问题.</p>\n<p>我举两个实际案例，</p>\n<blockquote><p>程序员A在某国企里面，持续开发 Windows Form, 拖拉控件为主，对SQL Server数据库增删改查，时间长达五年之久，突然有一天打算离职，看看新的机会，以为有五年工作经验，可以很轻松找一个更好的工作。但是实际上求职之路异常艰辛，名义上的五年工作经验，其实就是极其单一的技能重复使用了五年。而且大环境也变了，主流已经是web开发，移动开发了。因为没有及时更新自己的知识库和技能储备，那么真要跳槽的时候可能已经跳不动了。</p>\n<p>程序员B在某外企，氛围比较安逸轻松，项目节奏慢，看似也作了不少项目，但做的项目几乎比较类似，难度一般，涉及面挺广，但技术点都是蜻蜓点水，浅尝辄止。这样过了三年，其实积累也是比较松散，知识的深度没有，核心技能并没有养成。</p></blockquote>\n<h3>4.对未来没有想法，不考虑三五年自己要做什么</h3>\n<p>作者本人就犯过类似的错误，幡然醒悟的时候，三年时间已经过去了。</p>\n<p>程序员的职业生涯里面最初的三年其实是一个非常重要的打磨和规划时期，如果在迷茫中度过，那么事后想起肯定会扼腕叹息，奈何流水已经东去，再无复返之理。</p>\n<p>有目标，而没有具体的计划，那么就是一个愿景而已。</p>\n<p>建议不管是初级还是高级程序员，都应该积极向前辈或者直属老板沟通，看看他们有没有值得借鉴的规划和建议。</p>\n<p>职场大忌就是被动等待命运的安排，作者本人也是在职业生涯初期等待老板来帮我规划未来，到现在为止，十年过去了，也没有等到。。。</p>\n<p>所以老板不会主动帮助你规划未来，最重要的事情还是自己对自身的要求和期望。</p>\n<p> </p>\n<h3>5.没有意识到是给自己打工还是公司打工</h3>\n<p>这也是一个非常好的话题，很多人都没有想明白，甚至包括一些工作十年之久的程序员。</p>\n<p>想明白这一点，工作积极性明显就会好太多。自我驱动, 让工作更加有趣和有意义。</p>\n<p>国内知名的互联网公司大老板说过一句话，非常值得深思。</p>\n<p>“我每年付你20万，五年也就是100万。如果你在这里混日子，那么最后吃亏的肯定是你。你的五年青春就只值100万吗？”</p>\n<p>所以职场新人的主人翁意识一定要加强，你要持续提升自己的能力，持续强化自己创造价值的能力。</p>\n<p>举个例子，比如说现在公司支付你20万每年，那么你应该有目标能给公司带来远超过20万的收益，多多益善。</p>\n<p>你有这个能力，公司肯定也会对你相应回报。如果公司不给你升职加薪，那么一走了之，潇洒痛快。优质的人才从来都是抢着要。</p>\n<h3>6.不愿意走出舒适区域，不敢尝试新的东西</h3>\n<p>这点倒是因人而异，不可强求。这个话题其实有点广义。</p>\n<p>如果你在某个方向做的非常好，而且回报也不错，那么不愿意涉足其他领域也无可厚非。</p>\n<p>这个世界唯一不变的东西就是世界一直在改变。今天还有的岗位，明天也许就要消失。世界要抛弃你，都不会打一声招呼。</p>\n<blockquote><p>举个例子，你在公司是SQL Server或者Oracle专家，但是公司计划转非关系型数据库，如果你害怕改变甚至拒绝改变，那么意味着你可能要错过另外一个全新的数据存储平台。进而错过很多机会，而那些勇于接受变化，顺应趋势的人肯定会获得更好的时代回报。</p></blockquote>\n<p>又比如说，你现在用的技术在日常项目中都刚好够用，那么从改善用户体验和使用更加主流的技术角度看，是不是应该要尝试一些新的东西，同时也刷新了自己的技术栈，一举两得，何乐而不为呢？</p>\n<blockquote><p>还有一个例子是一位资深程序员习惯了长期的慢节奏的工作氛围，因为公司改组被裁员，不过自身条件不错，很快就加入国内一家一线互联网公司，但是完全适应不了互联网快节奏，工作一段时间就以公司管理”混乱”，战略规划”经常”改变为借口离职了，接下来很长一段时间找不到一个合适自己的工作，加上中年已到，如果自身不积极调整，接下来的工作和生活肯定困难重重。</p></blockquote>\n<h3>总结</h3>\n<p>最后再简单小结一下，职场新人需要做的就是从小事做起，学会吃亏，以结果为目标导向，日常工作中积极和同事，老板沟通。</p>\n<p>工作中要善于总结方法，经常更新问题的思考模式，对职业负责，对目标负责，对自己负责，脚踏实地，主动找事情做，而不是被动等事情来找你。</p>\n<p>相信职场新人如果能成功避开上面说的几个误区，那么在职业发展道路上就可以少走一些弯路，少犯一些错误，从而更快地实现自己的小目标。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112038\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112038votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112038\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/031407902bdeff19a2af7d3163aefed119d82c52.jpg"},{"url_object_id": "1401d80b943d81d3493c295bfe34a3ab", "title": "Linux 新用户？来试试这 8 款重要的软件", "url": "http://blog.jobbole.com/113775/", "create_date": "2018/03/21", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.maketecheasier.com/essential-linux-apps/\">Ada Ivanova</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9458-1.html\">Linux中国/ChenYi</a>   </div><p>即便您不是计算机的新手，刚接触 Linux 时，通常都会面临选择使用应用软件的问题。在数百万 Linux 应用程序中，做起选择来并不轻松。本文中，您将能发现八个重要的 Linux 应用，帮助您快速选择应用程序。</p>\n<p>下面这些应用程序大多不是 Linux 独有的。如果有过使用 Windows/Mac 的经验，您很可能会熟悉其中一些软件。根据兴趣和需求，下面的程序可能不全符合您的要求，但是在我看来，清单里大多数甚至全部的软件，对于新用户开启 Linux 之旅都是有帮助的。</p>\n<p><strong>相关链接</strong> : <a title=\"11 Portable Apps Every Linux User Should Use\" href=\"https://www.maketecheasier.com/portable-apps-for-linux/\">每一个 Linux 用户都应该使用的 11 个可移植软件</a></p>\n<h3 id=\"toc_1\">1. Chromium 网页浏览器</h3>\n<p><img title=\"linux-apps-01-chromium\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/1a4a3161971e417d60d75361bfdf7083.jpg\" alt=\"linux-apps-01-chromium\"></p>\n<p>几乎不会不需要使用网页浏览器的用户。您可以看到陈旧的 Linux 发行版几乎都会附带 Firefox（火狐浏览器）或者其他 <a href=\"https://www.maketecheasier.com/linux-browsers-you-probably-havent-heard-of/\">Linux 浏览器</a>，关于浏览器，强烈建议您尝试 <a href=\"http://www.chromium.org/\">Chromium</a>。它是谷歌浏览器的开源版。Chromium 的主要优点是速度和安全性。它同样拥有大量的附加组件。</p>\n<h3 id=\"toc_2\">2. LibreOffice</h3>\n<p><img title=\"linux-apps-02-libreoffice\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/4b02246613b823b1d7568cd8c7af6c79.jpg\" alt=\"linux-apps-02-libreoffice\"></p>\n<p><a href=\"https://www.libreoffice.org/\">LibreOffice</a> 是一个开源办公套件，其包括文字处理（Writer）、电子表格（Calc）、演示（Impress）、数据库（Base）、公式编辑器（Math）、矢量图和流程图（Draw）应用程序。它与 Microsoft Office 文档兼容，如果其基本功能不能满足需求，您可以使用 <a href=\"https://www.maketecheasier.com/best-libreoffice-extensions/\">LibreOffice 拓展</a>。</p>\n<p>LibreOffice 显然是 Linux 应用中至关重要的一员，如果您使用 Linux 的计算机，安装它是有必要的。</p>\n<h3 id=\"toc_3\">3. GIMP（GUN 图像处理程序GNU Image Manipulation Program）</h3>\n<p><img title=\"linux-apps-03-gimp\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/7c72e5b5a6595e7250a09f90ccd12e95.jpg\" alt=\"linux-apps-03-gimp\"></p>\n<p><a href=\"https://www.gimp.org/\">GIMP</a> 是一款非常强大的开源图片处理程序，它类似于 Photoshop。通过 GIMP，您可以编辑或是创建用于 Web 或是打印的光栅图（位图）。如果您对专业的图片处理没有概念，Linux 自然提供有更简单的图像编辑器，GIMP 看上去可能会复杂一点。GIMP 并不单纯提供图片裁剪和大小调整，它更覆盖了图层、滤镜、遮罩、路径和其他一些高级功能。</p>\n<h3 id=\"toc_4\">4. VLC 媒体播放器</h3>\n<p><img title=\"linux-apps-04-vlc\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/ec5bc4abf3e1daf3ee5371e3bfbc8a4a.jpg\" alt=\"linux-apps-04-vlc\"></p>\n<p><a href=\"http://www.videolan.org/\">VLC</a> 也许就是最好的影音播放器了。它是跨平台的，所以您可能在 Windows 上也听说过它。VLC 最特殊的地方是其拥有大量解码器（并不是所有的解码器都开放源代码），所以它几乎可以播放所有的影音文件。</p>\n<h3 id=\"toc_5\">5. Jitsy</h3>\n<p><img title=\"linux-apps-05-jitsi\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/106a94517baf8cca5c0302d20afdcb58.jpg\" alt=\"linux-apps-05-jitsi\"></p>\n<p><a href=\"https://jitsi.org/\">Jitsy</a> 完全是关于通讯的。您可以借助它使用 Google talk、Facebook chat、Yahoo、ICQ 和 XMPP。它是用于音视频通话（包括电话会议），桌面流desktop streaming和群组聊天的多用户工具。会话会被加密。Jistsy 同样能帮助您传输文件或记录电话。</p>\n<h3 id=\"toc_6\">6. Synaptic</h3>\n<p><img title=\"linux-apps-06-synaptic\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/a939e9ecbb8c51fa5908c7a234317cef.jpg\" alt=\"linux-apps-06-synaptic\"></p>\n<p><a href=\"http://www.nongnu.org/synaptic/\">Synaptic</a> 是一款基于 Debian 系统发行版的另一款应用程序安装程序。并不是所有基于 Debian 的 Linux 都安装有它，如果您使用基于 Debian 的 Linux 操作系统没有预装，也许您可以试一试。Synaptic 是一款用于添加或移除系统应用的 GUI 工具，甚至相对于许多发行版默认安装的 <a href=\"https://www.maketecheasier.com/are-linux-gui-software-centers-any-good/\">软件中心包管理器</a> ，经验丰富的 Linux 用户更亲睐于 Sunaptic。</p>\n<p><strong>相关链接</strong> : <a title=\"10 Free Linux Productivity Apps You Haven’t Heard Of\" href=\"https://www.maketecheasier.com/free-linux-productivity-apps-you-havent-heard-of/\">10 款您没听说过的 Linux 生产力应用程序</a></p>\n<h3 id=\"toc_7\">7. VirtualBox</h3>\n<p><img title=\"linux-apps-07-virtualbox\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/653bd651a823462de3513ae285eb14d4.jpg\" alt=\"linux-apps-07-virtualbox\"></p>\n<p><a href=\"https://www.virtualbox.org/\">VirtualBox</a> 能支持您在计算机上运行虚拟机。当您想在当前 Linux 发行版上安装其他发行版或操作系统时，使用虚拟机会方便许多。您同样可以通过它运行 Windows 应用程序，性能可能会稍弱，但是如果您有一台强大的计算机，就不会那么糟。</p>\n<h3 id=\"toc_8\">8. AisleRiot Solitaire（纸牌游戏）</h3>\n<p><img title=\"linux-apps-08-aisleriot\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/433400c4755063f31346d9ddcdf76188.jpg\" alt=\"linux-apps-08-aisleriot\"></p>\n<p>对于 Linux 的新用户来说，一款纸牌游戏并不是刚需，但是它真的太有趣了。当您进入这款纸牌游戏，您会发现，这是一款极好的纸牌游戏包。<a href=\"https://wiki.gnome.org/Aisleriot\">AisleRiot</a> 是 Linux 标志性的应用程序，原因是 – 它涵盖超过八十种纸牌游戏，包括流行的 Klondike、Bakers Dozen、Camelot 等等，作为预警 – 它是会上瘾的，您可能会花很长时间沉迷于此！</p>\n<p>根据您所使用的发行版，这些软件会有不同的安装方法。但是大多数都可以通过您使用的发行版中的包管理器安装使用，甚至它们可能会预装在您的发行版上。安装并且尝试它们想必是最好的，如果不合您的胃口，您可以轻松地删除它们。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113775\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113775votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113775\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "d750eaa333832623ef22835422172102", "title": "如何在 Linux 上安装应用程序", "url": "http://blog.jobbole.com/113793/", "create_date": "2018/03/27", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/1/how-install-apps-linux\">Seth Kenlon</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9486-1.html\">Linux中国/MjSeven</a>   </div><blockquote><p>学习在你的 Linux 计算机上摆弄那些软件。</p></blockquote>\n<p>如何在 Linux 上安装应用程序？因为有许多操作系统，这个问题不止有一个答案。应用程序可以可以来自许多来源 —— 几乎不可能数的清，并且每个开发团队都可以以他们认为最好的方式提供软件。知道如何安装你所得到的软件是成为操作系统高级用户的一部分。</p>\n<h3 id=\"toc_1\">仓库</h3>\n<p>十多年来，Linux 已经在使用软件库来分发软件。在这种情况下，“仓库”是一个托管可安装软件包的公共服务器。Linux 发行版提供了一条命令，以及该命令的图形界面，用于从服务器获取软件并将其安装到你的计算机。这是一个非常简单的概念，它已经成为所有主流手机操作系统的模式，最近，该模式也成为了两大闭源计算机操作系统的“应用商店”。</p>\n<p><img class=\"aligncenter\" title=\"Linux repository\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/760b92cca45081c6804cd6aaed0a77cc.png\" alt=\"Linux repository\"></p>\n<p style=\"text-align: center\"><em>不是应用程序商店</em></p>\n<p>从软件仓库安装是在 Linux 上安装应用程序的主要方法，它应该是你寻找想要安装的任何应用程序的首选地方。</p>\n<p>从软件仓库安装，通常需要一个命令，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58e94918021476\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf install inkscape\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58e94918021476-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58e94918021476-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58e94918021476-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">inkscape</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58e94918021476-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>实际使用的命令取决于你所使用的 Linux 发行版。Fedora 使用 <code>dnf</code>，OpenSUSE 使用 <code>zypper</code>，Debian 和 Ubuntu 使用 <code>apt</code>，Slackware 使用 <code>sbopkg</code>，FreeBSD 使用 <code>pkg_add</code>，而基于 lllumos 的 Openlndiana 使用 <code>pkg</code>。无论你使用什么，该命令通常要搜索你想要安装应用程序的正确名称，因为有时候你认为的软件名称不是它官方或独有的名称：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58e9d023908340\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf search pyqt\r\nPyQt.x86_64 : Python bindings for Qt3\r\nPyQt4.x86_64 : Python bindings for Qt4\r\npython-qt5.x86_64 : PyQt5 is Python bindings for Qt5\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58e9d023908340-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58e9d023908340-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58e9d023908340-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58e9d023908340-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58e9d023908340-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58e9d023908340-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">search </span><span class=\"crayon-e\">pyqt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58e9d023908340-2\"><span class=\"crayon-v\">PyQt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">bindings </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Qt3</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a58e9d023908340-3\"><span class=\"crayon-v\">PyQt4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">bindings </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Qt4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58e9d023908340-4\"><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qt5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyQt5 </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">bindings </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Qt5</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a58e9d023908340-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>一旦你找到要安装的软件包的名称后，使用 <code>install</code> 子命令执行实际的下载和自动安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58ea2237409307\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf install python-qt5\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ea2237409307-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ea2237409307-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ea2237409307-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">qt5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ea2237409307-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>有关从软件仓库安装的具体信息，请参阅你的 Linux 发行版的文档。</p>\n<p>图形工具通常也是如此。搜索你认为你想要的，然后安装它。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/b69db96d52abf01b5c5bca4a7945bcb0.png\" alt=\"\"></p>\n<p>与底层命令一样，图形安装程序的名称取决于你正在运行的 Linux 发行版。相关的应用程序通常使用“软件（software）”或“包（package）”等关键字进行标记，因此请在你的启动项或菜单中搜索这些词汇，然后你将找到所需的内容。 由于开源全由用户来选择，所以如果你不喜欢你的发行版提供的图形用户界面（GUI），那么你可以选择安装替代品。 你知道该如何做到这一点。</p>\n<h4 id=\"toc_2\">额外仓库</h4>\n<p>你的 Linux 发行版为其打包的软件提供了标准仓库，通常也有额外的仓库。例如，<a href=\"https://fedoraproject.org/wiki/EPEL\">EPEL</a> 服务于 Red Hat Enterprise Linux 和 CentOS，<a href=\"http://rpmfusion.org\">RPMFusion</a> 服务于 Fedora，Ubuntu 有各种级别的支持以及个人包存档（PPA），<a href=\"http://packman.links2linux.org/\">Packman</a> 为 OpenSUSE 提供额外的软件以及 <a href=\"http://slackbuilds.org\">SlackBuilds.org</a> 为 Slackware 提供社区构建脚本。</p>\n<p>默认情况下，你的 Linux 操作系统设置为只查看其官方仓库，因此如果你想使用其他软件集合，则必须自己添加额外库。你通常可以像安装软件包一样安装仓库。实际上，当你安装例如 <a href=\"https://ring.cx/en/download/gnu-linux\">GNU Ring</a> 视频聊天，<a href=\"http://vivaldi.com\">Vivaldi</a> web 浏览器，谷歌浏览器等许多软件时，你的实际安装是访问他们的私有仓库，从中将最新版本的应用程序安装到你的机器上。</p>\n<p><img class=\"aligncenter\" title=\"Installing a repo\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/9c5806b523c1a55ae242c8aa66c46bcc.png\" alt=\"Installing a repo\"></p>\n<p style=\"text-align: center\"><em>安装仓库</em></p>\n<p>你还可以通过编辑文本文件将仓库手动添加到你的软件包管理器的配置目录，或者运行命令来添加添加仓库。像往常一样，你使用的确切命令取决于 Linux 发行版本。例如，这是一个 <code>dnf</code> 命令，它将一个仓库添加到系统中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58ea6848484774\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf config-manager --add-repo=http://example.com/pub/centos/7\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ea6848484774-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ea6848484774-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ea6848484774-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">config</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">manager</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">add</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">repo</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//example.com/pub/centos/7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ea6848484774-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">不使用仓库来安装应用程序</h3>\n<p>仓库模型非常流行，因为它提供了用户（你）和开发人员之间的链接。重要更新发布之后，系统会提示你接受更新，并且你可以从一个集中位置接受所有更新。</p>\n<p>然而，有时候一个软件包还没有放到仓库中时。这些安装包有几种形式。</p>\n<h4 id=\"toc_4\">Linux 包</h4>\n<p>有时候，开发人员会以通用的 Linux 打包格式分发软件，例如 RPM、DEB 或较新但非常流行的 FlatPak 或 Snap 格式。你不是访问仓库下载的，你只是得到了这个包。</p>\n<p>例如，视频编辑器 <a href=\"https://www.lwks.com/\">Lightworks</a> 为 APT 用户提供了一个 <code>.deb</code> 文件，RPM 用户提供了 <code>.rpm</code> 文件。当你想要更新时，可以到网站下载最新的适合的文件。</p>\n<p>这些一次性软件包可以使用从仓库进行安装时所用的一样的工具进行安装。如果双击下载的软件包，图形安装程序将启动并逐步完成安装过程。</p>\n<p>或者，你可以从终端进行安装。这里的区别在于你从互联网下载的独立包文件不是来自仓库。这是一个“本地”安装，这意味着你的软件安装包不需要下载来安装。大多数软件包管理器都是透明处理的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58eaa221540741\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf install ~/Downloads/lwks-14.0.0-amd64.rpm\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58eaa221540741-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58eaa221540741-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58eaa221540741-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lwks</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">14.0.0</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">amd64</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">rpm</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58eaa221540741-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在某些情况下，你需要采取额外的步骤才能使应用程序运行，因此请仔细阅读有关你正在安装软件的文档。</p>\n<h4 id=\"toc_5\">通用安装脚本</h4>\n<p>一些开发人员以几种通用格式发布他们的包。常见的扩展名包括 <code>.run</code> 和 <code>.sh</code>。NVIDIA 显卡驱动程序、像 Nuke 和 Mari 这样的 Foundry visual FX 软件包以及来自 <a href=\"http://gog.com\">GOG</a> 的许多非 DRM 游戏都是用这种安装程序。（LCTT 译注：DRM 是数字版权管理。）</p>\n<p>这种安装模式依赖于开发人员提供安装“向导”。一些安装程序是图形化的，而另一些只是在终端中运行。</p>\n<p>有两种方式来运行这些类型的安装程序。</p>\n<p>1、 你可以直接从终端运行安装程序：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58eb5316583673\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sh ./game/gog_warsow_x.y.z.sh\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58eb5316583673-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58eb5316583673-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58eb5316583673-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">game</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">gog_warsow_x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">z</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58eb5316583673-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>2、 另外，你可以通过标记其为可执行文件来运行它。要标记为安装程序可执行文件，右键单击它的图标并选择其属性。</p>\n<p><img class=\"aligncenter\" title=\"Giving an installer executable permission\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/819db3a7089befb230a5c94d66686b4c.jpg\" alt=\"Giving an installer executable permission\"></p>\n<p style=\"text-align: center\"><em>给安装程序可执行权限。</em></p>\n<p>一旦你允许其运行，双击图标就可以安装了。</p>\n<p><img class=\"aligncenter\" title=\"GOG installer\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/53afe89b824042f9a90daabea5e29cba.jpg\" alt=\"GOG installer\"></p>\n<p style=\"text-align: center\"><em>GOG 安装程序</em></p>\n<p>对于其余的安装程序，只需要按照屏幕上的说明进行操作。</p>\n<h4 id=\"toc_6\">AppImage 便携式应用程序</h4>\n<p>AppImage 格式对于 Linux 相对来说比较新，尽管它的概念是基于 NeXT 和 Rox 的。这个想法很简单：运行应用程序所需的一切都应该放在一个目录中，然后该目录被视为一个“应用程序”。要运行该应用程序，只需双击该图标即可运行。不需要也要不应该把应用程序安装在传统意义的地方；它从你在硬盘上的任何地方运行都行。</p>\n<p>尽管它可以作为独立应用运行，但 AppImage 通常提供一些系统集成。</p>\n<p><img class=\"aligncenter\" title=\"AppImage system integration\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/59ee2073d407653a05fa297c873d7446.png\" alt=\"AppImage system integration\"></p>\n<p style=\"text-align: center\"><em>AppImage 系统集成</em></p>\n<p>如果你接受此条件，则将一个本地的 <code>.desktop</code> 文件安装到你的主目录。<code>.desktop</code> 文件是 Linux 桌面的应用程序菜单和 mimetype 系统使用的一个小配置文件。实质上，只是将桌面配置文件放置在主目录的应用程序列表中“安装”应用程序，而不实际安装它。你获得了安装某些东西的所有好处，以及能够在本地运行某些东西的好处，即“便携式应用程序”。</p>\n<h4 id=\"toc_7\">应用程序目录</h4>\n<p>有时，开发人员只是编译一个应用程序，然后将结果发布到下载中，没有安装脚本，也没有打包。通常，这意味着你下载了一个 TAR 文件，然后 <a href=\"https://opensource.com/article/17/7/how-unzip-targz-file\">解压缩</a>，然后双击可执行文件（通常是你下载软件的名称）。</p>\n<p><img class=\"aligncenter\" title=\"Twine downloaded for Linux\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/8ebbfff11cc8cda27c3cacbbc6fa7f4f.jpg\" alt=\"Twine downloaded for Linux\"></p>\n<p style=\"text-align: center\"><em>下载 Twine</em></p>\n<p>当使用这种软件方式交付时，你可以将它放在你下载的地方，当你需要它时，你可以手动启动它，或者你可以自己进行快速但是麻烦的安装。这包括两个简单的步骤：</p>\n<ol>\n<li>将目录保存到一个标准位置，并在需要时手动启动它。</li>\n<li>将目录保存到一个标准位置，并创建一个 <code>.desktop</code> 文件，将其集成到你的系统中。</li>\n</ol>\n<p>如果你只是为自己安装应用程序，那么传统上会在你的主目录中放个 <code>bin</code> （“二进制文件binary” 的简称）目录作为本地安装的应用程序和脚本的存储位置。如果你的系统上有其他用户需要访问这些应用程序，传统上将二进制文件放置在 <code>/opt</code> 中。最后，这取决于你存储应用程序的位置。</p>\n<p>下载通常以带版本名称的目录进行，如 <code>twine_2.13</code> 或者 <code>pcgen-v6.07.04</code>。由于假设你将在某个时候更新应用程序，因此将版本号删除或创建目录的符号链接是个不错的主意。这样，即使你更新应用程序本身，为应用程序创建的启动程序也可以保持不变。</p>\n<p>要创建一个 <code>.desktop</code> 启动文件，打开一个文本编辑器并创建一个名为 <code>twine.desktop</code> 的文件。<a href=\"https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html\">桌面条目规范</a> 由 <a href=\"http://freedesktop.org\">FreeDesktop.org</a> 定义。下面是一个简单的启动器，用于一个名为 Twine 的游戏开发 IDE，安装在系统范围的 <code>/opt</code> 目录中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58ebb382883378\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[Desktop Entry]\r\nEncoding=UTF-8\r\nName=Twine\r\nGenericName=Twine\r\nComment=Twine\r\nExec=/opt/twine/Twine\r\nIcon=/usr/share/icons/oxygen/64x64/categories/applications-games.png\r\nTerminal=false\r\nType=Application\r\nCategories=Development;IDE;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ebb382883378-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ebb382883378-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ebb382883378-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ebb382883378-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ebb382883378-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ebb382883378-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ebb382883378-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ebb382883378-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ebb382883378-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ebb382883378-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ebb382883378-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ebb382883378-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Desktop </span><span class=\"crayon-v\">Entry</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ebb382883378-2\"><span class=\"crayon-v\">Encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">UTF</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ebb382883378-3\"><span class=\"crayon-v\">Name</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Twine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ebb382883378-4\"><span class=\"crayon-v\">GenericName</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Twine</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ebb382883378-5\"><span class=\"crayon-v\">Comment</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Twine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ebb382883378-6\"><span class=\"crayon-v\">Exec</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">twine</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Twine</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ebb382883378-7\"><span class=\"crayon-v\">Icon</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">icons</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">oxygen</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">64x64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">categories</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">applications</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">games</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">png</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ebb382883378-8\"><span class=\"crayon-v\">Terminal</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ebb382883378-9\"><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Application</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ebb382883378-10\"><span class=\"crayon-v\">Categories</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">Development</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">IDE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ebb382883378-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>棘手的一行是 <code>Exec</code> 行。它必须包含一个有效的命令来启动应用程序。通常，它只是你下载的东西的完整路径，但在某些情况下，它更复杂一些。例如，Java 应用程序可能需要作为 Java 自身的参数启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58ebf992696851\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nExec=java -jar /path/to/foo.jar\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ebf992696851-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ebf992696851-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ebf992696851-1\"><span class=\"crayon-v\">Exec</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">java</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">jar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">jar</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ebf992696851-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>有时，一个项目包含一个可以运行的包装脚本，这样你就不必找出正确的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a58ec2830091314\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nExec=/opt/foo/foo-launcher.sh\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a58ec2830091314-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a58ec2830091314-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a58ec2830091314-1\"><span class=\"crayon-v\">Exec</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">launcher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a58ec2830091314-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在这个 Twine 例子中，没有与该下载的软件捆绑的图标，因此示例 <code>.desktop</code> 文件指定了 KDE 桌面附带的通用游戏图标。你可以使用类似的解决方法，但如果你更具艺术性，可以创建自己的图标，或者可以在 Internet 上搜索一个好的图标。只要 <code>Icon</code> 行指向一个有效的 PNG 或 SVG 文件，你的应用程序就会以该图标为代表。</p>\n<p>示例脚本还将应用程序类别主要设置为 Development，因此在 KDE、GNOME 和大多数其他应用程序菜单中，Twine 出现在开发类别下。</p>\n<p>为了让这个例子出现在应用程序菜单中，把 <code>twine.desktop</code> 文件放这到两个地方之一：</p>\n<ul>\n<li>如果你将应用程序存储在你自己的家目录下，那么请将其放在 <code>~/.local/share/applications</code>。</li>\n<li>如果你将应用程序存储在 <code>/opt</code> 目录或者其他系统范围的位置，并希望它出现在所有用户的应用程序菜单中，请将它放在 <code>/usr/share/applications</code> 目录中。</li>\n</ul>\n<p>现在，该应用程序已安装，因为它需要与系统的其他部分集成。</p>\n<h3 id=\"toc_8\">从源代码编译</h3>\n<p>最后，还有真正的通用格式安装格式：源代码。从源代码编译应用程序是学习如何构建应用程序，如何与系统交互以及如何定制应用程序的好方法。尽管如此，它绝不是一个点击按钮式过程。它需要一个构建环境，通常需要安装依赖库和头文件，有时还要进行一些调试。</p>\n<p>要了解更多关于从源代码编译的内容，请阅读<a href=\"https://opensource.com/article/17/10/open-source-cats\">我这篇文章</a>。</p>\n<h3 id=\"toc_9\">现在你明白了</h3>\n<p>有些人认为安装软件是一个神奇的过程，只有开发人员理解，或者他们认为它“激活”了应用程序，就好像二进制可执行文件在“安装”之前无效。学习许多不同的安装方法会告诉你安装实际上只是“将文件从一个地方复制到系统中适当位置”的简写。 没有什么神秘的。只要你去了解每次安装，不是期望应该如何发生，并且寻找开发者为安装过程设置了什么，那么通常很容易，即使它与你的习惯不同。</p>\n<p>重要的是安装器要诚实于你。 如果你遇到未经你的同意尝试安装其他软件的安装程序（或者它可能会以混淆或误导的方式请求同意），或者尝试在没有明显原因的情况下对系统执行检查，则不要继续安装。</p>\n<p>好的软件是灵活的、诚实的、开放的。 现在你知道如何在你的计算机上获得好软件了。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113793\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113793votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113793\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "9f64c90d116e8593354ebaf19462978b", "title": "DNS 解析器性能比较：CloudFlare vs Google vs Quad9", "url": "http://blog.jobbole.com/113809/", "create_date": "2018/04/03", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/03/912be8d20ca700194c3aced111cc833d1.jpg"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 0, "tags": "IT技术,DNS,Web", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.com/@nykolas.z/dns-resolvers-performance-compared-cloudflare-x-google-x-quad9-x-opendns-149e803734e5\">medium</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/94836/dns-resolvers-performance-compared\">开源中国社区</a>   </div><p>几个月前，我做了一些可用的顶级免费 DNS 解析器之间的性能比较。恰好在 Quad9 发布之后，我试图根据性能决定使用哪一个：Google，OpenDNS，Quad9 等等…</p>\n<p>CloudFlare 是最了解互联网性能的公司之一，最近推出了自己的免费 DNS 解析器。它默认支持基于 TLS 和 HTTPS 上的 DNS。</p>\n<p>现在进行一个更加有趣的测试：Google 的 8.8.8.8，Quad9 的 9.9.9.9 和 CloudFlare 的 1.1.1.1  ，以及OpenDNS 的 208.67.222.222 和一些其他供应商进行比较。</p>\n<h3>供应商测试</h3>\n<p>这些是选择评估的前 8 位免费 DNS 提供商：</p>\n<ul class=\" list-paddingleft-2\">\n<li><strong>Google 8.8.8.8</strong>：私有和未过滤，最受欢迎。</li>\n<li><strong>CloudFlare 1.1.1.1</strong>：私有和未过滤的新玩家。</li>\n<li><strong>Quad 9 9.9.9.9</strong>：私有和安全意识很高的新玩家。</li>\n<li><strong>OpenDNS 208.67.222.222</strong>：阻止恶意网域并提供阻止成人内容的旧玩家。</li>\n<li><strong>Norton DNS 199.85.126.20</strong>：阻止恶意域名并与其防病毒软件集成的旧玩家。</li>\n<li><strong>CleanBrowsing 185.228.168.168</strong>：私有和阻止访问成人内容，新玩家。</li>\n<li><strong>Yandex DNS 77.88.8.7</strong>：阻止恶意域名的旧玩家，在俄罗斯非常受欢迎。</li>\n<li><strong>Comodo DNS 8.26.56.26</strong>：阻止恶意域名的旧玩家。</li>\n</ul>\n<p>这是他们之间关于隐私选项的快速功能分解：</p>\n<p><img src=\"https://static.oschina.net/uploads/space/2018/0402/175742_67ED_3703517.png\" alt=\"\"></p>\n<h3>地点</h3>\n<p>从全球18个地点运行测试。主要使用 VPS 提供商和一些宽带位置尝试从尽可能多的地方查询他们的DNS。它会告诉我们它们的连接程度如何，数据中心的位置以及某个人在该领域的经验有多接近。选择的地点：</p>\n<ul class=\" list-paddingleft-2\">\n<li><strong>北美</strong>：圣地亚哥，洛杉矶，纽约，多伦多，蒙特利尔，亚特兰大，达拉斯，弗里蒙特，旧金山</li>\n<li><strong>欧洲</strong>：伦敦，巴黎，阿姆斯特丹，法兰克福</li>\n<li><strong>亚洲</strong>：东京，新加坡，班加罗尔（印度），悉尼，布里斯班（澳大利亚）</li>\n<li><strong>南美洲</strong>：圣保罗</li>\n</ul>\n<h3>结果摘要</h3>\n<p>测试非常简单，针对不同流行的域名（google, facebook, twitter, gmail 等）在整个一小时内执行了 70 次DNS 查询。对每个位置的所有请求进行平均，以获得每个 DNS 解析程序的整体性能指标。</p>\n<h4>TLDR /摘要</h4>\n<ul class=\" list-paddingleft-2\">\n<li>所有供应商（Yandex 除外）在北美和欧洲表现非常好。他们在美国，加拿大和欧洲的响应时间均小于 15 毫秒。然而，亚洲和南美洲在总体平均数上有所不同，因为一些提供商在那里连接不好。</li>\n<li>CloudFlare 是所有位置中最快的 DNS。它在全球的平均值为 4.98 毫秒，令人惊叹。</li>\n<li>谷歌和 Quad9 分别接近第二和第三。Quad9 在北美和欧洲比谷歌速度快，但在亚洲/南美洲表现不佳。</li>\n<li>CloudFlare 在任何地方都有强大的存在。尽管 Google 和 Quad9 在某些地方的响应时间很高，但CloudFlare 在各个地方都表现良好。</li>\n<li>Yandex 仅适用于俄罗斯。它不像其他提供商那样使用 Anycast，并且在任何地方都非常缓慢。</li>\n<li>CleanBrowsing 是成人（色情）内容过滤的最快速的提供商。</li>\n</ul>\n<h4>全球平均</h4>\n<blockquote><p>＃1 CloudFlare：4.98 ms<br>\n＃2 Google：16.44 ms<br>\n＃3 Quad9：18.25 ms<br>\n＃4 CleanBrowsing：19.14 ms<br>\n＃5 Norton：34.75 ms<br>\n＃6 OpenDNS：46.51 ms<br>\n＃7 Comodo：71.90<br>\n＃8 Yandex：169.91</p></blockquote>\n<h4>北美平均水平</h4>\n<blockquote><p>＃1 CloudFlare：3.93 ms<br>\n＃2 Quad9：7.21 ms<br>\n＃3 Norton：8.32 ms<br>\n＃4 Google：8.53 ms<br>\n＃5 CleanBrowsing：11.83 ms<br>\n＃6 OpenDNS：14.66 ms<br>\n＃7 Comodo：25.91 ms<br>\n＃8 Yandex：119.09 ms</p></blockquote>\n<h4>欧洲平均</h4>\n<blockquote><p>＃1 CloudFlare：2.96<br>\n＃2 Quad9：4.35<br>\n＃3 CleanBrowsing：5.74<br>\n＃4 Google：7.17<br>\n＃5 OpenDNS：8.99<br>\n＃6 Norton：10.35<br>\n＃7 Comodo：13.06<br>\n＃8 Yandex：35.74</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113809\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113809votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113809\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/bbd3c66a3badc127bce3c714ce00a0e73265cc91.jpg"},{"url_object_id": "5916e51b19bf349342b376e0f581f950", "title": "为初学者准备的 ln 命令教程（5 个示例）", "url": "http://blog.jobbole.com/113800/", "create_date": "2018/04/02", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/linux-ln-command/\">Himanshu Arora</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9501-1.html\">Linux中国/ChenYi</a>   </div><p>当我们在命令行上工作时，您可能需要在文件之间创建链接。这时，您可以可以借助一个专用命令，<code>ln</code>。本教程中，我们将通过一些简单易理解的例子来讨论此工具的基础知识。在此之前，值得一提的是，本教程所有例子都已在 Ubuntu 16.04 上测试通过。</p>\n<h3 id=\"toc_1\">Linux ln 命令</h3>\n<p>正如你现在所了解的，<code>ln</code> 命令能够让您在文件之间创建链接。下面就是 <code>ln</code> 工具的语法（或者使用其他一些可行的语法）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebebc1193155238\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nln [OPTION]... [-T] TARGET LINK_NAME （第一种形式）\r\nln [OPTION]... TARGET （第二种形式）\r\nln [OPTION]... TARGET... DIRECTORY （第三种形式）\r\nln [OPTION]... -t DIRECTORY TARGET... （第四种形式）\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebebc1193155238-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebebc1193155238-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebebc1193155238-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebebc1193155238-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebebc1193155238-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebebc1193155238-1\"><span class=\"crayon-i\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TARGET </span><span class=\"crayon-v\">LINK</span><span class=\"crayon-sy\">_</span>NAME<span class=\"crayon-h\"> </span>（第一种形式）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebebc1193155238-2\"><span class=\"crayon-i\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">TARGET</span><span class=\"crayon-h\"> </span>（第二种形式）</div><div class=\"crayon-line\" id=\"crayon-5ae2693ebebc1193155238-3\"><span class=\"crayon-i\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TARGET</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">DIRECTORY</span><span class=\"crayon-h\"> </span>（第三种形式）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebebc1193155238-4\"><span class=\"crayon-i\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DIRECTORY </span><span class=\"crayon-v\">TARGET</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span>（第四种形式）</div><div class=\"crayon-line\" id=\"crayon-5ae2693ebebc1193155238-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>下面是 <code>ln</code> 工具 man 文档描述的内容：</p>\n<blockquote><p>在第一种形式下，为目标位置（TARGET）创建一个叫 LINK_NAME 的链接。在第二种形式下，为目标位置（TARGET）在当前目录下创建一个链接（LCTT 译注：创建的为同名链接）。在第三和第四种形式中，在 DIRECTORY 目录下为每一个目标位置（TARGET）创建链接。默认创建硬链接，符号链接需要 <code>--symbolic</code> 选项。默认创建的每一个创建的链接（新链接的名字）都不能已经存在。当创建硬链接时，目标位置（TARGET）文件必须存在；符号链接可以保存任意文本，如果之后解析，相对链接的解析与其父目录有关。</p></blockquote>\n<p>通过下面问答风格的例子，可能会给你更好的理解。但是在此之前，建议您先了解 <a href=\"https://medium.com/meatandmachines/explaining-the-difference-between-hard-links-symbolic-links-using-bruce-lee-32828832e8d3\">硬链接和软链接的区别</a>.</p>\n<h3 id=\"toc_2\">Q1. 如何使用 ln 命令创建硬链接？</h3>\n<p>这很简单，你只需要像下面使用 <code>ln</code> 命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebebcd213685672\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nln [file] [hard-link-to-file]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebebcd213685672-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebebcd213685672-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebebcd213685672-1\"><span class=\"crayon-i\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hard</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">link</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebebcd213685672-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebebd1037109900\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nln test.txt test_hard_link.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebebd1037109900-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebebd1037109900-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebebd1037109900-1\"><span class=\"crayon-e\">ln </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">test_hard_link</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebebd1037109900-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><a href=\"https://www.howtoforge.com/images/command-tutorial/big/ln-hard-link.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/01298effe75946f995e7917f557462d5.png\" alt=\"如何使用 ln 命令创建硬链接\"></a></p>\n<p>如此，您便可以看见一个已经创建好的，名为 <code>test_hard_link.txt</code> 的硬链接。</p>\n<h3 id=\"toc_3\">Q2. 如何使用 ln 命令创建软/符号链接？</h3>\n<p>使用 <code>-s</code> 命令行选项：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebebd5250881674\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nln -s [file] [soft-link-to-file]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebebd5250881674-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebebd5250881674-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebebd5250881674-1\"><span class=\"crayon-v\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">soft</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">link</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebebd5250881674-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebebd8889484970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nln -s test.txt test_soft_link.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebebd8889484970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebebd8889484970-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebebd8889484970-1\"><span class=\"crayon-v\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">test_soft_link</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebebd8889484970-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><a href=\"https://www.howtoforge.com/images/command-tutorial/big/ln-soft-link.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/50c704a6f945d0c923e4e0537f8c8074.png\" alt=\"如何使用 ln 命令创建软/符号链接\"></a></p>\n<p><code>test_soft_link.txt</code> 文件就是一个软/符号链接，以天蓝色文本 <a href=\"https://askubuntu.com/questions/17299/what-do-the-different-colors-mean-in-ls\">标识</a>。</p>\n<h3 id=\"toc_4\">Q3. 如何使用 ln 命令删除既存的同名目标文件？</h3>\n<p>默认情况下，<code>ln</code> 不允许您在目标目录下创建已存在的链接。</p>\n<p><a href=\"https://www.howtoforge.com/images/command-tutorial/big/ln-file-exists.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/e0fd2f36a9b21dba7e12ac1cb09ade9d.png\" alt=\"ln 命令示例\"></a></p>\n<p>然而，如果一定要这么做，您可以使用 <code>-f</code> 命令行选项覆盖此行为。</p>\n<p><a href=\"https://www.howtoforge.com/images/command-tutorial/big/ln-f-option.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/50acf4e490700767594928b22cfe2699.png\" alt=\"如何使用 ln 命令创建软/符号链接\"></a></p>\n<p>提示：如果您想在此删除过程中有所交互，您可以使用 <code>-i</code> 选项。</p>\n<h3 id=\"toc_5\">Q4. 如何使用 ln 命令创建现有文件的同名备份？</h3>\n<p>如果您不想 <code>ln</code> 删除同名的现有文件，您可以为这些文件创建备份。使用 <code>-b</code> 即可实现此效果，以这种方式创建的备份文件，会在其文件名结尾处包含一个波浪号（<code>~</code>）。</p>\n<p><a href=\"https://www.howtoforge.com/images/command-tutorial/big/ln-b-option.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/4c82e6ffb43f28c1e41aa82208cb755a.png\" alt=\"如何使用 ln 命令创建现有文件的同名备份\"></a></p>\n<h3 id=\"toc_6\">Q5. 如何在当前目录以外的其它目录创建链接？</h3>\n<p>使用 <code>-t</code> 选项指定一个文件目录（除了当前目录）。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2693ebebdd364087925\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls test* | xargs ln -s -t /home/himanshu/Desktop/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2693ebebdd364087925-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2693ebebdd364087925-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2693ebebdd364087925-1\"><span class=\"crayon-e\">ls </span><span class=\"crayon-e \">test*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xargs </span><span class=\"crayon-v\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">himanshu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2693ebebdd364087925-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>上述命令会为（当前目录下的）所有 <code>test*</code> 文件创建链接，并放到桌面目录下。</p>\n<h3 id=\"toc_7\">总结</h3>\n<p>当然，尤其对于新手来说，<code>ln</code> 并不是日常必备命令。但是，这是一个有用的命令，因为你永远不知道它什么时候能够节省你一天的时间。对于这个命令，我们已经讨论了一些实用的选项，如果你已经完成了这些，可以查询 <a href=\"https://linux.die.net/man/1/ln\">man 文档</a> 来了解更多详情。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113800\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113800votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113800\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "1bd4810b83c51a23ef605311000781f3", "title": "Redis源码阅读：sds字符串实现", "url": "http://blog.jobbole.com/113798/", "create_date": "2018/04/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Redis", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hector\">hoohack</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><h2 id=\"初衷\">初衷</h2>\n<p>从开始工作就开始使用Redis，也有一段时间了，但都只是停留在使用阶段，没有往更深的角度探索，每次想读源码都止步在阅读书籍上，因为看完书很快又忘了，这次逼自己先读代码。因为个人觉得写作需要阅读文字来增强灵感，那么写代码的，就阅读更多代码来增强灵感吧。</p>\n<p>redis的实现原理，在《Redis设计与实现》一书中讲得很详细了，但是想通过结合代码的形式再深入探索，加深自己的理解，现在将自己探索的心得写在这儿。</p>\n<h2 id=\"sds结构体的定义\">sds结构体的定义</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676ca028554297\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define SDS_TYPE_5  0\r\n#define SDS_TYPE_8  1\r\n#define SDS_TYPE_16 2\r\n#define SDS_TYPE_32 3\r\n#define SDS_TYPE_64 4\r\n#define SDS_TYPE_MASK 7\r\n\r\n// sds结构体，使用不同的结构体来保存不同长度大小的字符串\r\ntypedef char *sds;\r\n\r\nstruct __attribute__ ((__packed__)) sdshdr5 {\r\n    unsigned char flags; /* flags共8位，低三位保存类型标志，高5位保存字符串长度，小于32(2^5-1) */\r\n    char buf[]; // 保存具体的字符串\r\n};\r\nstruct __attribute__ ((__packed__)) sdshdr8 {\r\n    uint8_t len; /* 字符串长度，buf已用的长度 */\r\n    uint8_t alloc; /* 为buf分配的总长度，alloc-len就是sds结构体剩余的空间 */\r\n    unsigned char flags; /* 低三位保存类型标志 */\r\n    char buf[];\r\n};\r\nstruct __attribute__ ((__packed__)) sdshdr16 {\r\n    uint16_t len; /* used */\r\n    uint16_t alloc; /* excluding the header and null terminator */\r\n    unsigned char flags; /* 3 lsb of type, 5 unused bits */\r\n    char buf[];\r\n};\r\nstruct __attribute__ ((__packed__)) sdshdr32 {\r\n    uint32_t len; /* used */\r\n    uint32_t alloc; /* excluding the header and null terminator */\r\n    unsigned char flags; /* 3 lsb of type, 5 unused bits */\r\n    char buf[];\r\n};\r\nstruct __attribute__ ((__packed__)) sdshdr64 {\r\n    uint64_t len; /* used */\r\n    uint64_t alloc; /* excluding the header and null terminator */\r\n    unsigned char flags; /* 3 lsb of type, 5 unused bits */\r\n    char buf[];\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ca028554297-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ca028554297-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-1\"><span class=\"crayon-p\">#define SDS_TYPE_5  0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-2\"><span class=\"crayon-p\">#define SDS_TYPE_8  1</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-3\"><span class=\"crayon-p\">#define SDS_TYPE_16 2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-4\"><span class=\"crayon-p\">#define SDS_TYPE_32 3</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-5\"><span class=\"crayon-p\">#define SDS_TYPE_64 4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-6\"><span class=\"crayon-p\">#define SDS_TYPE_MASK 7</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-8\"><span class=\"crayon-c\">// sds结构体，使用不同的结构体来保存不同长度大小的字符串</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-9\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">sds</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-10\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-11\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__attribute__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__packed__</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdshdr5</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* flags共8位，低三位保存类型标志，高5位保存字符串长度，小于32(2^5-1) */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 保存具体的字符串</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-14\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-15\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__attribute__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__packed__</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdshdr8</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint8_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 字符串长度，buf已用的长度 */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint8_t </span><span class=\"crayon-v\">alloc</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 为buf分配的总长度，alloc-len就是sds结构体剩余的空间 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 低三位保存类型标志 */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-20\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-21\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__attribute__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__packed__</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdshdr16</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint16_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* used */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint16_t </span><span class=\"crayon-v\">alloc</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* excluding the header and null terminator */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 3 lsb of type, 5 unused bits */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-26\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-27\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__attribute__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__packed__</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdshdr32</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint32_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* used */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint32_t </span><span class=\"crayon-v\">alloc</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* excluding the header and null terminator */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 3 lsb of type, 5 unused bits */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-32\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-33\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__attribute__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__packed__</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdshdr64</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint64_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* used */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint64_t </span><span class=\"crayon-v\">alloc</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* excluding the header and null terminator */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 3 lsb of type, 5 unused bits */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ca028554297-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ca028554297-38\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>sds结构体从4.0开始就使用了5种header定义，节省内存的使用，但是不会用到sdshdr5，我认为是因为sdshdr5能保存的大小较少，2^5=32，因此就不使用它。</p>\n<p>其他的结构体保存了len、alloc、flags以及buf四个属性。各自的含义见代码的注释。</p>\n<h2 id=\"sds结构体的获取\">sds结构体的获取</h2>\n<p>上面可以看到有5种结构体的定义，在使用的时候是通过一个宏来获取的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676d5884941331\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define SDS_HDR(T,s) ((struct sdshdr##T *)((s)-(sizeof(struct sdshdr##T))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676d5884941331-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676d5884941331-1\"><span class=\"crayon-p\">#define SDS_HDR(T,s) ((struct sdshdr##T *)((s)-(sizeof(struct sdshdr##T))))</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><strong>”##”</strong>被称为连接符，它是一种预处理运算符， 用来把两个语言符号(Token)组合成单个语言符号。比如<code>SDS_HDR(8, s)</code>，根据宏定义展开是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676da025512743\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n((struct sdshdr8 *)((s)-(sizeof(struct sdshdr8))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676da025512743-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676da025512743-1\"><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sdshdr8 *</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sdshdr8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>而具体使用哪一个结构体，sds底层是通过flags属性与<code>SDS_TYPE_MASK</code>做与运算得出具体的类型（具体的实现可见下面的sdslen函数），然后再根据类型去获取具体的结构体。</p>\n<h2 id=\"sds特性的实现\">sds特性的实现</h2>\n<p>在Redis设计与实现一书中讲到，相比C字符串而言，sds的特性如下：</p>\n<blockquote>\n<ul>\n<li>常数复杂度获取字符串长度</li>\n<li>杜绝缓冲区溢出</li>\n<li>减少内存重新分配次数</li>\n<li>二进制安全</li>\n</ul>\n</blockquote>\n<p>那么，它是怎么做到的呢？看代码。</p>\n<h3 id=\"常数复杂度获取字符串长度\">常数复杂度获取字符串长度</h3>\n<p>因为sds将长度属性保存在结构体中，所以只需要读取这个属性就能获取到sds的长度，具体调用的函数时sdslen，实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676de666034249\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic inline size_t sdslen(const sds s) {\r\n    unsigned char flags = s[-1];\r\n    switch(flags&amp;SDS_TYPE_MASK) {\r\n        case SDS_TYPE_5:\r\n            return SDS_TYPE_5_LEN(flags);\r\n        case SDS_TYPE_8:\r\n            return SDS_HDR(8,s)-&gt;len;\r\n        case SDS_TYPE_16:\r\n            return SDS_HDR(16,s)-&gt;len;\r\n        case SDS_TYPE_32:\r\n            return SDS_HDR(32,s)-&gt;len;\r\n        case SDS_TYPE_64:\r\n            return SDS_HDR(64,s)-&gt;len;\r\n    }\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676de666034249-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676de666034249-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676de666034249-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676de666034249-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676de666034249-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676de666034249-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676de666034249-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676de666034249-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676de666034249-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676de666034249-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676de666034249-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676de666034249-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676de666034249-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676de666034249-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676de666034249-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676de666034249-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676de666034249-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inline </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-e\">sdslen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sds</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676de666034249-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676de666034249-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">switch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">SDS_TYPE_MASK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676de666034249-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SDS_TYPE_5</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676de666034249-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SDS_TYPE_5_LEN</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676de666034249-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SDS_TYPE_8</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676de666034249-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SDS_HDR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676de666034249-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SDS_TYPE_16</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676de666034249-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SDS_HDR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676de666034249-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SDS_TYPE_32</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676de666034249-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SDS_HDR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676de666034249-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SDS_TYPE_64</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676de666034249-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SDS_HDR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676de666034249-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676de666034249-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676de666034249-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>可以看到，函数是根据类型调用SDS_HDR宏来获取具体的sds结构，然后直接返回结构体的len属性。</p>\n<h3 id=\"杜绝缓冲区溢出\">杜绝缓冲区溢出</h3>\n<p>对于C字符串的操作函数来说，如果在修改字符串的时候忘了为字符串分配足够的空间，就有可能出现缓冲区溢出的情况。而sds中的API就不会出现这种情况，因为它在修改sds之前，都会判断它是否有足够的空间完成接下来的操作。</p>\n<p>拿书中举例的<code>sdscat</code>函数来看，如果<code>strcat</code>想在原来的”Redis”字符串的基础上进行字符串拼接的操作，但是没有检查空间是否满足，就有可能会修改了”Redis”字符串之后使用到的内存，可能是其他结构使用了，也有可能是一段没有被使用的空间，因此有可能会出现缓冲区溢出。但是<code>sdscat</code>就不会，如下面代码所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676e2975599367\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsds sdscatlen(sds s, const void *t, size_t len) {\r\n    size_t curlen = sdslen(s);\r\n\r\n    s = sdsMakeRoomFor(s,len);\r\n    if (s == NULL) return NULL;\r\n    memcpy(s+curlen, t, len);\r\n    sdssetlen(s, curlen+len);\r\n    s[curlen+len] = '\\0';\r\n    return s;\r\n}\r\n\r\nsds sdscat(sds s, const char *t) {\r\n    return sdscatlen(s, t, strlen(t));\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e2975599367-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e2975599367-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e2975599367-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e2975599367-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e2975599367-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e2975599367-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e2975599367-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e2975599367-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e2975599367-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e2975599367-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e2975599367-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e2975599367-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e2975599367-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e2975599367-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e2975599367-1\"><span class=\"crayon-e\">sds </span><span class=\"crayon-e\">sdscatlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">sds</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e2975599367-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">curlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdslen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e2975599367-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e2975599367-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdsMakeRoomFor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e2975599367-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e2975599367-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">curlen</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e2975599367-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sdssetlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curlen</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e2975599367-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">curlen</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\0'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e2975599367-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e2975599367-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e2975599367-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e2975599367-12\"><span class=\"crayon-e\">sds </span><span class=\"crayon-e\">sdscat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">sds</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e2975599367-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdscatlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e2975599367-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>从代码中可以看到，在执行<code>memcpy</code>将字符串写入sds之前会调用<code>sdsMakeRoomFor</code>函数去检查sds字符串s是否有足够的空间，如果没有足够空间，就为其分配足够的空间，从而杜绝了缓冲区溢出。<code>sdsMakeRoomFor</code>函数的实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676e5436422033\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsds sdsMakeRoomFor(sds s, size_t addlen) {\r\n    void *sh, *newsh;\r\n    size_t avail = sdsavail(s);\r\n    size_t len, newlen;\r\n    char type, oldtype = s[-1] &amp; SDS_TYPE_MASK;\r\n    int hdrlen;\r\n\r\n    /* 只有有足够空间就马上返回，否则就继续执行分配空间的操作 */\r\n    if (avail &gt;= addlen) return s;\r\n\r\n    len = sdslen(s);\r\n    sh = (char*)s-sdsHdrSize(oldtype);\r\n    newlen = (len+addlen);\r\n    // SDS_MAX_PREALLOC == 1MB，如果修改后的长度小于1M，则分配的空间是原来的2倍，否则增加1MB的空间\r\n    if (newlen</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e5436422033-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e5436422033-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e5436422033-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e5436422033-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e5436422033-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e5436422033-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e5436422033-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e5436422033-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e5436422033-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e5436422033-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e5436422033-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e5436422033-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e5436422033-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e5436422033-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e5436422033-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e5436422033-1\"><span class=\"crayon-e\">sds </span><span class=\"crayon-e\">sdsMakeRoomFor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">sds</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">addlen</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e5436422033-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">newsh</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e5436422033-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">avail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdsavail</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e5436422033-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newlen</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e5436422033-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">oldtype</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SDS_TYPE_MASK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e5436422033-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e5436422033-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e5436422033-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 只有有足够空间就马上返回，否则就继续执行分配空间的操作 */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e5436422033-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">avail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addlen</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e5436422033-10\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e5436422033-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdslen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e5436422033-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">sdsHdrSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">oldtype</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e5436422033-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">newlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">len</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">addlen</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e5436422033-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// SDS_MAX_PREALLOC == 1MB，如果修改后的长度小于1M，则分配的空间是原来的2倍，否则增加1MB的空间</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e5436422033-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newlen</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p></p>\n<h3 id=\"减少内存分配操作\">减少内存分配操作</h3>\n<p>sds字符串的很多操作都涉及到修改字符串内容，比如<code>sdscat</code>拼接字符串、<code>sdscpy</code>拷贝字符串等等。这时候就需要内存的分配与释放，如果每次操作都分配刚刚好的大小，那么对程序的性能必定有影响，因为内存分配涉及到系统调用以及一些复杂的算法。</p>\n<p>sds使用了空间预分配以及惰性空间释放的策略来减少内存分配操作。</p>\n<h4 id=\"空间预分配\">空间预分配</h4>\n<p>前面提到，每次涉及到字符串的修改时，都会调用<code>sdsMakeRoomFor</code>检查sds字符串，如果大小不够再进行大小的重新分配。<code>sdsMakeRoomFor</code>函数有下面这几行判断：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676e9197186615\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// SDS_MAX_PREALLOC == 1MB，如果修改后的长度小于1M，则分配的空间是原来的2倍，否则增加1MB的空间\r\nif (newlen</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676e9197186615-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676e9197186615-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676e9197186615-1\"><span class=\"crayon-c\">// SDS_MAX_PREALLOC == 1MB，如果修改后的长度小于1M，则分配的空间是原来的2倍，否则增加1MB的空间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676e9197186615-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newlen</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>函数判断字符串修改后的大小，如果修改后的长度小于1M，则分配给sds的空间是原来的2倍，否则增加1MB的空间。</p>\n<h4 id=\"惰性空间释放\">惰性空间释放</h4>\n<p>如果操作后减少了字符串的大小，比如下面的<code>sdstrim</code>函数，只是在最后修改len属性，不会马上释放多余的空间，而是继续保留多余的空间，这样在下次需要增加sds字符串的大小时，就不需要再为其分配空间了。当然，如果之后检查到sds的大小实在太大，也会调用<code>sdsRemoveFreeSpac</code>e函数释放多余的空间。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676ed365266308\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsds sdstrim(sds s, const char *cset) {\r\n    char *start, *end, *sp, *ep;\r\n    size_t len;\r\n\r\n    sp = start = s;\r\n    ep = end = s+sdslen(s)-1;\r\n    /* 从头部和尾部逐个字符遍历往中间靠拢，如果字符在cest中，则继续前进 */\r\n    while(sp  sp &amp;&amp; strchr(cset, *ep)) ep--;\r\n    len = (sp &gt; ep) ? 0 : ((ep-sp)+1); // 全部被去除了，长度就是0\r\n    if (s != sp) memmove(s, sp, len); // 拷贝内容\r\n    s[len] = '\\0';\r\n    sdssetlen(s,len);\r\n    return s;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ed365266308-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ed365266308-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ed365266308-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ed365266308-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ed365266308-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ed365266308-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ed365266308-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ed365266308-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ed365266308-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ed365266308-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ed365266308-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ed365266308-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676ed365266308-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676ed365266308-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ed365266308-1\"><span class=\"crayon-e\">sds </span><span class=\"crayon-e\">sdstrim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">sds</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">cset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ed365266308-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">ep</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ed365266308-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">size_t </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ed365266308-4\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ed365266308-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ed365266308-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">+</span><span class=\"crayon-e\">sdslen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ed365266308-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 从头部和尾部逐个字符遍历往中间靠拢，如果字符在cest中，则继续前进 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ed365266308-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sp  </span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strchr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">ep</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ep</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ed365266308-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ep</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ep</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 全部被去除了，长度就是0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ed365266308-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 拷贝内容</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ed365266308-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\0'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ed365266308-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sdssetlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676ed365266308-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676ed365266308-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0077 seconds] -->\r\n<p></p>\n<h3 id=\"二进制安全\">二进制安全</h3>\n<p>二进制安全指的是只关心二进制化的字符串，不关心具体格式。只会严格的按照二进制的数据存取，不会妄图以某种特殊格式解析数据。比如遇到’\\0’字符不会停止解析。</p>\n<p>对于C字符串来说，<code>strlen</code>是判断遇到’\\0’之前的字符数量。如果需要保存二进制的数据，就不能通过传统的C字符串来保存，因为获取不到它真实的长度。而sds字符串是通过len属性保存字符串的大小，所以它是二进制安全的。</p>\n<h2 id=\"其他小函数实现\">其他小函数实现</h2>\n<p>在阅读源码的过程中，也发现了两个个人比较感兴趣趣的函数：</p>\n<blockquote>\n<ul>\n<li>sdsll2str（将long long类型的整型数字转成字符串）</li>\n<li>sdstrim （去除头部和尾部的指定字符）</li>\n</ul>\n</blockquote>\n<p>我这两个函数拉出来做了测试，在项目的<code>redis-4.0/tests</code>目录下。<code>sdstrim</code>函数的实现源码上面有列出，看看<code>sdsll2str</code>的实现：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a676f1281920160\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint sdsll2str(char *s, long long value) {\r\n    char *p, aux;\r\n    unsigned long long v;\r\n    size_t l;\r\n\r\n    /* 通过取余数得到原字符串的逆转形式 */\r\n    v = (value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676f1281920160-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676f1281920160-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676f1281920160-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676f1281920160-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676f1281920160-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a676f1281920160-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a676f1281920160-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a676f1281920160-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdsll2str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676f1281920160-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">aux</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676f1281920160-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676f1281920160-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">_</span>t<span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676f1281920160-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a676f1281920160-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* 通过取余数得到原字符串的逆转形式 */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a676f1281920160-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>函数是通过不断取余数，得到原字符串的逆转形式，接着，通过从尾部开始将字符逐个放到字符串s中，看起来像是一个反转操作，从而实现了将整型转为字符串的操作。</p>\n<p>觉得感兴趣是因为<code>sdsll2str</code>这个函数在之前学习C语言的时候经常能看到作为问题出现，能看到如此简洁的实现，表示眼前一亮。而在PHP开发时经常使用trim函数，所以想看看它们的区别。</p>\n<h2 id=\"总结\">总结</h2>\n<p>通过详细地阅读sds的源码，不仅学习到sds的实现细节，还学习到了一些常用字符串操作函数的实现。如果只是仅仅看看数据结构的定义也可以初步了解，但是要深入了解的话还是需要详细的阅读具体函数的实现代码。还是那句，写代码的，需要阅读更多代码来增强灵感。</p>\n<p>我在github有对Redis源码更详细的注解。感兴趣的可以围观一下，给个star。<a href=\"https://github.com/hoohack/read-redis-src\">Redis4.0源码注解</a>。可以通过<a href=\"https://github.com/hoohack/read-redis-src/commits/master\">commit记录</a>查看已添加的注解。</p>\n<p>原创文章，文笔有限，才疏学浅，文中若有不正之处，万望告知。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/7aa70eaa311d5a5dec82ca0d49624741.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/1a4b335ec981d013f4002205a23fedd0.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113798\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113798votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113798\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hector\">hoohack</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hector\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/df22a501f19a5bba1b3331e2001f8ec2.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个正在努力的菜鸟        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hector\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hector/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hector/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 27</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.hoohack.me\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/2388493434?is_all=1\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：914099943\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：hhq8307231\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/hoohack\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"},{"url_object_id": "3ddc63f75c52601a85de2d939777f079", "title": "给初学者的 type 命令教程", "url": "http://blog.jobbole.com/113817/", "create_date": "2018/04/06", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/the-type-command-tutorial-with-examples-for-beginners/\">SK</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9519-1.html\">Linux中国/geekpi</a>   </div><p><code>type</code> 命令用于查找 Linux 命令的信息。顾名思义，你可以使用 <code>type</code> 命令轻松找出给定的命令是否是别名、shell 内置命令、文件、函数或关键字。另外，你也可以找到命令的实际路径。为什么有人需要找到命令类型？例如，如果你经常在共享的计算机上工作，则某些人可能会故意或意外地为特定的 Linux 命令创建别名来执行不需要的操作，例如 <code>alias ls = rm -rf /</code>。因此，在发生更糟糕的事情之前检查它们总是一个好主意。这是 <code>type</code> 命令有用的地方。</p>\n<p>让我给你看一些例子。</p>\n<p>不带任何选项运行 <code>type</code> 命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2863e06884929246859\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ type ls\r\nls is aliased to `ls --color=auto'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2863e06884929246859-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e06884929246859-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2863e06884929246859-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e06884929246859-2\"><span class=\"crayon-e\">ls </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aliased </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">auto</span>'</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>正如你在上面的输出中看到的那样，<code>ls</code> 命令已被别名为 <code>ls -color-auto</code>。但是，它是无害的。但只要想想 <code>ls</code> 如果被别名为了其他一些危险的命令。你不想那样，是吗？</p>\n<p>你可以使用 <code>-t</code> 选项仅找出 Linux 命令的类型。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2863e0688d074767899\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ type -t ls\r\nalias\r\n$ type -t mkdir\r\nfile\r\n$ type -t pwd\r\nbuiltin\r\n$ type -t if\r\nkeyword\r\n$ type -t rvm\r\nfunction</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2863e0688d074767899-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e0688d074767899-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2863e0688d074767899-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e0688d074767899-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2863e0688d074767899-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e0688d074767899-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2863e0688d074767899-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e0688d074767899-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae2863e0688d074767899-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e0688d074767899-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2863e0688d074767899-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e0688d074767899-2\"><span class=\"crayon-i\">alias</span></div><div class=\"crayon-line\" id=\"crayon-5ae2863e0688d074767899-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mkdir</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e0688d074767899-4\"><span class=\"crayon-i\">file</span></div><div class=\"crayon-line\" id=\"crayon-5ae2863e0688d074767899-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e0688d074767899-6\"><span class=\"crayon-i\">builtin</span></div><div class=\"crayon-line\" id=\"crayon-5ae2863e0688d074767899-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e0688d074767899-8\"><span class=\"crayon-i\">keyword</span></div><div class=\"crayon-line\" id=\"crayon-5ae2863e0688d074767899-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rvm</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e0688d074767899-10\"><span class=\"crayon-t\">function</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>该命令仅显示命令的类型，例如别名。它不显示被别名的内容。如果该命令找不到，你将在终端中看不到任何内容。</p>\n<p><code>type</code> 命令的另一个有用的地方是我们可以很容易地找出给定 Linux 命令的绝对路径。为此，请使用 <code>-p</code> 选项，如下所示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2863e06892970147484\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ type -p cal\r\n/usr/bin/cal</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2863e06892970147484-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e06892970147484-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2863e06892970147484-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e06892970147484-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cal</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这与 <code>which ls</code> 命令类似。如果给定的命令是别名，则不会打印任何内容。</p>\n<p>要显示命令的所有信息，请使用 <code>-a</code> 选项。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2863e06895088538141\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ type -a ls\r\nls is aliased to `ls --color=auto'\r\nls is /usr/bin/ls\r\nls is /bin/ls</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2863e06895088538141-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e06895088538141-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2863e06895088538141-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2863e06895088538141-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2863e06895088538141-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e06895088538141-2\"><span class=\"crayon-e\">ls </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aliased </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">auto</span>'</div><div class=\"crayon-line\" id=\"crayon-5ae2863e06895088538141-3\"><span class=\"crayon-e\">ls </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2863e06895088538141-4\"><span class=\"crayon-e\">ls </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ls</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>如你所见，<code>-a</code> 标志显示给定命令的类型及其绝对路径。有关更多详细信息，请参阅手册页。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2863e06899717549930\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ man type</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2863e06899717549930-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2863e06899717549930-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">man </span><span class=\"crayon-v\">type</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>希望这有帮助。会有更多的好东西。请继续访问！</p>\n<p>干杯!</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113817\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113817votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113817\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "19e82073707c6fead43789396f1c0f0a", "title": "Git 12 岁了，为你送上 12 个 Git 的使用技巧！", "url": "http://blog.jobbole.com/113885/", "create_date": "2018/04/16", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/04/e38d25144c3ef2d81d73a884cacbf9c2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 4, "tags": "IT技术,Git", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/4/git-tips\">opensource.com</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/12-git-tips-gits-12th-birthday\">开源中国</a>   </div><p>使用这12个Git的诀窍与技巧来令你的版本控制经验更加有用。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/e38d25144c3ef2d81d73a884cacbf9c2.jpg\"></p>\n<p>Git，一个分布式版本控制系统，它已经成为了开源世界的源码控制默认工具，在4月7号12岁了。但是使用Git中更另人沮丧的是，你需要了解多少才能让你更有效的使用它。同时这也是使用Git中比较美妙的一件事，因为没有什么比发现一个新的小技巧来简化或提高你的工作流的效率更加令人快乐了。</p>\n<p>为了纪念Git的12岁生日，这篇文章提供12个诀窍与技巧来让你的Git经验更加有用和强大，从一些你可能会忽视的基础开始到一些真正的强大技巧!</p>\n<ol>\n<li>\n<h3>你的 ~/.gitconfig 文件</h3>\n</li>\n</ol>\n<p>在第一次用git命令来提交一个仓库的修改，你可能会首先看到像下面这种内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae295107045c491919985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n*** Please tell me who you are.\r\nRun\r\n  git config --global user.email \"you@example.com\"\r\n  git config --global user.name \"Your Name\"\r\nto set your account's default identity.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae295107045c491919985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae295107045c491919985-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae295107045c491919985-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae295107045c491919985-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae295107045c491919985-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae295107045c491919985-1\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span> <span class=\"crayon-i\">Please</span> <span class=\"crayon-i\">tell</span> <span class=\"crayon-i\">me</span> <span class=\"crayon-i\">who</span> <span class=\"crayon-i\">you</span> <span class=\"crayon-v\">are</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae295107045c491919985-2\"><span class=\"crayon-i\">Run</span></div><div class=\"crayon-line\" id=\"crayon-5ae295107045c491919985-3\">  <span class=\"crayon-i\">git</span> <span class=\"crayon-i\">config</span> <span class=\"crayon-o\">--</span><span class=\"crayon-m\">global</span> <span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">email</span> <span class=\"crayon-s\">\"you@example.com\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae295107045c491919985-4\">  <span class=\"crayon-i\">git</span> <span class=\"crayon-i\">config</span> <span class=\"crayon-o\">--</span><span class=\"crayon-m\">global</span> <span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">name</span> <span class=\"crayon-s\">\"Your Name\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae295107045c491919985-5\"><span class=\"crayon-st\">to</span> <span class=\"crayon-i\">set</span> <span class=\"crayon-i\">your</span> <span class=\"crayon-i\">account</span>'<span class=\"crayon-i\">s</span> <span class=\"crayon-st\">default</span> <span class=\"crayon-v\">identity</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>你可能还没有意识到那些命令正在修改~/.gitconfig文件的内容，这个文件就是Git存储全局配置选项的文件。通过你的~/.gitconfig文件你可要做很多事情，包括定义别名，永久的打开（或关闭）一些特定的命令选项，还可以修改Git如何工作的方面（例如：git diff使用哪个diff算法，或者默认使用什么类型的的合并策略）。你甚至可以按条件地基于路径包含其他配置文件到一个仓库！使用“man git-config”查看所有细节。</p>\n<h3>2. 你的仓库的.gitconfig文件</h3>\n<p>在之前的技巧中，你可能会想知道在git config 命令中的—global标识是做什么的。它告诉Git更新“global”配置，也就是~/.gitconfig发现的这个配置。当然，拥有一个全局的配置代表了一个本地配置，而且足够肯定的是，如果你省略—global选项，git config 会更新这个仓库自己的配置，这个配置文件存储在.git/config。<br>\n在.git/config中设置的选项会推翻在~/.gitconfig文件中的对应设置。因此，例如，如果你需要在一个特定的仓库中使用一个不同的邮箱地址，你可以运行“git config user.email “also_you@example.com””。然后，你在这个仓库中提交会使用你单独配置的这个邮箱地址。如果你使用一个工作的电脑在开源项目中工作，但是希望在这个项目中使用个人的邮箱地址，而其他在主Git配置中仍然使用工作邮箱，这一点是非常有用的。<br>\n在~/.gitconfig中可以设置的任何东西，都可以在.git/config中设置来对这个仓库做特定设置。在下面的这些技巧中，当我提到在你的~/.gitconfig文件中添加什么东西，同时也说明可以在特定的仓库的.git/config中添加来设置那个选项。</p>\n<h3>3、别名</h3>\n<p>别名是你可以在你的~/.gitconfig文件里做的另外一件事。他的工作原理就像shell命令行里的别名——设置一个新的命令名称来调用一个或者多个其他的命令，这些命令通常包括一些特定的选项或标识。别名对于你经常使用的那些又长又复杂的命令行是非常有效的。</p>\n<p>你可以使用git config命令来定义别名——例如，执行”git config —global —add <a href=\"http://alias.st/\" rel=\"nofollow\">alias.st</a> status”命令后，会使得执行git st与执行git status做的是同样的事情——然而，我发现当定义别名的时候，只需要直接在~/.gitconfig文件里编辑通常会更加容易。</p>\n<p>如果你选择这么做，你会发现~/.gitconfig文件就是一个INI文件，INI是一种带有特定段落的基础键值对文件格式。添加一个别名时，你将改变[alias]段落。例如：上面提到的定义相同的git st别名，需要添加下面这段代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2951070467347054341\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[alias]\r\nst = status</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2951070467347054341-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2951070467347054341-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2951070467347054341-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">alias</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2951070467347054341-2\"><span class=\"crayon-i\">st</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">status</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>（如果已经有了[alias]这个段落，只需要在这个段落中添加到第二行）</p>\n<h3>4. shell命令中的别名</h3>\n<p>别名不仅仅是运行其他Git子命令——你也可以定义别名，这些别名可以运行其他shell命令。这是一个很好的方法来处理一个重复的、罕见的、复杂的任务：一旦你已经想到第一次怎么做，那就使用一个别名保存这个命令。例如，我有几个仓库是我fork了一个开源项目，而且在本地做了一些修改，这些修改不用贡献给这个项目。在项目的持续的开发的过程中我想保持最新的版本，同时保留我的本地修改。为了完成这个想法，我需要定期地从upstream仓库中合并这些修改到我的fork——我定义一个别名“upstream-merge”来完成这个操作。定义如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae295107046c472786101\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nupstream-merge = !\"git fetch origin -v &amp;&amp; git fetch upstream -v &amp;&amp; git merge upstream/master &amp;&amp; git push\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae295107046c472786101-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae295107046c472786101-1\"><span class=\"crayon-v\">upstream</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">merge</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-o\">!</span><span class=\"crayon-s\">\"git fetch origin -v &amp;&amp; git fetch upstream -v &amp;&amp; git merge upstream/master &amp;&amp; git push\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>别名定义开始的这个“!”是告诉Git来通过shell运行这个命令。这个例子包括了运行一些git命令，但是使用这种方式定义别名可以运行任何shell命令。<br>\n（注意：如果你想复制我的upstream-merge别名，你将需要确认你有一个Git remote命名为upstream来指定这个你fork的upstream仓库。你可以通过“git remote add upstream &lt;URL to repo&gt;”来添加一个。）</p>\n<h3>5. 可视化提交图</h3>\n<p>如果你从事的是一个有很多分支活动的项目，有时可能很难掌握所有正在发生的工作以及它们之间的相关性。各种GUI工具可让你弄清楚不同分支的概况以及在所谓的“提交图”中提交记录。例如，以下是我使用<a href=\"https://gitlab.com/\" target=\"_blank\" rel=\"nofollow\">GitLab</a>提交图查看器进行可视化的一个存储卡的部分截图：<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/5dd3991f489b7311925ad56455d62ba1.png\"></p>\n<p>John Anderson, CC BY</p>\n<p>如果你是专注于命令行的用户，就可以不在多个工具之间切换导致分心，这个工具在命令行上实现了类似图形界面的提交视图。通过 –graph 参数获取 git 的记录：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/1ba96822e6f6beb6bca67ca9a19525af.png\"></p>\n<p>John Anderson, CC BY</p>\n<p>下面的命令可以得到一样的仓库可视化片段：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2951070470514204232\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit --date=relative</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2951070470514204232-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2951070470514204232-1\"><span class=\"crayon-i\">git</span> <span class=\"crayon-i\">log</span> <span class=\"crayon-o\">--</span><span class=\"crayon-i\">graph</span> <span class=\"crayon-o\">--</span><span class=\"crayon-v\">pretty</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">format</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> <span class=\"crayon-o\">--</span><span class=\"crayon-v\">abbrev</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">commit</span> <span class=\"crayon-o\">--</span><span class=\"crayon-v\">date</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">relative</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>–graph 选项将图表添加到日志的左侧，–abbrev-commit 存储提交使用了 <a href=\"https://en.wikipedia.org/wiki/Secure_Hash_Algorithms\" target=\"_blank\" rel=\"nofollow\">SHA</a> 方法，          –date=relative 表达式用相对的术语来表示日期，并且  –pretty 以 bit 格式处理自定义格式。我知道 git lg 的别名，它是我最常运行的10个命令之一。</p>\n<h3>6. 更优雅的强制推送(force-push)</h3>\n<p>有时，就跟你尽量避免使用它一样困难的是，你会发现你需要运行 git push –force 来覆写你仓库的远程副本上的历史记录。你可能已得到了一些反馈，他们会要求你进行交互式的变基(rebase)，或者你可能已经搞砸了，并且希望隐藏证据。</p>\n<p>当他人在仓库的远程副本的同一分支上进行改动后，会发生强制推送的风险。当你强制推送已重写的历史记录时，某些提交将会丢失。这是 git push –force-with-lease 出现的原因 – 如果远程分支已更新，它不会允许你执行强制推送，这将确保你不会丢弃他人的工作。</p>\n<h3>7. git add -N</h3>\n<p>你是否使用过git commit -a在一次行动中提交你所有未完成的修改，只有在你push完你的提交后才发现git commit -a忽略了新添加的文件？解决这个问题你可以用git add -N（“通知”）来告诉Git你想把新添加的文件包含在提交中在你第一次实际提交之前。</p>\n<h3>8. git add -p</h3>\n<p>一最佳的实践为当使用Git时确保每个提交只包含一个逻辑更改–不管是修复一个bug还是（实现）一个新功能。然而，有时当你工作，会在你的仓库中出现一个以上的修改提交。你怎么样把事情分开，使每个提交只包含适当的修改呢？git add –patch来解救！</p>\n<p>这个标志将会使git add命令查看你工作副本中所有的变更，询问你是否愿意将它提交，跳过，或者推迟决定（还有其他一些更强大的选项，你可以通过在运行这命令后选择？来查看）。git add -p是一个神奇的工具来生产结构良好的提交。</p>\n<h3>9. git checkout -p</h3>\n<p>与 git add -p类似，git checkout命令将使用 –patch 或 -p 选项，这会使 git 在本地工作副本中展示每个“大块”的改动，并允许丢弃对应改动 —— 简单地说就是恢复本地工作副本到你改变之前的状态。</p>\n<p>某些场景下这非常有用，例如，在你跟踪一个 bug 时引入了一堆调试日志语句，在修正了这个 bug 之后，你可以先使用 git checkout -p 删除所有新加的调试日志，之后使用 git add -p 来添加 bug 修复。没有比组合一个极好的、结构良好的提交更令人满意的了！</p>\n<h3>10. Rebase with command execution</h3>\n<p>有些项目有一条规则，即存储库中的每个提交都必须处于可工作状态 – 也就是说，在每次提交时，代码应该是可编译的，或运行测试套件应该不会失败的。当你在某分支上工作时间长时，但如果你最终因为某种原因需要rebase时，那么跳过每个变基后的提交以确保你没有意外引入一个中断是有些冗长乏味的。</p>\n<p>幸运的是，git rebase已经支持了-x或–exec选项。git rebase -x &lt;cmd&gt;将在每次提交应用到rebase后运行该命令。因此，例如，如果你有一个项目，其中npm run tests会运行你的测试套件，那么在rebase期间应用每次提交后，git rebase -x npm run tests将会运行测试套件。这使你可以查看测试套件是否在任何变基后的提交中有失败情况，因此你可以确保测试套件在每次提交时仍能通过。</p>\n<h3>11. 基于时间修改的指南</h3>\n<p>很多Git子命令都接受一个修正的参数来决定命令作用于仓库的哪个部分，可能是某次特定的提交的 sha1 值，或者一个分支的名称，又或者是一个符号性的名称如 HEAD（代表当前检出分支最后一次的提交），除了这些简单的形式以外，你还可以附加一个指定的日期或时间作为参数，表示“这个时间的引用”。</p>\n<p>这个功能在某些时候会变得十分有用，比如当你处理最新出现的 bug，自言自语道：“这个功能明明昨天还是好好的，到底又改了些什么”，不用盯着满屏的 git 日志的输出试图弄清楚什么时候更改了提交，您只需运行 git diff HEAD@{yesterday}，会看到从昨天以来的所有修改，这也适用于较长的时间段（例如 git diff HEAD@{‘2 months ago’}） ，以及一个确切的日期（例如git diff HEAD@{‘2010-01-01 12:00:00’}）。</p>\n<p>您还可以将这些基于日期的修改参数与使用修正参数的任何 Git 子命令一起使用。在 gitrevisions 手册页中有关于具体使用哪种格式的详细信息。</p>\n<h3>12. 全知的 reflog</h3>\n<p>你是不是试过在 rebase 时干掉过某次提交，后来又发现你需要保留这次提交的一些东西？你可能觉得这些提交的东西已经永远找不回来了，只能从头再来了。其实不然，但如果你在本地工作副本中提交了，提交就会进入到 “引用日志” ，你仍然可以访问到。</p>\n<p>运行 git reflog 将在本地工作副本中显示当前分支的所有活动的列表，并为您提供每个提交的 SHA1 值。一旦发现你 rebase 时放弃的那个提交，你可以运行 git checkout  来检出该次提交，复制好你需要的信息，然后再运行 git checkout HEAD 返回到分支最新的提交去。</p>\n<h3>以上就是全部内容</h3>\n<p>希望这些技巧中至少有一个能教你一些关于 Git 的新知识，Git 已经 12 岁了，在这个持续创新，不断添加新特性的项目里，你最喜欢哪个技巧？</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113885\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113885votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113885\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/bfa5a7db3c91976d399fecda195ea01b82163b74.jpg"},{"url_object_id": "942003ecbc643f51f276927739872b18", "title": "计算机语言的巨变", "url": "http://blog.jobbole.com/113828/", "create_date": "2018/04/08", "front_image_url": ["https://dn-linuxcn.qbox.me/data/attachment/album/201804/01/123903dpmgspk0trmlpkwl.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 5, "tags": "IT技术,语言", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://esr.ibiblio.org/?p=7724\">Eric Raymond</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9503-1.html\">Linux中国/name1e5s</a>   </div><p>我的上一篇博文《<a href=\"http://blog.jobbole.com/113538/\">与 C 语言长别离</a>》引来了我的老朋友，一位 C++ 专家的评论。在评论里，他推荐把 C++ 作为 C 的替代品。这是不可能发生的，如果 C++ 代替 C 是趋势的话，那么 Go 和 Rust 也就不会出现了。</p>\n<p class=\"article_img\"><img class=\"aligncenter\" src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201804/01/123903dpmgspk0trmlpkwl.jpg\" alt=\"\"></p>\n<p>但是我不能只给我的读者一个光秃秃的看法（LCTT 译注：此处是双关语）。所以，在这篇文章中，我来讲述一下为什么我不再碰 C++ 的故事。这是关于计算机语言设计经济学专题文章的起始点。这篇文章会讨论为什么一些真心不好的决策会被做出来，然后进入语言的基础设计之中，以及我们该如何修正这些问题。</p>\n<p>在这篇文章中，我会一点一点的指出人们（当然也包括我）自从 20 世纪 80 年代以来就存在的关于未来的编程语言的预见失误。直到最近，我们才找到了证明我们错了的证据。</p>\n<p>我记得我第一次学习 C++ 是因为我需要使用 GNU eqn 输出 MathXML，而 eqn 是使用 C++ 写的。那个项目不错。在那之后，21 世纪初，我在韦诺之战Battle For Wesnoth那边当了多年的资深开发人生，并且与 C++ 相处甚欢。</p>\n<p>在那之后啊，有一天我们发现一个不小心被我们授予提交权限的人已经把游戏的 AI 核心搞崩掉了。显然，在团队中只有我是不那么害怕查看代码的。最终，我把一切都恢复正常了 —— 我折腾了整整两周。再那之后，我就发誓我再也不靠近 C++ 了。</p>\n<p>在那次经历过后，我发现这个语言的问题就是它在尝试使得本来就复杂的东西更加复杂，来粗陋补上因为基础概念的缺失造成的漏洞。对于裸指针这样东西，它说“别这样做”，这没有问题。对于小规模的个人项目（比如我的魔改版 eqn），遵守这些规定没有问题。</p>\n<p>但是对于大型项目，或者开发者水平参差不齐的多人项目（这是我经常要处理的情况）就不能这样。随着时间的推移以及代码行数的增加，有的人就会捅篓子。当别人指出有 BUG 时，因为诸如 STL 之类的东西给你增加了一层复杂度，你处理这种问题所需要的精力就比处理同等规模的 C 语言的问题就要难上很多。我在韦诺之战时，我就知道了，处理这种问题真的相当棘手。</p>\n<p>我给 Stell Heller（我的老朋友，C++ 的支持者）写代码时不会发生的问题在我与非 Heller 们合作时就被放大了，我和他们合作的结局可能就是我得给他们擦屁股。所以我就不用 C++ ，我觉得不值得为了其花时间。 C 是有缺陷的，但是 C 有 C++ 没有的优点 —— 如果你能在脑内模拟出硬件，那么你就能很简单的看出程序是怎么运行的。如果 C++ 真的能解决 C 的问题（也就是说，C++ 是类型安全以及内存安全的），那么失去其透明性也是值得的。但是，C++ 并没有这样。</p>\n<p>我们判断 C++ 做的还不够的方法之一是想象一个 C++ 已经搞得不错的世界。在那个世界里，老旧的 C 语言项目会被迁移到 C++ 上来。主流的操作系统内核会是 C++ 写就，而现存的内核实现，比如 Linux 会渐渐升级成那样。在现实世界，这些都没有发生。C++ 不仅没有打消语言设计者设想像 D、Go 以及 Rust 那样的新语言的想法，它甚至都没有取代它的前辈。不改变 C++ 的核心思想，它就没有未来，也因此，C++ 的抽象泄露leaky abstraction也不会消失。</p>\n<p>既然我刚刚提到了 D 语言，那我就说说为什么我不把 D 视为一个够格的 C 语言竞争者的原因吧。尽管它比 Rust 早出现了八年（和 Rust 相比是九年）Walter Bright 早在那时就有了构建那样一个语言的想法。但是在 2001 年，以 Python 和 Perl 为首的语言的出现已经确定了，专有语言能和开源语言抗衡的时代已经过去。官方 D 语言库/运行时和 Tangle 的无谓纷争也打击了其发展。它从未修正这些错误。</p>\n<p>然后就是 Go 语言（我本来想说“以及 Rust”。但是如前文所述，我认为 Rust 还需要几年时间才能有竞争力）。它<em>的确是</em>类型安全以及内存安全的（好吧，是在大多数时候是这样，但是如果你要使用接口的话就不是如此了，但是自找麻烦可不是正常人的做法）。我的一位好友，Mark Atwood，曾指出过 Go 语言是脾气暴躁的老头子因为愤怒而创造出的语言，主要是 <em>C 语言的作者之一</em>（Ken Thompson） 因为 C++ 的混乱臃肿造成的愤怒，我深以为然。</p>\n<p>我能理解 Ken 恼火的原因。这几十年来我就一直认为 C++ 搞错了需要解决的问题。C 语言的后继者有两条路可走。其一就是 C++ 那样，接受 C 的抽象泄漏、裸指针等等，以保证兼容性。然后以此为基础，构建一个最先进的语言。还有一条道路，就是从根源上解决问题 —— <em>修正</em> C语言的抽象泄露。这一来就会破环其兼容性，但是也会杜绝 C/C++ 现有的问题。</p>\n<p>对于第二条道路，第一次严谨的尝试就是 1995 年出现的 Java。Java 搞得不错，但是在语言解释器上构建这门语言使其不适合系统编程。这就在系统编程那留下一个巨大的洞，在 Go 以及 Rust 出现之前的 15 年里，都没有语言来填补这个空白。这也就是我的 GPSD 和 NTPsec 等软件在 2017 年仍然主要用 C 写成的原因，尽管 C 的问题也很多。</p>\n<p>在许多方面这都是很糟糕的情况。尽管由于缺少足够多样化的选择，我们很难认识到 C/C++ 做的不够好的地方。我们都认为在软件里面出现缺陷以及基于安全方面考虑的妥协是理所当然的，而不是想想这其中多少是真的由于语言的设计问题导致的，就像缓存区溢出漏洞一样。</p>\n<p>所以，为什么我们花了这么长时间才开始解决这个问题？从 C 1972 年面世到 Go 2009 年出现，这其中隔了 37 年；Rust 也是在其仅仅一年之前出现。我想根本原因还是经济。</p>\n<p>从最早的计算机语言开始，人们就已经知道，每种语言的设计都体现了程序员时间与机器资源的相对价值的权衡。在机器这端，就是汇编语言，以及之后的 C 语言，这些语言以牺牲开发人员的时间为代价来提高性能。 另一方面，像 Lisp 和（之后的）Python 这样的语言则试图自动处理尽可能多的细节，但这是以牺牲机器性能为代价的。</p>\n<p>广义地说，这两端的语言的最重要的区别就是有没有自动内存管理。这与经验一致，内存管理缺陷是以机器为中心的语言中最常见的一类缺陷，程序员需要手动管理资源。</p>\n<p>当相对价值断言与软件开发在某个特定领域的实际成本动因相匹配时，这个语言就是在经济上可行的。语言设计者通过设计一个适合处理现在或者不远的将来出现的情况的语言，而不是使用现有的语言来解决他们遇到的问题。</p>\n<p>随着时间的推移，时兴的编程语言已经渐渐从需要手动管理内存的语言变为带有自动内存管理以及垃圾回收（GC）机制的语言。这种变化对应了摩尔定律导致的计算机硬件成本的降低，使得程序员的时间与之前相比更加的宝贵。但是，除了程序员的时间以及机器效率的变化之外，至少还有两个维度与这种变化相关。</p>\n<p>其一就是距离底层硬件的距离。底层软件（内核与服务代码）的低效率会被成倍地扩大。因此我们可以发现，以机器为中心的语言向底层推进，而以程序员为中心的语言向着高级发展。因为大多数情况下面向用户的语言仅仅需要以人类的反应速度（0.1 秒）做出回应即可。</p>\n<p>另一个维度就是项目的规模。由于程序员抽象发生的问题的漏洞以及自身的疏忽，任何语言都会有可预期的每千行代码的出错率。这个比率在以机器为中心的语言上很高，而在程序员为中心的带有 GC 的语言里就大大降低。随着项目规模的增大，带有 GC 的语言作为一个防止出错率不堪入目的策略就显得愈发重要起来。</p>\n<p>当我们使用这三种维度来看当今的编程语言的形势 —— C 语言在底层，蓬勃发展的带有 GC 的语言在上层，我们会发现这基本上很合理。但是还有一些看似不合理的是 —— C 语言的应用不合理地广泛。</p>\n<p>我为什么这么说？想想那些经典的 Unix 命令行工具吧。那些小程序通常都可以使用带有完整的 POSIX 支持的脚本语言快速实现出来。重新编码那些程序将使得它们调试、维护和拓展起来都会更加简单。</p>\n<p>但是为什么还是使用 C （或者某些像 eqn 的项目，使用 C++）？因为有转换成本。就算是把相当小、相当简单的程序使用新的语言重写并且确认你已经忠实地保留了所有非错误行为都是相当困难的。笼统地说，在任何一个领域的应用编程或者系统编程在一种语言的权衡过时之后，仍然坚持使用它。</p>\n<p>这就是我和其他预测者犯的大错。 我们认为，降低机器资源成本（增加程序员时间的相对成本）本身就足以取代 C 语言（以及没有 GC 的语言）。 在这个过程中，我们有一部分或者甚至一大部分都是错误的 —— 自 20 世纪 90 年代初以来，脚本语言、Java 以及像 Node.js 这样的东西的兴起显然都是这样兴起的。</p>\n<p>但是，竞争系统编程语言的新浪潮并非如此。 Rust 和 Go 都明确地回应了<em>增加项目规模</em> 这一需求。 脚本语言是先是作为编写小程序的有效途径，并逐渐扩大规模，而 Rust 和 Go 从一开始就定位为减少<em>大型项目</em>中的缺陷率。 比如 Google 的搜索服务和 Facebook 的实时聊天复用。</p>\n<p>我认为这就是对 “为什么不再早点儿” 这个问题的回答。Rust 和 Go 实际上并不算晚，它们相对迅速地回应了一个直到最近才被发现低估的成本动因问题。</p>\n<p>好，说了这么多理论上的问题。按照这些理论我们能预言什么？它告诉我们在 C 之后会出现什么？</p>\n<p>推动 GC 语言发展的趋势还没有扭转，也不要期待其扭转。这是大势所趋。因此：最终我们<em>将</em>拥有具有足够低延迟的 GC 技术，可用于内核和底层固件，这些技术将以语言实现方式被提供。 这些才是真正结束 C 长期统治的语言应有的特性。</p>\n<p>我们能从 Go 语言开发团队的工作文件中发现端倪，他们正朝着这个方向前进 —— 可参见关于并发 GC 的学术研究 —— 从未停止研究。 如果 Go 语言自己没有选择这么做，其他的语言设计师也会这样。 但我认为他们会这么做 —— 谷歌推动他们的项目的能力是显而易见的（我们从 “Android 的发展”就能看出来）。</p>\n<p>在我们拥有那么理想的 GC 之前，我把能替换 C 语言的赌注押在 Go 语言上。因为其 GC 的开销是可以接受的 —— 也就是说不只是应用，甚至是大部分内核外的服务都可以使用。原因很简单： C 的出错率无药可医，转化成本还很高。</p>\n<p>上周我尝试将 C 语言项目转化到 Go 语言上，我发现了两件事。其一就是这活很简单， C 的语言和 Go 对应的很好。还有就是写出的代码相当简单。由于 GC 的存在以及把集合视为首要的数据结构，人们会预期代码减少，但是我意识到我写的代码比我最初期望的减少的更多，比例约为 2:1 —— 和 C 转 Python 类似。</p>\n<p>抱歉呐，Rust 粉们。你们在内核以及底层固件上有着美好的未来，但是你们在别的 C 领域被 Go 压的很惨。没有 GC ，再加上难以从 C 语言转化过来，还有就是 API 的标准部分还是不够完善。（我的 <code>select(2)</code> 又哪去了啊？）。</p>\n<p>对你们来说，唯一的安慰就是，C++ 粉比你们更糟糕 —— 如果这算是安慰的话。至少 Rust 还可以在 Go 顾及不到的 C 领域内大展宏图。C++ 可不能。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113828\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113828votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113828\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8441f8e55bb24a2a5052ec2c163397dfd0b0cdfb.jpg"},{"url_object_id": "7a3fd4e360713292fb09393642fffc46", "title": "从业 24 年独立开发者：大多数同行都只看 5 年以内", "url": "http://blog.jobbole.com/113778/", "create_date": "2018/03/22", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/03/db3f0f9a2c81173f5758eed4074b7543.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "职场,游戏", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.gamelook.com.cn/2018/03/323982\">GameLook</a>   </div><p>GameLook报道/有人说，游戏行业的竞争越来越激烈，游戏数量的增加使得曝光率问题日益严重，但在Jeff Vogel看来，真正热爱游戏研发的人，是不会抱怨这些问题的，因为大多数人做开发者都是从1-5年的时间看待自己的游戏研发职业生涯，而真正想要把游戏当作职业的人，往往是考虑40年或者更长的周期。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/db3f0f9a2c81173f5758eed4074b7543.jpg\" alt=\"\" width=\"564\" height=\"293\"></p>\n<p>在24年的独立游戏研发生涯中，Spiderweb Software创始人Jeff Vogel学到了很多东西。在3月20日举行的GDC独立游戏峰会上，他分享了一些自己的心得，有些观点让人十分意外。</p>\n<p><strong>游戏是朝阳产业，创新不是唯一出路</strong></p>\n<p>Vogel强调，“游戏行业还是个朝阳产业，没有人无所不知，我们还有很多东西都需要弄明白，比如，如何设计这些游戏，如何创造、测试以及销售这些产品，如何为游戏做营销，如何给1亿美元预算的项目增加开箱子玩法而又不影响发布之后的口碑？”他提到自己的第一个游戏项目时候说，“这个项目并没有耗时太久，我当时有了一个想法，也就是小时候就喜欢的那些游戏，所以我要做的就是把小时候喜欢的游戏都回顾一遍，然后从每个游戏里汲取最好的创意。按照我的方法，我希望把它们变成让我觉得满意的游戏”。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/3ea9cfb97b6ce8d6c4919b5e34eb106f.jpg\" alt=\"\" width=\"698\" height=\"566\"></p>\n<p style=\"text-align: center\">Jeff Vogel的第一款游戏截图</p>\n<p>独立游戏非常适合做创新，但创新并不是唯一的出路。你必须知道，我们游戏行业的每个人都是站在巨人的肩膀上，所有的玩法都是在原有的玩法之上演变而来，我只了解自己喜欢的，然后复制这个想法，这就是我的创意过程，他鼓励其他开发者们用类似的方式，按照自己的个人需求去寻找创意，有人把游戏创意说的很玄，比如追求自己的灵感，这样的建议，但我的建议是千万不要这样做，这是一个非常现实的建议，我来说说原因。</p>\n<p>大多数人思考自己在游戏行业生涯的时候，往往是从1-5年的角度考虑问题，对于一些刚开始做游戏研发的人们来说，追寻自己的灵感似乎是非常合理的事情。但是，如果你把自己从事独立游戏研发行业的期限延长到40年或者更久的时间考虑，或许会有所帮助。</p>\n<p>这是一个特别长的时间，如果你在一个行业工作这么久，就会达到最高的工作效率，因为你需要维持生存，需要一个对应的生活方式，一个长久的想法，一个可持续的过程，保持自己不至于破产，因为，如果你因为一些想法而失去了立足之本，在接下来的40年里，它都会让你不断吃亏。</p>\n<p><strong>独立游戏要注重体验，远离消极玩家</strong></p>\n<p>当然，Vogel的创意也并不只是抄袭其他游戏的玩法，他对自己游戏的要求也是相对较高的，比如研发续作的时候，前作25%最差的部分需要被替换，提高整体游戏质量。他非常喜欢重复使用资源、代码和引擎，并认为所有人都不应该因此感到羞辱，比如有一个狼的icon，他在15款不同的游戏里使用过，“人们一直拿这个梗开我的玩笑，但我还是没有因此失业”。</p>\n<p>虽然Spiderweb的游戏有一定的用户群，而且口碑还不错，但这些游戏对于更大的用户群缺乏吸引力，有很大一部分原因是画质无法和3A游戏媲美，但Vogel说，“我非常反感所有人吐槽我的画面质量不够好，我也是投入了资金，专门招聘了美术师的，有些美术资源也是从比较大的渠道获得的，然而还是有人经常说，我的游戏画面很差，我以后再也不会浪费精力去专门提高美术质量了”。</p>\n<p>对于独立游戏开发者而言，这种批评的声音也是经常遇到的，人性有一部分是刻薄的，会对某些事物提出不合理的需求，而且在Steam这样的分销平台没有出现之前，Vogel做电话销售的时候就遇到过类似的问题。而到了互联网时代，这种问题就更加严重，“通常最愤怒的人不是完全匿名的，他们可能是五年前你的游戏最忠实的粉丝，然后你对游戏做出了改变，而且改掉的恰好是他们最喜欢的东西，他们就不再是你的粉丝，你要知道，有时候爱与恨之间的界限很小”。</p>\n<p>作为一个想要长期在游戏行业生存的开发者，Vogel表示，远离各种形式的骚扰是很重要的，作为一个成年人，虽然你很少会被人轻易激怒，但仍有很多事情会让你抓狂，所以Vogel基本上不会看自己的游戏在Steam平台的评论，也不访问论坛，如果被人喷，他还会暂时不登陆Twitter，等待事情平息了之后再登录，如果与一些玩家的关系闹僵，他会毫不犹豫的放弃这部分用户。Vogel说，“不要怕得罪用户，他们说客户总是对的，但实际上并非如此，用户一直是错的。但差别在于，你永远吵不赢他们。有时候你不得不对一部分玩家说，‘我的游戏不适合你，所以我不能增加你要的功能、不能做这样的资料片、不能满足你的要求’，对于你无法让他们满意的用户，退款是最好的方法”。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/b87866fb081fe1d1caf5bc8b5b63273f.jpg\" alt=\"\" width=\"714\" height=\"401\"></p>\n<p style=\"text-align: center\">《Geneforge 3》截图</p>\n<p>对于论坛管理，他说，“如果有人在论坛挑事，直接封掉就是了。但如果有人说，‘这些人又不会影响你的生意，不应该封他们’，那你可以连这些人一起封掉，这些消极的负面声音只会给你的社区带来不利影响，真正支持你的玩家会理解你的做法”。</p>\n<p>和所有的工作室一样，Spiderweb也经历了起伏，Vogel指出，2004年是最艰难的时候，那一年他的两款游戏，《Blades of Avernum》和《Geneforge 3》的销量都不佳。</p>\n<p>有人说，游戏开发者就像是艺术家，遭遇挫折在所难免，但Vogel认为，作为艺术家，你必须成长，“我们更像是玩具制造者，我们卖的是娱乐体验，我们的作品是用来给人们的大脑带来消遣的，我们卖的是惊喜，而自满、平淡无奇和重复会扼杀惊喜。如果你想做续作，很好，但你的续作最好是加入一些新东西，而且是越早越好，因为，如果玩家们开始发现你的需走只是重复，那么就会以拒绝购买的方式让你看到他们的答案”。</p>\n<p>最后，Vogel还提醒同行们不要过度消耗自己的健康，“不要因为熬夜工作而感到自豪，你需要睡眠才能活的长久，最好是挑一把好的椅子，因为有一天如果你的脊椎不行了，就会追悔莫及”。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113778\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113778votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113778\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e987a29d5f8519c5dcfb6963d8ba061ebf03b879.jpg"},{"url_object_id": "051cf547a88e56c435894d7ce9d248b3", "title": "如何对分布式 NewSQL 数据库 TiDB 进行性能调优", "url": "http://blog.jobbole.com/113834/", "create_date": "2018/04/10", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/how-to-do-performance-tuning-on-tidb-a-distributed\">IDG Communications</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/how-to-do-performance-tuning-on-tidb\">开源中国</a>   </div><p>在分布式系统中进行调优不是开玩笑的事情。分布式系统中调优比单节点服务器调优复杂得多，它的瓶颈可能出现在任何地方，单个节点上的系统资源，子组件，或者节点间的协作，甚至网络带宽这些都可能成为瓶颈。性能调优就是发现并解决这些瓶颈的实践，直到系统达到最佳性能水平。我会在本文中分享如何对 TiDB 的“写入”操作进行调优，使其达到最佳性能的实践。</p>\n<p><a href=\"http://bit.ly/tidb_repo_publication\" target=\"_blank\" rel=\"nofollow\">TiDB</a> 是开源的混合事务处理/分析处理（HTAP）的 NewSQL 数据库。一个 TiDB 集群拥有几个 TiDB 服务、几个 TiKV 服务和一组 Placement Deiver（PD）（通常 3-5 个节点）。TiDB 服务是无状态 SQL 层，TiKV 服务是键值对存储层，PD 则是管理组件，从顶层视角负责存储元数据以及负载均衡。下面是一个 TiDB 集群的架构，你可以在 <a href=\"https://github.com/pingcap/docs\" target=\"_blank\" rel=\"nofollow\">TiDB 官方文档</a>中找到每个组成部分的详细描述。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fq7c3yhsywj20q50c479p.jpg\"></p>\n<h3 id=\"content_h3_2_5\">采集监控数据</h3>\n<p><a href=\"https://prometheus.io/\" target=\"_blank\" rel=\"nofollow\">Prometheus</a> 是一个开源的系统监测的解决方案，采集每个内部组件的监控数据，并定期发给  <a href=\"https://prometheus.io/\" target=\"_blank\" rel=\"nofollow\">Prometheus</a> 。借助开源的时序分析平台  <a href=\"https://grafana.com/\" target=\"_blank\" rel=\"nofollow\">Grafana</a> ，我们可以轻易观测到这些数据的表现。使用 <a href=\"https://github.com/pingcap/docs/blob/master/op-guide/ansible-deployment.md\" target=\"_blank\" rel=\"nofollow\">Ansible</a> 部署 TiDB 时，Prometheus 和 Grafana 是默认安装选项。通过观察这些数据的变化，我们可以看到每个组件是否处于运行状态，可以定位瓶颈所在，可以调整参数来解决问题。</p>\n<h4 id=\"content_h4_2_11\">插入 SQL 语句的写入流（Writeflow）</h4>\n<p>假设我们使用如下 SQL 来插入一条数据到表 t</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae27bf8b70b7698638094\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmysql &gt;&gt; INSERT INTO t(id, name, address) values(1, “Jack”, “Sunnyvale”);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae27bf8b70b7698638094-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae27bf8b70b7698638094-1\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-i\">INTO</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">t</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-i\">Jack</span>”<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-i\">Sunnyvale</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><img id=\"pic\" class=\"M_cur_zoom_out\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fq7c3z498sj20jg0j60vc.jpg\"></p>\n<p>上面是一个简单而直观的简述，介绍了 TiDB 如何处理 SQL 语句。TiDB 服务器收到 SQL 语句后，根据索引的编号将语句转换为一个或多个键值对(KV)，这些键值对被发送到相关联的 TiKV 服务器，这些服务器以 Raft 日志的形式复制保存。最后，Raf 日志被提交，这些键值对会被写入指定的存储引擎。</p>\n<p>在此过程中，有 3 类关键的过程要处理：转换 SQL 为多个键值对、Region 复制和二阶段提交。接下来让我们深入探讨各细节。</p>\n<h4 id=\"content_h4_3_5\">从 SQL 转换为键值对</h4>\n<p>与其他数据库系统不同，TiDB 只存储键值对，以提供无限的水平可伸缩性以及强大的一致性。那么要如何实现诸如数据库、表和索引等高层概念呢？在 TiDB 中，每个表都有一个关联的全局唯一编号，被称为 “table-id”。特定表中的所有数据（包括记录和索引）的键都是以 8 字节的 table-id 开头的。每个索引都有一个名为 “index-id” 的表范围的唯一编号。下面展示了记录键和索引键的编码规则。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fq7c3zph2vj20n1026acu.jpg\"></p>\n<h4 id=\"content_h4_4_5\">Region（区域）的概念</h4>\n<p>在 TiDB 中，Region 表示一个连续的、左闭右开的键值范围 [start_key，end_key）。每个 Region 有多个副本，并且每个副本称为一个 peer 。每个 Region 也归属于单独的 Raft 组，以确保所有 peer 之间的数据一致性。（有关如何在 TiKV 中实现 Raft 一致性算法的更多信息，请参阅 PingCAP 杰出工程师唐刘的相关<a href=\"https://pingcap.com/blog/optimizing-raft-in-tikv/\" target=\"_blank\" rel=\"nofollow\">博文</a>。）由于我之前提到的编码规则的原因，同一表的临近记录很可能位于同一 Region 中。</p>\n<p>当集群第一次初始化时，只存在一个 Region 。当 Region 达到特定大小（当前默认值为96MB）时， Region 将动态分割为两个邻近的 Region ，并自动将数据分布到系统中以提供水平扩展。</p>\n<h4 id=\"content_h4_5_5\">二阶段提交</h4>\n<p>我们的事务处理模型设计灵感来源于 <a href=\"https://research.google.com/pubs/pub36726.html\" target=\"_blank\" rel=\"nofollow\">Percolator</a>，并在此基础上进行了一些优化。简单地说，这是一个二阶段提交协议，即预写入和提交。</p>\n<p>每个组件中都有更多的内容，但从宏观层次来理解足以为性能调优设置场景。现在我们来深入研究四种调优技术。</p>\n<h3 id=\"content_h3_5_9\">调优技巧 #1: 调度器</h3>\n<p>所有写入命令都被发送到调度器模型，然后被复制。调度器模型由一个调度线程和几个工作线程组成。为什么需要调度器模型？在向数据库写入数据之前，需要检查是否允许这些写命令，以及这些写命令是否满足事务约束。所有这些检查工作都需要从底层存储引擎读取信息，它们通过调度由工作线程来进行处理。</p>\n<p>如果看到所有工作线程的 CPU 使用量总和超过 scheduler-worker-pool-size * 80% 时，就需要通过增加调度工作线程的数理来提高性能。</p>\n<p>可以通过修改配置文件中 ‘storage’ 节的 ‘scheduler-worker-pool-size’ 来改变调度工作线程的数量。对于 CPU 核心数目小于 16 的机器，默认情况下配置了 4 个调度工作线程，其它情况下默认值是 8。参阅相关代码部分：<a href=\"https://github.com/pingcap/tikv/blob/master/etc/config-template.toml#L81\" target=\"_blank\" rel=\"nofollow\">scheduler-worker-pool-size = 4</a></p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fq7c40c16oj20q50au0zj.jpg\"></p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fq7c41430oj20q50ao46e.jpg\"></p>\n<h3 id=\"content_h3_6_5\"><strong>调优技巧 #2：raftstore进程与apply进程</strong></h3>\n<p>像我前边提到的，我们在多节点之间使用Raft实现强一致性。在将一个键值对写入数据库之前，这个键值对首先要被复制成Raft log格式，同时还要被写入各个节点硬盘中保存。在Raft log被提交后，相关的键值对才能被写入数据库。</p>\n<p>这样就产生两种写入操作：一个是写Raft log，一个是把键值对写入数据库。为了在TiKV中独立地执行这两种操作，我们创建一个raftstore进程，它的工作是拦截所有Raft信息，并写Raft log到硬盘中；同时我们创建另一个进程apply worker，它的职责是把键值对写到数据库中。在Grafana中，这两个进程显示在TiKV面板的子面板Thread CPU中（如下图所示）。它们都是极其重要的写操作负载，在Grafana中我们很容易就能发现它们相当繁忙。</p>\n<p>为什么需要特别关注这两个进程？当一些TiKV服务器的apply或者raftstore进程很繁忙，而另一些机器却很空闲的时候，也就是说写操作负载不均衡的时候，这些比较繁忙的服务器就成了集群中的瓶颈。造成这种情况的一种原因是使用了单调递增的列，比如使用AUTOINCREMENT指定主键，或者在值不断增加的列上创建索引，例如最后一次访问的时间戳。</p>\n<p>要优化这样的场景并消除瓶颈，必须避免在单调增加的列上设计主键和索引。</p>\n<p>在传统单节点数据库系统上，使用AUTOINCREMENT关键字可以为顺序写入带来极大好处，但是在分布式数据库系统中，使所有组件的负载均衡才是最重要的。</p>\n<p> </p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fq7c41ouo6j20q50ci47h.jpg\"></p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fq7c42a4sdj20q50b9tdb.jpg\"></p>\n<h3 id=\"content_h3_7_5\"><strong>调优技巧＃3：RocksDB</strong></h3>\n<p><a href=\"https://github.com/facebook/rocksdb\" target=\"_blank\" rel=\"nofollow\">RocksDB</a> 是一个高性能，有大量特性的永久性 KV 存储。 TiKV 使用 RocksDB 作为底层存储引擎，和其他诸多功能，比如列族、范围删除、前缀索引、memtable 前缀布隆过滤器，sst 用户定义属性等等。 RocksDB 提供详细的<a href=\"https://github.com/facebook/rocksdb/wiki/RocksDB-Tuning-Guide\" target=\"_blank\" rel=\"nofollow\">性能调优文档。</a></p>\n<p>每个 TiKV 服务器下面都有两个 RocksDB 实例：一个存储数据，我们称之为 kv-engine ，另一个存储 Raft 日志，我们称之为 raft-engine 。kv-engine 有4个列族：“default” 、“lock”、 “write”  和 “raft” 。大多数记录存储在 “default” 列族中，所有索引都存储在 “write” 列族中。你可以通过修改配置文件关联部分中的 block-cache-size 值来调整这两个 RocksDB 实例，以实现最佳性能。相关部分是： [rocksdb.defaultcf] <a href=\"https://github.com/pingcap/tikv/blob/master/etc/config-template.toml#L336\" target=\"_blank\" rel=\"nofollow\">block-cache-size = “1GB”</a> 和 [rocksdb.writecf] <a href=\"https://github.com/pingcap/tikv/blob/master/etc/config-template.toml#L370\" target=\"_blank\" rel=\"nofollow\">block-cache-size = “1GB”</a></p>\n<p>我们调整 block-cache-size 的原因是因为 TiKV 服务器频繁地从“write” 列族中读取数据以检查插入时是否满足事务约束，所以为 “write” 列族的块缓存设置合适的大小非常重要。当 “write” 列族的 block-cache  命中率低于 90％ 时，应该增加 “write” 列族的 block-cache-size 大小。 “write”列族的 block-cache-size 的默认值为总内存的 15％ ，而 “default” 列族的默认值为 25％ 。例如，如果我们在 32GB 内存的机器上部署 TiKV 节点，那么对于 “default” 列族， “write” 列族的 block-cache-size 的值约为 4.8GB 到 8GB 。在繁重的写入工作量中， “default” 列族中的数据很少被访问，所以当我们确定 “write”  列族的缓存命中率低于 90％（例如50％）时，我们知道 “write” 列族大约是默认 4.8 GB的两倍。为了调优以获得更好的性能，我们可以明确地将 “write” 列族的 block-cache-size 设置为 9GB 。但是，我们还需要将 “default” 列族的 block-cache-size 大小减少到 4GB ，以避免 OOM（内存不足）风险。你可以在 Grafana 的 “RocksDB-kv” 面板中找到 RocksDB 的详细统计信息，以帮助进行调优。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fq7c42uohgj20q50czq9u.jpg\"></p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fq7c43evcdj20q50cx0z5.jpg\"></p>\n<p> </p>\n<p style=\"text-align: center;\"><em>RocksDB-kv 面板</em></p>\n<h3 id=\"content_h3_8_5\">调优技巧#4: 批量插入</h3>\n<p>使用批量插入可以实现更好的写入性能。从 TiDB 服务器的角度来看，批量插入不仅可以减少客户端与 TiDB 服务器之间的 RPC 延迟，还可以减少 SQL 解析时间。在 TiKV 内部，批量插入可以通过将多个记录合并到一个 Raft 日志条目中来减少 Raft 信息的总数量。根据我们的经验，建议将批量大小保持在 50〜100 行之内。当一个表中有超过 10 个索引时，应减少批量处理的大小，因为按照上述编码规则，插入一行类似数据将创建超过 10 个键值对。</p>\n<h3 id=\"content_h3_9_5\">总结</h3>\n<p>我希望本文能够在使用 <a href=\"http://bit.ly/tidb_repo_publication\" target=\"_blank\" rel=\"nofollow\">TiDB</a> 时帮助你了解一些常见的瓶颈状况，以及如何调优这些问题，以便在“写入”过程中实现最优性能。综上所述：</p>\n<ol>\n<li>不要让一些 TiKV 节点处理大部分“写入”工作负载，避免在单调增加的列上设计主键和索引。</li>\n<li>当 TiKV 调度模型中的调度器的总 CPU 使用率超过 scheduler-worker-pool-size*80％ 时，请增加 scheduler-worker-pool-size 的值。</li>\n<li>当写入任务频繁读取’write’列族并且块缓存命中率低于 90％ 时，在 RocksDB 中增加 block-cache-size 的值。</li>\n<li>使用批量插入来提高“写入”操作的性能。</li>\n</ol>\n<p>我们的许多客户，从电子商务市场和游戏，到金融科技、媒体和旅行，已经在生产中使用这些调优技术，以充分利用 TiDB 的设计、体系结构和优化。期待在不久的将来分享他们的使用案例和经验。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113834\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113834votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113834\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"},{"url_object_id": "478668b98ba578838009ccb38b2d6a09", "title": "6 个开源的家庭自动化工具", "url": "http://blog.jobbole.com/113713/", "create_date": "2018/03/06", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/1503a298ec77047d9314ddceef5e4ff7.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,智能家居,自动化", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/life/17/12/home-automation-tools\">Jason Baker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9410-1.html\">Linux中国/qhwdw</a>   </div><blockquote><p>用这些开源软件解决方案构建一个更智能的家庭。</p></blockquote>\n<p><a href=\"https://opensource.com/resources/internet-of-things\">物联网</a> 不仅是一个时髦词，在现实中，自 2016 年我们发布了一篇关于家庭自动化工具的评论文章以来，它也在迅速占领着我们的生活。在 2017，<a href=\"https://www.statista.com/outlook/279/109/smart-home/united-states\">26.5% 的美国家庭</a> 已经使用了一些智能家居技术；预计五年内，这一数字还将翻倍。</p>\n<p>随着这些数量持续增加的各种设备的使用，可以帮助你实现对家庭的自动化管理、安保、和监视，在家庭自动化方面，从来没有像现在这样容易和更加吸引人过。不论你是要远程控制你的 HVAC 系统，集成一个家庭影院，保护你的家免受盗窃、火灾、或是其它威胁，还是节省能源或只是控制几盏灯，现在都有无数的设备可以帮到你。</p>\n<p>但同时，还有许多用户担心安装在他们家庭中的新设备带来的安全和隐私问题 —— 这是一个很现实也很 <a href=\"http://www.crn.com/slide-shows/internet-of-things/300089496/black-hat-2017-9-iot-security-threats-to-watch.htm\">严肃的问题</a>。他们想要去控制有谁可以接触到这个重要的系统，这个系统管理着他们的应用程序，记录了他们生活中的点点滴滴。这种想法是可以理解的：毕竟在一个连你的冰箱都是智能设备的今天，你不想要一个基本的保证吗？甚至是如果你授权了设备可以与外界通讯，它是否是仅被授权的人访问它呢？</p>\n<p><a href=\"https://opensource.com/business/15/5/why-open-source-means-stronger-security\">对安全的担心</a> 是为什么开源对我们将来使用的互联设备至关重要的众多理由之一。由于源代码运行在他们自己的设备上，完全可以去搞明白控制你的家庭的程序，也就是说你可以查看它的代码，如果必要的话甚至可以去修改它。</p>\n<p>虽然联网设备通常都包含它们专有的组件，但是将开源引入家庭自动化的第一步是确保你的设备和这些设备可以共同工作 —— 它们为你提供一个接口 —— 并且是开源的。幸运的是，现在有许多解决方案可供选择，从 PC 到树莓派，你可以在它们上做任何事情。</p>\n<p>这里有几个我比较喜欢的。</p>\n<h3 id=\"toc_1\">Calaos</h3>\n<p><a href=\"https://calaos.fr/en/\">Calaos</a> 是一个设计为全栈的家庭自动化平台，包含一个服务器应用程序、触摸屏界面、Web 应用程序、支持 iOS 和 Android 的原生移动应用、以及一个运行在底层的预配置好的 Linux 操作系统。Calaos 项目出自一个法国公司，因此它的支持论坛以法语为主，不过大量的介绍资料和文档都已经翻译为英语了。</p>\n<p>Calaos 使用的是 <a href=\"https://github.com/calaos/calaos-os/blob/master/LICENSE\">GPL</a> v3 的许可证，你可以在 <a href=\"https://github.com/calaos\">GitHub</a> 上查看它的源代码。</p>\n<h3 id=\"toc_2\">Domoticz</h3>\n<p><a href=\"https://domoticz.com/\">Domoticz</a> 是一个有大量设备库支持的家庭自动化系统，在它的项目网站上有大量的文档，从气象站到远程控制的烟雾探测器，以及大量的第三方 <a href=\"https://www.domoticz.com/wiki/Integrations_and_Protocols\">集成软件</a> 。它使用一个 HTML5 前端，可以从桌面浏览器或者大多数现代的智能手机上访问它，它是一个轻量级的应用，可以运行在像树莓派这样的低功耗设备上。</p>\n<p>Domoticz 是用 C++ 写的，使用 <a href=\"https://github.com/domoticz/domoticz/blob/master/License.txt\">GPLv3</a> 许可证。它的 <a href=\"https://github.com/domoticz/domoticz\">源代码</a> 在 GitHub 上。</p>\n<h3 id=\"toc_3\">Home Assistant</h3>\n<p><a href=\"https://home-assistant.io/\">Home Assistant</a> 是一个开源的家庭自动化平台，它可以轻松部署在任何能运行 Python 3 的机器上，从树莓派到网络存储（NAS），甚至可以使用 Docker 容器轻松地部署到其它系统上。它集成了大量的开源和商业的产品，允许你去连接它们，比如，IFTTT、天气信息、或者你的 Amazon Echo 设备，去控制从锁到灯的各种硬件。</p>\n<p>Home Assistant 以 <a href=\"https://github.com/home-assistant/home-assistant/blob/dev/LICENSE.md\">MIT 许可证</a> 发布，它的源代码可以从 <a href=\"https://github.com/balloob/home-assistant\">GitHub</a> 上下载。</p>\n<h3 id=\"toc_4\">MisterHouse</h3>\n<p>从 2016 年起，<a href=\"http://misterhouse.sourceforge.net/\">MisterHouse</a> 取得了很多的进展，我们把它作为一个“可以考虑的另外选择”列在这个清单上。它使用 Perl 脚本去监视任何东西，它可以通过一台计算机来查询或者控制任何可以远程控制的东西。它可以响应语音命令，查询当前时间、天气、位置、以及其它事件，比如去打开灯、唤醒你、记下你喜欢的电视节目、通报呼入的来电、开门报警、记录你儿子上了多长时间的网、如果你女儿汽车超速它也可以告诉你等等。它可以运行在 Linux、macOS、以及 Windows 计算机上，它可以读/写很多的设备，包括安全系统、气象站、来电显示、路由器、机动车位置系统等等。</p>\n<p>MisterHouse 使用 <a href=\"http://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html\">GPLv2</a> 许可证，你可以在 <a href=\"https://github.com/hollie/misterhouse\">GitHub</a> 上查看它的源代码。</p>\n<h3 id=\"toc_5\">OpenHAB</h3>\n<p><a href=\"http://www.openhab.org/\">OpenHAB</a>（开放家庭自动化总线的简称）是在开源爱好者中所熟知的家庭自动化工具，它拥有大量用户的社区以及支持和集成了大量的设备。它是用 Java 写的，OpenHAB 非常轻便，可以跨大多数主流操作系统使用，它甚至在树莓派上也运行的很好。支持成百上千的设备，OpenHAB 被设计为与设备无关的，这使开发者在系统中添加他们的设备或者插件很容易。OpenHAB 也支持通过 iOS 和 Android 应用来控制设备以及设计工具，因此，你可以为你的家庭系统创建你自己的 UI。</p>\n<p>你可以在 GitHub 上找到 OpenHAB 的 <a href=\"https://github.com/openhab/openhab\">源代码</a>，它使用 <a href=\"https://github.com/openhab/openhab/blob/master/LICENSE.TXT\">Eclipse 公共许可证</a>。</p>\n<h3 id=\"toc_6\">OpenMotics</h3>\n<p><a href=\"https://www.openmotics.com/\">OpenMotics</a> 是一个开源的硬件和软件家庭自动化系统。它的设计目标是为控制设备提供一个综合的系统，而不是从不同的供应商处将各种设备拼接在一起。不像其它的系统主要是为了方便改装而设计的，OpenMotics 专注于硬件解决方案。更多资料请查阅来自 OpenMotics 的后端开发者 Frederick Ryckbosch的 <a href=\"https://opensource.com/life/14/12/open-source-home-automation-system-opemmotics\">完整文章</a> 。</p>\n<p>OpenMotics 使用 <a href=\"http://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html\">GPLv2</a> 许可证，它的源代码可以从 <a href=\"https://github.com/openmotics\">GitHub</a> 上下载。</p>\n<p>当然了，我们的选择不仅有这些。许多家庭自动化爱好者使用不同的解决方案，甚至是他们自己动手做。其它用户选择使用单独的智能家庭设备而无需集成它们到一个单一的综合系统中。</p>\n<p>如果上面的解决方案并不能满足你的需求，下面还有一些潜在的替代者可以去考虑：</p>\n<ul>\n<li><a href=\"http://www.eventghost.net/\">EventGhost</a> 是一个开源的（<a href=\"http://www.gnu.org/licenses/old-licenses/gpl-2.0.html\">GPL v2</a>）家庭影院自动化工具，它只能运行在 Microsoft Windows PC 上。它允许用户去控制多媒体电脑和连接的硬件，它通过触发宏指令的插件或者定制的 Python 脚本来使用。</li>\n<li><a href=\"http://iobroker.net/\">ioBroker</a> 是一个基于 JavaScript 的物联网平台，它能够控制灯、锁、空调、多媒体、网络摄像头等等。它可以运行在任何可以运行 Node.js 的硬件上，包括 Windows、Linux、以及 macOS，它使用 <a href=\"https://github.com/ioBroker/ioBroker#license\">MIT 许可证</a>。</li>\n<li><a href=\"https://www.jeedom.com/site/en/index.html\">Jeedom</a> 是一个由开源软件（<a href=\"http://www.gnu.org/licenses/old-licenses/gpl-2.0.html\">GPL v2</a>）构成的家庭自动化平台，它可以控制灯、锁、多媒体等等。它包含一个移动应用程序（Android 和 iOS），并且可以运行在 Linux PC 上；该公司也销售 hub，它为配置家庭自动化提供一个现成的解决方案。</li>\n<li><a href=\"http://www.linuxmce.com/\">LinuxMCE</a> 标称它是你的多媒体与电子设备之间的“数字粘合剂”。它运行在 Linux（包括树莓派）上，它基于 Pluto 开源 <a href=\"http://wiki.linuxmce.org/index.php/License\">许可证</a> 发布，它可以用于家庭安全、电话（VoIP 和语音信箱）、A/V 设备、家庭自动化、以及玩视频游戏。</li>\n<li><a href=\"http://opennethome.org/\">OpenNetHome</a>，和这一类中的其它解决方案一样，是一个控制灯、报警、应用程序等等的一个开源软件。它基于 Java 和 Apache Maven，可以运行在 Windows、macOS、以及 Linux —— 包括树莓派，它以 <a href=\"https://github.com/NetHome/NetHomeServer/blob/master/LICENSE\">GPLv3</a> 许可证发布。</li>\n<li><a href=\"https://www.smarthomatic.org/\">Smarthomatic</a> 是一个专注于硬件设备和软件的开源家庭自动化框架，而不仅是用户界面。它基于 <a href=\"https://github.com/breaker27/smarthomatic/blob/develop/GPL3.txt\">GPLv3</a> 许可证，它可用于控制灯、电器、以及空调、检测温度、提醒给植物浇水。</li>\n</ul>\n<p>现在该轮到你了：你已经准备好家庭自动化系统了吗？或者正在研究去设计一个。你对家庭自动化的新手有什么建议，你会推荐什么样的系统？</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113713\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113713votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113713\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/36430ccefda2f0d333a3bbac206945b3528bf1aa.jpg"},{"url_object_id": "c04253a00ce7d51d704df4838a462dc1", "title": "工程师思维，做不出好产品？", "url": "http://blog.jobbole.com/112125/", "create_date": "2018/03/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/15cdc9eaec6ba9ac858b0eaebfb6b949.jpg"], "praise_nums": "1", "comment_nums": 2, "fav_nums": 0, "tags": "职场,工程师", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://kimix.name/%E5%B7%A5%E7%A8%8B%E5%B8%AB%E6%80%9D%E7%B6%AD%EF%BC%8C%E5%81%9A%E4%B8%8D%E5%87%BA%E5%A5%BD%E7%94%A2%E5%93%81%EF%BC%9F/\">kimix</a>   </div><p>这不是一个鸡汤文，也不是警世文，这文章没什么结论和重点，你不会从这篇文章中获得什么领悟。</p>\n<p>恭喜你，你选择继续往下看，代表你对这标题也有一定程度的好奇，或许你也有同样的疑惑？</p>\n<p>「你的想法太工程师了，不适用在「一般」用户上，怎么可能用一般用户的角度去思考产品呢？」会这样说可能是你就是从事市场或和技术半毛关系都没有的岗位上。</p>\n<p>我觉得这个指控实在很莫名其妙，农夫讲出关于种树的话，渔夫讲出关于捞鱼的话，本该是天经地义的事，然后现在我们要进森林开垦，凭什么渔夫说的就是道理，农夫说的就是歪理呢。</p>\n<p>况且重点还是，最后要操刀的是农夫啊！</p>\n<p>世间上的事，都不是完全都是两极化的对与错，一件事通常面向都会超过一个，就取决于那是站在那一面观看，我要说的正是，软件工程师如何设计好产品。</p>\n<p>马云说过一句差不多这样的话，他说：他就是 QA，他不会用的产品，大概就不是什么好产品，因为大部分人都和他一样，是一个不懂技术的人。</p>\n<p>就单凭这句话，很多人就会抛开技术思维，抛开一切，就只想自己要做的「大方向」就好，那是当然的，做为一个领导，作为一艘船的导航，确实需要一个明确的方向，大家就尽力前进。但前进的动力来自哪里呢？你可以知道人家背后有多少水手不断研究划船的方法，才可以说出这句那么铿锵有力的话。</p>\n<p>「我考第一名，我从来不念书！」</p>\n<p>马云那番话字面上理解，那个思维是成立的，但事实上，越是简单的产品，RD 就必须花更多的时间和精力去思考，如果做出「简单」而产品的「直觉和简单」仅仅只是技术演进的结果罢了，千万不要忽略过程。</p>\n<p>我只想要飞，就往断崖跳，就肯定会死的。想要飞的心情我理解，但我们能不能坐下来谈谈如何办到「飞」这回事呢？</p>\n<p>而越简单的东西，越难做出来。</p>\n<p>有一个箱子，里面很冷，食物不会坏；一个箱子，里面有画面，哎！箱子好占空间，做到跟墙一样薄行不行？我想要一个放在口袋的电脑，看到的脸就开锁，啊，要确保一定会开喔，不要让我 demo 的时候开不了。</p>\n<p>概念谁都会说，根本不需要花很多时间在这个地方上。</p>\n<p>一个好产品，重点是要解决问题，是不是废话？是。</p>\n<p>那么要解决问题，要靠技术？还是靠想法？…</p>\n<p>你开始质疑自己了吧，你没有马上选技术，或者你选了想法？</p>\n<p>因为一般人是不会有这个认知的。你不用怀疑，好产品解决问题的重点，就是技术。不是想法。这两者有什么区别？会讲不会做，就叫做想法；会讲也会做，那是技术。但产品人员最爱放在嘴巴的一句话就是「技术不难，可以做得出来」、「技术可以办到」大部分的概念都是来自于别家产品，至于如何实现，还是一种跟网恋一样的概念，还没见过本人，但是照片看起来还不错。</p>\n<p>时至今日要找出，只要好点子，就有好活路的故事太少了，技术突破不了，就是一个「和别人差不多」的东西。既然是差不多，就没有必要多一个，面对消费者，你要怎么说服人家用你家的产品呢？</p>\n<p>我写了一大堆都是在靠北，没什么重点，那我先讲一个重点。</p>\n<p>「讲 HOW 不要讲 WHAT 和 WHY」</p>\n<p>一个组织要做什么事，应该不难决定，那就是一个决定。</p>\n<p>试想想，最近我有个朋友在想开餐厅的事，我就默默的观察，他会如何思考开餐厅的流程。</p>\n<p>他从菜单一路讲到店面，从行销和定位，说到 SWOT 和五力分析。都还没说到，如何做饭这个点上。虽然只是比喻，但是你可以想像餐厅本身最关键的除了价格，就是味道，好吃！最直接的竞争力，就是要</p>\n<p>「HOW 做到很好吃」一个点就好。</p>\n<p>而 HOW 的精髓，就是技术（技巧），做菜需要技巧；写程序也需要技巧，如何用什么工具解决什么问题（这是重点，我只是没有特别强调）是很重要的一个概念。</p>\n<p>就跟为什么这个控肉饭那么好吃，它是怎么办到的？！靠，那就是靠技术啊，每天做研究啊，研究又试做啊，然后失败又再来啊，不然你以为咧。</p>\n<p>至于说，技术本身是没有意义的，除非它用来解决问题。</p>\n<p>那就是一个重点了，要讲出问题在哪里（WHAT），和为什么会发生（WHY），即便这些很有可能都是在猜的，要讲出几个点那也不是一件难的差事，只差你愿不愿意面对而已，因为就算你说错了，也没有什么证据证明你是错的，你顶多只能怀疑，这个家伙在胡说。</p>\n<p>技术本身是没有意义的，就让我想起一个名人说的话，钱本身是没有意义的，除非你利用它！说到我帐户有几万千还没开始「利用」一样。那个重点不是这句话，重点是我没有钱啊！</p>\n<p>技术本身有没有价值，我不好说，但重点是，我们要先研究出技术啊！</p>\n<p>而很多时候，我们只需要一个菜单，就那么简单。但是可怕的事还不是没有菜单，而是有菜单还有一叠厚厚的明细，随着不懂做菜的人进厨房，然后还帮你为每个做菜步骤列名时间和顺序，然后当你仔细一看，那个根本不是做菜步骤，是上菜和吃饭的步骤，里面写的跟做菜一点屁关系都没有。</p>\n<p>这群人根本不在乎怎么做菜啊。</p>\n<p>但不要误会，半点也没有怪他们「为何不关心」做菜这事上。</p>\n<p>因为很多时候，甚至极大部分时候，工程师也是不关心如何「上菜」的，也不关心味道如何，只要时间内上菜，老板没有埋怨，客户没有中毒死，更也别说口碑好不好，有的厨师本来就是抱着能吃就好的心情做菜，竟然吃不死，就是好料理啦。</p>\n<p>但这主题是说「好产品」就不是能吃就好的东西了，要对味道和整个用餐过程都很有要求。</p>\n<p>就算不是五星，也要老板亲切啊，服务态度 UX 要好，UX 不是一个人的工作，UX 是一个团队的工作，一个集体带来的效益。大部分团队就是设计出图，PM 画 flow，RD 写 code；就跟打传说有人坦克，有人输出，有人牵制，但如果要胜出，就可能互相帮打，坦克输出会补刀，输出火力也要帮忙牵制，但是如果规定了坦克就只能挨打，牵制就只能在那边躲起来发功，那就死定了。</p>\n<p>分工的结果就如参加一个比赛，的确是顺利的把比赛结束了，但也别想说有什么惊喜的表现。</p>\n<p>写程序的人就会用工具了，尤其是前端，现在光是设一个开发环境，就用了一堆东西，有些太久没有用它还更新改版了，有天有个朋友请我帮忙做个事，我就拿着笔电狂 Key，滴滴答答的，一个多小时之后，我就「yeah」喊了一声，他就问「你弄好咯，感谢啦」</p>\n<p>我说「还没，但可以开始弄了！yeah」</p>\n<p>但我以一个消费者的立场，做出产品，至于好不好，是消费者自己的看法。千万不要一直和我说你东西有多好吃，我自己有嘴巴好嘛！如果不好吃，你和我说一百遍也不会好吃啊。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112125\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112125votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112125\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d6573fc92df4aa98014ce9dc55320411b7b5bf1d.jpg"},{"url_object_id": "19e4dca035c34d14347d07439ad43f77", "title": "计算机如何感知大数据——聚类算法", "url": "http://blog.jobbole.com/113745/", "create_date": "2018/04/04", "front_image_url": ["http://wx4.sinaimg.cn/mw690/63918611gy1fpachr4a3bj20rs0daags.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,图论,大数据,聚类", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaoai37\">LynnShaw</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.freecodecamp.com/how-machines-make-sense-of-big-data-an-introduction-to-clustering-algorithms-4bd97d4fbaba\">Peter Gleeso</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>看看下面这张图片。这是一个不同形状大小的昆虫的集合。花点时间按照相似程度将它们分成几组。</p>\n<p>这不是什么很有技巧性的问题。 我们从把蜘蛛分到一起开始。</p>\n<h6 class=\"section-inner sectionLayout--outsetColumn\" style=\"text-align: center;\"><img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fpachr4a3bj20rs0daags.jpg\"></h6>\n<h6 style=\"text-align: center;\">图片来自Google图片搜索，标记以便重用</h6>\n<p>做完了吗？虽然这里没有必要有所谓的正确答案，不过你极有可能将这些虫子分成四组。蜘蛛分成一组，蜗牛一组，蝴蝶和蛾子一族，黄蜂和蜜蜂总共三个一组。</p>\n<p class=\"section-inner sectionLayout--outsetColumn\">不算太糟糕，是吧？如果虫子数量是这个的两倍你可能还是会这么分，对吧？如果你有空余的时间——或者对昆虫学的热情——你甚至可能用相同方法对一百年个虫子这样分类。</p>\n<p class=\"section-inner sectionLayout--outsetColumn\">然而对一个机器来说，将十个目标分成多个有意义的群组是个不小的任务，多亏了数学中一个令人费解的分支<a href=\"https://en.wikipedia.org/wiki/Bell_number\">组合数学</a>，它告诉我们将十个昆虫分组共有115975种不同的可能。如果对二十个虫子进行分组，将会有<a href=\"https://www.wolframalpha.com/input/?i=bell%27s+number+%2820%29\">超过五十万亿</a>种不同的可能。</p>\n<p class=\"section-inner sectionLayout--outsetColumn\"> 如果对一百个虫子分类——方案数将是<a href=\"https://www.wolframalpha.com/input/?i=particles+in+universe\">宇宙中粒子的数量</a>的很多倍。多少倍呢？通过我的计算，大概是<a href=\"https://www.wolframalpha.com/input/?i=BellB%5B100%5D+%2F+number+of+particles+in+universe\">5*10的35次方倍</a>。事实上，有<a href=\"https://www.wolframalpha.com/input/?i=BellB%5B100%5D+%2F+googol\">四千万亿googol</a>多种方案（<a href=\"https://www.wolframalpha.com/input/?i=googol\">什么是googol?</a>）。仅仅是一百个目标。</p>\n<p class=\"section-inner sectionLayout--outsetColumn\">而这些方案几乎都是没有意义的——虽然从这些数量异常庞大的可能的选择中，你可以很快地找到为数不多的对虫子分类的有用的方式。</p>\n<p class=\"section-inner sectionLayout--outsetColumn\">我们人类理所当然的可以很快地对大量数据理解并分类。无论是一段文字，或者屏幕上的图像，或是一系列的目标——人类通常可以相当有效地搞清世界给我们的任何数据。</p>\n<p class=\"section-inner sectionLayout--outsetColumn\">鉴于发展人工智能和机器学习的一个关键方面就是让机器迅速理解庞大的输入数据集，那么有什么捷径吗？在这本文中，你将会看到三个聚类算法，机器可以这些算法快速理解大型数据集。这决不是一个详尽的清单——还有很多其他的算法——但这三个算法代表了一个良好的开端！</p>\n<p class=\"section-inner sectionLayout--outsetColumn\">当你想要使用它们的时候，你会得到对于每一个问题的总结，一个总体的功能介绍以及一个更细致的，一步一步实现的例子。我相信在现实中实现对于理解是非常有帮助的。如果你真的<em>很喜欢</em>这些，你会发现最好的学习方式是用笔和纸。加油去吧——没人评判哪种方式更好！</p>\n<h6 class=\"section-inner sectionLayout--outsetColumn\" style=\"text-align: center;\"><img src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fpachstvd8j20m80em762.jpg\"></h6>\n<h6 class=\"section-inner sectionLayout--outsetColumn\" style=\"text-align: center;\">三个整齐的聚类，K=3</h6>\n<h3 id=\"c662\" class=\"graf graf--h3 graf-after--figure\">K-均值聚类</h3>\n<h4 id=\"cf9b\" class=\"graf graf--h4 graf-after--h3\"><strong>适用场景：</strong></h4>\n<p>预先已经知道要分成多少组。</p>\n<h4 id=\"71dc\" class=\"graf graf--h4 graf-after--p\"><strong>如何工作：</strong></h4>\n<p id=\"ad35\" class=\"graf graf--p graf-after--h4\">算法首先将每一个观测点随机地分配到<em>K</em>个类别中的一个，然后计算每一个类别的<em>均值</em>。下一步，在重新计算均值之前算法将每一个点重新分配给均值与该点数据最接近的类别。不断重复这一步直到不需要再重新分配。</p>\n<h4 id=\"6699\" class=\"graf graf--h4 graf-after--p\"><strong>实现例子：</strong></h4>\n<p id=\"cd33\" class=\"graf graf--p graf-after--h4\">考虑有12个足球运动员的一个足球队，这些运动员每个人在本赛季都获得了一定的进球数（3-30之间）。现在我们来将他们分成三个单独的聚类。</p>\n<p class=\"graf graf--p graf-after--h4\"><strong>第一步</strong>需要我们随机地将这些运动员分成三组并计算每组的均值。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e460620104912\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGroup 1\r\nPlayer A (5 goals), Player B (20 goals), Player C (11 goals) \r\nGroup Mean = (5 + 20 + 11) / 3 = 12\r\n\r\nGroup 2\r\nPlayer D (5 goals), Player E (3 goals), Player F (19 goals)\r\nGroup Mean = 9\r\n\r\nGroup 3\r\nPlayer G (30 goals), Player H (3 goals), Player I (15 goals)\r\nGroup Mean = 16</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e460620104912-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e460620104912-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e460620104912-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e460620104912-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e460620104912-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e460620104912-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e460620104912-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e460620104912-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e460620104912-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e460620104912-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e460620104912-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e460620104912-1\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e460620104912-2\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e460620104912-3\"><span class=\"crayon-e\">Group </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e460620104912-4\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e460620104912-5\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e460620104912-6\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">D</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">E</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e460620104912-7\"><span class=\"crayon-e\">Group </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e460620104912-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e460620104912-9\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e460620104912-10\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">G</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">H</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e460620104912-11\"><span class=\"crayon-e\">Group </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<p class=\"graf graf--p graf-after--h4\"><strong>第二步：</strong>对每一个运动员，将它们重新分配到均值离他们最近的组。即，运动员A（进球数5）被分配到第2个组（均值=9）。然后重新计算这几组的均值。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e469828025568\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGroup 1 (Old Mean = 12)\r\nPlayer C (11 goals) \r\nNew Mean = 11\r\n\r\nGroup 2 (Old Mean = 9)\r\nPlayer A (5 goals), Player D (5 goals), Player E (3 goals), Player H (3 goals)\r\nNew Mean = 4\r\n\r\nGroup 3 (Old Mean = 16)\r\nPlayer G (30 goals), Player I (15 goals), Player B (20 goals), Player F (19 goals)\r\nNew Mean = 21</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e469828025568-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e469828025568-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e469828025568-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e469828025568-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e469828025568-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e469828025568-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e469828025568-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e469828025568-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e469828025568-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e469828025568-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e469828025568-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e469828025568-1\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Old </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e469828025568-2\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e469828025568-3\"><span class=\"crayon-r\">New</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e469828025568-4\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e469828025568-5\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Old </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e469828025568-6\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">D</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">E</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">H</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e469828025568-7\"><span class=\"crayon-r\">New</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e469828025568-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e469828025568-9\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Old </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e469828025568-10\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">G</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e469828025568-11\"><span class=\"crayon-r\">New</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>不断<strong>重复</strong>第二步直到所有组的均值不再变化。对于这个有些不太好的例子，下一次重复就会达到终止条件。<strong>停止！</strong>现在你已经形成三个聚类的数据集！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e46d810100230\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGroup 1 (Old Mean = 11)\r\nPlayer C (11 goals), Player I (15 goals)\r\nFinal Mean = 13\r\n\r\nGroup 2 (Old Mean = 4)\r\nPlayer A (5 goals), Player D (5 goals), Player E (3 goals), Player H (3 goals)\r\nFinal Mean = 4\r\n\r\nGroup 3 (Old Mean = 21)\r\nPlayer G (30 goals), Player B (20 goals), Player F (19 goals)\r\nFinal Mean = 23</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e46d810100230-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e46d810100230-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e46d810100230-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e46d810100230-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e46d810100230-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e46d810100230-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e46d810100230-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e46d810100230-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e46d810100230-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e46d810100230-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e46d810100230-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e46d810100230-1\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Old </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e46d810100230-2\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e46d810100230-3\"><span class=\"crayon-m\">Final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e46d810100230-4\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e46d810100230-5\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Old </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e46d810100230-6\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">D</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">E</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">H</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e46d810100230-7\"><span class=\"crayon-m\">Final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e46d810100230-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e46d810100230-9\"><span class=\"crayon-i\">Group</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Old </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e46d810100230-10\"><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">G</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Player</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">goals</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e46d810100230-11\"><span class=\"crayon-m\">Final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>在这个例子中，聚类可能对应于球员在场上的位置——如后卫、中场和前锋。k-均值在这里使用因为我们合理地预期数据可以分成这三类。</p>\n<p>通过这种方式，给出一系列性能统计数据，机器可以合理地评估任何团体运动中运动员的位置——这对运动分析很有用，对任何其他的将数据集按照预定义的组别进行分类也可以提供相关的见解。</p>\n<h4 id=\"27e9\" class=\"graf graf--h4 graf-after--p\"><strong>细节：</strong></h4>\n<p id=\"7aa0\" class=\"graf graf--p graf-after--h4\">这个算法有一些变体。对聚类进行“seeding”的初始化方法有好几种方式。在这里，我们将每个球员随机分配到一个小组，然后计算出这些组的均值。这会导致初始生成的组之间的均值很接近，致使后面有更多重复步骤。</p>\n<p class=\"graf graf--p graf-after--h4\">另一种方法是初始化每个聚类时只分配一个球员，然后将其它球员分配到最近的聚类。这样返回的聚类比初始化seeding得到的聚类更有意义，降低了变化很大的数据集中的重复性。但是，这种方法可能会减少完成算法所需的迭代次数，因为这些组将花费较少的时间完成收敛。</p>\n<p class=\"graf graf--p graf-after--h4\">K-均值聚类的一个明显的缺点是你必须提供关于你期望找到多少个聚类的<em>先验</em>假设。 有一些方法可以评估一组特定的聚类结果。 例如，聚类内平方和（<em class=\"markup--em markup--p-em\">Within-Cluster  </em><a href=\"https://en.wikipedia.org/wiki/Partition_of_sums_of_squares\"><em>Sum-of-Squares</em></a>）是每个聚类内方差的度量。 聚类效果越好，整体WCSS越低。</p>\n<h3 id=\"acbe\" class=\"graf graf--h3 graf-after--p\">层次聚类</h3>\n<h4 id=\"1eb8\" class=\"graf graf--h4 graf-after--h3\"><strong>什么时候使用：</strong></h4>\n<p>…你希望发掘出你的观测数据之间的潜在关系。</p>\n<p><strong>如何工作：</strong></p>\n<p id=\"6625\" class=\"graf graf--p graf-after--h4\">计算距离矩阵，其中矩阵元素(i,j)的值是观察值i和j之间的距离度量值。 然后，将最接近的两个观察值进行配对并计算其平均值。通过将配对的观测值合并成一个单一的对象，形成一个新的距离矩阵。 从这个距离矩阵中，配对最近的两个观察值并计算它们的平均值。 重复这个过程，直到所有的观察结果合并在一起。</p>\n<p><strong>实例：</strong></p>\n<p id=\"6bb0\" class=\"graf graf--p graf-after--h4\">这是一个关于鲸鱼和海豚物种选择的超简化数据集。作为一名训练有素的生物学家，我可以向您保证，我们通常会使用更多更详细的数据集来<a href=\"https://en.wikipedia.org/wiki/Phylogenetic_tree\">重建系统发生树</a>。 现在我们来看看这六种物种的典型体长。 我们将只使用两个重复的步骤。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e473413141184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSpecies          Initials  Length(m)\r\nBottlenose Dolphin     BD        3.0\r\nRisso's Dolphin        RD        3.6\r\nPilot Whale            PW        6.5\r\nKiller Whale           KW        7.5\r\nHumpback Whale         HW       15.0\r\nFin Whale              FW       20.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e473413141184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e473413141184-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e473413141184-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e473413141184-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e473413141184-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e473413141184-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e473413141184-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e473413141184-1\"><span class=\"crayon-e\">Species          </span><span class=\"crayon-e\">Initials  </span><span class=\"crayon-e\">Length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e473413141184-2\"><span class=\"crayon-e\">Bottlenose </span><span class=\"crayon-e\">Dolphin     </span><span class=\"crayon-i\">BD</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3.0</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e473413141184-3\"><span class=\"crayon-i\">Risso</span>'<span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dolphin        </span><span class=\"crayon-i\">RD</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3.6</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e473413141184-4\"><span class=\"crayon-e\">Pilot </span><span class=\"crayon-e\">Whale            </span><span class=\"crayon-i\">PW</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">6.5</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e473413141184-5\"><span class=\"crayon-e\">Killer </span><span class=\"crayon-e\">Whale           </span><span class=\"crayon-i\">KW</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">7.5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e473413141184-6\"><span class=\"crayon-e\">Humpback </span><span class=\"crayon-e\">Whale         </span><span class=\"crayon-i\">HW</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">15.0</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e473413141184-7\"><span class=\"crayon-e\">Fin </span><span class=\"crayon-e\">Whale              </span><span class=\"crayon-i\">FW</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">20.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<p class=\"graf graf--p graf-after--h4\"><strong>步骤1：</strong>计算每个物种之间的距离矩阵。在这里，我们将使用<a href=\"https://en.wikipedia.org/wiki/Euclidean_distance\">欧式距离</a>——数据点之间的距离。你可以计算出距离就像在道路图上查看距离图一样。可以通过读取相关行和列的交点处的值来查找任何物种对之间的长度差异。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e477281107098\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    BD   RD   PW   KW   HW\r\nRD  0.6                    \r\nPW  3.5  2.9               \r\nKW  4.5  3.9  1.0          \r\nHW 12.0 11.4  8.5  7.5     \r\nFW 17.0 16.4 13.5 12.5  5.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e477281107098-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e477281107098-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e477281107098-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e477281107098-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e477281107098-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e477281107098-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e477281107098-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">BD   </span><span class=\"crayon-e\">RD   </span><span class=\"crayon-e\">PW   </span><span class=\"crayon-e\">KW   </span><span class=\"crayon-e\">HW</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e477281107098-2\"><span class=\"crayon-i\">RD</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.6</span><span class=\"crayon-h\">                    </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e477281107098-3\"><span class=\"crayon-i\">PW</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3.5</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2.9</span><span class=\"crayon-h\">               </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e477281107098-4\"><span class=\"crayon-i\">KW</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4.5</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3.9</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\">          </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e477281107098-5\"><span class=\"crayon-i\">HW</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11.4</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8.5</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7.5</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e477281107098-6\"><span class=\"crayon-i\">FW</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16.4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13.5</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.5</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<p id=\"7109\" class=\"graf graf--p graf-after--pre\"><strong>步骤2：</strong>配对两个最接近的物种。在这里，两个最接近的物种是宽吻海豚和灰海豚，平均长度为3.3米。</p>\n<p id=\"d409\" class=\"graf graf--p graf-after--p\"><strong>重复</strong>步骤1重新计算距离矩阵，但是这次将宽吻海豚和灰海豚合并成长度为3.3m的单个对象。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e482396420094\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    [BD, RD]   PW   KW   HW\r\nPW       3.2               \r\nKW       4.2   1.0          \r\nHW      11.7   8.5  7.5     \r\nFW      16.7  13.5 12.5  5.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e482396420094-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e482396420094-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e482396420094-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e482396420094-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e482396420094-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e482396420094-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">BD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RD</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">PW   </span><span class=\"crayon-e\">KW   </span><span class=\"crayon-e\">HW</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e482396420094-2\"><span class=\"crayon-i\">PW</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3.2</span><span class=\"crayon-h\">               </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e482396420094-3\"><span class=\"crayon-i\">KW</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">4.2</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\">          </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e482396420094-4\"><span class=\"crayon-i\">HW</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">11.7</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">8.5</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7.5</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e482396420094-5\"><span class=\"crayon-i\">FW</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">16.7</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">13.5</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.5</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<p id=\"77af\" class=\"graf graf--p graf-after--pre\"><strong>接下来</strong>，用这个新距离矩阵重复步骤2。现在，距离最小的是领航鲸与逆戟鲸，所以我们计算他们的平均——7.0米。</p>\n<p class=\"graf graf--p graf-after--p\"><strong>然后</strong>，我们重复第1步——重新计算距离矩阵，但是现在我们已经将领航鲸与逆戟鲸合并成了一个长度为7.0米的单个对象。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e486458088616\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n         [BD, RD] [PW, KW]   HW\r\n[PW, KW]      3.7              \r\nHW           11.7      8.0     \r\nFW           16.7     13.0   5.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e486458088616-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e486458088616-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e486458088616-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e486458088616-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e486458088616-1\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">BD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RD</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">PW</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KW</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">HW</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e486458088616-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">PW</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KW</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">3.7</span><span class=\"crayon-h\">              </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e486458088616-3\"><span class=\"crayon-i\">HW</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">11.7</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">8.0</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e486458088616-4\"><span class=\"crayon-i\">FW</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">16.7</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">13.0</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">5.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<p id=\"da48\" class=\"graf graf--p graf-after--pre\"><strong>接下来</strong>，我们用这个距离矩阵重复步骤2。最小距离是两个合并对象之间的（3.7米）——现在我们将它们合并成一个更大的对象，并取平均值（即5.2米）。</p>\n<p class=\"graf graf--p graf-after--p\"><strong>然后</strong>，我们重复步骤1并计算一个新的距离矩阵，合并了宽吻海豚和灰海豚与领航鲸与逆戟鲸。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e489718147658\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n   [[BD, RD] , [PW, KW]]    HW\r\nHW                   9.8    \r\nFW                  14.8   5.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e489718147658-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e489718147658-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e489718147658-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e489718147658-1\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">BD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RD</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">PW</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KW</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">HW</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e489718147658-2\"><span class=\"crayon-i\">HW</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">9.8</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e489718147658-3\"><span class=\"crayon-i\">FW</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">14.8</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">5.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<p id=\"cf09\" class=\"graf graf--p graf-after--pre\"><strong>接下来</strong>，我们重复步骤2。最小的距离（5.0米）在座头鲸与长须鲸之间，所以我们将它们合并成一个单一的对象，取平均值（17.5米）。</p>\n<p id=\"a88d\" class=\"graf graf--p graf-after--p\"><strong>然后</strong>，返回步骤1——计算距离矩阵，座头鲸与长须鲸已经合并。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e48d900730592\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n         [[BD, RD] , [PW, KW]]\r\n[HW, FW]                  12.3</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e48d900730592-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e48d900730592-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e48d900730592-1\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">BD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RD</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">PW</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KW</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e48d900730592-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">HW</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FW</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">12.3</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<p class=\"graf graf--p graf-after--p\"><strong>最后</strong>，我们重复步骤2——在这个矩阵中只有一个距离（12.3米），我们把所有东西都放在一个大对象中，现在我们可以停下来了！我们来看看最后的合并对象：</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e490033770669\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[[[BD, RD],[PW, KW]],[HW, FW]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e490033770669-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e490033770669-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">BD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RD</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">PW</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KW</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">HW</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FW</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<p class=\"graf graf--p graf-after--p\">它有一个嵌套的结构（可以认为是<a href=\"http://json.org/example.html\">JSON</a>），可以把它绘制成一个树状的图形或者树形图。 它读取的方式与家谱相同。 两个观察结果在树上离得越近，就被认为是更相似或更密切相关的。</p>\n<div class=\"aspectRatioPlaceholder is-locked\"> <img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fpachtrft4j20dc0dc3yh.jpg\"></div>\n<p class=\"graf graf--p graf-after--p\">在<a href=\"http://www.r-fiddle.org/#\">R-Fiddle.org</a>上生成一个简单的树状图</p>\n<p id=\"e2dc\" class=\"graf graf--p graf-after--figure\">树状图的结构使我们能够深入了解数据集的结构。在我们的例子中，我们看到两个主要分支，一个分支是 HW 和 FW，另一个是 BD、RD、PW、KW。</p>\n<p id=\"5b08\" class=\"graf graf--p graf-after--p\">在进化生物学中，具有更多样本和测量的更大的数据集以这种方式被用来推断它们之间的分类关系。 除了生物学之外，层次聚类在数据挖掘和机器学习环境中也有应用。</p>\n<p id=\"a111\" class=\"graf graf--p graf-after--p\">很酷的是，这种方法不需要假设你正在寻找的聚类数量。 您可以通过在给定高度“切割”树来将返回的树形图划分为聚类。 这个高度可以通过多种方式进行选择，具体取决于你希望对数据进行聚类的分辨率。</p>\n<p id=\"c890\" class=\"graf graf--p graf-after--p\">例如，从上面的树状图可以看出，如果我们在高度为10的情况下绘制一条水平线，我们就会将两条主要分支分割，将树状图分成两个子图。 如果我们在高度= 2切割，树状图就被分成三个聚类。</p>\n<p><strong>细节：</strong></p>\n<p id=\"a2ce\" class=\"graf graf--p graf-after--h4\">关于层次聚类算法可以出现的变化，基本上有三个方面。</p>\n<p class=\"graf graf--p graf-after--h4\">最根本的是方法——在这里，我们使用了一个<em>凝聚</em>的过程，我们从单个数据点开始，并将它们迭代地聚集在一起，直到剩下一个大聚类。 另一种（但是计算量更大）的方法是从一个大聚类开始，然后将数据分成越来越小的聚类，直到剩下孤立的数据点为止。</p>\n<p class=\"graf graf--p graf-after--h4\">还有一系列的方法可以用来计算距离矩阵。 很多情况下，欧几里得距离（参考毕达哥拉斯定理）就足够了，但是在某些情况下还有其他可能更适用的选择。</p>\n<p class=\"graf graf--p graf-after--h4\">最后，连接标准也可以变化。 聚类根据彼此之间的距离而相互连接，但是我们定义“近”的方式是灵活的。 在上面的例子中，我们测量了每个组的平均值（或“质心”）之间的距离，并将最近的组进行配对。 但是， 你可能想要使用其他的定义。</p>\n<p class=\"graf graf--p graf-after--h4\">例如，每个聚类由多个离散点组成。 我们可以将两个聚类之间的距离定义为任意点之间的最小（或最大）距离——如下图所示。 还有其他方法来定义连接标准，它们可能适用于不同的环境。</p>\n<p class=\"graf graf--p graf-after--h4\"><img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fpachuzciuj20m80cgmyu.jpg\"></p>\n<p class=\"graf graf--p graf-after--h4\" style=\"text-align: center;\">红/蓝：形心连接；红色/绿色：最少连接；绿/蓝：最大连接</p>\n<h3 id=\"b664\" class=\"graf graf--h3 graf-after--figure\">图社区发现</h3>\n<h4 id=\"f884\" class=\"graf graf--h4 graf-after--h3\"><strong>什么时候使用：</strong></h4>\n<p id=\"7a65\" class=\"graf graf--p graf-after--h4\">…你可以将数据表示为网络或“图”的时候。</p>\n<h4 id=\"71dc\" class=\"graf graf--h4 graf-after--p\"><strong>如何工作：</strong></h4>\n<p id=\"6e96\" class=\"graf graf--p graf-after--h4\">图中的社区通常被定义为与网络其余部分相比，彼此连接更多的顶点的子集。 存在各种算法来基于更具体的定义来识别社区。 算法包括但不限于：Edge Betweenness，Modularity-Maximsation，Walktrap，Clique Percolation，Leading Eigenvector …</p>\n<h4 id=\"6699\" class=\"graf graf--h4 graf-after--p\"><strong>实现例子：</strong></h4>\n<p id=\"6cc8\" class=\"graf graf--p graf-after--h4\"><a href=\"https://en.wikipedia.org/wiki/Graph_theory\">图论</a>或网络的数学研究是数学的一个有趣的分支，它让我们将复杂系统建模为由“线”（或边）连接的“点”（或顶点）的抽象集合。</p>\n<p id=\"a226\" class=\"graf graf--p graf-after--p\">最直观的案例研究也许就是社交网络了。在这里，顶点代表人，边连接的是朋友/关注者的顶点。 然而，如果你能证明一个方法可以有意义地连接不同的部分，任何系统都可以被建模为一个网络。 图论中聚类的创新应用包括从图像数据中提取特征，分析基因调控网络。</p>\n<p id=\"30e4\" class=\"graf graf--p graf-after--p\">作为一个入门级的例子，看看这个快速组合在一起的图。 它显示了我最近访问过的八个网站，根据它们各自的维基百科文章是否彼此连接而连接在一起。 您可以手动组合这些数据，但是对于大型项目，编写Python脚本执行相同的操作要快得多。<a href=\"https://raw.githubusercontent.com/pg0408/Medium-articles/master/graph_maker.py\">这是我之前写的一个</a>。</p>\n<p id=\"3c6b\" class=\"graf graf--p graf-after--figure\"><img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fpachw50t6j20et093gm1.jpg\"></p>\n<p class=\"graf graf--p graf-after--figure\">根据其社区成员对顶点进行着色，并根据其中心位置来确定大小。 看看Google和Twitter是最中心的吧？</p>\n<p class=\"graf graf--p graf-after--p\">而且，这些聚类在现实世界中也很有意义（一直一个重要的性能指标）。黄色的顶点通常是参考/搜索网站；蓝色顶点全部用于在线发布（文章，推文或代码）；红色的顶点包括YouTube，因为Youtube是由前PayPal员工创建的。 机器推论的不错！</p>\n<p class=\"graf graf--p graf-after--p\">除了作为有用的大型系统可视化的方式之外，网络的真正威力是其数学分析。 让我们开始把我们的这张网络图片变成一种更加数学的格式。 以下是网络的邻接矩阵。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e498939443064\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n         GH Gl  M  P  Q  T  W  Y\r\nGitHub    0  1  0  0  0  1  0  0  \r\nGoogle    1  0  1  1  1  1  1  1\r\nMedium    0  1  0  0  0  1  0  0\r\nPayPal    0  1  0  0  0  1  0  1\r\nQuora     0  1  0  0  0  1  1  0\r\nTwitter   1  1  1  1  1  0  0  1\r\nWikipedia 0  1  0  0  1  0  0  0\r\nYouTube   0  1  0  1  0  1  0  0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e498939443064-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e498939443064-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e498939443064-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e498939443064-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e498939443064-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e498939443064-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e498939443064-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e498939443064-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e498939443064-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e498939443064-1\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">GH </span><span class=\"crayon-i\">Gl</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">M</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">P</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">W</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">Y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e498939443064-2\"><span class=\"crayon-i\">GitHub</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e498939443064-3\"><span class=\"crayon-i\">Google</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e498939443064-4\"><span class=\"crayon-i\">Medium</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e498939443064-5\"><span class=\"crayon-i\">PayPal</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e498939443064-6\"><span class=\"crayon-i\">Quora</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e498939443064-7\"><span class=\"crayon-i\">Twitter</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e498939443064-8\"><span class=\"crayon-i\">Wikipedia</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e498939443064-9\"><span class=\"crayon-i\">YouTube</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<p id=\"7ad5\" class=\"graf graf--p graf-after--pre\">每行和每列交点处的值记录该对顶点之间是否存在边。例如，Medium和Twitter之间存在一条边（惊喜！），所以它们的行/列相交的值是1。同样，Medium和PayPal之间没有边，所以它们行/列交点的值为0。</p>\n<p id=\"fd3d\" class=\"graf graf--p graf-after--p\">在邻接矩阵内进行编码就会得到这个网络的所有属性——它给了我们解锁各种有价值见解的钥匙。首先，将任意列（或行）相加，就可以得出每个顶点的度数——即连接了多少个顶点。通常用字母<em>k</em>表示。</p>\n<p id=\"7634\" class=\"graf graf--p graf-after--p\">同样，将每个顶点的度数相加并除以2得到L，即网络中边（或“连接”）的数量。行数/列数即网络中顶点（或“节点”）的数量，用<em>N</em>表示。</p>\n<p id=\"bc6b\" class=\"graf graf--p graf-after--p\">知道<em>k</em>，<em>L</em>，<em>N</em>和邻接矩阵<em>A</em>中每个单元的值，就可以计算任意给定的网络聚类的<em><a href=\"https://en.wikipedia.org/wiki/Modularity_%28networks%29\">模块性</a></em>。</p>\n<p id=\"facf\" class=\"graf graf--p graf-after--p\">假设我们已经将网络聚类成了一些社区。我们可以使用模块性评分来评估这个聚类的“质量”。更高的分数将表明我们已经把网络分成了“准确”的社区，而低分表明我们的聚类更随机。下面的图片说明了这一点。</p>\n<figure id=\"b803\" class=\"graf graf--figure graf-after--p\">\n<figcaption class=\"imageCaption\"><img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fpachxk96wj20m80aggnj.jpg\"></figcaption>\n<figcaption class=\"imageCaption\">模块性是衡量分区“质量”的指标。</figcaption>\n</figure>\n<p id=\"e812\" class=\"graf graf--p graf-after--figure\">模块性可以使用下面的公式计算：</p>\n<p id=\"4d1a\" class=\"graf graf--p graf-after--figure\"><img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fpachz41ulj20m8089t94.jpg\"></p>\n<p class=\"graf graf--p graf-after--figure\">这个公示包含相当数量的数学知识，但我们可以一点一点地分解它，使它更好理解。</p>\n<p class=\"graf graf--p graf-after--p\"><em>M</em>当然是我们正在计算的——模块性。</p>\n<p class=\"graf graf--p graf-after--p\">1/2<em>L</em>告诉我们把后面所有的东西除以2<em>L</em>，即网络中边的数量的两倍。到现在为止，一切都很好理解。</p>\n<p class=\"graf graf--p graf-after--figure\"><strong>Σ</strong>符号告诉我们对右边的所有东西求和，并迭代邻接矩阵<em>A</em>中的每一行和列。对于那些不熟悉求和符号的人来说，<em>i，j = 1</em>和<em>N</em>的作用非常像编程中的嵌套for循环。在Python中，你可以这样写：</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e49d526108212\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsum = 0\r\n\r\nfor i in range(1,N):\r\n    for j in range(1,N):\r\n        ans = #stuff with i and j as indices\r\n        sum += ans</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e49d526108212-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e49d526108212-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e49d526108212-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e49d526108212-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e49d526108212-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e49d526108212-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e49d526108212-1\"><span class=\"crayon-v\">sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e49d526108212-2\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e49d526108212-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e49d526108212-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e49d526108212-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ans</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#stuff with i and j as indices</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e49d526108212-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ans</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p></p>\n<p class=\"graf graf--p graf-after--figure\"><code class=\"markup--code markup--p-code\">那么#stuff with i and j</code> 具体是什么？</p>\n<p id=\"1f91\" class=\"graf graf--p graf-after--p\">括号里的东西告诉我们从<em>A_ij</em>中减去<em>（k_i k_j）/ 2L</em>。</p>\n<p id=\"4555\" class=\"graf graf--p graf-after--p\"><em>A_ij</em>是邻接矩阵中第<em>i</em>行第<em>j</em>列的值。</p>\n<p id=\"1ca6\" class=\"graf graf--p graf-after--p\"><em>k_i</em>和<em>k_j</em>的值是每个顶点的度数——通过将第<em>i</em>行和第<em>j</em>列中的项分别相加而得到。将它们相乘并除以<em>2L</em>得到如果网络是随机分布的顶点<em>i</em>和<em>j</em>之间的期望的边数。</p>\n<p class=\"graf graf--p graf-after--p\">总的来说，括号中的项表示网络的真实结构和随机重组的预期结构之间的差异。研究这个值表明，当<em>A_ij = 1，（k_i k_j）/ 2L</em>小的时候，它返回最大值。这意味着如果在顶点<em>i</em>和<em>j</em>之间存在“非预期”边缘，我们会看到更大的值。</p>\n<p class=\"graf graf--p graf-after--p\">最后，我们将括号中的项和后面几个符号相乘。</p>\n<p class=\"graf graf--p graf-after--p\"><em>δc_i</em>，<em>c_j</em>就是有名的 <em class=\"markup--em markup--p-em\">Kronecker-delta </em><em>函数</em>。 这里是其Python解释：</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9a5e4a1823006612\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef Kronecker_Delta(ci, cj):\r\n    if ci == cj:\r\n        return 1\r\n    else:\r\n        return 0\r\n\r\nKronecker_Delta(\"A\",\"A\")    #returns 1\r\nKronecker_Delta(\"A\",\"B\")    #returns 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e4a1823006612-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e4a1823006612-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e4a1823006612-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e4a1823006612-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e4a1823006612-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e4a1823006612-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9a5e4a1823006612-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9a5e4a1823006612-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e4a1823006612-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">Kronecker_Delta</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ci</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e4a1823006612-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ci</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cj</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e4a1823006612-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e4a1823006612-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e4a1823006612-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e4a1823006612-6\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9a5e4a1823006612-7\"><span class=\"crayon-e\">Kronecker_Delta</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"A\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"A\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#returns 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9a5e4a1823006612-8\"><span class=\"crayon-e\">Kronecker_Delta</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"A\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"B\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#returns 0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<p class=\"graf graf--p graf-after--p\">是的——这真的很简单。Kronecker-delta函数有两个参数，如果相同则返回1，否则返回0。</p>\n<p class=\"graf graf--p graf-after--p\">这意味着如果顶点i和j已经被放入同一个聚类中，则δc_i，c_j = 1。否则，如果它们在不同的聚类中，则该函数返回0。</p>\n<p class=\"graf graf--p graf-after--p\">我们用这个Kronecker-delta函数乘以括号中的项，我们发现对于嵌套总和Σ，当分配给同一个聚类很多“非预期”的连接顶点的边时，其结果是最高的。因此，模块性是衡量图如何聚类到不同社区中的一种衡量标准。</p>\n<p id=\"7643\" class=\"graf graf--p graf-after--p\">除以<em>2L</em>这一操作将模块性的上限值界定为1。模块性分数接近或低于0表示网络的当前聚类实际上是无用的。模块性值越高，网络分散到不同社区的聚类越好。通过最大化模块性，我们可以找到聚类网络的最佳方式。</p>\n<p id=\"4f28\" class=\"graf graf--p graf-after--p\">请注意，我们必须预先定义图形如何聚类，以找出聚类实际上的“好”。不幸的是，使用暴力对图的每一种可能的聚类方式进行计算，以找到<br>\n具有最高模块性分数的方式，即使是在有限样本大小的情况下也是不可能的。</p>\n<p class=\"graf graf--p graf-after--p\"><a href=\"https://en.wikipedia.org/wiki/Partition_of_a_set#Counting_partitions\">组合学</a>告诉我们，对于只有8个顶点的网络，有4140种不同的聚类方式。 规模两倍的16个顶点的网络将有超过一百亿种可能的聚集顶点的方式。再次将网络加倍（对一个非常适中的32个顶点）将会产生128 septillion （128*10^24）种可能的方式，而且有八十个顶点的网络的聚类方式将比<a href=\"https://www.wolframalpha.com/input/?i=991267988808424794443839434655920239360814764000951599022939879419136287216681744888844&amp;lk=1&amp;rawformassumption=%22ClashPrefs%22+-%3E+%7B%22Math%22%7D\">宇宙中可观察的原子数还多</a>。</p>\n<p class=\"graf graf--p graf-after--p\">所以，我们不得不转向一种<em>启发式的</em>方法，该方法在评估可以产生最高模块性分数的聚类方面做得相当不错，而不是尝试每一种可能性。 这是一种叫Fast-Greedy Modularity-Maximization的算法，它有点类似于上面描述的凝聚层次聚类算法。 “Mod-Max”不是根据距离进行合并，而是根据模块性的变化来合并。它是这样工作的：</p>\n<p id=\"db81\" class=\"graf graf--p graf-after--p\"><strong>首先</strong>将每个顶点分配到自己的社区，然后计算整个网络的模块性。</p>\n<p id=\"80a1\" class=\"graf graf--p graf-after--p\"><strong>第一步</strong>要求每一个社区至少被一条单边连接，如果两个社区合并为一个，算法计算模块性的变化结果<em>ΔM</em>。</p>\n<p id=\"09cd\" class=\"graf graf--p graf-after--p\">然后，<strong>步骤2</strong>将使得<em>ΔM</em>增加最多的一对社区合并。为这个聚类计算新的模块性<em>M</em>，并记录下来。</p>\n<p id=\"8228\" class=\"graf graf--p graf-after--p\"><strong>重复</strong>步骤1和2——每次合并产生最大<em>ΔM</em>增益的社区，然后记录新的聚类模式及其相关的模块性评分<em>M</em>。</p>\n<p id=\"80a6\" class=\"graf graf--p graf-after--p\">当所有的顶点被分成一个大聚类时<strong>停下来</strong>。现在，算法检查它整个过程的记录，并确定返回最高值<em>M</em>的聚类模式。这就是返回的社区结构。</p>\n<p><strong>细节：</strong></p>\n<p id=\"37cf\" class=\"graf graf--p graf-after--h4\">这需要进行的计算太多了，至少对于我们人类来说。图论中有丰富的计算难题，通常是NP-hard问题，但它也具有难以置信的潜力，为复杂的系统和数据集提供有价值的见解。与Larry Page同名的PageRank算法——帮助Google在不到一代人的时间里从初创阶段发展到了几乎统治世界——完全基于图论。</p>\n<p id=\"8eec\" class=\"graf graf--p graf-after--p\">社区发现是当前图论研究的一个焦点问题，模块性最大化有许多替代方案，虽然有用，但也有一些缺点。</p>\n<p id=\"7379\" class=\"graf graf--p graf-after--p\">一开始，其聚集的方法往往将小而明确的社区吞并为大的社区。 这就是所谓的分辨率限制——算法不会在一定大小以内找到社区。 另一个挑战是，Mod-Max方法实际上倾向于产生许多具有类似的高模块性分数组成的“高原”，而不是一个独特的，易于到达的全局高峰值，这导致有时候难以确定最大分数。</p>\n<p id=\"3c5a\" class=\"graf graf--p graf-after--p\">其他算法使用不同的方式来定义和处理社区发现。<em class=\"markup--em markup--p-em\">Edge-Betweenness</em>是一个分裂的算法，从所有顶点分组在一个大聚类开始。持续迭代去除网络中最不重要的边，直到所有的顶点都被分开。这个过程产生了一个层级结构，类似的顶点在层级结构中更接近。</p>\n<p id=\"dd08\" class=\"graf graf--p graf-after--p\">另一种算法是<em class=\"markup--em markup--p-em\">Clique Percolation</em>，它考虑了图社区之间可能的重叠。 还有另一组算法是基于图上的<a href=\"https://en.wikipedia.org/wiki/Random_walk\">随机漫步</a>，然后是<em><a href=\"https://en.wikipedia.org/wiki/Spectral_clustering\">谱聚类</a></em>方法，它从邻接矩阵和由其导出的其它矩阵的特征分解开始研究。这些方法被用于例如计算机视觉等领域的特征提取。</p>\n<p id=\"b391\" class=\"graf graf--p graf-after--p\">给每个算法提供一个深入的实例，这已经远远超出了本文的范围。我想说的是，这是一个活跃的研究领域，它提供了强大的方法来理解数据，即使在十年前还是个非常困难的过程。</p>\n<h3 id=\"6ec6\" class=\"graf graf--h3 graf-after--p\">结论</h3>\n<p id=\"4fee\" class=\"graf graf--p graf-after--h3\">希望这篇文章能够让你更好地理解机器如何理解大数据。未来瞬息万变，其中许多变化将由在下一代或两代中的产生的技术所驱动。</p>\n<p id=\"e236\" class=\"graf graf--p graf-after--p\">正如介绍中所概述的，机器学习是一个雄心勃勃的研究领域，其中大量复杂的问题需要尽可能准确和高效地解决。对于我们人类来说任何容易完成的任务都需要机器采取创新的解决方案。</p>\n<p id=\"49ba\" class=\"graf graf--p graf-after--p graf--trailing\">这个领域内还有很大的进步空间，谁来贡献下一个突破的想法，无疑将会得到丰厚的回报。 也许读了这篇文章的某个人就会发明下一个强大的算法？所有伟大的想法都必须从某处开始！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113745\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113745votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113745\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaoai37\">LynnShaw</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaoai37\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/104743/4e04a90ce037ac8e7d76fe8ac03d6610-bpthumb.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            微博：@萧萧萧宁        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaoai37\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/shaoai37/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaoai37/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 35</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/7c651e0fce13acb304e7b99f8851cc540be4decd.jpg"},{"url_object_id": "742e67917a72f6ef4997410757b7b877", "title": "剖析内存中的程序之秘", "url": "http://blog.jobbole.com/113699/", "create_date": "2018/03/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/03/916f9d62e323d9f101c7d545e3fc030e.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 6, "tags": "C/C++,内存", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory/\">Gustavo Duarte</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9255-1.html\">Linux中国</a>   </div><p>内存管理是操作系统的核心任务；它对程序员和系统管理员来说也是至关重要的。在接下来的几篇文章中，我将从实践出发着眼于内存管理，并深入到它的内部结构。虽然这些概念很通用，但示例大都来自于 32 位 x86 架构的 Linux 和 Windows 上。这第一篇文章描述了在内存中程序如何分布。</p>\n<p>在一个多任务操作系统中的每个进程都运行在它自己的内存“沙箱”中。这个沙箱是一个<strong><span style=\"color: #ff0000\">虚拟地址空间</span></strong><span style=\"color: #ff0000\">（virtual address space）</span>，在 32 位的模式中它总共有 4GB 的内存地址块。这些虚拟地址是通过内核<strong><span style=\"color: #ff0000\">页表</span></strong><span style=\"color: #ff0000\">（page table）</span>映射到物理地址的，并且这些虚拟地址是由操作系统内核来维护，进而被进程所消费的。每个进程都有它自己的一组页表，但是这里有点玄机。一旦虚拟地址被启用，这些虚拟地址将被应用到这台电脑上的 <strong><span style=\"color: #ff0000\"><em>所有软件</em>，<em>包括内核本身</em></span></strong>。因此，一部分虚拟地址空间必须保留给内核使用：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/3e27c63a998ba0d994ce525cf44ffb4a.png\" alt=\"Kernel/User Memory Split\"></p>\n<p>但是，这并<span style=\"color: #ff0000\"><strong>不是</strong></span>说内核就使用了很多的物理内存，恰恰相反，它只使用了很少一部分可用的地址空间映射到其所需要的物理内存。内核空间在内核页表中被标记为独占使用于 <a href=\"http://duartes.org/gustavo/blog/post/cpu-rings-privilege-and-protection\">特权代码</a> （ring 2 或更低），因此，如果一个用户模式的程序尝试去访问它，将触发一个页面故障错误。在 Linux 中，内核空间是始终存在的，并且在所有进程中都映射相同的物理内存。内核代码和数据总是可寻址的，准备随时去处理中断或者系统调用。相比之下，用户模式中的地址空间，在每次进程切换时都会发生变化：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/88f9c9eb62a7e791bae979dd65ee60a5.png\" alt=\"Process Switch Effects on Virtual Memory\"></p>\n<p>蓝色的区域代表映射到物理地址的虚拟地址空间，白色的区域是尚未映射的部分。在上面的示例中，众所周知的内存“饕餮” Firefox 使用了大量的虚拟内存空间。在地址空间中不同的条带对应了不同的内存段，像<strong><span style=\"color: #ff0000\">堆</span></strong><span style=\"color: #ff0000\">（heap）</span>、<strong><span style=\"color: #ff0000\">栈</span></strong><span style=\"color: #ff0000\">（stack）</span>等等。请注意，这些段只是一系列内存地址的简化表示，它与 <a href=\"http://duartes.org/gustavo/blog/post/memory-translation-and-segmentation\">Intel 类型的段</a> <em>并没有任何关系</em> 。不过，这是一个在 Linux 进程的标准段布局：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/3d53f82d37d856ac7cc70e2e2617bd45.png\" alt=\"Flexible Process Address Space Layout In Linux\"></p>\n<p>当计算机还是快乐、安全的时代时，在机器中的几乎每个进程上，那些段的起始虚拟地址都是<span style=\"color: #ff0000\"><strong>完全相同</strong></span>的。这将使远程挖掘安全漏洞变得容易。漏洞利用经常需要去引用绝对内存位置：比如在栈中的一个地址，一个库函数的地址，等等。远程攻击可以闭着眼睛选择这个地址，因为地址空间都是相同的。当攻击者们这样做的时候，人们就会受到伤害。因此，地址空间随机化开始流行起来。Linux 会通过在其起始地址上增加偏移量来随机化<a href=\"http://lxr.linux.no/linux+v2.6.28.1/fs/binfmt_elf.c#L542\">栈</a>、<a href=\"http://lxr.linux.no/linux+v2.6.28.1/arch/x86/mm/mmap.c#L84\">内存映射段</a>、以及<a href=\"http://lxr.linux.no/linux+v2.6.28.1/arch/x86/kernel/process_32.c#L729\">堆</a>。不幸的是，32 位的地址空间是非常拥挤的，为地址空间随机化留下的空间不多，因此 <a href=\"http://www.stanford.edu/%7Eblp/papers/asrandom.pdf\">妨碍了地址空间随机化的效果</a>。</p>\n<p>在进程地址空间中最高的段是栈，在大多数编程语言中它存储本地变量和函数参数。调用一个方法或者函数将推送一个新的栈帧stack frame到这个栈。当函数返回时这个栈帧被删除。这个简单的设计，可能是因为数据严格遵循 <a href=\"http://en.wikipedia.org/wiki/Lifo\">后进先出（LIFO）</a> 的次序，这意味着跟踪栈内容时不需要复杂的数据结构 —— 一个指向栈顶的简单指针就可以做到。推入和弹出也因此而非常快且准确。也可能是，持续的栈区重用往往会在 <a href=\"http://duartes.org/gustavo/blog/post/intel-cpu-caches\">CPU 缓存</a> 中保持活跃的栈内存，这样可以加快访问速度。进程中的每个线程都有它自己的栈。</p>\n<p>向栈中推送更多的而不是刚合适的数据可能会耗尽栈的映射区域。这将触发一个页面故障，在 Linux 中它是通过 <a href=\"http://lxr.linux.no/linux+v2.6.28/mm/mmap.c#L1716\"><code>expand_stack()</code></a> 来处理的，它会去调用 <a href=\"http://lxr.linux.no/linux+v2.6.28/mm/mmap.c#L1544\"><code>acct_stack_growth()</code></a> 来检查栈的增长是否正常。如果栈的大小低于 <code>RLIMIT_STACK</code> 的值（一般是 8MB 大小），那么这是一个正常的栈增长和程序的合理使用，否则可能是发生了未知问题。这是一个栈大小按需调节的常见机制。但是，栈的大小达到了上述限制，将会发生一个栈溢出，并且，程序将会收到一个段故障Segmentation Fault错误。当映射的栈区为满足需要而扩展后，在栈缩小时，映射区域并不会收缩。就像美国联邦政府的预算一样，它只会扩张。</p>\n<p>动态栈增长是 <a href=\"http://lxr.linux.no/linux+v2.6.28.1/arch/x86/mm/fault.c#L692\">唯一例外的情况</a> ，当它去访问一个未映射的内存区域，如上图中白色部分，是允许的。除此之外的任何其它访问未映射的内存区域将触发一个页面故障，导致段故障。一些映射区域是只读的，因此，尝试去写入到这些区域也将触发一个段故障。</p>\n<p>在栈的下面，有内存映射段。在这里，内核将文件内容直接映射到内存。任何应用程序都可以通过 Linux 的 <a href=\"http://www.kernel.org/doc/man-pages/online/pages/man2/mmap.2.html\"><code>mmap()</code></a> 系统调用（ <a href=\"http://lxr.linux.no/linux+v2.6.28.1/arch/x86/kernel/sys_i386_32.c#L27\">代码实现</a>）或者 Windows 的 <a href=\"http://msdn.microsoft.com/en-us/library/aa366537(VS.85).aspx\"><code>CreateFileMapping()</code></a> / <a href=\"http://msdn.microsoft.com/en-us/library/aa366761(VS.85).aspx\"><code>MapViewOfFile()</code></a> 来请求一个映射。内存映射是实现文件 I/O 的方便高效的方式。因此，它经常被用于加载动态库。有时候，也被用于去创建一个并不匹配任何文件的匿名内存映射，这种映射经常被用做程序数据的替代。在 Linux 中，如果你通过 <a href=\"http://www.kernel.org/doc/man-pages/online/pages/man3/malloc.3.html\"><code>malloc()</code></a> 去请求一个大的内存块，C 库将会创建这样一个匿名映射而不是使用堆内存。这里所谓的“大”表示是超过了<code>MMAP_THRESHOLD</code> 设置的字节数，它的缺省值是 128 kB，可以通过 <a href=\"http://www.kernel.org/doc/man-pages/online/pages/man3/undocumented.3.html\"><code>mallopt()</code></a> 去调整这个设置值。</p>\n<p>接下来讲的是“堆”，就在我们接下来的地址空间中，堆提供运行时内存分配，像栈一样，但又不同于栈的是，它分配的数据生存期要长于分配它的函数。大多数编程语言都为程序提供了堆管理支持。因此，满足内存需要是编程语言运行时和内核共同来做的事情。在 C 中，堆分配的接口是 <a href=\"http://www.kernel.org/doc/man-pages/online/pages/man3/malloc.3.html\"><code>malloc()</code></a> 一族，然而在支持垃圾回收的编程语言中，像 C#，这个接口使用 <code>new</code> 关键字。</p>\n<p>如果在堆中有足够的空间可以满足内存请求，它可以由编程语言运行时来处理内存分配请求，而无需内核参与。否则将通过 <a href=\"http://www.kernel.org/doc/man-pages/online/pages/man2/brk.2.html\"><code>brk()</code></a> 系统调用（<a href=\"http://lxr.linux.no/linux+v2.6.28.1/mm/mmap.c#L248\">代码实现</a>）来扩大堆以满足内存请求所需的大小。堆管理是比较 <a href=\"http://g.oswego.edu/dl/html/malloc.html\">复杂的</a>，在面对我们程序的混乱分配模式时，它通过复杂的算法，努力在速度和内存使用效率之间取得一种平衡。服务一个堆请求所需要的时间可能是非常可观的。实时系统有一个 <a href=\"http://rtportal.upv.es/rtmalloc/\">特定用途的分配器</a> 去处理这个问题。堆也会出现  <span style=\"color: #ff0000\"><em>碎片化</em> </span>，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/d00072799463f32077204b75b2ed28d4.png\" alt=\"Fragmented Heap\"></p>\n<p>最后，我们抵达了内存的低位段：BSS、数据、以及程序文本。在 C 中，静态（全局）变量的内容都保存在 BSS 和数据中。它们之间的不同之处在于，BSS 保存 <span style=\"color: #ff0000\"><em>未初始化的</em></span>  静态变量的内容，它的值在源代码中并没有被程序员设置。BSS 内存区域是 <span style=\"color: #ff0000\"><em>匿名</em></span> 的：它没有映射到任何文件上。如果你在程序中写这样的语句 <code>static int cntActiveUsers</code>，<code>cntActiveUsers</code> 的内容就保存在 BSS 中。</p>\n<p>反过来，数据段，用于保存在源代码中静态变量 <span style=\"color: #ff0000\"><em>初始化后</em> </span>的内容。这个内存区域是 <span style=\"color: #ff0000\"><em>非匿名</em></span> 的。它映射了程序的二进值镜像上的一部分，包含了在源代码中给定初始化值的静态变量内容。因此，如果你在程序中写这样的语句 <code>static int cntWorkerBees = 10</code>，那么，<code>cntWorkerBees</code> 的内容就保存在数据段中，并且初始值为 <code>10</code>。尽管可以通过数据段映射到一个文件，但是这是一个私有内存映射，意味着，如果改变内存，它并不会将这种变化反映到底层的文件上。必须是这样的，否则，分配的全局变量将会改变你磁盘上的二进制文件镜像，这种做法就太不可思议了！</p>\n<p>用图去展示一个数据段是很困难的，因为它使用一个指针。在那种情况下，指针 <code>gonzo</code> 的<span style=\"color: #ff0000\"><em>内容</em></span>（一个 4 字节的内存地址）保存在数据段上。然而，它并没有指向一个真实的字符串。而这个字符串存在于文本段中，文本段是只读的，它用于保存你的代码中的类似于字符串常量这样的内容。文本段也会在内存中映射你的二进制文件，但是，如果你的程序写入到这个区域，将会触发一个段故障错误。尽管在 C 中，它比不上从一开始就避免这种指针错误那么有效，但是，这种机制也有助于避免指针错误。这里有一个展示这些段和示例变量的图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/22b60ebab0d1036b0f016b8feaec7594.png\" alt=\"ELF Binary Image Mapped Into Memory\"></p>\n<p>你可以通过读取 <code>/proc/pid_of_process/maps</code> 文件来检查 Linux 进程中的内存区域。请记住，一个段可以包含很多的区域。例如，每个内存映射的文件一般都在 mmap 段中的它自己的区域中，而动态库有类似于 BSS 和数据一样的额外的区域。下一篇文章中我们将详细说明“<strong><span style=\"color: #ff0000\">区域</span></strong><span style=\"color: #ff0000\">（area）</span>”的真正含义是什么。此外，有时候人们所说的“<strong><span style=\"color: #ff0000\">数据段</span></strong><span style=\"color: #ff0000\">（data segment）</span>”是指“<strong><span style=\"color: #ff0000\">数据</span></strong><span style=\"color: #ff0000\">（data）</span> + BSS + 堆”。</p>\n<p>你可以使用 <a href=\"http://manpages.ubuntu.com/manpages/intrepid/en/man1/nm.1.html\">nm</a> 和 <a href=\"http://manpages.ubuntu.com/manpages/intrepid/en/man1/objdump.1.html\">objdump</a> 命令去检查二进制镜像，去显示它们的符号、地址、段等等。最终，在 Linux 中上面描述的虚拟地址布局是一个“弹性的”布局，这就是这几年来的缺省情况。它假设 <code>RLIMIT_STACK</code> 有一个值。如果没有值的话，Linux 将恢复到如下所示的“经典” 布局：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/6d496238b477a0c12363d116e642fa13.png\" alt=\"Classic Process Address Space Layout In Linux\"></p>\n<p>这就是虚拟地址空间布局。接下来的文章将讨论内核如何对这些内存区域保持跟踪、内存映射、文件如何读取和写入、以及内存使用数据的意义。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113699\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113699votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113699\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/652b3c8d1651a6157260fbbbe71ec8e2cded6fd4.jpg"},{"url_object_id": "b531dd3dbe9f166d522d5fbe6829f74d", "title": "我只想安静地写代码，领导却跟我谈大局、讲奉献", "url": "http://blog.jobbole.com/113705/", "create_date": "2018/03/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/03/a0d3ddbd4770543de0a261f2585f4306.jpg"], "praise_nums": "1", "comment_nums": 3, "fav_nums": 7, "tags": "职场,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/why-your-programmers-just-want-to-code-36da9973388e\">Marcus Blankenship</a>   译文出处：<a target=\"_blank\" href=\"http://36kr.com/p/5121539.html\">36Kr</a>   </div><p>编者按：是的，为什么你们这帮程序猿整天就只想写代码？难道做什么不比怎么做更重要吗？但凡你对公司有点奉献精神对业务有点关心的话都不会这样，一切都是你的错，对吧？不对，《Habits That Harm Your Technical Team》作者 Marcus Blankenship 说<a href=\"https://hackernoon.com/why-your-programmers-just-want-to-code-36da9973388e\" target=\"_blank\">错不在程序员，错在你们这帮领导</a>。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/a0d3ddbd4770543de0a261f2585f4306.jpg\" alt=\"\"></p>\n<p>我面试 Jamie 的时候，他看起来就像一位狂热的工程师。技术技能可靠，对流程和产品改进有想法，也有着很好的团队合作态度，是个明显的选择。</p>\n<blockquote><p>不过 2 年后，Jamie 变成了“那个家伙”。你懂的，就是那个只想不被打扰、埋头写自己代码的家伙。</p></blockquote>\n<p>我本来应该注意到迹象。现在回想起来，他没有站出来说过话，他没有像我预期那样贡献自己对流程或产品的想法，而他的“团队友好”型互动通常是挖苦别人。他经常讨论技术债务，说我们缺乏创新，以及拖我们后腿的“愚蠢”决定。而他的评论和反馈显示出他已经深受“我早就告诉过你了”的情绪之困扰。</p>\n<p>Jamie 可能曾考虑过要离开公司。如果他这么做，那我就不能说了。尽管我肯定希望他离开。不过我们现在人手不足，而且我需要能找到的所有帮助。</p>\n<p>结果呢？</p>\n<p>结果还是老一套，又一位只想着写代码的程序员被孤立了。</p>\n<p><strong>环境塑造人</strong></p>\n<p>太多经理认为问题出在 Jamie 身上了。如果他是一位好一点的员工、有奉献精神的员工，或者至少多一点关心的话，都不会发生这样的事情，对吧？</p>\n<p>不幸的是，不对。</p>\n<blockquote><p>冰冻三尺非一日之寒，热忱的程序员变成偏执的程序员不是一夜之间的事情。但是事情的发展速度比你想象的要快。</p></blockquote>\n<p><strong>第一次建议非常重要</strong></p>\n<p>你如何处置新程序员的想法会发出重要信号。不管好坏，这都为他们的预期做好了准备。这决定了他们会不会在将来分享更多的想法……或者闭嘴不再多管闲事。</p>\n<p>当然，一些想法在你的环境未必可行。有的可能需要“等我们没那么忙”的时候再进行讨论。有的想法看起来很好，但跟这里的潜规则是有冲突的。</p>\n<p>不管是什么理由，鄙视或者贬低你的程序员的想法，尤其是在他们刚来的几个月内做出这种举动是糟糕的做法。</p>\n<p>满腔热情被泼冷水之后，他会试着换种方式表达自己的想法，为的是想得到成功的结果。但是如果还是好心被当成驴肝肺的话，他就会意识到唯一的取胜之道就是不玩了。</p>\n<p>这恰恰是你不希望你的程序员吸取的教训。</p>\n<p>他不再提出想法，不再要求跟客户见面，并且真诚地试图去理解业务。</p>\n<p>到最后就变成了双输的局面。</p>\n<p><strong>想法越大，风险越大</strong></p>\n<p>记住，你的程序员在提出新想法的时候其实是在冒险。想法越大，风险越大。</p>\n<p>为什么是风险？因为我们的想法反映了我们自己、我们的观点以及我们的热情。我们不会推动自己不关心或者认为不可行的想法。我们把自己最好的想法贡献出来，希望能够被接受。</p>\n<p>这需要有暴露脆弱的勇气，我们只有在相当确定不会受辱的情况才会大胆吐露自己的想法。如果我们认为自己的想法不会被接受的话，就不会再说出去了。</p>\n<p><strong>对想法的反馈塑造了行为</strong></p>\n<p>那么你的程序员退回去只做能让自己成功的事情，也就是写代码，就是很自然的事了。</p>\n<p>令人悲哀地，他满腔的创造、创新和开发热忱都没了。</p>\n<p>也许它已经变成了对代码质量或者代码指标不切实际的想法。</p>\n<p>他对市场份额和业务健康的担忧已经被对头衔和工资的担忧所取代。他变得更加关心自己挣了多少，自己的头衔是什么，以及自己 LinkedIn 的形象怎么样。</p>\n<p>他对改变世界的热情已经被对开发过程的挑剔所替代。</p>\n<blockquote><p>不过更糟糕的是，他对“我们没有开发正确的东西”的担心会被“我们没有把东西开发正确。”的担心取代。</p></blockquote>\n<p>他已经学会了不对要开发什么提供输入，于是他开始对怎么去开发变得痴迷。</p>\n<p>对于他来说，你的文化已经变成了适者生存。</p>\n<p><strong>你的培训都教了些什么？</strong></p>\n<p>尽管你永远都不会直接说这些，但你的培训和文化也许会教这些：</p>\n<ul>\n<li>“我们的公司不喜欢小人物的大想法。”</li>\n<li>“你做好开发的事情就行了。我们会找出客户想要什么的。”</li>\n<li>“你就是个程序猿。”</li>\n<li>“嗯……为什么你有十万个为什么。你没有代码可写了吗？”</li>\n</ul>\n<p><strong>你的真正文化是什么？</strong></p>\n<p>文化不是贴在墙上的口号，也不是在面试的时候你介绍的公司使命。文化是大家的做事之道，是大家真正关心的东西。</p>\n<p>德州农工大学教授 Ifte Choudhury 指出：</p>\n<blockquote><p>文化是一群人的生活方式——行为、理念、价值观以及他们接受的象征，一般都是潜移默化，通过一代代人的沟通和模仿而传递下去的。</p></blockquote>\n<p><strong>如果你想知道自己的文化是什么类型，那就看看大家是怎么做的。</strong></p>\n<p>如果你不喜欢自己看到的东西，那就去改变它。文化不是命令。而是学习、榜样以及模仿。</p>\n<blockquote><p>作为领导，值得别人效仿是你的工作。</p></blockquote>\n<p>因为文化不是 Jamie 的错。文化是我们的错——团队领导、软件经理以及 CTO 的错。</p>\n<p>所以，别再指责 Jamie 了，开始做出你的文化需要的改变吧。越快越好。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113705\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113705votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113705\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/75c46be89b190cbaddeecac80a39d022262d67bb.jpg"},{"url_object_id": "a6f0ef6debff996ff3defb5399281308", "title": "为什么浏览器的用户代理字符串以 Mozilla 开头", "url": "http://blog.jobbole.com/113716/", "create_date": "2018/03/06", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/03/47a58f731472797655f14eeebe80e7d7.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,浏览器", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.solidot.org/story?sid=55694\">Solidot</a>   </div><p>最早流行的浏览器是 NCSA Mosaic，它称自己为 NCSA_Mosaic/2.0 (Windows 3.1)；后来一个新浏览器出现了，它的名字叫 Mozilla，是 Mosaic Killer 的缩写，Mosaic 并不觉得这好笑，因此该浏览器改名为 Netscape，它称自己为 Mozilla/1.0 (Win3.1)。</p>\n<p>Netscape 支持框架（frame），而 Mosaic 不支持，因此用户代理嗅探（User Agent sniffing）出现了，网站在检测到 Mozilla 后就发送框架，如果不是就不发送。后来微软开发了 IE，希望它成为 Netscape Killer，IE 也支持框架，但由于它不是 Mozilla，网站没有向它发送框架。</p>\n<p>微软没有耐心等待网站修改而是声称它兼容于 Mozilla，因此冒充 Netscape 称自己为 Mozilla/1.22 (compatible; MSIE 2.0; Windows 95)。第一次浏览器战争以 Netscape 的失利结束，但 Netscape 以 Mozilla 的名字获得了新生。</p>\n<p>Mozilla 构建了 Gecko，称自己为 Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.1) Gecko/20020826。Gecko 是一个渲染引擎，Mozilla 在此基础上开发了 Firefox，它称自己为 Mozilla/5.0 (Windows; U; Windows NT 5.1; sv-SE; rv:1.7.5) Gecko/20041108 Firefox/1.0。因为 Gecko 好于 IE，因此用户代理嗅探又出现了，网站在检测到 Gecko 后会提供更好的页面代码。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/47a58f731472797655f14eeebe80e7d7.png\" alt=\"YL}%@8@6764CYM (9J]%W[LU.png\"></p>\n<p>Linux 上的浏览器 Konqueror 使用的渲染引擎是 KHTM，它只能冒充 Gecko 称自己为 Mozilla/5.0 (compatible; Konqueror/3.2; FreeBSD) (KHTML, like Gecko)。Opera 则提供了选项，让用户想冒充哪个浏览器就冒充哪个浏览器。苹果后来创建了 KHTML 的一个分支 WebKit，称自己为 Mozilla/5.0 (Macintosh; U; PPC Mac OS X; de-de) AppleWebKit/85.7 (KHTML, like Gecko) Safari/85.5。这就是为什么浏览器的用户代理字符串以 Mozilla 开头。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113716\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113716votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113716\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8f56708c8277db3452adbaf82ed7ad944f9b4ada.jpg"},{"url_object_id": "7cb32f69be9fc1f56a8f1a54e4cf6b00", "title": "索引表和 ES 的一点点思考", "url": "http://blog.jobbole.com/113726/", "create_date": "2018/03/08", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2011/11/go-out-of-the-three-errors-of-the-seo.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,搜索,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">Sam哥哥</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><h3>索引表设计</h3>\n<p>在电商项目中，物理库存系统是个极其重要的系统，订单支付后，就会开始来占用物理库存。一般情况下，库存系统都是要分库的，因为主要的操作是写操作，例如占用/释放/取消等写操作。使用分库可以降低数据库写的压力。尽管写操作为主，但是读操作也是有的。</p>\n<p>比如说，库存占用的时候，得先查询是否有库存，而这个查询操作并不都会带上分库因子(用于路由到具体的某个数据库)，而是一些比较宽松的查询条件，这些查询条件对应的数据可能分布在不同的数据库上。这个时候为了查询的方便，会构建一个索引表。这个索引表是<strong>存在另外的单独的一个数据库中</strong>，不会再分库了的。</p>\n<p>索引表的设计也分不同情况，大体可以分三种。<br>\n1、查询字段+数据库主键</p>\n<blockquote><p>把查询字段放到索引表，还需要把对应的数据库主键ID也放置进去。当查询请求到来时，根据查询条件找出对应的数据主键，再根据数据主键路由到对应的存有完整业务数据的数据分库上。这种方案呢。索引表占用空间小，可以支撑很久。但是要找出业务数据，还是需要路由到分库上。另外，如果要把索引表的数据存储到ES搜索引擎上的话，这种方式就不行了。因为索引表中没有外部系统要的业务数据。所以当时的库存系统没有使用这种索引表设计方案。</p></blockquote>\n<p>2、查询字段+数据库主键+需要展示的业务字段</p>\n<blockquote><p>这种方案呢。当请求到来的时候，直接查询索引表即可。无需根据主键路由到分库了。同时如果要结合ES的话。可以直接把索引表的数据弄到ES上即可。后续直接让ES暴露查询接口即可。目前我在唯品会参与的物理库存项目中，是使用这种方式的。但是这个方案也有个缺点。就是索引表的体积比较大，后续数据量一大的话，也是个问题。能不能优化一下呢？</p></blockquote>\n<p>3、索引表拆分</p>\n<blockquote><p>上面说到的第二种方案，索引表的膨胀可能很快，可以考虑将索引表拆分。比如说：索引表只是保存查询条件和主键，而需要展示给外部系统的数据，另外存储在单独的表上。比如叫index_detail表。这个表拥有索引表的主键。这样的话，当查询请求到来的时候，先从索引表查询到主键，再根据主键从index_detail表中查询出数据。当然这样做的话。ES的数据来源就变成多张表了，不过这是可以接受的。</p></blockquote>\n<h3>如何把业务数据写入到索引表</h3>\n<h4 id=\"使用mq\">使用MQ</h4>\n<p>一般来说，构建索引数据是使用单独一个应用来做的。比如叫data-index域。这个域会从消息队列中读取消息，用于构建索引数据。当业务数据发生变化后，生产者发送MQ消息到队列上。<br>\n这里的消息设计也分两种情况。一种是消息只是带有数据主键和操作类型(ADD/Update/DELETE),消费者拿到主键后再去DB获取完整的数据并插入到索引表中。另一种方案呢，是消息包含了大部分需要的字段，消费者拿到消息后直接把数据插入到索引表中。这两种消息设计，我在实际项目中都有用过。</p>\n<h4 id=\"直接操作db\">直接操作DB</h4>\n<p>这种方案呢就比较粗暴，直接配置一个索引表库的数据源，当业务数据发生变化时，使用Mybatis或者JDBC把数据更新到索引表中。一般不建议这么做，一来构建索引数据的逻辑跟数据的CRUD操作融合在一起了。二来，操作其他数据库的数据，要么通过接口的方式，要么由单独的域来做。建议还是使用MQ的方式来构建索引数据。</p>\n<h3>如何把索引表数据弄到ES上</h3>\n<h4 id=\"监听数据库表的数据变化\">监听数据库表的数据变化</h4>\n<p>像在唯品会这边，自研了一个叫VDP的组件，使用storm job去监听索引表数据的变化，一旦有变化，就把数据同步到队列中，ES直接从队列中获取数据，并存储到ES上。<br>\n这种方案的好处是，我们无需写任何代码，数据自动可以同步到ES上。</p>\n<h4 id=\"使用mq-1\">使用MQ</h4>\n<p>如果公司内部没有开发VDP这样的组件，可以通过发送MQ消息的方式来将索引表的数据同步数据到ES上。</p>\n<h4 id=\"让es暴露cud接口\">让ES暴露CUD接口</h4>\n<p>另外一种方案是，让ES暴露CUD接口，用于同步索引表数据。但是这样就跟ES耦合在一块了。不太推荐这么做。</p>\n<h3>进一步的思考</h3>\n<p>1、ES不支持Group By这样的操作，所以在构建索引表的时候，可以事先计算好Group By的一些统计数据，并存储到索引表中；<br>\n2、一些后台应用中，如果数据库表的数量已经很大，好几个亿了，并且查询的SQL还非常变态，用数据库已经无法支持了，那么可以使用ES，查询速度快，也支持一些统计操作；<br>\n3、使用ES输出数据时，也有个坑。经常会拿到脏数据的。例如当数据发送变化后，构建索引数据并把索引数据同步到ES上是需要时间的，但是我们后台通常有将数据下架的操作，下架的操作操作完后，再次点击查询按钮，可能还是看到脏数据，因为数据同步到ES上没那么快。现在我还没想到很好的办法来解决这个问题。欢迎网友提些建议。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/54f7206fd1f1907bec78ddf32f50d66d.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113726\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113726votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113726\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">Sam哥哥</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/3660a090181b2b6ae3bd8c07d393aa36.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网技术爱好者，目前就职于广州唯品会担任JAVA高级开发。个人的csdn技术博客如下：http://blog.csdn.net/linsongbin1本人伯乐在线的文章，都出自这个csdn博客        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/sam-2/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8cd9b25acfe438d20acd37accc39f6be8b8924dc.jpg"},{"url_object_id": "0ec536e6cc340e779e8be8c764ab39c0", "title": "Linux 主目录中的隐藏文件是干什么用的？", "url": "http://blog.jobbole.com/113719/", "create_date": "2018/03/07", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/03/c96c574ca76e6b552476e508f1247902.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.maketecheasier.com/hidden-files-linux-home-directory/\">Alexander Fox</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9409-1.html\">Linux中国/MjSeven</a>   </div><p>在 Linux 系统中，你可能会在主目录中存储了大量文件和文件夹。但在这些文件之外，你知道你的主目录还附带了很多隐藏的文件和文件夹吗？如果你在主目录中运行 <code>ls -a</code>，你会发现一堆带有点前缀的隐藏文件和目录。这些隐藏的文件到底做了什么？</p>\n<h3 id=\"toc_1\">在主目录中隐藏的文件是干什么用的?</h3>\n<p><img class=\"aligncenter\" title=\"hidden-files-liunux-2\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/c96c574ca76e6b552476e508f1247902.png\" alt=\"hidden-files-liunux-2\"></p>\n<p>通常，主目录中的隐藏文件和目录包含该用户程序访问的设置或数据。它们不打算让用户编辑，只需要应用程序进行编辑。这就是为什么它们被隐藏在用户的正常视图之外。</p>\n<p>通常，删除和修改自己主目录中的文件不会损坏操作系统。然而，依赖这些隐藏文件的应用程序可能不那么灵活。从主目录中删除隐藏文件时，通常会丢失与其关联的应用程序的设置。</p>\n<p>依赖该隐藏文件的程序通常会重新创建它。 但是，你将从“开箱即用”设置开始，如全新用户一般。如果你在使用应用程序时遇到问题，那实际上可能是一个巨大的帮助。它可以让你删除可能造成麻烦的自定义设置。但如果你不这样做，这意味着你需要把所有的东西都设置成原来的样子。</p>\n<h3 id=\"toc_2\">主目录中某些隐藏文件的特定用途是什么？</h3>\n<p><img class=\"aligncenter\" title=\"hidden-files-linux-3\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/e5c7ad21014cb9f242377c5c8c36e38f.png\" alt=\"hidden-files-linux-3\"></p>\n<p>每个人在他们的主目录中都会有不同的隐藏文件。每个人都有一些。但是，无论应用程序如何，这些文件都有类似的用途。</p>\n<h4 id=\"toc_3\">系统设置</h4>\n<p>系统设置包括桌面环境和 shell 的配置。</p>\n<ul>\n<li>shell 和命令行程序的<strong>配置文件</strong>：根据你使用的特定 shell 和类似命令的应用程序，特定的文件名称会变化。你会看到 <code>.bashrc</code>、<code>.vimrc</code> 和 <code>.zshrc</code>。这些文件包含你已经更改的有关 shell 的操作环境的任何设置，或者对 <code>vim</code> 等命令行实用工具的设置进行的调整。删除这些文件将使关联的应用程序返回到其默认状态。考虑到许多 Linux 用户多年来建立了一系列微妙的调整和设置，删除这个文件可能是一个非常头疼的问题。</li>\n<li><strong>用户配置文件</strong>：像上面的配置文件一样，这些文件（通常是 <code>.profile</code> 或 <code>.bash_profile</code>）保存 shell 的用户设置。该文件通常包含你的 <code>PATH</code> 环境变量。它还包含你设置的<a href=\"https://www.maketecheasier.com/making-the-linux-command-line-a-little-friendlier/#aliases\">别名</a>。用户也可以在 <code>.bashrc</code> 或其他位置放置别名。<code>PATH</code> 环境变量控制着 shell 寻找可执行命令的位置。通过添加或修改 <code>PATH</code>，可以更改 shell 的命令查找位置。别名更改了原有命令的名称。例如：一个别名可能将 <code>ls -l</code> 设置为 <code>ll</code>。这为经常使用的命令提供基于文本的快捷方式。如果删除 <code>.profile</code> 文件，通常可以在 <code>/etc/skel</code> 目录中找到默认版本。</li>\n<li><strong>桌面环境设置</strong>：这里保存你的桌面环境的任何定制。其中包括桌面背景、屏幕保护程序、快捷键、菜单栏和任务栏图标以及用户针对其桌面环境设置的其他任何内容。当你删除这个文件时，用户的环境会在下一次登录时恢复到新的用户环境。</li>\n</ul>\n<h4 id=\"toc_4\">应用配置文件</h4>\n<p>你会在 Ubuntu 的 <code>.config</code> 文件夹中找到它们。 这些是针对特定应用程序的设置。 它们将包含喜好列表和设置等内容。</p>\n<ul>\n<li><strong>应用程序的配置文件</strong>：这包括应用程序首选项菜单中的设置、工作区配置等。 你在这里找到的具体取决于应用程序。</li>\n<li><strong>Web 浏览器数据</strong>：这可能包括书签和浏览历史记录等内容。这些文件大部分是缓存。这是 Web 浏览器临时存储下载文件（如图片）的地方。删除这些内容可能会降低你首次访问某些媒体网站的速度。</li>\n<li><strong>缓存</strong>：如果用户应用程序缓存仅与该用户相关的数据（如 <a href=\"https://www.maketecheasier.com/clear-spotify-cache/\">Spotify 应用程序存储播放列表的缓存</a>），则主目录是存储该目录的默认地点。 这些缓存可能包含大量数据或仅包含几行代码：这取决于应用程序需要什么。 如果你删除这些文件，则应用程序会根据需要重新创建它们。</li>\n<li><strong>日志</strong>：一些用户应用程序也可能在这里存储日志。根据开发人员设置应用程序的方式，你可能会发现存储在你的主目录中的日志文件。然而，这不是一个常见的选择。</li>\n</ul>\n<h3 id=\"toc_5\">结论</h3>\n<p>在大多数情况下，你的 Linux 主目录中的隐藏文件用于存储用户设置。 这包括命令行程序以及基于 GUI 的应用程序的设置。删除它们将删除用户设置。 通常情况下，它不会导致程序被破坏。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113719\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113719votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113719\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/25fd6361e58d68d4d0e0fe883f9e496afcab090b.jpg"},{"url_object_id": "f7fd5491f869ff395a8d3670134dea28", "title": "励志！海外开发者讲述用脚做游戏的研发经历", "url": "http://blog.jobbole.com/113722/", "create_date": "2018/03/08", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/03/f4b90537c9da89d7b415ea699c9fe008.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,开发者", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.gamelook.com.cn/2018/03/322396\">gamelook</a>   </div><p>对于游戏开发者而言，失去双手对于职业和生活可能是灾难性的打击。</p>\n<div>\n<p>然而，业内却有一小部分人每天都要面临这样的问题，位于奥斯丁的开发者Rusty Moyher就是其中之一。五年前，他被诊断为重复性劳损（RSI），而作为一名写代码的游戏策划，这个病症几乎让他的职业生涯和对游戏的热情遭遇毁灭性打击。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/0f9786b2767ac6277e33aa54660bf447.jpg\" alt=\"\" width=\"675\" height=\"411\"></p>\n<p>图片来自网络，并非开发者本人</p>\n<p>为了便于理解，这里我们复制了一段百度百科的介绍:重复使力伤害（repetitive strain injury，缩写RSI），或称重复性劳损、劳肌损伤、重复性动作的伤害，是指因长时间重复使用某组肌肉造成的损害。吉他、打字、在装配线工作、某些球类运动（棒球、网球、高尔夫球）都可能引致RSI，是常见的职业病，疼痛、肿胀、僵硬和易累等都是RSI的病征。不会在瞬间发生，是经年累月，不知不觉地缠上电脑使用者。如未经治疗，可能会对双手造成无可挽救的损害，一旦严重的伤害，双手将不再灵活。但到了这个时候，往往神经、肌肉和结缔组织，早已受到严重的损伤。</p>\n<p>对于游戏开发者来说这个问题是很严重的，因为鼠标和键盘是最有效的工作和交流方式，但对于患有RSI疾病的人而言，这两个外设几乎形同虚设，所以使用电脑都是很大的问题。</p>\n<p>然而，Rusty决定学习不用手的方式做游戏研发，他几乎用了一年半的时间学习与电脑互动的新方式，通过语音编程、眼部追踪和脚踏板的方式完成了游戏研发。上个月，他创作的新游戏《Dig Dog》正式登录PC、主机和手游平台。</p>\n<h1>患病之后：如何替代键盘鼠标输入</h1>\n<p>本质来说，Moyher是可以使用手的，但RSI意味着连续几个小时使用键盘鼠标已经是不可能的，为了找回对游戏研发的热情，他必须使用新的方式与电脑互动。最开始的时候，他尝试了很多种非传统外设，但却没有一个能够满足需求。</p>\n<p>Moyher说，“我尝试了各种辅助设备，但投入了大量资金之后发现这些并没有什么作用，比如立体键盘、和立体鼠标等等，我买过250美元一个的辊轮鼠标，用起来还可以，但我觉得人类的身体素质各异，所以你很难找到真正适合你用的”。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/db5539029e3bf667ad59b7af9d39ec1e.gif\" alt=\"\" width=\"643\" height=\"359\"></p>\n<p>他的第一次突破是发现了一个可以用语音写代码的视频，这个视频是Travis Rudd在2013年发布的，后者也是一个患有RSI症状的程序员和开发者，视频中展示了Rudd自己研发的声音识别软件Dragon NaturallySpeaking，这样就可以通过语音指令写Python代码。</p>\n<p>与Rudd联系之后，Moyher学习了Natlink与Dragonfly工具，这些可以让用户把定制化的关键短语作为触发器，如果你不太熟悉这个软件，那么我们进行简单的介绍，在默认情况下，它的主要工作就是把一个人的声音转化为文字，如果没有额外的工具和变成，那么使用Dragon写代码是非常消耗时间的工作。</p>\n<p>通过配合Natlink与Dragonfly工具，Moyher可以直接使用语音指令，但这对他来说并没有那么容易适应。“我用了很长时间适应这种工具的使用方法，实际上在项目开始的一年半之前就已经在尝试了，当时我只是在研究这些工具，尝试适合我的方式”。</p>\n<p>据Moyher透露，大多数的时间都用在了把输入方式简单化，这样他在工作的时候就不用担心一个失误导致所有工作都白费，“我看到过有些人使用这种语音写代码的案例，他们会设置中继设备，比如在虚拟机里运行Windows系统和Dragon软件，比如Parallels，而且他们使用这些与操作系统的外界声音进行交流”。</p>\n<p>这让整个过程更加复杂，所以他决定进行简化，“我是直接使用Windows，所以就没有那么多的相关环节，这样错误的几率就会降低，“在简化之后，我用起来更为得心应手”。Moyher遇到的另一个问题就是他不能直接使用Rudd研发的Python指令，因为Moyher使用的集成研发环境（IDE）是Visual Studio和Xcode。他不仅要研发新的语音指令，由于这些环境使用鼠标的频率很高，所以他还要需要新的指令输入方式。</p>\n<h1>不用手如何做游戏研发？</h1>\n<p>虽然Moyher尝试了大量不同的外设，但没有一个真正令他满意，直到体验了Natural Point的SmartNav 4，SmartNav的工作原理就是追踪与Moyher帽子上连接的反射器，由于灵敏度较高，他只需要很小幅度的转头就可以在屏幕上发出指令，然而他也表示，SmartNav 4也并不是100%理想。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/f495b537370340dfba8da04fff31ba71.jpg\" alt=\"\" width=\"646\" height=\"406\"></p>\n<p>“SmartNav 4是我在网上找到的，由于我知道自己的病情，只能尽可能少的用手，多休息，所以它成为了一个很好的鼠标替代工具，至少已经足够好用。但我认为它可以变得更好，软件版本很老，而且也是一个不那么注意细节的USB设备”。</p>\n<p>用了这个设备之后，Moyher对它的要求更高了，“我从其他人那里得到了很多使用眼睛追踪的建议，这些事情实际上我以前就尝试过，所以决定深度挖掘这种方式”。</p>\n<p>当然，找到不用手操作鼠标并不是唯一的问题，他还需要解决鼠标点击输入的问题，当然，这跟眼部追踪或者语音识别比起来就简单很多，“我是用脚点击的，所以这种设备用起来较为便宜，而且使用起来也很方便”。</p>\n<p>游戏研发是辛苦的，但如果你面临Moyher这样的困难，那就更艰难了。《Dig Dog》最初是一个很简单的游戏，只是让一条狗在沙漠中行走，他非常喜欢平台游戏，但加入了挖掘玩法之后，这款游戏的玩法重心就发生了变化，而且项目最初的名字也不是Dig Dog。</p>\n<p>“游戏名字并不是参考了《Dig Dug》，最初我只是想做一款让狗狗在沙漠中行走的游戏，一开始我很想做一款iOS平台游戏，这个游戏就是这么开始的。发现了挖掘玩法之后，游戏的主要玩法就变成了挖掘，曾几何时我给项目取的名字是Dig A Dog A Bone，但最后《Dig Dog》更利于传播”。</p>\n<p>为了写代码，Moyher不仅要重新思考新的代码输入方式，还需要重新设计代码整体布局，在游戏研发过程中，他的输入方式也发生了很多变化。不过，游戏测试仍然需要他使用双手，“的确，这是一款平台游戏，游戏带给玩家的感觉是很重要的，你必须亲自体验和经历手柄操作，所以我有时候也避免不了”。</p>\n<h1>新挑战：不用手玩游戏</h1>\n<p>在编写《Dig Dog》代码的时候，Moyher克服了重重困难，他打算继续追逐游戏研发的梦想，疾病没有扼杀他对于游戏研发的热爱，他不仅继续编程，还坚持玩游戏，这样可以让游戏设计被更多人接受。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/ff478803b38378840f749436e1e8ce80.jpg\" alt=\"\" width=\"792\" height=\"449\"></p>\n<p>“这些方法是我在使用SmartNav 4的时候发现的，我最开始只是用鼠标和脚踏板玩游戏，随后我开始尝试其他回合制游戏，并且寻找不用手进行游戏操作的方式”。</p>\n<p>虽然游戏速度是一方面的因素，Moyher表示一款游戏真正的难度在于，玩家需要同时处理很多东西，“我觉得回合制游戏比较适合，比如《RimWorld》用这种方法玩起来就很难，你需要点击太多的东西，鼠标的不精确让你很难操作这么多的单位”。</p>\n<p>之所以提到Moyher的故事，主要是为了说明，只要你对于某些事情有热情，就能找到方法克服重重困难，或许，他在采访最后所说的话可以给业内所有同行共勉：我开始这个项目的时候，就已经有了足够多的工具，所以很确定整个游戏是能够做出来的，我只需要更有耐心就可以完成，但当时我甚至不知道能否做得到，虽然写代码很难，但我认为只要你想学，所有人都能学会。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113722\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113722votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113722\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/6d8769da18e5fbec28cb5a2e5550323fe12e463a.jpg"},{"url_object_id": "c5b87c22be1fbc4b5d456243c449d9bb", "title": "100 倍价值的工程师", "url": "http://blog.jobbole.com/113710/", "create_date": "2018/03/06", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/11/90129c6662feee86738bd3663ce83108.png"], "praise_nums": "2", "comment_nums": 5, "fav_nums": 5, "tags": "职场,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://zef.me/the-100x-engineer-6d50a690a866\">zef.me</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：工程师如何花同样的时间比其他人生产的价值多100倍：知道自己在做什么，不需要别人过多干预；不断对自己发出挑战，使工作更有效；一个人是无法成为100 倍价值工程师的，需要带动周围人一起提升生产力。</p>\n<hr>\n<p>几个月前一个新工程师加入了我们的团队。和往常一样，我花了些时间和他相处，来更好地了解他是哪种类型的人、他的驱动力是什么。我们经常讨论过去的经历，但更重要的是：未来的目标。结果发现，他有个有趣的目标：</p>\n<p style=\"text-align: center;\"><em><strong>「我想成为世界上最好的程序员」</strong></em></p>\n<p>野心勃勃。我喜欢。</p>\n<p>但是，这让我思考了一个问题：成为“最好的程序员”实际上意味着什么。怎么衡量“好”？怎么知道他（她）是“<em>最好的程序员</em>”？</p>\n<p>这让我想起了上世纪 60 年代，Sackman、 Erikson 和 Grant 撰写的论文《Exploratory Experimental Studies Comparing Online and Offline Programming Performance》。该研究的目的是调查程序员在编程的多个方面的表现，无论他有电脑——那时是主机——的交互权限还是用“纸和笔”高效工作。尽管这个问题的答案几乎要过时了——谁还在纸上编程啊——仍然有几点发现现在仍然适用：</p>\n<p>研究对象中，</p>\n<ul>\n<li>最好和最差的程序员完成一个编程练习所用的编程时间有 <strong>20 倍</strong>的差距。</li>\n<li>调试时间有<strong> 25 倍</strong>的差距。</li>\n<li>所写程序大小有<strong> 5 倍</strong>差距。</li>\n<li>程序执行速度有 <strong>10 倍</strong>差距。</li>\n</ul>\n<p>研究对象都有几年的经验，事实上经验年数对这些数字似乎没有显著的影响。总之，差距还是挺显著的，不是吗？</p>\n<h3>10 倍价值的程序员</h3>\n<p>“10 倍价值程序员”这个概念起源于这篇论文。这个概念吸引了人们数十年，而且及其有争议。<a href=\"https://www.google.pl/search?q=10x+programmer&amp;ie=UTF-8&amp;oe=UTF-8&amp;hl=en-us&amp;client=safari\">直接 Google 一下这个英文短语</a>（10x programmer）。</p>\n<p>公平来讲，Sackman 等人的数字一定被夸大了，很多人都对他们的方法提出了质疑。但是几乎没有人反对在糟糕的程序员与优秀的程序员之间有着显著差距。甚至据传，每个人都认识一个人，他能在极短时间内写出惊人的软件。</p>\n<h3>谁在乎？</h3>\n<p>“所以……谁在乎？”你可能会问。为什么 10 倍价值程序员这么重要呢？</p>\n<p>一方面来说，10 倍价值程序员至少表面上对雇主来说是桩好买卖。理论上，雇主可以：</p>\n<ul>\n<li>1.炒掉 90% 的员工</li>\n<li>2.剩余 10% 雇佣 10 倍价值程序员</li>\n<li>3.付给他们大约 2 倍工资</li>\n<li>4.盈利</li>\n</ul>\n<p>简单，对吧？</p>\n<p>然而现实会有点不一样。首先，这假设你能招到一个 10 倍价值程序员的团队……祝你好运。由于你很可能做不到这一点，你得把他们整合进现存的一倍价值程序员团队中去。结果发现，团队中有一个比你<strong>更更更</strong>高产的程序员并不是那么鼓舞人心。</p>\n<p>但是实际上，我不想太过详述 10 倍价值程序员这个概念。因为在我看来，有这么一群不同的“人种”，他们的影响力远超过 10 倍价值程序员。</p>\n<p>是谁呢？</p>\n<p>我们先来仔细研究一下“程序员”这个概念。在 Sackman 的研究中，他们完全只关注编程能力。练习是高度与算法相关的，像“假定某网格代表一个迷宫，编写一个程序找到通路”这样的类型。好“程序员”擅长这种类型的工作：输入编程挑战，输出代码。每个程序员都有自己的任务列，并且在逐个完成。</p>\n<p>输入代码。</p>\n<p>如果这是你喜欢的工作，我肯定你能找到如此工作的地方。</p>\n<p>然而，在我曾经工作的任何地方，实际编程都不是这样的。实话实说——谢天谢地。我觉得长期这样编程会无聊透顶的。</p>\n<p>我觉得更有趣的角色是<strong>工程师</strong>的角色。工程师把想法变成实实在在的产品，他们也因此有更广阔的视野。他们手头有大量工具可以完成工作，当然编程也是工具之一。</p>\n<p>但是实话实说，并且我想我也可以在此说，我们真的超级不擅长在那些被过分吹嘘的技能。</p>\n<p><a href=\"https://www.mayerdan.com/ruby/2012/11/11/bugs-per-line-of-code-ratio\">统计量不会说谎：</a></p>\n<blockquote><p>（a）行业均值：“每 1000 行代码中大约有 15 到 50 处错误。”他进一步声明这对那些背后有一定程度结构化编程、可能混有一些代码技巧的代码具有代表性。</p></blockquote>\n<blockquote><p>（b）微软应用：“内部测试时每 1000 行代码中大约有 10 到 20 处错误，发布产品中每 1000 行代码中大约有 0.5 处错误（Moore 1992）。”他将其归功于代码阅读技巧和独立检测的组合（在其著作的另一章中有进一步讨论）。</p></blockquote>\n<blockquote><p>（c）“Harlan Mills 开创了名为 ‘cleanroom development’ 的技巧，能实现在内部测试时每 1000 行代码有 3 处错误，在发布产品中每 1000 行代码有 0.1 处错误（Cobb 和 Mills 1990）。几个项目——例如飞船软件——利用了格式开发方法系统、同行审查和统计测试实现了在 500,000 行代码中有 0 处错误的水平。</p></blockquote>\n<p>要我说——我们应该尽力避免编程，使世界免受每次在集成开发环境（IDE）中按下某键产生的所有 bug 的侵害。</p>\n<p>所以没错，10 倍价值程序员是个好主意，但是我要把门槛设置得高一点。到 2018 年了，世界已经变了。</p>\n<p style=\"text-align: center;\">…………</p>\n<h3>100 倍价值工程师</h3>\n<p>我喜欢延伸目标。它们经常引导我们后退一步，并带来思维的巨大转变。这个目标也一样。如果我们想成为 100 倍价值工程师——其影响力是老一倍价值工程师的 100 倍，该怎么实现呢？</p>\n<p><b>做到自己</b>高产并不够——当然单单有编程天赋就可能实现 10 倍价值，但达到 100 倍价值就不可能了。<strong>为了拥有有 100 倍的影响力，你得让团队和组织的生产率均大幅提高，并最终领导其他人用同样的工作方式。</strong></p>\n<p>尽管 100 倍价值听起来很极端，我在职业生涯中仍然和许多我认为有“100 倍价值的观念模式”、独特的思考、说话和行动方式的人合作过。</p>\n<p>可能让某些人吃惊的是，这些与编程能力、科技和编程语言没有任何关系。常见的口号是：“为什么我们还在用 Java？如果我们能只用 Scala、Clojure、Node，&lt;&lt;在此输入今日便好 insert flavor of the day here&gt;&gt;就会更高产！”现实是，一种不同的编程语言可能最多让你达到 1.5 倍到 2 倍。这与 100 倍价值相比简直是小巫见大巫。100 倍价值是完全不同的游戏。</p>\n<p>所以，到底什么是“100 倍价值的的观念模式”？让我们一起来讨论两个方面。</p>\n<p><strong>1. Ownership 所有权</strong></p>\n<p>100 倍价值工程师掌控他们所做的事。他们知道为什么这么做、怎么做、所做的是什么。在<a href=\"https://www.amazon.com/Extreme-Ownership-U-S-Navy-SEALs-ebook/dp/B00VE4Y0Z2\">《Extreme Ownership》</a>这本书中，两位前海豹突击队队员解释了他们的极端所有权（extreme ownership）概念。这个概念的核心是，当我说“拥有某物”时到底意味着什么。这意味着：接受你要对你所做的任何事情负责。</p>\n<p>最重要的是这意味着：<strong>不能指别人</strong>。这不意味着所有事情都在你的控制之下，却意味着：当事情不可避免地出错时，你要对你如何反应负责。这意味着：你要负责预期可能发生的事情，并做好应急措施。这意味着你要从错误中学习，甚至从中汲取价值。掌控你所做事情的各个方面。</p>\n<p>要得到这种程度的所有权，我只知道一个方法：挑战。挑战你和<strong>你的团队</strong>被要求做的任何事情，这样你能理解并掌控每一个决定。</p>\n<p><strong>2. Challenging the status quo 挑战现状</strong></p>\n<p>100 倍价值工程师在三个维度进行挑战：</p>\n<p>1.<em>做什么（What）？</em></p>\n<p>这主要是关于范围的：我们在开发什么？是否仔细研究过？要求是否明确？我们确定所有这些都是重要的并且需要（马上）完成吗？</p>\n<p>2.<em>怎么做（How）？</em></p>\n<p>这是关于在怎样机智地执行某事。有可以得到同样结果的更轻松方法吗？这也是关于过程的：我们怎么样得到想要的结果，以及怎样提高？</p>\n<p>3.<em>为什么（Why）？</em></p>\n<p>这是关于业务环境的、关于完全理解为什么需要开发某个特性并检查产品经理的方法是否是满足用户需求的正确方法。</p>\n<p>来逐个看看更多细节。</p>\n<p><strong>What?  做什么？</strong></p>\n<p>更快地提供某产品的唯一最好方法是：缩减范围。它<em>需要</em>拥有的特性是什么。</p>\n<p>可以在此应用我的“5 个真的吗？”技巧：</p>\n<blockquote><p>产品经理：我们需要有所有这 10 个特性</p>\n<p>100 倍价值工程师：真的吗？</p>\n<p>产品经理：嗯。</p>\n<p>100 倍价值工程师：真的吗？</p>\n<p>产品经理：好吧，好吧，可能不需要第七个特性。但是剩下的都要。</p>\n<p>100 倍价值工程师：真的吗？</p>\n<p>产品经理：嗯，是的，我是这么想的……让我跟客户确认一下。</p>\n<p>好吧，他们可能需要第四个和第五个特性，但是我们可以之后再做这两个。剩下的都是必须的。</p>\n<p>100 倍价值工程师：真的吗？</p>\n<p>产品经理：是的。</p></blockquote>\n<p>这可能听起来像个玩笑，但是产品经理常常会拿一张长长的必需特性清单出现。然后经过几小时、几天、有时是几个月的谈判后，你得到了一张几乎只有原清单四分之一的清单。这是自然的，想出要加上的新特性要比移除特性更容易。</p>\n<p>另一个在将范围降低到较低水平的方法，是使用“帕累托法则”，二八法则。<a href=\"https://en.wikipedia.org/wiki/Pareto_principle\">维基百科</a>：</p>\n<blockquote><p>帕累托法则（也叫二八法则，关键少数法则，或者稀疏因子法则）表明，对很多事件来说，大约 80% 的影响来自于 20% 的原因。</p></blockquote>\n<p>该法则有很多应用，软件开发就是其一。往往有很多种实现某特性的方法，使用极少的精力（比如说 20%）就能带来大多数收益（例如 80%）。这点吸引人，不仅仅是因为更少的工作量，还因为你能更经济地彻底检查特性，并且只在这些特性有价值、使用过后才进行完全开发。</p>\n<p><strong>How?  怎么做？</strong></p>\n<p>既然<em>需要开发的清单</em>已经减少到一小部分了，仍然要通过挑战特性的实现方法来获得机动空间和好处。一般来说，实现某特性有很多方法。一旦团队想出一种方法，很多团队就满意了。100 倍价值工程师总会进一步寻找替代方法，根据各自的优缺点评估所有选择。</p>\n<p>“怎么做”也会被技术债务影响。经常有“变态的”方法来实现某些快、脏的特性，“合适的”方法来首先还清技术债务，再干净地实现特性。什么是最好的方法？100 倍价值工程师认识到不只有一个正确答案，并且这取决于不同情况和累积技术债务的费用。一个 100 倍价值工程师能在不同的情景中作出正确抉择，能在合适的时机和产品谈判来降低技术债务。</p>\n<p>“怎么做”的另一个方面是过程。我对 Scrum 很喜欢的一点是，它能有效设定一个基础，如果用得合适可以鼓励 100 倍价值的行为：</p>\n<p>•<b>改进</b>是讨论和挑战做什么、怎么做和为什么的好平台。产品所有者提出要开发的新特性，开发团队挑战做什么和为什么，来得到全面的背景，并相互挑战如何实现特性。</p>\n<p>•<strong>Plannings</strong> 针对下一步冲刺（sprint）做什么的<strong>计划，</strong>计划也是通往“辉煌和头脑”的手段：记起到底需要做什么，并且计划团队如何合作来交付产品</p>\n<p>•<strong>Retrospectives</strong> <strong>回顾</strong>是团队提升的方法。在一次冲刺循环中，有些事情出错了，有些事情进展不顺利。回顾是 100 倍价值工程师挑战团队来提升、下次做得更好的时刻。回顾也能练习所有权。100 倍价值工程师不抱怨低产，不指向自己以外的其他人。</p>\n<p><strong>Why?  为什么？</strong></p>\n<p>上周我和一个工程师聊了聊，他刚刚发现自己花了整整 3 个月时间实现某特性，后来有发现对用户来说同样的价值本可以在 3 日内实现。显然不会是同一种功能，但是实现的目标是一样的。</p>\n<p>这种事情怎么会发生呢？</p>\n<p>除非工程师退后一步、扩大视野、挑战为什么，这种事情就会发生。为什么要开发这个特性？用户想要实现什么？他们的需求是什么？产品经理往往会提出非常具体的特性要求，偶尔具体化程度会比较低。他们的出发点是好的。然而更可能的情况是：产品经理也是人，也会遗漏。此外，风险在于工程师不再挑战更基础的问题：为什么我们要这么做？不是还有用其他更少的精力实现同样结果的方法吗？</p>\n<p><strong>但是，等等</strong></p>\n<p>说起来容易做起来难。做起来也应该难，不是什么人都应该能跻身 100 倍价值工程师。然而，我们都可以渴望变得更好，并找到相应的方法。</p>\n<p>因此，看看 100 倍价值工程师的技能集合是值得的。你会注意到，这与 10 倍价值程序员是非常非常不同的。</p>\n<p>•<strong>沟通</strong>——这点几乎明显得不用提了，但是它是重要的一点。100 倍价值工程师有优秀的沟通技巧。沟通是拥有 100 倍影响力的关键部分。</p>\n<p>•<strong>创造力</strong>——显然这在 10 倍价值程序员中是常见的，但是所要求的创造力不是关于算法的，也不是关于灵巧的类继承结构（class inheritance structures）的，而是关于想出更有效的方法来实现目标。</p>\n<p>•<strong>同理心</strong>——在“挑战所有”的长篇大论中隐藏着“生产力挑战”。那么我这么说意味着什么？让我用我的大儿子做例子来解释一下。他 4 岁了。4 岁小孩最喜欢的问题是什么？“为什么！？”这意味着我儿子是个 100 倍价值工程师吗？不。为什么不呢？因为他总是问“为什么？”，无论时机正确与否，无论有没有意义，无论他是不是让他的父母想自杀。拥有知道该挑战什么、怎么挑战和何时挑战的同理心也是 100 倍价值工程师的重要技能。</p>\n<p>•<strong>谈判</strong>——好主意被高估了。人人都有好主意，但几乎没人真正实现这些想法。你知道需要实现一个想法，实现它的一个重要因素就是谈判——与其他开发人员谈判，与产品经理谈判，与其他利益相关者谈判。解释为什么某个主意是个好主意，以及为什么需要时间执行它们。100 倍价值工程师知道怎么做。所以当他们在场时，所有事情都似乎有可能实现。</p>\n<p>•<strong>技术</strong>——这是清单上的最后一点，但依然重要。虽然大多数提到的技巧都是“软实力”，但这并不意味着 100 倍价值工程师不需要技术。事实上，他（她）拥有领先的技术天赋是先决条件，原因有二：（1）挑战技术层面上的事情会产生巨大收益，也因此要求对技术有深层次的理解；（2）<a href=\"https://en.wikipedia.org/wiki/Ethos\">理念</a>是重要的，如果 100 倍价值工程师没有高技术，就不会被同辈接受。你得是“我们的一员”。</p>\n<p style=\"text-align: center;\">…………</p>\n<p style=\"text-align: left;\">几个月后，“我想成为世界上最好的程序员”先生作为程序员工作得非常顺利。他有天赋、努力工作、高产而且非常聪明。他会成为世界上最好的程序员吗？我不知道。</p>\n<p>但是私下里，我希望这不重要。</p>\n<p>我希望某一天，不是现在，但是可能是几年后，他会想做更多事。那时他会调整他的理想，不仅仅要擅长这个叫“编程”狭窄领域，而且渴望拥有 100 倍价值工程师的影响力。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113710\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113710votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113710\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 22</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f49c8437c74dd90a906b7a9579e6520f3044c962.jpg"},{"url_object_id": "aa94da9060b646e6772ebf4ad4c5ffe7", "title": "开源作者遭受小白的 9 种伤害", "url": "http://blog.jobbole.com/113728/", "create_date": "2018/03/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/f1a3d556b79a7fae23ad3ecc6f972164.jpg"], "praise_nums": "3", "comment_nums": 2, "fav_nums": 2, "tags": "业界,开源", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/xiandafu/blog/1630989\">闲大赋</a>   </div><div>\n<p>我是Beetl和BeetlSQL开源的作者，这俩类技术实现难度较大，前者是属于语言实现类开源，后者则是全功能ORM实现。但是这俩个开源使用门槛又低，能遇到各种各样的小白用户。我帮助小白解决了非常多技术问题，但也遭遇过小白给予的困扰。我总结了一下9种小白对开源作者造成的有意无意的伤害，并且按照严重程度分为3个级别</p>\n<h1>一级伤害，普通伤害</h1>\n<h2>聊天式提问</h2>\n<p>这种行为的小白从来没有察觉到提问是一门学科，没有研究如何提问，也没有观摩过别人的提问为何能得到专家的仔细回答。他总觉得，专家就在身边，专家有足够的时间帮助自己。他通常提问方式是</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c227aa889833384\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n小白&gt;你好，在吗？\r\n小白&gt;（10分钟后）大神，有空吗？我有一个问题想问问\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227aa889833384-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c227aa889833384-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227aa889833384-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c227aa889833384-1\">小白<span class=\"crayon-o\">&gt;</span>你好，在吗？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c227aa889833384-2\">小白<span class=\"crayon-o\">&gt;</span>（<span class=\"crayon-cn\">10</span>分钟后）大神，有空吗？我有一个问题想问问</div><div class=\"crayon-line\" id=\"crayon-5ae26a9c227aa889833384-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这类小白并不知道，开源作者都很忙，如果他空闲了恰好看到你的提问，但你没有科学提问，他几乎不会跟你去互动接下来你希望的事情。这种无意义的叨扰开源作者，挺让人心烦的。</p>\n<h2>从不阅读官方文档</h2>\n<p>这种行为小白是最为常见的小白，遇到问题都是以Baidu为工具来解决。小白需要清楚几点关于搜索引擎不能做到的地方</p>\n<ul>\n<li>对新技术，小微技术的查询滞后</li>\n<li>对流行技术，有会让人陷入信息汪洋大海中</li>\n</ul>\n<p>靠搜索引擎来解决问题的人，都会技术积累不牢固，较好的办法是以官网手册为中心，结合官网论坛，或者oschina这样专门的技术社区，结合源代码和搜索引擎来找到解决办法。对于小白来说，大部分问题都能从官网文档中找到答案。但小白却没有时间去研究官官网文档。以我经验，越是厉害的人越对官网文档重视，越要花时间去通读官网手册，官网的其他技术资料。 越是小白呢，因为忙就不详细了解官网文档，结果知识不牢固，会导致后面越来越忙（因为会一直解决跟本不是问题的问题），陷入恶心循环</p>\n<p>我在我的SpringBoot-Plus开源中，安装说明有14行，有5行且标准了重点，都提到要用JDK8和打开Parameter参数，并详细说明了如果系统启动时报报错，应该就是paramter参数没有打开（我同时也链接了如何打开JDK8 paramter参数的文章),结果还是有10几位小白告诉我系统起不来，并附上了我在安装说明里提到过的相同错误。</p>\n<p>这类小白老是问一下显而易见的问题，对开源作者和其他初级用户造成了困惑</p>\n<h2>要这要那，不经过思考和探索</h2>\n<p>这类小白对开源作者造成了常规性的伤害最多。有时候我都怀疑他们并不是不会，而是懒，以为开源作者就是他身边的老师，或者身边的同事 ，比如他们经常提一些明显能自己解决的问题，比如</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c227b5115021171\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n小白&gt;BeetlSQL如何翻页（实际上官网文档有专门一章讲翻页）\r\n小白&gt;Beetl的Maven坐标是什么（同样官网文档肯定有哇）\r\n小白&gt;SpringBoot-Plus 数据库安装脚本有吗（如果没有，还能叫开源吗，就在doc目录下）\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227b5115021171-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c227b5115021171-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227b5115021171-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c227b5115021171-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c227b5115021171-1\">小白<span class=\"crayon-o\">&gt;</span><span class=\"crayon-i\">BeetlSQL</span>如何翻页（实际上官网文档有专门一章讲翻页）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c227b5115021171-2\">小白<span class=\"crayon-o\">&gt;</span><span class=\"crayon-i\">Beetl</span>的<span class=\"crayon-i\">Maven</span>坐标是什么（同样官网文档肯定有哇）</div><div class=\"crayon-line\" id=\"crayon-5ae26a9c227b5115021171-3\">小白<span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">SpringBoot</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Plus</span><span class=\"crayon-h\"> </span>数据库安装脚本有吗（如果没有，还能叫开源吗，就在<span class=\"crayon-i\">doc</span>目录下）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c227b5115021171-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>这类小白的问题，如果你真有空回答，还并不好回答，这类小白的问题通常都需要大篇幅的解答其疑问，因为问的实在太基础了</p>\n<h1>二级伤害，常规伤害</h1>\n<h2>情绪宣泄类型小白</h2>\n<p>这类小白有一定技术能力，但靠自己没有解决问题，因此在和开源作者交流过程中过于注重自己的情感体验了，比如</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c227bc124909463\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n小白&gt;这个问题我花了周末俩天都没解决，难道Beetl真的很不好用吗？（作为开源作者的我，真想一棍子敲打上去，你是不是来解决问题的？）\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227bc124909463-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c227bc124909463-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c227bc124909463-1\">小白<span class=\"crayon-o\">&gt;</span>这个问题我花了周末俩天都没解决，难道<span class=\"crayon-i\">Beetl</span>真的很不好用吗？（作为开源作者的我，真想一棍子敲打上去，你是不是来解决问题的？）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c227bc124909463-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>还比如经常有小白辛苦工作到晚上11点，然后qq群提问</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c227c0665306565\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n小白&gt;大家好，问个问题,很着急解决......\r\n\r\n小白&gt;(半小时后)，这个群太冷漠了，都没人愿意帮助我\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227c0665306565-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c227c0665306565-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227c0665306565-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c227c0665306565-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c227c0665306565-1\">小白<span class=\"crayon-o\">&gt;</span>大家好，问个问题<span class=\"crayon-sy\">,</span>很着急解决<span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c227c0665306565-2\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c227c0665306565-3\">小白<span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span>半小时后<span class=\"crayon-sy\">)</span>，这个群太冷漠了，都没人愿意帮助我</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c227c0665306565-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>其实大家不愿帮助，可能是因为都睡觉了，或者没有精力再深夜去帮你解决问题，但你宣泄了个人情感，估计第二天也不会得到社区任何帮助</p>\n<h2>选择性的展示问题线索</h2>\n<p>这类小白是最让人开源作者头疼的，因为他们在寻求帮助的时候，不知道自己需要向开源作者提供什么样的信息。甚至有时候故意只将自己写正确的部分展示出来，来取得开源作者的认同。但这无法解决问题</p>\n<p>最常见的是只贴出自己的代码，但并没有贴出错误提示。其实错误提示更能帮助开源作者解决问题，甚至不需要贴出你的代码都行。 有些人贴出了错误提示，比如异常栈，但并没有完整的贴出异常栈，有些人贴出了代码，但并没有把IDE的代码行也跟图粘贴出来，这导致无法交流</p>\n<p>比如这个贴图，很难给开源作者提供详细的线索，真正的线索应该在下面未贴出的异常栈里</p>\n<p><img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/44fecd417e8fb41407739e36f8842fd8.png\" alt=\"输入图片说明\"></p>\n<p>这个贴图则没有包含代码行数，会出现交流困难 <img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/fbf597c38a270d90e2370b006ee08304.png\" alt=\"输入图片说明\"></p>\n<p>较好的方式是这个图</p>\n<p><img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/05a9aac62b2942fcdade9d3f841d4549.png\" alt=\"输入图片说明\"></p>\n<p>这类小白会非常浪费开源作者的时间，所以我认为是二级伤害。</p>\n<p>我经常说一句话，你若仔细提问，我便详细回答。通常，对于社区提问附带多张图片的小白，非常受我欢迎</p>\n<h2>向开源作者提出错误的问题</h2>\n<p>有些小白经过思考和探索后，提出了错误的问题。比如</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c227c4351102046\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n小白&gt;为什么XXX开源不兼容Java7(实际上根本不是版本的事情）\r\n小白&gt;为什么BeetlSQL不支持SQLServer(实际上是数据库配置不正确)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227c4351102046-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c227c4351102046-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227c4351102046-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c227c4351102046-1\">小白<span class=\"crayon-o\">&gt;</span>为什么<span class=\"crayon-i\">XXX</span>开源不兼容<span class=\"crayon-e\">Java7</span><span class=\"crayon-sy\">(</span>实际上根本不是版本的事情）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c227c4351102046-2\">小白<span class=\"crayon-o\">&gt;</span>为什么<span class=\"crayon-i\">BeetlSQL</span>不支持<span class=\"crayon-e\">SQLServer</span><span class=\"crayon-sy\">(</span>实际上是数据库配置不正确<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c227c4351102046-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>。这类提问能错误引导问题解答者。正确的姿势应该是完整的说出自己的期望和自己的过程以及最后的现象。然后可以提出自己认为的解答方向来辅助开源作者帮你解决问题</p>\n<h2>隐藏自己的背景信息</h2>\n<p>开源作者回答的思路很多，背景信息对开源作者回答问题有很大帮助。比如，你是个新手，那么SpringBoot-Plus没有启动，可能是你没有安装Maven或者JDK，如果你是个SpringBoot有经验者，曾经用SpringBoot在好几个项目里，那么启动失败可能真的意味这有环境不兼容，甚至是开源Bug</p>\n<p>小白提问的时候花几句介绍一下自己是非常有必要的，比如</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c227ca673957655\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n大有前途的小白&gt;我是SpringBoot-Plus使用新手，我有3年java经验，也使用过Spring，自己也实现过AOP，现在有一个SpringBoot的自定义AOP如何实现的问题....\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c227ca673957655-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c227ca673957655-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c227ca673957655-1\">大有前途的小白<span class=\"crayon-o\">&gt;</span>我是<span class=\"crayon-v\">SpringBoot</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Plus</span>使用新手，我有<span class=\"crayon-cn\">3</span>年<span class=\"crayon-i\">java</span>经验，也使用过<span class=\"crayon-i\">Spring</span>，自己也实现过<span class=\"crayon-i\">AOP</span>，现在有一个<span class=\"crayon-i\">SpringBoot</span>的自定义<span class=\"crayon-i\">AOP</span>如何实现的问题<span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c227ca673957655-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>这样的提问，比小白一上来就问如何实现AOP好很多，前者能帮助开源作者知道解答的范围从而精确解答，节省了开源作者的时间，也节省了小白时间</p>\n<h1>三级伤害，伤透了心</h1>\n<h2>对于开源作者招待不周行为进行攻击，造谣</h2>\n<p>开源作者都是出于兴趣在业余时间完成开源，也是抽空帮助解答问题，因此如果开源作者不回答问题，或者简洁回答，这都是开源作者的常态行为。但有些小白却认为受到了冒犯从而转为攻击开源作者。</p>\n<p>我就遭受过俩个人类似的攻击，他们嫌我怠慢他们，或者是言语上让他们难堪，就转而在社区攻击我，比如，用小号再次潜入群里，故意激怒我踢走他，然后他在oschina上发帖子说《beetl作者闲大赋为什么如此自负和目中无人》，并截图为证。这个帖子在oschina首页因为热门而存在了一个月时间</p>\n<p>还有人因为我的怠慢而在社区收集我的各种黑证据，比如有一次看到并发里的内存模型，我就在社区提问（其实当时我已经了解了），意图是想让大家讨论一下技术，结果又有人马上把这个截图发到社区，然后说《闲大赋连并发都不懂》</p>\n<p><img title=\"在这里输入图片标题\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/85ed9e2d4e339bcdd6c6eb005bd0dbeb.png\" alt=\"输入图片说明\"></p>\n<h1>三级++伤害</h1>\n<h2>攻击网站，黑掉开源作者的开源社区</h2>\n<p>这个也许是特列，但我碰上了，这位小白是某大互联网公司的技术人员，在社区里不可一世，甚至开始教育其他人的品德。作为一个年轻人，非常猖狂。我后来驱逐他出社区后，没想到的是，网站立刻不能访问，一直遭受暴力破解，而且他还通过小号在社区直播破坏过程。第二天，ibeetl.com 真的不能访问，整个社区被黑，数据被清空，积累了3年的技术问答全不不复存在。</p>\n<p>后来在社区其他人员帮助写，用SpringBoot+Beetl+BeetlSQL重写了一个java论坛，甚至开源了这个项目，因祸得福吧。远离了恶人，结交了真朋友</p>\n<h1>总结</h1>\n<p>作为开源作者，提供了自己的想法和实践出来的作品，难得可贵，如果有好的小白，那么开源产品会更加完美。如果遭遇到上面我列举出来的各种小白，那就是开源作者的不幸，我觉得这个一直是常态，遇上几个特别优秀的小白，又会碰上几个对开源作者造成各种级别伤害的小白。希望小白们看了这个博客，能减少自己对开源作者造成的困扰和伤害，同时提高自己的技术水平</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113728\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113728votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113728\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/70c7b887c37d9154dc2b5636ed919464c716d375.jpg"},{"url_object_id": "b49b820d1a88139adbc0e923d2f824f6", "title": "Linux 跟踪器之选", "url": "http://blog.jobbole.com/113735/", "create_date": "2018/03/10", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.brendangregg.com/blog/2015-07-08/choosing-a-linux-tracer.html\">Brendan Gregg</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9424-1.html\">Linux中国/qhwdw</a>   </div><blockquote><p>Linux 跟踪很神奇！</p></blockquote>\n<p>跟踪器tracer是一个高级的性能分析和调试工具，如果你使用过 <code>strace(1)</code> 或者 <code>tcpdump(8)</code>，你不应该被它吓到 … 你使用的就是跟踪器。系统跟踪器能让你看到很多的东西，而不仅是系统调用或者数据包，因为常见的跟踪器都可以跟踪内核或者应用程序的任何东西。</p>\n<p>有大量的 Linux 跟踪器可供你选择。由于它们中的每个都有一个官方的（或者非官方的）的吉祥物，我们有足够多的选择给孩子们展示。</p>\n<p>你喜欢使用哪一个呢？</p>\n<p>我从两类读者的角度来回答这个问题：大多数人和性能/内核工程师。当然，随着时间的推移，这也可能会发生变化，因此，我需要及时去更新本文内容，或许是每年一次，或者更频繁。（LCTT 译注：本文最后更新于 2015 年）</p>\n<h3 id=\"toc_1\">对于大多数人</h3>\n<p>大多数人（开发者、系统管理员、运维人员、网络可靠性工程师（SRE）…）是不需要去学习系统跟踪器的底层细节的。以下是你需要去了解和做的事情：</p>\n<h4 id=\"toc_2\">1. 使用 perf_events 进行 CPU 剖析</h4>\n<p>可以使用 perf_events 进行 CPU 剖析profiling。它可以用一个 <a href=\"http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html\">火焰图</a> 来形象地表示。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c41c3f964368940\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit clone --depth 1 https://github.com/brendangregg/FlameGraph\r\nperf record -F 99 -a -g -- sleep 30\r\nperf script | ./FlameGraph/stackcollapse-perf.pl | ./FlameGraph/flamegraph.pl &gt; perf.svg\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c41c3f964368940-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c41c3f964368940-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c41c3f964368940-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c41c3f964368940-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c41c3f964368940-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">depth</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/brendangregg/FlameGraph</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c41c3f964368940-2\"><span class=\"crayon-e\">perf </span><span class=\"crayon-v\">record</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">99</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c41c3f964368940-3\"><span class=\"crayon-e\">perf </span><span class=\"crayon-v\">script</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">FlameGraph</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">stackcollapse</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">perf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">FlameGraph</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">flamegraph</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">perf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">svg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c41c3f964368940-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/a5247adc2d78d2586e73f049d6d2347c.png\" alt=\"\"></p>\n<p>Linux 的 perf_events（即 <code>perf</code>，后者是它的命令）是官方为 Linux 用户准备的跟踪器/分析器。它位于内核源码中，并且维护的非常好（而且现在它的功能还在快速变强）。它一般是通过 linux-tools-common 这个包来添加的。</p>\n<p><code>perf</code> 可以做的事情很多，但是，如果我只能建议你学习其中的一个功能的话，那就是 CPU 剖析。虽然从技术角度来说，这并不是事件“跟踪”，而是采样sampling。最难的部分是获得完整的栈和符号，这部分在我的 <a href=\"http://www.brendangregg.com/blog/2015-02-27/linux-profiling-at-netflix.html\">Linux Profiling at Netflix</a> 中针对 Java 和 Node.js 讨论过。</p>\n<h4 id=\"toc_3\">2. 知道它能干什么</h4>\n<p>正如一位朋友所说的：“你不需要知道 X 光机是如何工作的，但你需要明白的是，如果你吞下了一个硬币，X 光机是你的一个选择！”你需要知道使用跟踪器能够做什么，因此，如果你在业务上确实需要它，你可以以后再去学习它，或者请会使用它的人来做。</p>\n<p>简单地说：几乎任何事情都可以通过跟踪来了解它。内部文件系统、TCP/IP 处理过程、设备驱动、应用程序内部情况。阅读我在 lwn.net 上的 <a href=\"http://lwn.net/Articles/608497/\">ftrace</a> 的文章，也可以去浏览 <a href=\"http://www.brendangregg.com/perf.html\">perf_events 页面</a>，那里有一些跟踪（和剖析）能力的示例。</p>\n<h4 id=\"toc_4\">3. 需要一个前端工具</h4>\n<p>如果你要购买一个性能分析工具（有许多公司销售这类产品），并要求支持 Linux 跟踪。想要一个直观的“点击”界面去探查内核的内部，以及包含一个在不同堆栈位置的延迟热力图。就像我在 <a href=\"http://www.brendangregg.com/blog/2015-06-23/netflix-instance-analysis-requirements.html\">Monitorama 演讲</a> 中描述的那样。</p>\n<p>我创建并开源了我自己的一些前端工具，虽然它是基于 CLI 的（不是图形界面的）。这样可以使其它人使用跟踪器更快更容易。比如，我的 <a href=\"http://www.brendangregg.com/blog/2015-03-17/linux-performance-analysis-perf-tools.html\">perf-tools</a>，跟踪新进程是这样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c41c49135002849\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ./execsnoop\r\nTracing exec()s. Ctrl-C to end.\r\n PID PPID ARGS\r\n 22898 22004 man ls\r\n 22905 22898 preconv -e UTF-8\r\n 22908 22898 pager -s\r\n 22907 22898 nroff -mandoc -rLL=164n -rLT=164n -Tutf8\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c41c49135002849-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c41c49135002849-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c41c49135002849-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c41c49135002849-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c41c49135002849-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c41c49135002849-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c41c49135002849-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c41c49135002849-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c41c49135002849-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c41c49135002849-1\"><span class=\"crayon-p\"># ./execsnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c41c49135002849-2\"><span class=\"crayon-e\">Tracing </span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ctrl</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c41c49135002849-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PID </span><span class=\"crayon-e\">PPID </span><span class=\"crayon-i\">ARGS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c41c49135002849-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22898</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22004</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">man </span><span class=\"crayon-i\">ls</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c41c49135002849-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22905</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22898</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">preconv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UTF</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c41c49135002849-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22908</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22898</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pager</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c41c49135002849-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22907</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22898</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nroff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mandoc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rLL</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">164n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rLT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">164n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Tutf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c41c49135002849-8\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c41c49135002849-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>在 Netflix 公司，我正在开发 <a href=\"http://techblog.netflix.com/2015/04/introducing-vector-netflixs-on-host.html\">Vector</a>，它是一个实例分析工具，实际上它也是一个 Linux 跟踪器的前端。</p>\n<h3 id=\"toc_5\">对于性能或者内核工程师</h3>\n<p>一般来说，我们的工作都非常难，因为大多数人或许要求我们去搞清楚如何去跟踪某个事件，以及因此需要选择使用哪个跟踪器。为完全理解一个跟踪器，你通常需要花至少一百多个小时去使用它。理解所有的 Linux 跟踪器并能在它们之间做出正确的选择是件很难的事情。（我或许是唯一接近完成这件事的人）</p>\n<p>在这里我建议选择如下，要么：</p>\n<p>A）选择一个全能的跟踪器，并以它为标准。这需要在一个测试环境中花大量的时间来搞清楚它的细微差别和安全性。我现在的建议是 SystemTap 的最新版本（例如，从 <a href=\"https://sourceware.org/git/?p=systemtap.git;a=blob_plain;f=README;hb=HEAD\">源代码</a> 构建）。我知道有的公司选择的是 LTTng ，尽管它并不是很强大（但是它很安全），但他们也用的很好。如果在 <code>sysdig</code> 中添加了跟踪点或者是 kprobes，它也是另外的一个候选者。</p>\n<p>B）按我的 <a href=\"http://www.slideshare.net/brendangregg/velocity-2015-linux-perf-tools\">Velocity 教程中</a> 的流程图。这意味着尽可能使用 ftrace 或者 perf_events，eBPF 已经集成到内核中了，然后用其它的跟踪器，如 SystemTap/LTTng 作为对 eBPF 的补充。我目前在 Netflix 的工作中就是这么做的。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/e8c50ccc72d9f49c3f75c3d34f139c65.png\" alt=\"\"></p>\n<p>以下是我对各个跟踪器的评价：</p>\n<h4 id=\"toc_6\">1. ftrace</h4>\n<p>我爱 <a href=\"http://lwn.net/Articles/370423/\">ftrace</a>，它是内核黑客最好的朋友。它被构建进内核中，它能够利用跟踪点、kprobes、以及 uprobes，以提供一些功能：使用可选的过滤器和参数进行事件跟踪；事件计数和计时，内核概览；函数流步进function-flow walking。关于它的示例可以查看内核源代码树中的 <a href=\"https://www.kernel.org/doc/Documentation/trace/ftrace.txt\">ftrace.txt</a>。它通过 <code>/sys</code> 来管理，是面向单一的 root 用户的（虽然你可以使用缓冲实例以让其支持多用户），它的界面有时很繁琐，但是它比较容易调校hackable，并且有个前端：ftrace 的主要创建者 Steven Rostedt 设计了一个 trace-cmd，而且我也创建了 perf-tools 集合。我最诟病的就是它不是可编程的programmable，因此，举个例子说，你不能保存和获取时间戳、计算延迟，以及将其保存为直方图。你需要转储事件到用户级以便于进行后期处理，这需要花费一些成本。它也许可以通过 eBPF 实现可编程。</p>\n<h4 id=\"toc_7\">2. perf_events</h4>\n<p><a href=\"https://perf.wiki.kernel.org/index.php/Main_Page\">perf_events</a> 是 Linux 用户的主要跟踪工具，它的源代码位于 Linux 内核中，一般是通过 linux-tools-common 包来添加的。它又称为 <code>perf</code>，后者指的是它的前端，它相当高效（动态缓存），一般用于跟踪并转储到一个文件中（perf.data），然后可以在之后进行后期处理。它可以做大部分 ftrace 能做的事情。它不能进行函数流步进，并且不太容易调校（而它的安全/错误检查做的更好一些）。但它可以做剖析（采样）、CPU 性能计数、用户级的栈转换、以及使用本地变量利用调试信息debuginfo进行行级跟踪line tracing。它也支持多个并发用户。与 ftrace 一样，它也不是内核可编程的，除非 eBPF 支持（补丁已经在计划中）。如果只学习一个跟踪器，我建议大家去学习 perf，它可以解决大量的问题，并且它也相当安全。</p>\n<h4 id=\"toc_8\">3. eBPF</h4>\n<p>扩展的伯克利包过滤器extended Berkeley Packet Filter（eBPF）是一个内核内in-kernel的虚拟机，可以在事件上运行程序，它非常高效（JIT）。它可能最终为 ftrace 和 perf_events 提供内核内编程in-kernel programming，并可以去增强其它跟踪器。它现在是由 Alexei Starovoitov 开发的，还没有实现完全的整合，但是对于一些令人印象深刻的工具，有些内核版本（比如，4.1）已经支持了：比如，块设备 I/O 的延迟热力图latency heat map。更多参考资料，请查阅 Alexei 的 <a href=\"http://www.phoronix.com/scan.php?page=news_item&amp;px=BPF-Understanding-Kernel-VM\">BPF 演示</a>，和它的 <a href=\"https://github.com/torvalds/linux/tree/master/samples/bpf\">eBPF 示例</a>。</p>\n<h4 id=\"toc_9\">4. SystemTap</h4>\n<p><a href=\"https://sourceware.org/systemtap/wiki\">SystemTap</a> 是一个非常强大的跟踪器。它可以做任何事情：剖析、跟踪点、kprobes、uprobes（它就来自 SystemTap）、USDT、内核内编程等等。它将程序编译成内核模块并加载它们 —— 这是一种很难保证安全的方法。它开发是在内核代码树之外进行的，并且在过去出现过很多问题（内核崩溃或冻结）。许多并不是 SystemTap 的过错 —— 它通常是首次对内核使用某些跟踪功能，并率先遇到 bug。最新版本的 SystemTap 是非常好的（你需要从它的源代码编译），但是，许多人仍然没有从早期版本的问题阴影中走出来。如果你想去使用它，花一些时间去测试环境，然后，在 irc.freenode.net 的 #systemtap 频道与开发者进行讨论。（Netflix 有一个容错架构，我们使用了 SystemTap，但是我们或许比起你来说，更少担心它的安全性）我最诟病的事情是，它似乎假设你有办法得到内核调试信息，而我并没有这些信息。没有它我实际上可以做很多事情，但是缺少相关的文档和示例（我现在自己开始帮着做这些了）。</p>\n<h4 id=\"toc_10\">5. LTTng</h4>\n<p><a href=\"http://lttng.org/\">LTTng</a> 对事件收集进行了优化，性能要好于其它的跟踪器，也支持许多的事件类型，包括 USDT。它的开发是在内核代码树之外进行的。它的核心部分非常简单：通过一个很小的固定指令集写入事件到跟踪缓冲区。这样让它既安全又快速。缺点是做内核内编程不太容易。我觉得那不是个大问题，由于它优化的很好，可以充分的扩展，尽管需要后期处理。它也探索了一种不同的分析技术。很多的“黑匣子”记录了所有感兴趣的事件，以便可以在 GUI 中以后分析它。我担心该记录会错失之前没有预料的事件，我真的需要花一些时间去看看它在实践中是如何工作的。这个跟踪器上我花的时间最少（没有特别的原因）。</p>\n<h4 id=\"toc_11\">6. ktap</h4>\n<p><a href=\"http://ktap.org/\">ktap</a> 是一个很有前途的跟踪器，它在内核中使用了一个 lua 虚拟机，不需要调试信息和在嵌入时设备上可以工作的很好。这使得它进入了人们的视野，在某个时候似乎要成为 Linux 上最好的跟踪器。然而，由于 eBPF 开始集成到了内核，而 ktap 的集成工作被推迟了，直到它能够使用 eBPF 而不是它自己的虚拟机。由于 eBPF 在几个月过去之后仍然在集成过程中，ktap 的开发者已经等待了很长的时间。我希望在今年的晚些时间它能够重启开发。</p>\n<h4 id=\"toc_12\">7. dtrace4linux</h4>\n<p><a href=\"https://github.com/dtrace4linux/linux\">dtrace4linux</a> 主要由一个人（Paul Fox）利用业务时间将 Sun DTrace 移植到 Linux 中的。它令人印象深刻，一些供应器provider可以工作，还不是很完美，它最多应该算是实验性的工具（不安全）。我认为对于许可证的担心，使人们对它保持谨慎：它可能永远也进入不了 Linux 内核，因为 Sun 是基于 CDDL 许可证发布的 DTrace；Paul 的方法是将它作为一个插件。我非常希望看到 Linux 上的 DTrace，并且希望这个项目能够完成，我想我加入 Netflix 时将花一些时间来帮它完成。但是，我一直在使用内置的跟踪器 ftrace 和 perf_events。</p>\n<h4 id=\"toc_13\">8. OL DTrace</h4>\n<p><a href=\"http://docs.oracle.com/cd/E37670_01/E38608/html/index.html\">Oracle Linux DTrace</a> 是将 DTrace 移植到 Linux （尤其是 Oracle Linux）的重大努力。过去这些年的许多发布版本都一直稳定的进步，开发者甚至谈到了改善 DTrace 测试套件，这显示出这个项目很有前途。许多有用的功能已经完成：系统调用、剖析、sdt、proc、sched、以及 USDT。我一直在等待着 fbt（函数边界跟踪，对内核的动态跟踪），它将成为 Linux 内核上非常强大的功能。它最终能否成功取决于能否吸引足够多的人去使用 Oracle Linux（并为支持付费）。另一个羁绊是它并非完全开源的：内核组件是开源的，但用户级代码我没有看到。</p>\n<h4 id=\"toc_14\">9. sysdig</h4>\n<p><a href=\"http://www.sysdig.org/\">sysdig</a> 是一个很新的跟踪器，它可以使用类似 <code>tcpdump</code> 的语法来处理系统调用syscall事件，并用 lua 做后期处理。它也是令人印象深刻的，并且很高兴能看到在系统跟踪领域的创新。它的局限性是，它的系统调用只能是在当时，并且，它转储所有事件到用户级进行后期处理。你可以使用系统调用来做许多事情，虽然我希望能看到它去支持跟踪点、kprobes、以及 uprobes。我也希望看到它支持 eBPF 以查看内核内概览。sysdig 的开发者现在正在增加对容器的支持。可以关注它的进一步发展。</p>\n<h3 id=\"toc_15\">深入阅读</h3>\n<p>我自己的工作中使用到的跟踪器包括：</p>\n<ul>\n<li><strong>ftrace</strong> ： 我的 <a href=\"http://www.brendangregg.com/blog/2015-03-17/linux-performance-analysis-perf-tools.html\">perf-tools</a> 集合（查看示例目录）；我的 lwn.net 的 <a href=\"http://lwn.net/Articles/608497/\">ftrace 跟踪器的文章</a>； 一个 <a href=\"http://www.brendangregg.com/blog/2015-03-17/linux-performance-analysis-perf-tools.html\">LISA14</a> 演讲；以及帖子： <a href=\"http://www.brendangregg.com/blog/2014-07-13/linux-ftrace-function-counting.html\">函数计数</a>、 <a href=\"http://www.brendangregg.com/blog/2014-07-16/iosnoop-for-linux.html\">iosnoop</a>、 <a href=\"http://www.brendangregg.com/blog/2014-07-25/opensnoop-for-linux.html\">opensnoop</a>、 <a href=\"http://www.brendangregg.com/blog/2014-07-28/execsnoop-for-linux.html\">execsnoop</a>、 <a href=\"http://www.brendangregg.com/blog/2014-09-06/linux-ftrace-tcp-retransmit-tracing.html\">TCP retransmits</a>、 <a href=\"http://www.brendangregg.com/blog/2015-06-28/linux-ftrace-uprobe.html\">uprobes</a> 和 <a href=\"http://www.brendangregg.com/blog/2015-07-03/hacking-linux-usdt-ftrace.html\">USDT</a>。</li>\n<li><strong>perf_events</strong> ： 我的 <a href=\"http://www.brendangregg.com/perf.html\">perf_events 示例</a> 页面；在 SCALE 的一个 <a href=\"http://www.brendangregg.com/blog/2015-02-27/linux-profiling-at-netflix.html\">Linux Profiling at Netflix</a> 演讲；和帖子：<a href=\"http://www.brendangregg.com/blog/2014-06-22/perf-cpu-sample.html\">CPU 采样</a>、<a href=\"http://www.brendangregg.com/blog/2014-06-29/perf-static-tracepoints.html\">静态跟踪点</a>、<a href=\"http://www.brendangregg.com/blog/2014-07-01/perf-heat-maps.html\">热力图</a>、<a href=\"http://www.brendangregg.com/blog/2014-07-03/perf-counting.html\">计数</a>、<a href=\"http://www.brendangregg.com/blog/2014-09-11/perf-kernel-line-tracing.html\">内核行级跟踪</a>、<a href=\"http://www.brendangregg.com/blog/2015-02-26/linux-perf-off-cpu-flame-graph.html\">off-CPU 时间火焰图</a>。</li>\n<li><strong>eBPF</strong> : 帖子 <a href=\"http://www.brendangregg.com/blog/2015-05-15/ebpf-one-small-step.html\">eBPF：一个小的进步</a>，和一些 <a href=\"https://github.com/brendangregg/BPF-tools\">BPF-tools</a> （我需要发布更多）。</li>\n<li><strong>SystemTap</strong> ： 很久以前，我写了一篇 <a href=\"http://dtrace.org/blogs/brendan/2011/10/15/using-systemtap/\">使用 SystemTap</a> 的文章，它有点过时了。最近我发布了一些 <a href=\"https://github.com/brendangregg/systemtap-lwtools\">systemtap-lwtools</a>，展示了在没有内核调试信息的情况下，SystemTap 是如何使用的。</li>\n<li><strong>LTTng</strong> ： 我使用它的时间很短，不足以发布什么文章。</li>\n<li><strong>ktap</strong> ： 我的 <a href=\"http://www.brendangregg.com/ktap.html\">ktap 示例</a> 页面包括一行程序和脚本，虽然它是早期的版本。</li>\n<li><strong>dtrace4linux</strong> ： 在我的 <a href=\"http://www.brendangregg.com/sysperfbook.html\">系统性能</a> 书中包含了一些示例，并且在过去我为了某些事情开发了一些小的修补，比如， <a href=\"https://github.com/dtrace4linux/linux/issues/55\">timestamps</a>。</li>\n<li><strong>OL DTrace</strong> ： 因为它是对 DTrace 的直接移植，我早期 DTrace 的工作大多与之相关（链接太多了，可以去 <a href=\"http://www.brendangregg.com\">我的主页</a> 上搜索）。一旦它更加完美，我可以开发很多专用工具。</li>\n<li><strong>sysdig</strong> ： 我贡献了 <a href=\"https://github.com/brendangregg/sysdig/commit/d0eeac1a32d6749dab24d1dc3fffb2ef0f9d7151\">fileslower</a> 和 <a href=\"https://github.com/brendangregg/sysdig/commit/2f21604dce0b561407accb9dba869aa19c365952\">subsecond offset spectrogram</a> 的 chisel。</li>\n<li><strong>其它</strong> ： 关于 <a href=\"http://www.brendangregg.com/blog/2014-05-11/strace-wow-much-syscall.html\">strace</a>，我写了一些告诫文章。</li>\n</ul>\n<p>不好意思，没有更多的跟踪器了！ … 如果你想知道为什么 Linux 中的跟踪器不止一个，或者关于 DTrace 的内容，在我的 <a href=\"http://www.brendangregg.com/blog/2015-02-28/from-dtrace-to-linux.html\">从 DTrace 到 Linux</a> 的演讲中有答案，从 <a href=\"http://www.slideshare.net/brendangregg/from-dtrace-to-linux/28\">第 28 张幻灯片</a> 开始。</p>\n<p>感谢 <a href=\"http://www.beginningwithi.com/\">Deirdre Straughan</a> 的编辑，以及跟踪小马的创建（General Zoi 是小马的创建者）。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113735\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113735votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113735\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "8dc9c672255230d0cfa267884f1e9bb5", "title": "利用 DB 实现分布式锁的思路", "url": "http://blog.jobbole.com/113707/", "create_date": "2018/03/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/07/8266f93c2d45d97e0d52e71428ca372e.png"], "praise_nums": "1", "comment_nums": 4, "fav_nums": 3, "tags": "IT技术,分布式", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">Sam哥哥</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h3>概述</h3>\n<p>以前参加过一个库存系统，由于其业务复杂性，搞了很多个应用来支撑。这样的话一份库存数据就有可能同时有多个应用来修改库存数据。比如说，有定时任务域xx.cron，和SystemA域和SystemB域这几个JAVA应用，可能同时修改同一份库存数据。如果不做协调的话，就会有脏数据出现。对于跨JAVA进程的线程协调，可以借助外部环境，例如DB或者Redis。下文介绍一下如何使用DB来实现分布式锁。</p>\n<h3>设计</h3>\n<p>本文设计的分布式锁的交互方式如下：<br>\n1、根据业务字段生成<code>transaction_id</code>，并线程安全的创建锁资源<br>\n2、根据<code>transaction_id</code>申请锁<br>\n3、释放锁</p>\n<h3>动态创建锁资源</h3>\n<p>在使用<code>synchronized</code>关键字的时候，必须指定一个锁对象。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c301f8579197764\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsynchronized(obj) {\r\n\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c301f8579197764-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c301f8579197764-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c301f8579197764-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c301f8579197764-1\"><span class=\"crayon-e\">synchronized</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c301f8579197764-2\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c301f8579197764-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>进程内的线程可以基于obj来实现同步。obj在这里可以理解为一个锁对象。如果线程要进入<code>synchronized</code>代码块里，必须先持有obj对象上的锁。这种锁是JAVA里面的内置锁，创建的过程是线程安全的。那么借助DB，如何保证创建锁的过程是线程安全的呢？可以利用DB中的<code>UNIQUE KEY</code>特性，一旦出现了重复的key，由于<code>UNIQUE KEY</code>的唯一性，会抛出异常的。在JAVA里面，是<code>SQLIntegrityConstraintViolationException</code>异常。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c30201543578898\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncreate table distributed_lock\r\n(\r\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '自增主键',\r\n    transaction_id varchar(128) NOT NULL DEFAULT '' COMMENT '事务id',\r\n    last_update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL COMMENT '最后更新时间',\r\n    create_time TIMESTAMP DEFAULT '0000-00-00 00:00:00' NOT NULL COMMENT '创建时间',\r\n    UNIQUE KEY `idx_transaction_id` (`transaction_id`)\r\n)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30201543578898-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30201543578898-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30201543578898-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30201543578898-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30201543578898-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30201543578898-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30201543578898-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30201543578898-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c30201543578898-1\"><span class=\"crayon-e\">create </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">distributed_lock</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30201543578898-2\"><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30201543578898-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">id </span><span class=\"crayon-e\">BIGINT </span><span class=\"crayon-t\">UNSIGNED</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY </span><span class=\"crayon-e\">AUTO_INCREMENT </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'自增主键'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30201543578898-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">transaction_id </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'事务id'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30201543578898-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">last_update_time </span><span class=\"crayon-e\">TIMESTAMP </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CURRENT_TIMESTAMP </span><span class=\"crayon-e\">ON </span><span class=\"crayon-e\">UPDATE </span><span class=\"crayon-e\">CURRENT_TIMESTAMP </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'最后更新时间'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30201543578898-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">create_time </span><span class=\"crayon-e\">TIMESTAMP </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0000-00-00 00:00:00'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'创建时间'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30201543578898-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">idx_transaction_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">transaction_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30201543578898-8\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p><code>transaction_id</code>是事务Id，比如说，可以用</p>\n<blockquote><p>仓库 + 条码 + 销售模式</p></blockquote>\n<p>来组装一个<code>transaction_id</code>，表示某仓库某销售模式下的某个条码资源。不同条码，当然就有不同的<code>transaction_id</code>。如果有两个应用，拿着相同的<code>transaction_id</code>来创建锁资源的时候，只能有一个应用创建成功。</p>\n<blockquote><p>一条<code>distributed_lock</code>记录插入成功了，就表示一份锁资源创建成功了。</p></blockquote>\n<h3>DB连接池列表设计</h3>\n<p>在写操作频繁的业务系统中，通常会进行分库，以降低单数据库写入的压力，并提高写操作的吞吐量。如果使用了分库，那么业务数据自然也都分配到各个数据库上了。在这种水平切分的多数据库上使用DB分布式锁，可以自定义一个<code>DataSouce</code>列表。并暴露一个<code>getConnection(String transactionId)</code>方法，按照<code>transactionId</code>找到对应的<code>Connection</code>。</p>\n<p>实现代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c30206383253503\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage dlock;\r\n\r\nimport com.alibaba.druid.pool.DruidDataSource;\r\nimport org.springframework.stereotype.Component;\r\n\r\nimport javax.annotation.PostConstruct;\r\nimport java.io.FileInputStream;\r\nimport java.io.IOException;\r\nimport java.sql.Connection;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.Properties;\r\n\r\n@Component\r\npublic class DataSourcePool {\r\n    private List dlockDataSources = new ArrayList();\r\n\r\n    @PostConstruct\r\n    private void initDataSourceList() throws IOException {\r\n        Properties properties = new Properties();\r\n        FileInputStream fis = new FileInputStream(\"db.properties\");\r\n        properties.load(fis);\r\n\r\n        Integer lockNum = Integer.valueOf(properties.getProperty(\"DLOCK_NUM\"));\r\n        for (int i = 0; i \"DLOCK_USER_\" + i);\r\n            String password = properties.getProperty(\"DLOCK_PASS_\" + i);\r\n            Integer initSize = Integer.valueOf(properties.getProperty(\"DLOCK_INIT_SIZE_\" + i));\r\n            Integer maxSize = Integer.valueOf(properties.getProperty(\"DLOCK_MAX_SIZE_\" + i));\r\n            String url = properties.getProperty(\"DLOCK_URL_\" + i);\r\n\r\n            DruidDataSource dataSource = createDataSource(user,password,initSize,maxSize,url);\r\n            dlockDataSources.add(dataSource);\r\n        }\r\n    }\r\n\r\n    private DruidDataSource createDataSource(String user, String password, Integer initSize, Integer maxSize, String url) {\r\n        DruidDataSource dataSource = new DruidDataSource();\r\n        dataSource.setDriverClassName(\"com.mysql.jdbc.Driver\");\r\n        dataSource.setUsername(user);\r\n        dataSource.setPassword(password);\r\n        dataSource.setUrl(url);\r\n        dataSource.setInitialSize(initSize);\r\n        dataSource.setMaxActive(maxSize);\r\n\r\n        return dataSource;\r\n    }\r\n\r\n    public Connection getConnection(String transactionId) throws Exception {\r\n        if (dlockDataSources.size() 0) {\r\n            return null;\r\n        }\r\n\r\n        if (transactionId == null || \"\".equals(transactionId)) {\r\n            throw new RuntimeException(\"transactionId是必须的\");\r\n        }\r\n\r\n        int hascode = transactionId.hashCode();\r\n        if (hascode 0) {\r\n            hascode = - hascode;\r\n        }\r\n\r\n        return dlockDataSources.get(hascode % dlockDataSources.size()).getConnection();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30206383253503-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30206383253503-64\">64</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dlock</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-2\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">alibaba</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">druid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DruidDataSource</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">springframework</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stereotype</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Component</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">javax</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">annotation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">PostConstruct</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-7\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FileInputStream</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-8\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">IOException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-9\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Connection</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-10\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-11\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-12\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Properties</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-14\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Component</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-15\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DataSourcePool</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">List </span><span class=\"crayon-v\">dlockDataSources</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ArrayList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">PostConstruct</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-19\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">initDataSourceList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Properties </span><span class=\"crayon-v\">properties</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Properties</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">FileInputStream </span><span class=\"crayon-v\">fis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FileInputStream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"db.properties\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lockNum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"DLOCK_NUM\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"DLOCK_USER_\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"DLOCK_PASS_\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"DLOCK_INIT_SIZE_\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"DLOCK_MAX_SIZE_\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getProperty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"DLOCK_URL_\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-30\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">DruidDataSource </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">createDataSource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">initSize</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">maxSize</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">dlockDataSources</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DruidDataSource </span><span class=\"crayon-e\">createDataSource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initSize</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxSize</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">DruidDataSource </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DruidDataSource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setDriverClassName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"com.mysql.jdbc.Driver\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setUsername</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setPassword</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setUrl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setInitialSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">initSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setMaxActive</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">maxSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-44\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataSource</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-e\">getConnection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dlockDataSources</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-50\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-52\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RuntimeException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"transactionId是必须的\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-56\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hascode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashCode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">hascode</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">hascode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hascode</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-61\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dlockDataSources</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hascode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dlockDataSources</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getConnection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30206383253503-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30206383253503-64\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0110 seconds] -->\r\n<p>首先编写一个<code>initDataSourceList</code>方法，并利用Spring的<code>PostConstruct</code>注解初始化一个<code>DataSource</code> 列表。相关的DB配置从<code>db.properties</code>读取。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c3020b262136216\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDLOCK_NUM=2\r\n\r\nDLOCK_USER_0=\"user1\"\r\nDLOCK_PASS_0=\"pass1\"\r\nDLOCK_INIT_SIZE_0=2\r\nDLOCK_MAX_SIZE_0=10\r\nDLOCK_URL_0=\"jdbc:mysql://localhost:3306/test1\"\r\n\r\nDLOCK_USER_1=\"user1\"\r\nDLOCK_PASS_1=\"pass1\"\r\nDLOCK_INIT_SIZE_1=2\r\nDLOCK_MAX_SIZE_1=10\r\nDLOCK_URL_1=\"jdbc:mysql://localhost:3306/test2\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020b262136216-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020b262136216-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020b262136216-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020b262136216-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020b262136216-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020b262136216-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020b262136216-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020b262136216-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020b262136216-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020b262136216-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020b262136216-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020b262136216-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020b262136216-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020b262136216-1\"><span class=\"crayon-v\">DLOCK_NUM</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020b262136216-2\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020b262136216-3\"><span class=\"crayon-v\">DLOCK_USER_0</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"user1\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020b262136216-4\"><span class=\"crayon-v\">DLOCK_PASS_0</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"pass1\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020b262136216-5\"><span class=\"crayon-v\">DLOCK_INIT_SIZE_0</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020b262136216-6\"><span class=\"crayon-v\">DLOCK_MAX_SIZE_0</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020b262136216-7\"><span class=\"crayon-v\">DLOCK_URL_0</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"jdbc:mysql://localhost:3306/test1\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020b262136216-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020b262136216-9\"><span class=\"crayon-v\">DLOCK_USER_1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"user1\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020b262136216-10\"><span class=\"crayon-v\">DLOCK_PASS_1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"pass1\"</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020b262136216-11\"><span class=\"crayon-v\">DLOCK_INIT_SIZE_1</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020b262136216-12\"><span class=\"crayon-v\">DLOCK_MAX_SIZE_1</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020b262136216-13\"><span class=\"crayon-v\">DLOCK_URL_1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"jdbc:mysql://localhost:3306/test2\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p><code>DataSource</code>使用阿里的<code>DruidDataSource</code>。</p>\n<p>接着最重要的一个实现<code>getConnection(String transactionId)</code>方法。实现原理很简单，获取<code>transactionId</code>的hashcode，并对<code>DataSource</code>的长度取模即可。</p>\n<p>连接池列表设计好后，就可以实现往<code>distributed_lock</code>表插入数据了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c3020e401195635\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage dlock;\r\n\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.stereotype.Component;\r\n\r\nimport java.sql.*;\r\n\r\n@Component\r\npublic class DistributedLock {\r\n\r\n    @Autowired\r\n    private DataSourcePool dataSourcePool;\r\n\r\n    /**\r\n     * 根据transactionId创建锁资源\r\n     */\r\n    public String createLock(String transactionId) throws Exception{\r\n        if (transactionId == null) {\r\n            throw new RuntimeException(\"transactionId是必须的\");\r\n        }\r\n        Connection connection = null;\r\n        Statement statement = null;\r\n        try {\r\n            connection = dataSourcePool.getConnection(transactionId);\r\n            connection.setAutoCommit(false);\r\n            statement = connection.createStatement();\r\n            statement.executeUpdate(\"INSERT INTO distributed_lock(transaction_id) VALUES ('\" + transactionId + \"')\");\r\n            connection.commit();\r\n            return transactionId;\r\n        }\r\n        catch (SQLIntegrityConstraintViolationException icv) {\r\n            //说明已经生成过了。\r\n            if (connection != null) {\r\n                connection.rollback();\r\n            }\r\n            return transactionId;\r\n        }\r\n        catch (Exception e) {\r\n            if (connection != null) {\r\n                connection.rollback();\r\n            }\r\n            throw  e;\r\n        }\r\n        finally {\r\n            if (statement != null) {\r\n                statement.close();\r\n            }\r\n\r\n            if (connection != null) {\r\n                connection.close();\r\n            }\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3020e401195635-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3020e401195635-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dlock</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-2\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">springframework</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">beans</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">annotation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Autowired</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">springframework</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stereotype</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Component</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-8\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Component</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-9\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DistributedLock</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-10\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Autowired</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-12\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DataSourcePool </span><span class=\"crayon-v\">dataSourcePool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-15\"><span class=\"crayon-c\">     * 根据transactionId创建锁资源</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-16\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">createLock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RuntimeException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"transactionId是必须的\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Statement </span><span class=\"crayon-v\">statement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataSourcePool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getConnection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setAutoCommit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">statement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createStatement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">statement</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">executeUpdate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"INSERT INTO distributed_lock(transaction_id) VALUES ('\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"')\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SQLIntegrityConstraintViolationException </span><span class=\"crayon-v\">icv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//说明已经生成过了。</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rollback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rollback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">statement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-46\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">statement</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-48\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-50\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3020e401195635-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3020e401195635-54\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0062 seconds] -->\r\n<p></p>\n<h3>根据transactionId锁住线程</h3>\n<p>接下来利用DB的<code>select for update</code>特性来锁住线程。当多个线程根据相同的<code>transactionId</code>并发同时操作<code>select for update</code>的时候，只有一个线程能成功，其他线程都<code>block</code>住，直到<code>select for update</code>成功的线程使用<code>commit</code>操作后，<code>block</code>住的所有线程的其中一个线程才能开始干活。我们在上面的<code>DistributedLock</code>类中创建一个<code>lock</code>方法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c30213377644588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n public boolean lock(String transactionId) throws Exception {\r\n        Connection connection = null;\r\n        PreparedStatement preparedStatement = null;\r\n        ResultSet resultSet = null;\r\n        try {\r\n            connection = dataSourcePool.getConnection(transactionId);\r\n            preparedStatement = connection.prepareStatement(\"SELECT * FROM distributed_lock WHERE transaction_id = ? FOR UPDATE \");\r\n            preparedStatement.setString(1,transactionId);\r\n            resultSet = preparedStatement.executeQuery();\r\n            if (!resultSet.next()) {\r\n                connection.rollback();\r\n                return false;\r\n            }\r\n            return true;\r\n        } catch (Exception e) {\r\n            if (connection != null) {\r\n                connection.rollback();\r\n            }\r\n            throw  e;\r\n        }\r\n        finally {\r\n            if (preparedStatement != null) {\r\n                preparedStatement.close();\r\n            }\r\n\r\n            if (resultSet != null) {\r\n                resultSet.close();\r\n            }\r\n\r\n            if (connection != null) {\r\n                connection.close();\r\n            }\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30213377644588-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c30213377644588-34\">34</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">PreparedStatement </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ResultSet </span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataSourcePool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getConnection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">prepareStatement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SELECT * FROM distributed_lock WHERE transaction_id = ? FOR UPDATE \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">executeQuery</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rollback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rollback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c30213377644588-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c30213377644588-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p></p>\n<h3>实现解锁操作</h3>\n<p>当线程执行完任务后，必须手动的执行解锁操作，之前被锁住的线程才能继续干活。在我们上面的实现中，其实就是获取到当时<code>select for update</code>成功的线程对应的<code>Connection</code>，并实行<code>commit</code>操作即可。</p>\n<p>那么如何获取到呢？我们可以利用<code>ThreadLocal</code>。首先在<code>DistributedLock</code>类中定义</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c30217872149012\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprivate ThreadLocal threadLocalConn = new ThreadLocal();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c30217872149012-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c30217872149012-1\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ThreadLocal </span><span class=\"crayon-v\">threadLocalConn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ThreadLocal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>每次调用<code>lock</code>方法的时候，把<code>Connection</code>放置到<code>ThreadLocal</code>里面。我们修改<code>lock</code>方法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c3021a634211180\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n public boolean lock(String transactionId) throws Exception {\r\n        Connection connection = null;\r\n        PreparedStatement preparedStatement = null;\r\n        ResultSet resultSet = null;\r\n        try {\r\n            connection = dataSourcePool.getConnection(transactionId);\r\n            threadLocalConn.set(connection);\r\n            preparedStatement = connection.prepareStatement(\"SELECT * FROM distributed_lock WHERE transaction_id = ? FOR UPDATE \");\r\n            preparedStatement.setString(1,transactionId);\r\n            resultSet = preparedStatement.executeQuery();\r\n            if (!resultSet.next()) {\r\n                connection.rollback();\r\n                threadLocalConn.remove();\r\n                return false;\r\n            }\r\n            return true;\r\n        } catch (Exception e) {\r\n            if (connection != null) {\r\n                connection.rollback();\r\n                threadLocalConn.remove();\r\n            }\r\n            throw  e;\r\n        }\r\n        finally {\r\n            if (preparedStatement != null) {\r\n                preparedStatement.close();\r\n            }\r\n\r\n            if (resultSet != null) {\r\n                resultSet.close();\r\n            }\r\n\r\n            if (connection != null) {\r\n                connection.close();\r\n            }\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021a634211180-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021a634211180-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">PreparedStatement </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ResultSet </span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataSourcePool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getConnection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">threadLocalConn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">prepareStatement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SELECT * FROM distributed_lock WHERE transaction_id = ? FOR UPDATE \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">transactionId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">executeQuery</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rollback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">threadLocalConn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-19\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rollback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-20\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">threadLocalConn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-26\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">preparedStatement</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-28\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">resultSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-32\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021a634211180-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021a634211180-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>这样子，当获取到<code>Connection</code>后，将其设置到<code>ThreadLocal</code>中，如果<code>lock</code>方法出现异常，则将其从<code>ThreadLocal</code>中移除掉。</p>\n<p>有了这几步后，我们可以来实现解锁操作了。我们在<code>DistributedLock</code>添加一个<code>unlock</code>方法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26a9c3021e030698100\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n public void unlock() throws Exception {\r\n        Connection connection = null;\r\n        try {\r\n            connection = threadLocalConn.get();\r\n            if (!connection.isClosed()) {\r\n                connection.commit();\r\n                connection.close();\r\n                threadLocalConn.remove();\r\n            }\r\n        } catch (Exception e) {\r\n            if (connection != null) {\r\n                connection.rollback();\r\n                connection.close();\r\n            }\r\n            threadLocalConn.remove();\r\n            throw e;\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae26a9c3021e030698100-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26a9c3021e030698100-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threadLocalConn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isClosed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-6\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">threadLocalConn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rollback</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">threadLocalConn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae26a9c3021e030698100-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26a9c3021e030698100-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p></p>\n<h3>缺点</h3>\n<p>毕竟是利用DB来实现分布式锁，对DB还是造成一定的压力。当时考虑使用DB做分布式的一个重要原因是，我们的应用是后端应用，平时流量不大的，反而关键的是要保证库存数据的正确性。对于像前端库存系统，比如添加购物车占用库存等操作，最好别使用DB来实现分布式锁了。</p>\n<h3>进一步思考</h3>\n<p>如果想锁住多份数据该怎么实现？比如说，某个库存操作，既要修改物理库存，又要修改虚拟库存，想锁住物理库存的同时，又锁住虚拟库存。其实也不是很难，参考<code>lock</code>方法，写一个<code>multiLock</code>方法，提供多个<code>transactionId</code>的入参，for循环处理就可以了。这个后续有时间再补上。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/54f7206fd1f1907bec78ddf32f50d66d.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113707\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113707votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113707\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">Sam哥哥</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/3660a090181b2b6ae3bd8c07d393aa36.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网技术爱好者，目前就职于广州唯品会担任JAVA高级开发。个人的csdn技术博客如下：http://blog.csdn.net/linsongbin1本人伯乐在线的文章，都出自这个csdn博客        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/sam-2/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/Sam%E5%93%A5%E5%93%A5/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/cd53a2302bc0852583e1e611cf280b011948f392.jpg"},{"url_object_id": "44f879688ac007f05bd74cdf86522e39", "title": "给 rm 命令添加个「垃圾桶」", "url": "http://blog.jobbole.com/113737/", "create_date": "2018/03/11", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 3, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.2daygeek.com/rm-command-to-move-files-to-trash-can-rm-alias/\">2daygeek</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9425-1.html\">Linux中国/amwps290</a>   </div><p>人类犯错误是因为我们不是一个可编程设备，所以，在使用 <code>rm</code> 命令时要额外注意，不要在任何时候使用 <code>rm -rf *</code>。当你使用 <code>rm</code> 命令时，它会永久删除文件，不会像文件管理器那样将这些文件移动到 “垃圾箱”。</p>\n<p>有时我们会将不应该删除的文件删除掉，所以当错误地删除了文件时该怎么办？ 你必须看看恢复工具（Linux 中有很多数据恢复工具），但我们不知道是否能将它百分之百恢复，所以要如何解决这个问题？</p>\n<p>我们最近发表了一篇关于 <a href=\"https://www.2daygeek.com/trash-cli-command-line-trashcan-linux-system/\">Trash-Cli</a> 的文章，在评论部分，我们从用户 Eemil Lgz 那里获得了一个关于 <a href=\"https://github.com/lagerspetz/linux-stuff/blob/master/scripts/saferm.sh\">saferm.sh</a> 脚本的更新，它可以帮助我们将文件移动到“垃圾箱”而不是永久删除它们。</p>\n<p>将文件移动到“垃圾桶”是一个好主意，当你无意中运行 <code>rm</code> 命令时，可以拯救你；但是很少有人会说这是一个坏习惯，如果你不注意“垃圾桶”，它可能会在一定的时间内被文件和文件夹堆积起来。在这种情况下，我建议你按照你的意愿去做一个定时任务。</p>\n<p>这适用于服务器和桌面两种环境。 如果脚本检测到 GNOME 、KDE、Unity 或 LXDE 桌面环境（DE），则它将文件或文件夹安全地移动到默认垃圾箱 <code>$HOME/.local/share/Trash/files</code>，否则会在您的主目录中创建垃圾箱文件夹 <code>$HOME/Trash</code>。</p>\n<p><code>saferm.sh</code> 脚本托管在 Github 中，可以从仓库中克隆，也可以创建一个名为 <code>saferm.sh</code> 的文件并复制其上的代码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26b647d4af666491715\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git clone https://github.com/lagerspetz/linux-stuff\r\n$ sudo mv linux-stuff/scripts/saferm.sh /bin\r\n$ rm -Rf linux-stuff\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4af666491715-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4af666491715-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4af666491715-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4af666491715-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26b647d4af666491715-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/lagerspetz/linux-stuff</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4af666491715-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">linux</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">stuff</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">scripts</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">bin</span></div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4af666491715-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Rf </span><span class=\"crayon-v\">linux</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">stuff</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4af666491715-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在 <code>.bashrc</code> 文件中设置别名，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26b647d4b8159479617\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalias rm=saferm.sh\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4b8159479617-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4b8159479617-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26b647d4b8159479617-1\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">rm</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4b8159479617-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>执行下面的命令使其生效，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26b647d4bc145682514\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ source ~/.bashrc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4bc145682514-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4bc145682514-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26b647d4bc145682514-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4bc145682514-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>一切就绪，现在你可以执行 <code>rm</code> 命令，自动将文件移动到”垃圾桶”，而不是永久删除它们。</p>\n<p>测试一下，我们将删除一个名为 <code>magi.txt</code> 的文件，命令行明确的提醒了 <code>Moving magi.txt to $HOME/.local/share/Trash/file</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26b647d4c0300952660\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ rm -rf magi.txt\r\nMoving magi.txt to /home/magi/.local/share/Trash/files\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c0300952660-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c0300952660-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c0300952660-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c0300952660-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">rf </span><span class=\"crayon-v\">magi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c0300952660-2\"><span class=\"crayon-e\">Moving </span><span class=\"crayon-v\">magi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magi</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Trash</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">files</span></div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c0300952660-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>也可以通过 <code>ls</code> 命令或 <code>trash-cli</code> 进行验证。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26b647d4c3918404718\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls -lh /home/magi/.local/share/Trash/files\r\nPermissions Size User Date Modified Name\r\n.rw-r--r-- 32 magi 11 Oct 16:24 magi.txt    \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c3918404718-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c3918404718-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c3918404718-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c3918404718-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c3918404718-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magi</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Trash</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">files</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c3918404718-2\"><span class=\"crayon-e\">Permissions </span><span class=\"crayon-e\">Size </span><span class=\"crayon-e\">User </span><span class=\"crayon-e\">Date </span><span class=\"crayon-e\">Modified </span><span class=\"crayon-i\">Name</span></div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c3918404718-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">magi</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Oct</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">magi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c3918404718-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>或者我们可以通过文件管理器界面中查看相同的内容。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/a21377f62f1d9e9057d4bd7380a6acf7.png\" alt=\"![][3]\"></p>\n<p>（LCTT 译注：原文此处混淆了部分 trash-cli 的内容，考虑到文章衔接和逻辑，此处略。）</p>\n<p>要了解 <code>saferm.sh</code> 的其他选项，请查看帮助。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae26b647d4c7188798453\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ saferm.sh -h\r\nThis is saferm.sh 1.16. LXDE and Gnome3 detection.\r\nWill ask to unsafe-delete instead of cross-fs move. Allows unsafe (regular rm) delete (ignores trashinfo).\r\nCreates trash and trashinfo directories if they do not exist. Handles symbolic link deletion.\r\nDoes not complain about different user any more.\r\n\r\nUsage: /path/to/saferm.sh [OPTIONS] [--] files and dirs to safely remove\r\nOPTIONS:\r\n-r      allows recursively removing directories.\r\n-f      Allow deleting special files (devices, ...).\r\n-u      Unsafe mode, bypass trash and delete files permanently.\r\n-v      Verbose, prints more messages. Default in this version.\r\n-q      Quiet mode. Opposite of verbose.\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c7188798453-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c7188798453-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c7188798453-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c7188798453-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c7188798453-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c7188798453-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c7188798453-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c7188798453-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c7188798453-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c7188798453-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c7188798453-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c7188798453-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c7188798453-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae26b647d4c7188798453-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae26b647d4c7188798453-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c7188798453-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c7188798453-2\"><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.16.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LXDE </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Gnome3 </span><span class=\"crayon-v\">detection</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c7188798453-3\"><span class=\"crayon-e\">Will </span><span class=\"crayon-e\">ask </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unsafe</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">instead </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">cross</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">fs </span><span class=\"crayon-v\">move</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Allows </span><span class=\"crayon-e\">unsafe</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">regular </span><span class=\"crayon-v\">rm</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">ignores </span><span class=\"crayon-v\">trashinfo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c7188798453-4\"><span class=\"crayon-e\">Creates </span><span class=\"crayon-e\">trash </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trashinfo </span><span class=\"crayon-e\">directories </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">they </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exist</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Handles </span><span class=\"crayon-e\">symbolic </span><span class=\"crayon-e\">link </span><span class=\"crayon-v\">deletion</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c7188798453-5\"><span class=\"crayon-e\">Does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">complain </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">different </span><span class=\"crayon-e\">user </span><span class=\"crayon-e\">any </span><span class=\"crayon-v\">more</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c7188798453-6\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c7188798453-7\"><span class=\"crayon-v\">Usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTIONS</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">files </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dirs </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">safely </span><span class=\"crayon-e\">remove</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c7188798453-8\"><span class=\"crayon-v\">OPTIONS</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c7188798453-9\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">allows </span><span class=\"crayon-e\">recursively </span><span class=\"crayon-e\">removing </span><span class=\"crayon-v\">directories</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c7188798453-10\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Allow </span><span class=\"crayon-e\">deleting </span><span class=\"crayon-e\">special </span><span class=\"crayon-e\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">devices</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c7188798453-11\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Unsafe </span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bypass </span><span class=\"crayon-e\">trash </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">files </span><span class=\"crayon-v\">permanently</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c7188798453-12\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Verbose</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">prints </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">version</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c7188798453-13\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">q</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Quiet </span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Opposite </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">verbose</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae26b647d4c7188798453-14\"> </div><div class=\"crayon-line\" id=\"crayon-5ae26b647d4c7188798453-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0072 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113737\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113737votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113737\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"},{"url_object_id": "346c3258b4b9bfbca9483337a14be393", "title": "我从 1000 份代码审查中学到了什么", "url": "http://blog.jobbole.com/113741/", "create_date": "2018/03/12", "front_image_url": ["http://wx3.sinaimg.cn/mw690/63918611gy1fpaca90vycj218g0tmtek.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Code Review,代码审查", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://hackernoon.com/what-i-learned-from-doing-1000-code-reviews-fe28d4d11c71\">Steven Heidel</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我看到有些建议不断重复出现，所以我决定整理一个清单，与诸位分享。</p>\n<p id=\"ec28\" class=\"graf graf--p graf-after--p\">这是我的 3（额外 +1）个最常见的代码审查建议。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fpaca90vycj218g0tmtek.jpg\" width=\"690\" height=\"460\"></p>\n<h3 id=\"1d0b\" class=\"graf graf--p graf-after--figure\"><strong>建议1：出错时抛出异常</strong></h3>\n<p id=\"9787\" class=\"graf graf--p graf-after--p\">我见过的一个常见模式是：</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2506355a44180890489\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nList&lt;String&gt; getSearchResults(...) {\r\n  try {\r\n    List&lt;String&gt; results = // make REST call to search service\r\n    return results;\r\n  } catch (RemoteInvocationException e) {\r\n    return Collections.emptyList();\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a44180890489-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a44180890489-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a44180890489-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a44180890489-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a44180890489-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a44180890489-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a44180890489-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a44180890489-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2506355a44180890489-1\"><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSearchResults</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a44180890489-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a44180890489-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// make REST call to search service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a44180890489-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a44180890489-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RemoteInvocationException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a44180890489-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Collections</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">emptyList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a44180890489-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a44180890489-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0056 seconds] -->\r\n<p>这种模式实际上导致了我做的移动应用程序崩溃，我们当时使用的搜索后端开始抛出异常。而应用程序的 API 服务器中也有一些类似的代码。从应用程序的角度来看，它成功获取了 200 个响应，只是每个搜索请求返回的是空列表。</p>\n<p id=\"addb\" class=\"graf graf--p graf-after--p\">如果当时 API 直接抛出异常，那么我们的监控系统就会立即检测到并修复它。</p>\n<p id=\"de7a\" class=\"graf graf--p graf-after--p\">很多时候，当你捕获一个异常时，你会希望它返回一个空对象。Java 中的空对象包括 Optional.empty()、null 和空列表，而它们在 URL 解析中经常出现。如果 URL 不能从一个字符串中正确解析时，先不要返回 null，而是停下来问问自己：“为什么 URL 格式不正确？这不是我们应该在上游解决的数据问题吗？”</p>\n<p id=\"3b2d\" class=\"graf graf--p graf-after--p\">空对象不是解决此类问题的合适工具。<strong>如果有异常，你应该（及时）抛出它。</strong></p>\n<h3 id=\"9dac\" class=\"graf graf--p graf-after--p\"><strong>建议2：使用尽可能具体的类型</strong></h3>\n<p id=\"42d5\" class=\"graf graf--p graf-after--p\">这个建议基本上与<a class=\"markup--anchor markup--p-anchor\" href=\"http://wiki.c2.com/?StringlyTyped\" target=\"_blank\" rel=\"noopener\">字符串类型编程</a>相反。</p>\n<p id=\"11ce\" class=\"graf graf--p graf-after--p\">我经常看到类似这样的代码：</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2506355a4e526872523\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvoid doOperation(String opType, Data data); \r\n// where opType is \"insert\", \"append\", or \"delete\", this should have clearly been an enum\r\n\r\nString fetchWebsite(String url);\r\n// where url is \"https://google.com\", this should have been an URN\r\n\r\nString parseId(Input input);\r\n// the return type is String but ids are actually Longs like \"6345789\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a4e526872523-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a4e526872523-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a4e526872523-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a4e526872523-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a4e526872523-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a4e526872523-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a4e526872523-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a4e526872523-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2506355a4e526872523-1\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doOperation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opType</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Data </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a4e526872523-2\"><span class=\"crayon-c\">// where opType is \"insert\", \"append\", or \"delete\", this should have clearly been an enum</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a4e526872523-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a4e526872523-4\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fetchWebsite</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a4e526872523-5\"><span class=\"crayon-c\">// where url is \"https://google.com\", this should have been an URN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a4e526872523-6\"> </div><div class=\"crayon-line\" id=\"crayon-5ae2506355a4e526872523-7\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parseId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Input </span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a4e526872523-8\"><span class=\"crayon-c\">// the return type is String but ids are actually Longs like \"6345789\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>尽可能具体的类型可以让你避免整个类的错误，这基本上是大家选择强类型语言（如 Java）的原因。</p>\n<p id=\"ebee\" class=\"graf graf--p graf-after--p\">所以现在的问题是：那些想要写强类型语言的程序员，最终是怎么写出糟糕的字符串类型的代码哪？答案是：因为外部世界不是强类型的。字符串通常来自许多不同的地方，比如：</p>\n<ul class=\"postList\">\n<li class=\"graf graf--li graf-after--li\">url 中的请求和路径参数</li>\n<li class=\"graf graf--li graf-after--li\">JSON</li>\n<li class=\"graf graf--li graf-after--li\">不支持枚举的数据库</li>\n<li class=\"graf graf--li graf-after--li\">写得很差的库</li>\n</ul>\n<p id=\"bce9\" class=\"graf graf--p graf-after--li\">这些情况下，你应该使用以下策略来避免这个问题：<strong>将字符串解析和序列化保持到程序边缘</strong>。这是一个例子：</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2506355a55317709157\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Step 1: Take a query param representing a company name / member id pair and parse it\r\n// example: context=Pair(linkedin,456)\r\nPair&lt;String, Long&gt; companyMember = parseQueryParam(\"context\");\r\n// this should throw an exception if malformed\r\n\r\n// Step 2: Do all the stuff in your application\r\n// MOST if not all of your code should live in this area\r\n\r\n// Step 3: Convert the parameter back into a String at the very end if necessary\r\nString redirectLink = serializeQueryParam(\"context\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a55317709157-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a55317709157-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a55317709157-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a55317709157-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a55317709157-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a55317709157-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a55317709157-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a55317709157-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a55317709157-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a55317709157-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2506355a55317709157-1\"><span class=\"crayon-c\">// Step 1: Take a query param representing a company name / member id pair and parse it</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a55317709157-2\"><span class=\"crayon-c\">// example: context=Pair(linkedin,456)</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a55317709157-3\"><span class=\"crayon-v\">Pair</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">companyMember</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parseQueryParam</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"context\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a55317709157-4\"><span class=\"crayon-c\">// this should throw an exception if malformed</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a55317709157-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a55317709157-6\"><span class=\"crayon-c\">// Step 2: Do all the stuff in your application</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a55317709157-7\"><span class=\"crayon-c\">// MOST if not all of your code should live in this area</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a55317709157-8\"> </div><div class=\"crayon-line\" id=\"crayon-5ae2506355a55317709157-9\"><span class=\"crayon-c\">// Step 3: Convert the parameter back into a String at the very end if necessary</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a55317709157-10\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redirectLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">serializeQueryParam</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"context\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>它带给我们许多好处：1、能够立刻发现格式不正确的数据；如果有任何问题，应用程序会提前显示并终止。2、一旦数据通过验证，你不必在整个应用程序中捕获解析异常。3、强类型使得签名具有更多信息，这样你就无需在每个方法上写 javadoc。</p>\n<h3 id=\"3981\" class=\"graf graf--p graf-after--p\"><strong>建议3：使用 Optionals 而不是 null</strong></h3>\n<p id=\"8e2f\" class=\"graf graf--p graf-after--p\"><code class=\"markup--code markup--p-code\">Optional</code>（可选）类是 Java 8 中最好的特性之一，它表示一个可以合理存在或不存在的实体。</p>\n<p id=\"d2f2\" class=\"graf graf--p graf-after--p\">问题时间：唯一用缩写来指代的异常是什么？答：NPE （Null Pointer Exception，空指针异常）。这是迄今为止 Java 中最常见的异常，被称为<a class=\"markup--anchor markup--p-anchor\" href=\"https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare\" target=\"_blank\" rel=\"noopener\">十亿美元的错误</a>。</p>\n<p id=\"2a55\" class=\"graf graf--p graf-after--p\"><code class=\"markup--code markup--p-code\">Optional</code> 允许你从程序中完全删除 NPE。但是，你必须正确地使用它。这里有一些关于如何使用 <code class=\"markup--code markup--p-code\">Optional</code> 的建议：</p>\n<ul class=\"postList\">\n<li id=\"aa71\" class=\"graf graf--li graf-after--p\">你不应该在任何时候随意调用 <code class=\"markup--code markup--li-code\">.get()</code>，而应仔细考虑 <code class=\"markup--code markup--li-code\">Optional</code> 不存在的情况，并给出合理的默认值。</li>\n<li id=\"b536\" class=\"graf graf--li graf-after--li\">如果你还没有一个合理的默认值，那么像 <code class=\"markup--code markup--li-code\">.map()</code> 和 <code class=\"markup--code markup--li-code\">.flatMap()</code> 这样的方法，可以让你晚点做这个决定。</li>\n<li id=\"c520\" class=\"graf graf--li graf-after--li\">如果外部库返回 <code class=\"markup--code markup--li-code\">null</code> 来表示空值，则立即使用 <code class=\"markup--code markup--li-code\">Optional.ofNullable()</code> 以封装它。相信我，以后你会感谢自己的。在程序内部，null 有往上“冒泡”的倾向，所以还是最好从源头上阻止它们。</li>\n<li id=\"4a95\" class=\"graf graf--li graf-after--li\">在返回类型的方法中使用 <code class=\"markup--code markup--li-code\">Optional</code>。这样做可以让你不用阅读 javadoc 就可以获知，值是否可能不存在。</li>\n</ul>\n<h3 id=\"573f\" class=\"graf graf--p graf-after--li\"><strong>额外建议：尽可能使用“Unlift”方法</strong></h3>\n<p id=\"1873\" class=\"graf graf--p graf-after--p\">你应该尽量避免类似的方法：</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ae2506355a5b243771972\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// AVOID:\r\nCompletableFuture&lt;T&gt; method(CompletableFuture&lt;S&gt; param);\r\n// PREFER: \r\nT method(S param);\r\n\r\n// AVOID:\r\nList&lt;T&gt; method(List&lt;S&gt; param);\r\n// PREFER:\r\nT method(S param);\r\n\r\n// AVOID: \r\nT method(A param1, B param2, Optional&lt;C&gt; param3);\r\n// PREFER:\r\nT method(A param1, B param2, C param3);\r\nT method(A param1, B param2);\r\n// This method is clearly doing two things, it should be two methods\r\n// The same is true for boolean parameters</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a5b243771972-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a5b243771972-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a5b243771972-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a5b243771972-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a5b243771972-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a5b243771972-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a5b243771972-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ae2506355a5b243771972-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ae2506355a5b243771972-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-1\"><span class=\"crayon-c\">// AVOID:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a5b243771972-2\"><span class=\"crayon-v\">CompletableFuture</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">method</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CompletableFuture</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">S</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-3\"><span class=\"crayon-c\">// PREFER: </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a5b243771972-4\"><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">method</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a5b243771972-6\"><span class=\"crayon-c\">// AVOID:</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-7\"><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">method</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">S</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a5b243771972-8\"><span class=\"crayon-c\">// PREFER:</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-9\"><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">method</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a5b243771972-10\"> </div><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-11\"><span class=\"crayon-c\">// AVOID: </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a5b243771972-12\"><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">method</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Optional</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">C</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-13\"><span class=\"crayon-c\">// PREFER:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a5b243771972-14\"><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">method</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-15\"><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">method</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ae2506355a5b243771972-16\"><span class=\"crayon-c\">// This method is clearly doing two things, it should be two methods</span></div><div class=\"crayon-line\" id=\"crayon-5ae2506355a5b243771972-17\"><span class=\"crayon-c\">// The same is true for boolean parameters</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>所有要避免的方法有什么共同点？他们都使用容器对象，比如 Optional，List 或 Task 作为方法的参数。当返回类型是同一类型的容器（即，一个参数的方法采用 Optional 并返回一个 Optional），情况会变得更糟糕。</p>\n<p id=\"3eb8\" class=\"graf graf--p graf-after--p\">为什么？</p>\n<p>相比 ① <code class=\"markup--code markup--p-code\">Promise&lt;A&gt; method(Promise&lt;B&gt; param)</code>，② <code class=\"markup--code markup--p-code\">A method(B param) </code>更具有灵活性。</p>\n<p>如果你有 <code class=\"markup--code markup--p-code\">Promise&lt;B&gt;</code>，那么你可以使用 ①，也可以通过  <code class=\"markup--code markup--p-code\">.map</code> 函数“提升（lifting）” （比如 <code class=\"markup--code markup--p-code\">promise.map(method)</code>）来使用 ②.</p>\n<p>但是，如果你只有 B，那么你可以很容易地使用 ②，却不能使用 ①，很明显，② 是一个更灵活的选择。</p>\n<p>我喜欢称之为“Unlift”，因为它与普通函数的实用方法“Lift”恰好相反。应用这些重写能使方法更灵活，调用更轻松。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113741\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113741votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113741\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 50</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/72fd692cdd9ccd44d3da74f6eda1119635b48c27.jpg"}